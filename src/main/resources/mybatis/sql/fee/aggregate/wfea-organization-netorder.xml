<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.fee.aggregate.mapper.WfeaOrganizationNetOrderMapper">

    <delete id="deleteBsPerformances">
        SELECT *
        FROM DUAL
    </delete>

    <insert id="insertBsPerformances">
        SELECT *
        FROM DUAL
    </insert>

    <select id='selectHomeMasters'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchHmstRes">
        SELECT M.OG2_NM    /* 지역단 */
             , M.OG3_NM    /* 지점 */
             , M.PRTNR_NO  /* 번호 */
             , M.PRTNR_KNM /* 성명 */
             , M.GUBN      /* 판매유형 */
             , M.PRDT_TYPE /* 제품유형 */
             , '' AS LCFLG0    /* 가격유형 임시 */
             , M.LCFLG1    /* 기변유형 */
             , M.CNTR_NO   /* 계약상세번호 */
             , M.LCCGUB    /* 고객구분 */
             , M.PD_NM     /* 상품명 */
             , M.PD_CD     /* 상품코드 */
             , M.LCIUSE    /* 용도*/
             , M.LCETC3    /* 할인구분*/
             , M.LCETC4    /* 할인유형*/
             , M.LCST11    /* 할인제도 */
             , M.LCST04    /* 결합구분 */
             , M.FNL_VAL   /* 입금실적 */
             , M.LCMONT    /* 할부 */
             , '' AS LCMONT2    /* 할인 임시 */
             , M.LCGUB3	   /* 약정개월 */
             , M.LCVMON    /* 관리주기*/
             , M.LCPAMT    /* 인정실적금액 */
             , M.LCBAMT	   /* 기준가격 */
             , M.LCTAMT	   /* 홈케어 */
             , M.LCGUB1	   /* 홈케어멤버십3년 */
             , M.LCST13    /* 정액여부 */
             , M.LEASE_YN  /* 금융리스 */
             , M.LCPCNT	   /* 인정건수*/
             , M.RCNT_YN   /* 재약정여부 */
             , M.LCCRTT	   /* 계약일자*/
             , M.LCSLET	   /* 매출일자 */
             , M.LCCANT    /* 취소일자*/
             , M.AKDBON	   /* 지점장번호 */
             , M.AKDBNM	   /* 지점장성명 */
             , M.LCAMT1	   /* 렌탈료*/
             , M.LCCK02	   /* 프로모션번호 */
             , M.LCGSEQ	   /* 패키지 일련번호 */
             , CASE WHEN NVL(MM.BASE_YM,0) = 0 THEN '' ELSE MM.BASE_YM END AS LCPAYM  /*수수료실적월*/
          FROM ( /* 할부 */
                 SELECT C.DGR2_LEVL_OG_NM AS OG2_NM  /* 지역단 */
                      , C.DGR3_LEVL_OG_NM AS OG3_NM  /* 지점 */
                      , A.PRTNR_NO  /* 번호 */
                      , B.PRTNR_KNM  /* 성명 */
                      , '할부' AS GUBN /* 판매유형 */
                      , CASE WHEN D.SELL_TP_DTL_CD = '12' THEN '홈케어'
                             WHEN D.SELL_TP_DTL_CD = '13' THEN '환경가전'
                             ELSE '환경가전외'
                        END AS PRDT_TYPE  /* 제품유형 */
                      , '' AS LCFLG1  /* 기변유형 */
                      , A.CNTR_NO    /* 계약상세번호 */
                      , A.CNTR_SN
                      , CASE WHEN A.LCCGUB = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 */
                      , D.PD_NM     /* 상품명 */
                      , D.PD_CD     /* 상품코드 */
                      , '' AS LCIUSE  /* 용도 현재없음 임시처리 */
                      , A.LCETC3  /* 할인구분 */
                      , A.LCETC4  /* 할인유형 */
                      , '' AS LCST11 /* 할인제도 */
                      , '' AS LCST04     /* 결합구분 */
                      , E.FNL_VAL  /* 입금실적 */
                      , A.LCMONT   /* 할부 */
                      , A.LCBAMT	  /* 기준가격 */
                      , A.LCTAMT	  /* 홈케어 */
                      , '' AS LCGUB1	/* 홈케어멤버십3년 */
                      , A.LCST13 /* 정액여부 */
                      , '' AS 	LEASE_YN	/* 금융리스 */
                      , A.LCPCNT	AS LCPCNT	/* 인정건수*/
                      , '' AS 	RCNT_YN	/* 재약정여부 */
                      , A.LCCRTT	            /* 계약일자*/
                      , A.LCSLET	/* 매출일자 */
                      , A.LCCANT 	/* 취소일자*/
                      , C.DGR3_LEVL_DG_PRTNR_NO AS AKDBON	/* 지점장번호 */
                      , C.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM	/* 지점장성명 */
                      , '렌탈료' AS LCAMT1	/* 렌탈료 미정 임시처리*/
                      , 0 AS 	LCGUB3	/* 약정기간 */
                      , A.LCVMON /* 관리주기 미정 임시처리*/
                      , A.LCPAMT   /* 인정실적금액 */
                      , '0' AS 	LCCK02	/* 프로모션번호 */
                      , '' AS 	LCGSEQ	/* 패키지 일련번호 */
                   FROM TB_OGBS_MM_PRTNR_IZ B  /* 월파트너 */
                  INNER JOIN TB_OGBS_MM_OG_IZ C  /* 월조직 */
                     ON B.BASE_YM = C.BASE_YM
                    AND B.OG_ID = C.OG_ID
                  INNER JOIN ( SELECT CD.CNTR_NO
                                    , CD.CNTR_SN
                                    , CB.SELL_PRTNR_NO AS PRTNR_NO
                                    , CB.SELL_OG_TP_CD AS OG_TP_CD
                                    , CB.CNTR_CST_NO AS CST_NO
                                    , CB.COPN_DV_CD AS LCCGUB
                                    , CD.BASE_PD_CD AS PD_CD
                                    , CD.ISTM_MCN AS LCMONT
                                    , CD.ACKMT_PERF_AMT AS LCPAMT
                                    , CD.FEE_ACKMT_BASE_AMT AS LCBAMT
                                    , CD.SELL_AMT AS LCTAMT
                                    , CD.FEE_FXAM_YN AS LCST13
                                    , CD.FEE_ACKMT_CT AS LCPCNT
                                    , CD.CNTR_PD_ENDDT AS LCCANT
                                    , CD.SV_PRD AS LCVMON
                                    , CB.CNTR_CNFM_DTM AS LCCRTT
                                    , CD.CNTR_PD_STRTDT AS LCSLET
                                    , CD.STPL_PTRM
                                    , CD.SELL_DSC_TP_CD AS LCETC4
                                    , CD.SELL_DSC_DV_CD AS LCETC3
                                 FROM TB_SSCT_CNTR_BAS CB
                                INNER JOIN TB_SSCT_CNTR_DTL CD
                                   ON CB.CNTR_NO = CD.CNTR_NO
                                  AND CD.SELL_TP_CD = '1'  /* 일시불/할부 */
                             <if test="schPdctTp == '02'">
                                  AND CD.SELL_TP_DTL_CD = '13'  /* 환경가전  */
                             </if>
                             <if test="schPdctTp == '03'">
                                  AND CD.SELL_TP_DTL_CD != '13'  /* 환경가전외  */
                             </if>
                             <if test="schPdctTp == '04'">
                                  AND CD.SELL_TP_DTL_CD = '12'  /* 홈케어  */
                             </if>
                             <if test="schPdctTp == '05'">
                                  AND 1 != 1  /* 정기배송  */
                             </if>
                             <if test="schDv == '01'">
                                  AND CD.BOO_SELL_TP_CD = '2'
                                INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                   ON CD.CNTR_NO = SC.CNTR_NO
                                  AND CD.CNTR_SN = SC.CNTR_SN
                                  AND SC.SL_RCOG_DT BETWEEN #{schSlDtStrt} AND #{schSlDtEnd}  /* 매출 확정일자 */
                                WHERE CB.SELL_OG_TP_CD	= 'W03'
                                <if test="schRcpDtStrt != null and schRcpDtStrt != ''">
                                  AND CB.CNTR_RCP_FSH_DTM &gt;= #{schRcpDtStrt} /*접수일자*/
                                </if>
                                <if test="schRcpDtEnd != null and schRcpDtEnd != ''">
                                  AND CB.CNTR_RCP_FSH_DTM &lt;= #{schRcpDtEnd} /*접수일자*/
                                </if>
                             </if>
                             <if test="schDv == '02'">
                                  AND CD.BOO_SELL_TP_CD = '2'
                                 <if test="schSlDtStrt != null and schSlDtStrt != ''">
                                 INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                    ON CD.CNTR_NO = SC.CNTR_NO
                                   AND CD.CNTR_SN = SC.CNTR_SN
                                   AND SC.SL_RCOG_DT &gt;= #{schSlDtStrt} /* 매출 확정일자 */
                                 <if test="schSlDtEnd != null and schSlDtEnd != ''">
                                   AND SC.SL_RCOG_DT &lt;= #{schSlDtEnd} /* 매출 확정일자 */
                                 </if>
                                 </if>
                                WHERE CB.SELL_OG_TP_CD	= 'W03'
                                  AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /*접수일자*/
                             </if>
                             <if test="schDv == '03'">
                                  AND CD.BOO_SELL_TP_CD = '1'
                                WHERE CB.SELL_OG_TP_CD	= 'W03'
                                  AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /* 접수일자 */
                             </if>
                             )A
                     ON B.PRTNR_NO = A.PRTNR_NO
                    AND B.OG_TP_CD = A.OG_TP_CD
                  INNER JOIN TB_PDBS_PD_BAS D
                     ON A.PD_CD = D.PD_CD
               <if test="schPdCdStrt != null and schPdCdStrt != ''">
                    AND D.PD_CD &gt;= #{schPdCdStrt}
               </if>
               <if test="schPdCdEnd != null and schPdCdEnd != ''">
                   AND D.PD_CD &lt;=  #{schPdCdEnd}
               </if>
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ E
                    ON A.CNTR_NO = E.CNTR_NO
                   AND A.CNTR_SN = E.CNTR_SN
               <if test="schDv == '01'">
                 WHERE B.BASE_YM = SUBSTR(#{schSlDtStrt},0,6)
               </if>
               <if test="schDv == '02'">
                 WHERE B.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)
               </if>
               <if test="schDv == '03'">
                 WHERE B.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)
               </if>
                   AND B.OG_TP_CD	= 'W03'
                 UNION ALL
                 /* 렌탈 */
                SELECT C.DGR2_LEVL_OG_NM AS OG2_NM  /* 지역단 */
                     , C.DGR3_LEVL_OG_NM AS OG3_NM  /* 지점 */
                     , A.PRTNR_NO  /* 번호 */
                     , B.PRTNR_KNM  /* 성명 */
                     , '렌탈' AS GUBN /* 판매유형 */
                     , CASE WHEN D.SELL_TP_DTL_CD = '12' THEN '홈케어'
                            WHEN D.SELL_TP_DTL_CD = '13' THEN '환경가전'
                            ELSE '환경가전외'
                       END AS PRDT_TYPE  /* 제품유형 */
                     , G.MCHN_CH_TP_CD AS LCFLG1       /* 기변유형 */
                     , A.CNTR_NO    /* 계약상세번호 */
                     , A.CNTR_SN
                     , CASE WHEN A.LCCGUB = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 */
                     , D.PD_NM     /* 상품명 */
                     , D.PD_CD     /* 상품코드 */
                     , '' AS LCIUSE  /* 용도 현재없음 임시처리 */
                     , A.LCETC3  /* 할인구분 */
                     , A.LCETC4  /* 할인유형 */
                     , '' AS LCST11    /* 할인제도 현재없음 임시처리 */
                     , '' AS  LCST04   /*결합구분 현재없음 임시처리 */
                     , E.FNL_VAL  /* 입금실적 */
                     , A.LCMONT   /* 할부 */
                     , A.LCBAMT	  /* 기준가격 */
                     , A.LCTAMT	  /* 홈케어 */
                     , '' AS LCGUB1	/* 홈케어멤버십3년 */
                     , A.LCST13 /* 정액여부 */
                     , '' AS 	LEASE_YN	/*  할인구분 관련 현재없음 임시처리  */
                     , CASE WHEN NVL(G.OJ_CNTR_NO, 0) > 0 AND G.MCHN_CH_TP_CD IN (1,18) THEN 0
                            ELSE A.LCPCNT
                       END AS LCPCNT   /* 수수료인정건수 */
                     , '' AS 	RCNT_YN	/* 재약정여부 */
                     , A.LCCRTT	            /* 계약일자*/
                     , A.LCSLET	/* 매출일자 */
                     , A.LCCANT 	/* 취소일자*/
                     , C.DGR3_LEVL_DG_PRTNR_NO AS AKDBON	/* 지점장번호 */
                     , C.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM	/* 지점장성명 */
                     , '렌탈료' AS LCAMT1	/* 렌탈료 미정 임시처리*/
                     , A.STPL_PTRM AS 	LCGUB3	/* 약정기간 */
                     , A.LCVMON /* 관리주기 미정 임시처리*/
                     , A.LCPAMT   /* 인정실적금액 */
                     , I.PMOT_CD AS 	LCCK02	/* 프로모션번호 */
                     , '' AS LCGSEQ       /*패키지 일련번호 미정 임시처리*/
                  FROM TB_OGBS_MM_PRTNR_IZ B  /* 월파트너 */
                 INNER JOIN TB_OGBS_MM_OG_IZ C  /* 월조직 */
                    ON B.BASE_YM = C.BASE_YM
                   AND B.OG_ID = C.OG_ID
                 INNER JOIN ( SELECT CD.CNTR_NO
                                   , CD.CNTR_SN
                                   , CB.SELL_PRTNR_NO AS PRTNR_NO
                                   , CB.SELL_OG_TP_CD AS OG_TP_CD
                                   , CB.CNTR_CST_NO AS CST_NO
                                   , CB.COPN_DV_CD AS LCCGUB
                                   , CD.BASE_PD_CD AS PD_CD
                                   , CD.ISTM_MCN AS LCMONT
                                   , CD.ACKMT_PERF_AMT AS LCPAMT
                                   , CD.FEE_ACKMT_BASE_AMT AS LCBAMT
                                   , CD.SELL_AMT AS LCTAMT
                                   , CD.FEE_FXAM_YN AS LCST13
                                   , CD.FEE_ACKMT_CT	AS LCPCNT
                                   , CD.CNTR_PD_ENDDT AS LCCANT
                                   , CD.SV_PRD AS LCVMON
                                   , CB.CNTR_CNFM_DTM AS LCCRTT
                                   , CD.CNTR_PD_STRTDT AS LCSLET
                                   , CD.STPL_PTRM
                                   , CD.SELL_DSC_TP_CD AS LCETC3
                                   , CD.SELL_DSC_DV_CD AS LCETC4
                                FROM TB_SSCT_CNTR_BAS CB
                               INNER JOIN TB_SSCT_CNTR_DTL CD
                                  ON CB.CNTR_NO = CD.CNTR_NO
                                 AND CD.SELL_TP_CD = '2'  /* 렌탈/리스 */
                            <if test="schPdctTp == '02'">
                                 AND CD.SELL_TP_DTL_CD = '13'  /* 환경가전  */
                            </if>
                            <if test="schPdctTp == '03'">
                                 AND CD.SELL_TP_DTL_CD != '13'  /* 환경가전외  */
                            </if>
                            <if test="schPdctTp == '04'">
                                 AND 1 != 1   /* 홈케어  */
                            </if>
                            <if test="schPdctTp == '05'">
                                 AND 1 != 1  /* 정기배송  */
                            </if>
                            <if test="schDv == '01'">
                                 AND CD.BOO_SELL_TP_CD = '2'
                               INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                  ON CD.CNTR_NO = SC.CNTR_NO
                                 AND CD.CNTR_SN = SC.CNTR_SN
                                 AND SC.SL_RCOG_DT BETWEEN #{schSlDtStrt} AND #{schSlDtEnd}  /* 매출 확정일자 */
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                               <if test="schRcpDtStrt != null and schRcpDtStrt != ''">
                                 AND CB.CNTR_RCP_FSH_DTM &gt;= #{schRcpDtStrt} /*접수일자*/
                               </if>
                               <if test="schRcpDtEnd != null and schRcpDtEnd != ''">
                                 AND CB.CNTR_RCP_FSH_DTM &lt;= #{schRcpDtEnd} /*접수일자*/
                               </if>
                            </if>
                            <if test="schDv == '02'">
                                 AND CD.BOO_SELL_TP_CD = '2'
                                <if test="schSlDtStrt != null and schSlDtStrt != ''">
                               INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                  ON CD.CNTR_NO = SC.CNTR_NO
                                 AND CD.CNTR_SN = SC.CNTR_SN
                                 AND SC.SL_RCOG_DT &gt;= #{schSlDtStrt} /* 매출 확정일자 */
                                 <if test="schSlDtEnd != null and schSlDtEnd != ''">
                                 AND SC.SL_RCOG_DT &lt;= #{schSlDtEnd} /* 매출 확정일자 */
                                 </if>
                                </if>
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                                 AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /* 접수일자 */
                            </if>
                            <if test="schDv == '03'">
                                 AND CD.BOO_SELL_TP_CD = '1'
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                                 AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /* 접수일자 */
                            </if>
                            )A
                    ON B.PRTNR_NO = A.PRTNR_NO
                   AND B.OG_TP_CD = A.OG_TP_CD
                 INNER JOIN TB_PDBS_PD_BAS D
                    ON A.PD_CD = D.PD_CD
              <if test="schPdCdStrt != null and schPdCdStrt != ''">
                   AND D.PD_CD &gt;= #{schPdCdStrt}
              </if>
              <if test="schPdCdEnd != null and schPdCdEnd != ''">
                   AND D.PD_CD &lt;=  #{schPdCdEnd}
              </if>
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ E
                    ON A.CNTR_NO = E.CNTR_NO
                   AND A.CNTR_SN = E.CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ G
                    ON A.CNTR_NO = G.BASE_CNTR_NO
                   AND A.CNTR_SN = G.BASE_CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_PMOT_IZ I
                    ON A.CNTR_NO = I.DTL_CNTR_NO
                   AND A.CNTR_SN = I.DTL_CNTR_SN
              <if test="schDv == '01'">
                 WHERE B.BASE_YM = SUBSTR(#{schSlDtStrt},0,6)
              </if>
              <if test="schDv == '02'">
                 WHERE B.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)
              </if>
              <if test="schDv == '03'">
                 WHERE B.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)
              </if>
                   AND B.OG_TP_CD	= 'W03'
                   AND NOT EXISTS (SELECT 1 FROM TB_SSCT_RENTAL_RSTL_IZ X WHERE A.CNTR_NO = X.CNTR_NO AND A.CNTR_SN = X.CNTR_SN) /*재렌탈약정X*/
              <if test="schDv != '예약'">
                 UNION ALL
                 /* 멤버십 */
                SELECT C.DGR2_LEVL_OG_NM AS OG2_NM  /* 지역단 */
                     , C.DGR3_LEVL_OG_NM AS OG3_NM  /* 지점 */
                     , A.PRTNR_NO  /* 번호 */
                     , B.PRTNR_KNM  /* 성명 */
                     , '멤버십' AS GUBN /* 판매유형 */
                     , CASE WHEN D.SELL_TP_DTL_CD = '12' THEN '홈케어'
                            WHEN D.SELL_TP_DTL_CD = '13' THEN '환경가전'
                            ELSE '환경가전외'
                       END AS PRDT_TYPE  /* 제품유형 */
                     , '' AS LCFLG1       /* 기변유형 */
                     , A.CNTR_NO    /* 계약상세번호 */
                     , A.CNTR_SN
                     , CASE WHEN A.LCCGUB = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 */
                     , D.PD_NM     /* 상품명 */
                     , D.PD_CD     /* 상품코드 */
                     , '' AS LCIUSE  /* 용도 현재없음 임시처리 */
                     , A.LCETC3  /* 할인구분 */
                     , A.LCETC4  /* 할인유형 */
                     , '' AS LCST11    /* 할인제도 현재없음 임시처리 */
                     , '' AS LCST04   /*결합구분 현재없음 임시처리 */
                     , 0 AS FNL_VAL  /* 입금실적 */
                     , A.LCMONT   /* 할부 */
                     , A.LCBAMT	  /* 기준가격 */
                     , CASE WHEN D.SELL_TP_DTL_CD = '12' THEN  A.MM_ISTM_AMT ELSE 0 END AS LCTAMT    /* 홈케어 */
                     , CASE WHEN A.LCMONT = 36 THEN 'Y' ELSE ' ' END AS LCGUB1   /* 홈케어멤버십3년 */
                     , '' AS LCST13 /* 정액여부 */
                     , '' AS LEASE_YN	/*  금융리스여부  */
                     , CASE WHEN G.MCHN_CH_TP_CD IN (8,16) THEN A.LCPCNT
                            ELSE 0
                       END AS LCPCNT   /* 수수료인정건수 할인율 관련 미정으로 임시처리 */
                     , '' AS 	RCNT_YN	/* 재약정여부 */
                     , A.LCCRTT	            /* 계약일자*/
                     , A.LCSLET	/* 매출일자 */
                     , A.LCCANT 	/* 취소일자*/
                     , C.DGR3_LEVL_DG_PRTNR_NO AS AKDBON	/* 지점장번호 */
                     , C.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM	/* 지점장성명 */
                     , '0' AS LCAMT1	/* 렌탈료*/
                     , 0 AS 	LCGUB3	/* 약정기간 */
                     , 0 AS 	LCVMON /* 관리주기*/
                     , A.LCPAMT   /* 인정실적금액 */
                     , '0' AS 	LCCK02	/* 프로모션번호 */
                     , '' AS LCGSEQ       /*패키지 일련번호 미정 임시처리*/
                  FROM TB_OGBS_MM_PRTNR_IZ B  /* 월파트너 */
                 INNER JOIN TB_OGBS_MM_OG_IZ C  /* 월조직 */
                    ON B.BASE_YM = C.BASE_YM
                   AND B.OG_ID = C.OG_ID
                 INNER JOIN ( SELECT CD.CNTR_NO
                                   , CD.CNTR_SN
                                   , CB.SELL_PRTNR_NO AS PRTNR_NO
                                   , CB.SELL_OG_TP_CD AS OG_TP_CD
                                   , CB.CNTR_CST_NO AS CST_NO
                                   , CB.COPN_DV_CD AS LCCGUB
                                   , CD.BASE_PD_CD AS PD_CD
                                   , CD.ISTM_MCN AS LCMONT
                                   , CD.ACKMT_PERF_AMT AS LCPAMT
                                   , CD.FEE_ACKMT_BASE_AMT AS LCBAMT
                                   , CD.SELL_AMT AS LCTAMT
                                   , CD.FEE_FXAM_YN AS LCST13
                                   , CD.FEE_ACKMT_CT	AS LCPCNT
                                   , CD.CNTR_PD_ENDDT AS LCCANT
                                   , CD.SV_PRD AS LCVMON
                                   , CB.CNTR_CNFM_DTM AS LCCRTT
                                   , CD.MM_ISTM_AMT
                                   , CD.CNTR_PD_STRTDT AS LCSLET
                                   , CD.STPL_PTRM
                                   , CD.SELL_DSC_TP_CD AS LCETC3
                                   , CD.SELL_DSC_DV_CD AS LCETC4
                                FROM TB_SSCT_CNTR_BAS CB
                               INNER JOIN TB_SSCT_CNTR_DTL CD
                                  ON CB.CNTR_NO = CD.CNTR_NO
                                 AND CD.SELL_TP_CD = '3'  /* 멤버십 */
                            <if test="schPdctTp == '02'">
                                 AND 1 != 1  /* 환경가전  */
                            </if>
                            <if test="schPdctTp == '03'">
                                 AND 1 != 1  /* 환경가전외  */
                            </if>
                            <if test="schPdctTp == '04'">
                                 AND CD.SELL_TP_DTL_CD = '12'  /* 홈케어  */
                            </if>
                            <if test="schPdctTp == '05'">
                                 AND 1 != 1  /* 정기배송  */
                            </if>
                            <if test="schDv == '01'">
                                 AND CD.BOO_SELL_TP_CD = '2'
                           INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                              ON CD.CNTR_NO = SC.CNTR_NO
                             AND CD.CNTR_SN = SC.CNTR_SN
                             AND SC.SL_RCOG_DT BETWEEN #{schSlDtStrt} AND #{schSlDtEnd}  /* 매출 확정일자 */
                           WHERE CB.SELL_OG_TP_CD	= 'W03'
                             <if test="schRcpDtStrt != null and schRcpDtStrt != ''">
                             AND CB.CNTR_RCP_FSH_DTM &gt;= #{schRcpDtStrt} /*접수일자*/
                             </if>
                             <if test="schRcpDtEnd != null and schRcpDtEnd != ''">
                             AND CB.CNTR_RCP_FSH_DTM &lt;= #{schRcpDtEnd} /*접수일자*/
                             </if>
                           </if>
                           <if test="schDv == '02'">
                             AND CD.BOO_SELL_TP_CD = '2'
                             <if test="schSlDtStrt != null and schSlDtStrt != ''">
                           INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                              ON CD.CNTR_NO = SC.CNTR_NO
                             AND CD.CNTR_SN = SC.CNTR_SN
                             AND SC.SL_RCOG_DT &gt;= #{schSlDtStrt} /* 매출 확정일자 */
                             <if test="schSlDtEnd != null and schSlDtEnd != ''">
                             AND SC.SL_RCOG_DT &lt;= #{schSlDtEnd} /* 매출 확정일자 */
                             </if>
                             </if>
                           WHERE CB.SELL_OG_TP_CD	= 'W03'
                             AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd}  /* 접수일자 */
                           </if>
                            )A
                    ON B.PRTNR_NO = A.PRTNR_NO
                   AND B.OG_TP_CD = A.OG_TP_CD
                 INNER JOIN TB_PDBS_PD_BAS D
                    ON A.PD_CD = D.PD_CD
              <if test="schPdCdStrt != null and schPdCdStrt != ''">
                   AND D.PD_CD &gt;= #{schPdCdStrt}
              </if>
              <if test="schPdCdEnd != null and schPdCdEnd != ''">
                   AND D.PD_CD &lt;=  #{schPdCdEnd}
              </if>
                  LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ G
                    ON A.CNTR_NO = G.BASE_CNTR_NO
                   AND A.CNTR_SN = G.BASE_CNTR_SN
              <if test="schDv == '01'">
                 WHERE B.BASE_YM = SUBSTR(#{schSlDtStrt},0,6) /* 매출일자 */
              </if>
              <if test="schDv == '02'">
                 WHERE B.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6) /* 접수일자 */
              </if>
                   AND B.OG_TP_CD	= 'W03'
              </if>
                 UNION ALL
                 /* 정기구매 */
                SELECT C.DGR2_LEVL_OG_NM AS OG2_NM  /* 지역단 */
                     , C.DGR3_LEVL_OG_NM AS OG3_NM  /* 지점 */
                     , A.PRTNR_NO  /* 번호 */
                     , B.PRTNR_KNM  /* 성명 */
                     , '정기구매' AS GUBN /* 판매유형 */
                     , CASE WHEN D.SELL_TP_DTL_CD = '62' THEN '웰스팜'
                            WHEN D.SELL_TP_DTL_CD = '63' THEN '캡슐'
                            ELSE '기타'
                       END AS PRDT_TYPE  /* 제품유형 */
                     , '' AS LCFLG1       /* 기변유형 */
                     , A.CNTR_NO    /* 계약상세번호 */
                     , A.CNTR_SN
                     , CASE WHEN A.LCCGUB = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 */
                     , D.PD_NM     /* 상품명 */
                     , D.PD_CD     /* 상품코드 */
                     , '' AS LCIUSE  /* 용도 현재없음 임시처리 */
                     , A.LCETC3  /* 할인구분 */
                     , A.LCETC4  /* 할인유형 */
                     , '' AS LCST11    /* 할인제도 */
                     , '' AS LCST04   /*결합구분 */
                     , E.FNL_VAL  /* 입금실적 미정 임시처리*/
                     , A.LCMONT   /* 할부 */
                     , A.LCBAMT	  /* 기준가격 */
                     , CASE WHEN D.SELL_TP_DTL_CD = '12' THEN  A.LCTAMT - A.LCRAMT  ELSE 0 END AS LCTAMT    /* 홈케어 */
                     , '' AS LCGUB1   /* 홈케어멤버십3년 */
                     , A.LCST13 /* 정액여부 */
                     , '' AS LEASE_YN	/*  금융리스여부  */
                     , A.LCPCNT         /* 수수료인정건수 할인율 관련 미정으로 임시처리 */
                     , ' ' AS 	RCNT_YN	/* 재약정여부 */
                     , A.LCCRTT	            /* 계약일자*/
                     , A.LCSLET	/* 매출일자 */
                     , A.LCCANT 	/* 취소일자*/
                     , C.DGR3_LEVL_DG_PRTNR_NO AS AKDBON	/* 지점장번호 */
                     , C.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM	/* 지점장성명 */
                     , TO_CHAR((A.LCTAMT - A.LCRAMT) / A.LCVMON) AS LCAMT1          /* 렌탈료 */
                     , A.STPL_PTRM AS LCGUB3	/* 약정기간 */
                     , 0 AS LCVMON /* 관리주기*/
                     , A.LCPAMT   /* 인정실적금액 */
                     , '0' AS 	LCCK02	/* 프로모션번호 */
                     , '' AS LCGSEQ       /*패키지 일련번호 미정 임시처리*/
                  FROM TB_OGBS_MM_PRTNR_IZ B  /* 월파트너 */
                 INNER JOIN TB_OGBS_MM_OG_IZ C  /* 월조직 */
                    ON B.BASE_YM = C.BASE_YM
                   AND B.OG_ID = C.OG_ID
                 INNER JOIN ( SELECT CD.CNTR_NO
                                   , CD.CNTR_SN
                                   , CB.SELL_PRTNR_NO AS PRTNR_NO
                                   , CB.SELL_OG_TP_CD AS OG_TP_CD
                                   , CB.CNTR_CST_NO AS CST_NO
                                   , CB.COPN_DV_CD AS LCCGUB
                                   , CD.BASE_PD_CD AS PD_CD
                                   , CD.STPL_PTRM AS LCMONT
                                   , CD.ACKMT_PERF_AMT AS LCPAMT
                                   , CD.FEE_ACKMT_BASE_AMT AS LCBAMT
                                   , CD.SELL_AMT AS LCTAMT
                                   , CD.FEE_FXAM_YN AS LCST13
                                   , CD.FEE_ACKMT_CT	AS LCPCNT
                                   , CD.CNTR_PD_ENDDT AS LCCANT
                                   , CD.SV_PRD AS LCVMON
                                   , CB.CNTR_CNFM_DTM AS LCCRTT
                                   , CD.DSC_AMT AS LCRAMT
                                   , CD.CNTR_PD_STRTDT AS LCSLET
                                   , CD.STPL_PTRM
                                   , CD.SELL_DSC_TP_CD AS LCETC3
                                   , CD.SELL_DSC_DV_CD AS LCETC4
                                FROM TB_SSCT_CNTR_BAS CB
                               INNER JOIN TB_SSCT_CNTR_DTL CD
                                  ON CB.CNTR_NO = CD.CNTR_NO
                                 AND CD.SELL_TP_CD = '6'  /* 정기배송 */
                            <if test="schPdctTp == '02'">
                                 AND 1 != 1  /* 환경가전  */
                            </if>
                            <if test="schPdctTp == '03'">
                                 AND 1 != 1  /* 환경가전외  */
                            </if>
                            <if test="schPdctTp == '04'">
                                 AND 1 != 1  /* 홈케어  */
                            </if>
                            <if test="schPdctTp == '05'">
                                 AND CD.SELL_TP_DTL_CD IN ('62','63')  /* 정기배송-모종, 캡슐 */
                            </if>
                            <if test="schDv == '01'">
                                 AND CD.BOO_SELL_TP_CD = '2'
                               INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                  ON CD.CNTR_NO = SC.CNTR_NO
                                 AND CD.CNTR_SN = SC.CNTR_SN
                                 AND SC.SL_RCOG_DT BETWEEN #{schSlDtStrt} AND #{schSlDtEnd}  /* 매출 확정일자 */
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                                <if test="schRcpDtStrt != null and schRcpDtStrt != ''">
                                 AND CB.CNTR_RCP_FSH_DTM &gt;= #{schRcpDtStrt} /*접수일자*/
                                </if>
                                <if test="schRcpDtEnd != null and schRcpDtEnd != ''">
                                 AND CB.CNTR_RCP_FSH_DTM &lt;= #{schRcpDtEnd} /*접수일자*/
                                </if>
                            </if>
                            <if test="schDv == '02'">
                                 AND CD.BOO_SELL_TP_CD = '2'
                                <if test="schSlDtStrt != null and schSlDtStrt != ''">
                               INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                                  ON CD.CNTR_NO = SC.CNTR_NO
                                 AND CD.CNTR_SN = SC.CNTR_SN
                                 AND SC.SL_RCOG_DT &gt;= #{schSlDtStrt} /* 매출 확정일자 */
                                <if test="schSlDtEnd != null and schSlDtEnd != ''">
                                 AND SC.SL_RCOG_DT &lt;= #{schSlDtEnd} /* 매출 확정일자 */
                                </if>
                                </if>
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                                 AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /* 접수일자 */
                            </if>
                            <if test="schDv == '03'">
                                 AND CD.BOO_SELL_TP_CD = '1'
                               WHERE CB.SELL_OG_TP_CD	= 'W03'
                                 AND CB.CNTR_RCP_FSH_DTM BETWEEN #{schRcpDtStrt} AND  #{schRcpDtEnd} /* 접수일자 */
                            </if>
                            )A
                    ON B.PRTNR_NO = A.PRTNR_NO
                   AND B.OG_TP_CD = A.OG_TP_CD
                 INNER JOIN TB_PDBS_PD_BAS D
                    ON A.PD_CD = D.PD_CD
              <if test="schPdCdStrt != null and schPdCdStrt != ''">
                   AND D.PD_CD &gt;= #{schPdCdStrt}
              </if>
              <if test="schPdCdEnd != null and schPdCdEnd != ''">
                   AND D.PD_CD &lt;=  #{schPdCdEnd}
              </if>
                  LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ E
                    ON A.CNTR_NO = E.CNTR_NO
                   AND A.CNTR_SN = E.CNTR_SN
                 WHERE B.BASE_YM = SUBSTR(#{schSlDtStrt},0,6)
                   AND B.OG_TP_CD	= 'W03'
               )M
          LEFT JOIN TB_FEAM_WELS_NRCTR_MM_CL MM
            ON M.CNTR_NO = MM.CNTR_NO
           AND M.CNTR_SN = MM.CNTR_SN
           AND MM.OG_TP_CD = 'W03'
           AND MM.FEE_TCNT_DV_CD = #{schTcnt}  /*차수*/
           AND MM.CNTR_PERF_CRT_DV_CD = '01'  /*순주문 집계*/
      <if test="schDv == '01'">
           AND MM.BASE_YM = SUBSTR(#{schSlDtStrt},0,6)  /* 매출일자 */
      </if>
      <if test="schDv == '02'">
           AND MM.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)  /* 접수일자 */
      </if>
      <if test="schDv == '03'">
           AND MM.BASE_YM = SUBSTR(#{schRcpDtStrt},0,6)  /* 접수일자 */
      </if>
    </select>

    <select id='selectHomeMasterSellFees'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchHmstSellFeeRes">
        SELECT C.DGR2_LEVL_OG_NM AS OG2_NM  /* 지역단 */
             , C.DGR3_LEVL_OG_NM AS OG3_NM  /* 지점 */
             , A.PRTNR_NO  /* 번호 */
             , B.PRTNR_KNM  /* 성명 */
             , A.CNTR_NO    /* 계약상세번호 */
             , A.RCPDT /*접수일자*/
             , A.SL_DT /*매출일자*/
             , A.CAN_DT /*취소일자*/
        , CASE WHEN CD.SELL_TP_DTL_CD = '12' THEN '홈케어'
        WHEN CD.SELL_TP_DTL_CD = '13' THEN '환경가전'
        WHEN CD.SELL_TP_CD = '6' AND CD.SELL_TP_DTL_CD = '62' THEN '웰스팜'
        WHEN CD.SELL_TP_CD = '6' AND CD.SELL_TP_DTL_CD = '63' THEN '캡슐'
        WHEN CD.SELL_TP_CD = '6' THEN '기타'
        ELSE '환경가전외'
        END AS PRDT_TYPE  /* 제품유형 */
             , A.PD_CD /*상품코드*/
             , '' AS PRDGRP/*상품그룹*/
             , D.PD_NM /*상품명*/
             , A.ACKMT_PERF_CT   /*인정건수*/
             , E.CD_CNTN AS MCHN_CH_TP_CD   /*기변유형*/
          FROM TB_FEAM_WELS_NRCTR_MM_CL A
         INNER JOIN TB_OGBS_MM_PRTNR_IZ B  /* 월파트너 */
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_TP_CD = B.OG_TP_CD
         INNER JOIN TB_OGBS_MM_OG_IZ C  /* 월조직 */
            ON B.BASE_YM = C.BASE_YM
           AND B.OG_ID = C.OG_ID
         INNER JOIN TB_PDBS_PD_BAS D
            ON A.PD_CD = D.PD_CD
         INNER JOIN TB_SSCT_CNTR_DTL CD
            ON A.CNTR_NO = CD.CNTR_NO
           AND A.CNTR_SN = CD.CNTR_SN
      <if test="schPdctTp == '02'">
           AND CD.SELL_TP_DTL_CD = '13'  /* 환경가전  */
      </if>
      <if test="schPdctTp == '03'">
           AND CD.SELL_TP_DTL_CD != '13'  /* 환경가전외  */
      </if>
      <if test="schPdctTp == '04'">
           AND CD.SELL_TP_DTL_CD = '12'  /* 홈케어  */
      </if>
      <if test="schPdctTp == '05'">
           AND CD.SELL_TP_DTL_CD IN ('62','63')  /* 정기배송-모종, 캡슐 */
      </if>
          LEFT OUTER JOIN T_CMZ_CD_D E
            ON A.MCHN_CH_TP_CD = E.CD_VLD_VAL
           AND E.TENANT_ID = #{session.tenantId}
           AND E.CD_ID = 'MCHN_CH_TP_CD'
         WHERE A.BASE_YM = SUBSTR(#{schSlDtStrt},0,6)
           AND A.FEE_TCNT_DV_CD = #{schTcnt}  /*차수*/
           AND A.CNTR_PERF_CRT_DV_CD = '01'  /*순주문 집계*/
           AND A.OG_TP_CD = 'W03'
       <if test="schPdCdStrt != null and schPdCdStrt != ''">
           AND A.PD_CD &gt;= #{schPdCdStrt}
       </if>
       <if test="schRcpDtStrt != null and schRcpDtStrt != ''">
           AND A.RCPDT &gt;= #{schRcpDtStrt} /*접수일자*/
       </if>
       <if test="schRcpDtEnd != null and schRcpDtEnd != ''">
           AND A.RCPDT &lt;= #{schRcpDtEnd} /*접수일자*/
       </if>
       <if test="schSlDtStrt != null and schSlDtStrt != ''">
           AND A.SL_DT &gt;= #{schSlDtStrt}
       </if>
       <if test="schSlDtEnd != null and schSlDtEnd != ''">
           AND A.SL_DT &lt;= #{schSlDtEnd} /*접수일자*/
       </if>
       <if test="schPdCdEnd != null and schPdCdEnd != ''">
           AND A.PD_CD &lt;=  #{schPdCdEnd}
       </if>
    </select>

    <select id='selectManagers'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchMngerRes">
        SELECT T.OG_ID AS BLG/* 소속 !!!*/
             , T.PRTNR_NO AS SEQUENCE_NUMBER /* 번호 !!!*/
             , T.PRTNR_KNM AS EMPL_NM /* 성명 !!!*/
             , CD1.CD_CNTN AS SEL_TYPE /* 판매유형 !!!*/
             , CD2.CD_CNTN AS PDCT_TP  /* 제품유형 !!!*/
             , CD3.CD_CNTN AS PRC_TP  /* 가격유형 !!!*/
             , CD4.CD_CNTN AS CHDVC_TP  /* 기변유형 !!!*/
             , CD5.CD_CNTN AS FEE  /* 수수료 실적유형 !!!*/
             , T.CNTR_DTL_CD AS CNTR_DTL_NO   /* 계약상세번호 !!!*/
             , T.LCCGUB AS CST_DV   /* 고객구분 !!!*/
             , T.PD_NM AS PRDT_NM    /* 상품명 !!!*/
             , T.PD_CD AS PRDT_CODE    /* 상품코드 !!!*/
             , CD7.CD_CNTN AS PD_DC_CLASS /* 할인구분 !!!*/
             , CD8.CD_CNTN AS DISC_CODE /* 할인유형 !!!*/
             , CD6.CD_CNTN AS DSC_SYST /* 할인제도 !!!*/
             , T.LCST04 AS COMBI_DV /* 결합구분 !!!*/
             , T.LCMONT AS ISTM  /* 할부 !!!*/
             , T.STPL_PTRM AS STPL_MCNT           /* 약정개월 !!!*/
             , T.LCFLG3 AS MNGT_PRD          /* 관리주기 !!!*/
             , T.LCPAMT AS PD_ACC_RSLT   /* 인정실적 !!!*/
             , T.LCBAMT AS BASE_PRC  /* 기준가격 !!!*/
             , T.HOMCARE AS HOME_CARE /* 홈케어 !!!*/
             , T.HOMCARE3_YEAR AS HCR_MSH_Y3 /* 홈케어멤버십3년 !!!!*/
             , T.LCST13 AS FXAM_YN /* 정액여부 !!!*/
             , T.LEASE_YN AS FNN_LEASE /* 금융리스 ???? 일단임시 */
             , T.LCPCNT AS ELHM_ACKMT_CT /* 가정 인정건수 !!!*/
             , T.NEW_LCPCNT AS NW_SELL_CT /* 신규판매건수 ???? 일단임시*/
             , T.BS_DAESANG AS OBJ /* BS대상 !!!!*/
             , T.RSTL_YN AS RECOMMITMENT           /* 재약정여부 !!!*/
             , T.LCCRTT AS CNTR_DATE /* 계약일자 !!!*/
             , T.LCSLET AS SL_DT /* 매출일자 !!!*/
             , T.LCCANT AS CANC_DT /* 취소일자 !!!*/
             , T.LCDELDT AS DEM_DT /* 철거일자???? 일단 임시*/
             , T.AKDBON AS BRMGR_NO /* 지점장번호 !!!*/
             , T.AKDBNM AS BRMGR_FNM /* 지점장성명 !!!*/
             , T.LCAMT1 AS RTLFE /* 렌탈료 !!!*/
             , T.LCCK02 AS PMOT_NO /* 프로모션번호!!!!! */
             , T.LCRCDE AS PKG_PD_NO /*패키지 상품번호!!!!!*/
             , T.LCGSEQ AS PKG_SN    /* 패키지 일련번호??? 렌탈, 멤버십 LCET14 없음 일단 임시 */
             , T.INTM_ORDR_NO AS MCHN_PRTNR /* 기기고객코드!!!! */
             , T.INTM_ORDR_PRDT AS MCHN_PD /* 기기상품코드!!! */
             , NVL(T.EX_YN,'N') AS PERF_EXCD /*실적제외등록여부!!! */
          FROM ( SELECT MP.OG_ID /* 소속 !!!*/
                      , MP.PRTNR_NO  /* 번호 !!!*/
                      , MP.PRTNR_KNM  /* 성명 !!!*/
                      , CD.SELL_TP_CD /* 판매유형 !!!*/
                      , PF.FEE_PERF_TP_CD  /* 제품유형 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN PSP.RGLR_SPP_PRC_DV_CD END AS RGLR_SPP_PRC_DV_CD  /* 가격유형 !!!*/
                      , MC.MCHN_CH_TP_CD  /* 기변유형 !!!*/
                      , PF.FEE_PDCT_TP_CD  /* 수수료 실적유형 !!!*/
                      , CD.CNTR_NO||CD.CNTR_SN AS CNTR_DTL_CD   /* 계약상세번호 !!!*/
                      , CASE WHEN CB.COPN_DV_CD = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 !!!*/
                      , PP.PD_NM     /* 상품명 !!!*/
                      , PP.PD_CD     /* 상품코드 !!!*/
                      , CD.SELL_DSC_DV_CD AS LCETC3  /* 할인구분 !!!*/
                      , CD.SELL_DSC_TP_CD AS LCETC4  /* 할인유형 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN CP.PMOT_TP_CD END AS PMOT_TP_CD /* 할인제도 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' AND PSP.RGLR_SPP_PRC_DV_CD = 4 THEN 'Y' END AS LCST04 /* 결합구분 !!!*/
                      , CD.ISTM_MCN AS LCMONT   /* 할부 !!!*/
                      , CD.STPL_PTRM            /* 약정개월 !!!*/
                      , CD.SV_PRD AS LCFLG3           /* 관리주기 !!!*/
                      , CD.ACKMT_PERF_AMT AS LCPAMT   /* 인정실적 !!!*/
                      , CD.FEE_ACKMT_BASE_AMT AS LCBAMT   /* 기준가격 !!!*/
                      , CASE WHEN PF.FEE_PDCT_TP_CD = 'E' THEN ( CASE WHEN CD.SELL_TP_CD = '6' THEN (CD.SELL_AMT- CD.CNTRAM_DSC_AMT )/ CD.SV_PRD
                                                                      ELSE CD.SELL_AMT
                                                                 END )
                             ELSE 0
                        END AS HOMCARE /* 홈케어 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '3' AND CD.STPL_PTRM = 36 THEN 'Y'
                             ELSE ' '
                        END  AS HOMCARE3_YEAR /* 홈케어멤버십3년 !!!!*/
                      , CD.FEE_FXAM_YN AS LCST13 /* 정액여부 !!!*/
                      , '' AS LEASE_YN  /* 금융리스 ???? 일단임시 */
                      , CASE WHEN CD.SELL_TP_CD IN ('1', '6') THEN CD.FEE_ACKMT_CT
                             WHEN CD.SELL_TP_CD = '2' THEN ( CASE WHEN NVL(MC.OJ_CNTR_NO, 0) > 0 AND MC.MCHN_CH_TP_CD IN (1,18) THEN 0
                                                                  ELSE CD.FEE_ACKMT_CT
                                                             END )
                             WHEN CD.SELL_TP_CD = '3' THEN ( CASE WHEN CD.CNTRW_TP_CD = '5' AND CD.SELL_TP_DTL_CD = '33' AND CP.PMOT_CD = 'P1' THEN 1
                                                                  ELSE 0
                                                             END )
                        END AS LCPCNT /* 가정 인정건수 !!!*/
                      , 0    AS NEW_LCPCNT /* 신규판매건수 ???? 일단임시*/
                      , CASE WHEN WS.ROW_SCNT = 1 THEN 'Y' END AS BS_DAESANG /* BS대상 !!!!*/
                      , CD.RSTL_YN            /* 재약정여부 !!!*/
                      , CB.CNTR_CNFM_DTM AS LCCRTT /* 계약일자 !!!*/
                      , SC.SL_RCOG_DT AS LCSLET /* 매출일자 !!!*/
                      , CD.CNTR_PD_ENDDT AS LCCANT  /* 취소일자 !!!*/
                      , WD.REQD_DT AS LCDELDT  /* 철거일자!!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NO AS AKDBON /* 지점장번호 !!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM /* 지점장성명 !!!*/
                      , CD.SELL_AMT AS LCAMT1 /* 렌탈료 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '2' THEN CP.PMOT_CD
                             ELSE '0'
                        END AS LCCK02 /* 프로모션번호!!!!! */
                      , CASE WHEN CD.SELL_TP_CD = '2' THEN CD.HGR_PD_CD
                             ELSE '0'
                        END AS LCRCDE /*패키지 상품번호!!!!!*/
                      , CASE WHEN CD.SELL_TP_CD IN ('2','3') THEN ''
                             ELSE ''
                        END AS LCGSEQ     /* 패키지 일련번호??? 렌탈, 멤버십 LCET14 없음 일단 임시 */
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN SUBSTR(CB.CNTR_NO,2,4) ||'-'||SUBSTR(CB.CNTR_NO,6,7)
                        END AS INTM_ORDR_NO /* 기기고객코드!!!! */
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN PP.PD_CD
                        END AS INTM_ORDR_PRDT/* 기기상품코드!!! */
                      , CASE WHEN EX.EX_SCNT = 1 THEN 'Y'
                        END AS EX_YN  /*실적제외등록여부!!! */
                   FROM TB_SSCT_CNTR_BAS CB
                  INNER JOIN TB_SSCT_CNTR_DTL CD
                     ON CB.CNTR_NO = CD.CNTR_NO
              <if test='@MybatisUtils@equals(schSelType, "0")'>
                    AND CD.SELL_TP_CD IN ('1','2','3','6')
              </if>
              <if test='@MybatisUtils@equals(schSelType, "7")'>
                   AND 1 = 2 /* 재약정은 따로 조회*/
              </if>
              <if test='!@MybatisUtils@equals(schSelType, "0") and !@MybatisUtils@equals(schSelType, "7")'>
                   AND CD.SELL_TP_CD = #{schSelType}
              </if>
              <if test='@MybatisUtils@equals(schDiv, "01") or @MybatisUtils@equals(schDiv, "02")'> /* 매출, 접수 */
                   AND CD.BOO_SELL_TP_CD = '2'
              </if>
              <if test='@MybatisUtils@equals(schDiv, "03")'> /* 예약 */
                   AND CD.BOO_SELL_TP_CD = '1'
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPkgCdStrt)'>
                   AND CD.HGR_PD_CD &gt;= #{schPkgCdStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPkgCdEnd)'>
                   AND CD.HGR_PD_CD &lt;= #{schPkgCdEnd}
              </if>
              <if test='@MybatisUtils@equals(schDiv, "01")'> /* 매출 */
                   INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                   ON CD.CNTR_NO = SC.CNTR_NO
                   AND CD.CNTR_SN = SC.CNTR_SN
                   AND SC.SL_RCOG_DT BETWEEN #{schDtStrt} AND #{schDtEnd}  /* 매출 확정일자 */
              </if>
              <if test='!@MybatisUtils@equals(schDiv, "01")'> /* 전체 */
                   LEFT OUTER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                   ON CD.CNTR_NO = SC.CNTR_NO
                   AND CD.CNTR_SN = SC.CNTR_SN
              </if>
                 INNER JOIN TB_OGBS_MM_PRTNR_IZ MP  /* 월파트너 */
                    ON CB.SELL_PRTNR_NO = MP.PRTNR_NO
                   AND CB.SELL_OG_TP_CD = MP.OG_TP_CD
                   AND MP.BASE_YM = SUBSTR(#{schDtStrt},0,6)
              <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
                   AND MP.PRTNR_NO = #{schPrtnrNo}
              </if>
                 INNER JOIN TB_OGBS_MM_OG_IZ MO  /* 월조직 */
                    ON MP.BASE_YM = MO.BASE_YM
                   AND MP.OG_ID = MO.OG_ID
                   AND MP.OG_TP_CD = MO.OG_TP_CD
              <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
                   AND MO.DGR1_LEVL_OG_ID = #{ogLevl1}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
                   AND MO.DGR2_LEVL_OG_ID = #{ogLevl2}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
                   AND MO.DGR3_LEVL_OG_ID = #{ogLevl3}
              </if>
                 INNER JOIN TB_PDBS_PD_BAS PP
                    ON CD.BASE_PD_CD = PP.PD_CD
              <if test='@MybatisUtils@isNotEmpty(schPdCdStrt)'>
                   AND PP.PD_CD &gt;= #{schPdCdStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPdCdEnd)'>
                   AND PP.PD_CD &lt;=  #{schPdCdEnd}
              </if>
                 INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS PD
                    ON CD.BASE_PD_CD = PD.BASE_PD_CD
                   AND SUBSTR(#{schDtStrt},0,6) BETWEEN APY_STRT_YM AND APY_END_YM
                 INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS PF
                    ON PD.FEE_PDCT_TP_CD1 = PF.FEE_PDCT_TP_CD
                   AND CD.SELL_TP_CD = PF.SELL_TP_CD
              <if test='!@MybatisUtils@equals(schPdctTp, "00")'>
                   AND PF.FEE_PDCT_TP_CD = #{schPdctTp}
              </if>
              <if test='!@MybatisUtils@equals(schFeePerf, "00")'>
                   AND PF.FEE_PERF_TP_CD = #{schFeePerf}
              </if>
                  LEFT OUTER JOIN TB_PDBS_SDING_PRC_BAS PSP
                    ON CD.BASE_PD_CD = PSP.PDCT_PD_CD
                   AND CB.CNTR_CNFM_DTM BETWEEN PSP.APY_STRTDT AND PSP.APY_ENDDT
                  LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ MC
                    ON CD.CNTR_NO = MC.BASE_CNTR_NO
                   AND CD.CNTR_SN = MC.BASE_CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_PMOT_IZ CP
                    ON CD.CNTR_NO = CP.DTL_CNTR_NO
                   AND CD.CNTR_SN = CP.DTL_CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL WD
                    ON CD.CNTR_NO = WD.CNTR_NO
                   AND CD.CNTR_SN = WD.CNTR_SN
                  LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS ROW_SCNT
                                              FROM TB_FEAM_WELS_SV_FEE_BAS A
                                             WHERE A.BASE_PD_CD = CD.BASE_PD_CD
                                               AND A.VST_MCN = 0
                                               AND SUBSTR(CB.CNTR_CNFM_DTM,0,6) BETWEEN A.APY_STRT_YM AND A.APY_END_YM
                                          )WS
                    ON 1=1
                  LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS EX_SCNT
                                              FROM TB_FEDD_FEE_PERF_EXCD_OJ_BAS A
                                             WHERE A.CNTR_NO = CD.CNTR_NO
                                               AND A.CNTR_SN = CD.CNTR_SN
                                               AND A.FEE_PERF_EXCD_DV_CD = '01'
                                          )EX
                    ON 1=1
                 WHERE CB.SELL_OG_TP_CD   = 'W02'
              <if test='!@MybatisUtils@equals(schDiv, "01")'>
                   AND CB.CNTR_CNFM_DTM BETWEEN #{schDtStrt} AND  #{schDtEnd} /* 계약확정일시 */
              </if>
              <if test='@MybatisUtils@isNotEmpty(schCancDtStrt)'>
                   AND CB.CNTR_CAN_DTM &gt;= #{schCancDtStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schCancDtEnd)'>
                   AND CB.CNTR_CAN_DTM &lt;= #{schCancDtEnd}
              </if>
              <if test='@MybatisUtils@equals(schSelType, "0") or @MybatisUtils@equals(schSelType, "7")'>
                 UNION
                SELECT MP.OG_ID /* 소속 !!!*/
                     , MP.PRTNR_NO  /* 번호 !!!*/
                     , MP.PRTNR_KNM  /* 성명 !!!*/
                     , CD.SELL_TP_CD /* 판매유형 !!!*/
                     , PF.FEE_PERF_TP_CD  /* 제품유형 !!!*/
                     , '' AS RGLR_SPP_PRC_DV_CD  /* 가격유형 !!!*/
                     , MC.MCHN_CH_TP_CD  /* 기변유형 !!!*/
                     , PF.FEE_PDCT_TP_CD  /* 수수료 실적유형 !!!*/
                     , CD.CNTR_NO||CD.CNTR_SN AS CNTR_DTL_CD    /* 계약상세번호 !!!*/
                     , CASE WHEN CB.COPN_DV_CD = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 !!!*/
                     , PP.PD_NM     /* 상품명 !!!*/
                     , PP.PD_CD     /* 상품코드 !!!*/
                     , CD.SELL_DSC_DV_CD AS LCETC3  /* 할인구분 !!!*/
                     , CD.SELL_DSC_TP_CD AS LCETC4  /* 할인유형 !!!*/
                     , '' AS PMOT_TP_CD /* 할인제도 !!!*/
                     , '' AS LCST04 /* 결합구분 !!!*/
                     , CD.ISTM_MCN AS LCMONT   /* 할부 !!!*/
                     , CD.STPL_PTRM            /* 약정개월 !!!*/
                     , CD.SV_PRD AS LCFLG3           /* 관리주기 !!!*/
                     , CD.ACKMT_PERF_AMT AS LCPAMT   /* 인정실적 !!!*/
                     , CD.FEE_ACKMT_BASE_AMT AS LCBAMT   /* 기준가격 !!!*/
                     , 0 AS HOMCARE /* 홈케어 !!!*/
                     , '' AS HOMCARE3_YEAR /* 홈케어멤버십3년 !!!!*/
                     , CD.FEE_FXAM_YN AS LCST13 /* 정액여부 !!!*/
                     , ''  AS LEASE_YN  /* 금융리스 ???? 일단임시 */
                     , CD.FEE_ACKMT_CT AS LCPCNT /* 가정 인정건수 !!!*/
                     , 0    AS NEW_LCPCNT /* 신규판매건수 ???? 일단임시*/
                     , CASE WHEN WS.ROW_SCNT = 1 THEN 'Y' END  AS BS_DAESANG /* BS대상 !!!!*/
                     , CD.RSTL_YN            /* 재약정여부 !!!*/
                     , RI.STPL_STRTDT AS LCCRTT /* 계약일자 !!!*/
                     , SC.SL_RCOG_DT AS LCSLET /* 매출일자 !!!*/
                     , CD.CNTR_PD_ENDDT AS LCCANT  /* 취소일자 !!!*/
                     , WD.REQD_DT AS LCDELDT  /* 철거일자!!!*/
                     , MO.DGR3_LEVL_DG_PRTNR_NO AS AKDBON /* 지점장번호 !!!*/
                     , MO.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM /* 지점장성명 !!!*/
                     , CD.SELL_AMT AS LCAMT1 /* 렌탈료 !!!*/
                     , '0' AS LCCK02 /* 프로모션번호!!!!! */
                     , '' AS LCRCDE /*패키지 상품번호!!!!!*/
                     , '' AS LCGSEQ     /* 패키지 일련번호!!!! */
                     , '' AS INTM_ORDR_NO /* 기기고객코드!!!! */
                     , '' AS INTM_ORDR_PRDT/* 기기상품코드!!! */
                     , CASE WHEN EX.EX_SCNT = 1 THEN 'Y' END AS EX_YN  /*실적제외등록여부!!! */
                  FROM TB_SSCT_RENTAL_RSTL_IZ RI
                 INNER JOIN TB_SSCT_CNTR_BAS CB
                    ON RI.CNTR_NO = CB.CNTR_NO
                 INNER JOIN TB_SSCT_CNTR_DTL CD
                    ON RI.CNTR_NO = CD.CNTR_NO
                   AND RI.CNTR_SN = CD.CNTR_SN
                   AND CD.SELL_TP_CD = '2'
              <if test='@MybatisUtils@equals(schDiv, "01") or @MybatisUtils@equals(schDiv, "02")'> /* 매출, 접수 */
                   AND CD.BOO_SELL_TP_CD = '2'
              </if>
              <if test='@MybatisUtils@equals(schDiv, "03")'> /* 예약 */
                   AND CD.BOO_SELL_TP_CD = '1'
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPkgCdStrt)'>
                   AND CD.HGR_PD_CD &gt;= #{schPkgCdStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPkgCdEnd)'>
                   AND CD.HGR_PD_CD &lt;= #{schPkgCdEnd}
              </if>
              <if test='@MybatisUtils@equals(schDiv, "01")'> /* 매출 */
                 INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                    ON RI.CNTR_NO = SC.CNTR_NO
                   AND RI.CNTR_SN = SC.CNTR_SN
                   AND SC.SL_RCOG_DT BETWEEN #{schDtStrt} AND #{schDtEnd}  /* 매출 확정일자 */
              </if>
              <if test='!@MybatisUtils@equals(schDiv, "01")'> /* 전체 */
                  LEFT OUTER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                    ON RI.CNTR_NO = SC.CNTR_NO
                   AND RI.CNTR_SN = SC.CNTR_SN
              </if>
                 INNER JOIN TB_OGBS_MM_PRTNR_IZ MP  /* 월파트너 */
                    ON RI.RCP_PRTNR_NO = MP.PRTNR_NO
                   AND RI.RCP_OG_TP_CD = MP.OG_TP_CD
                   AND MP.BASE_YM = SUBSTR(#{schDtStrt},0,6)
              <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
                   AND MP.PRTNR_NO = #{schPrtnrNo}
              </if>
                 INNER JOIN TB_OGBS_MM_OG_IZ MO  /* 월조직 */
                    ON MP.BASE_YM = MO.BASE_YM
                   AND MP.OG_ID = MO.OG_ID
                   AND MP.OG_TP_CD = MO.OG_TP_CD
              <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
                   AND MO.DGR1_LEVL_OG_ID = #{ogLevl1}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
                   AND MO.DGR2_LEVL_OG_ID = #{ogLevl2}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
                   AND MO.DGR3_LEVL_OG_ID = #{ogLevl3}
              </if>
                 INNER JOIN TB_PDBS_PD_BAS PP
                    ON CD.BASE_PD_CD = PP.PD_CD
              <if test='@MybatisUtils@isNotEmpty(schPdCdStrt)'>
                   AND PP.PD_CD &gt;= #{schPdCdStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schPdCdEnd)'>
                   AND PP.PD_CD &lt;=  #{schPdCdEnd}
              </if>
                 INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS PD
                    ON CD.BASE_PD_CD = PD.BASE_PD_CD
                   AND SUBSTR(#{schDtStrt},0,6) BETWEEN APY_STRT_YM AND APY_END_YM
                 INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS PF
                    ON PD.FEE_PDCT_TP_CD1 = PF.FEE_PDCT_TP_CD
                   AND CD.SELL_TP_CD = PF.SELL_TP_CD
              <if test='!@MybatisUtils@equals(schPdctTp, "00")'>
                   AND PF.FEE_PDCT_TP_CD = #{schPdctTp}
              </if>
              <if test='!@MybatisUtils@equals(schFeePerf, "00")'>
                   AND PF.FEE_PERF_TP_CD = #{schFeePerf}
              </if>
                  LEFT OUTER JOIN TB_PDBS_SDING_PRC_BAS PSP
                    ON CD.BASE_PD_CD = PSP.PDCT_PD_CD
                   AND RI.STPL_STRTDT BETWEEN PSP.APY_STRTDT AND PSP.APY_ENDDT
                  LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ MC
                    ON RI.CNTR_NO = MC.BASE_CNTR_NO
                   AND RI.CNTR_SN = MC.BASE_CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_PMOT_IZ CP
                    ON RI.CNTR_NO = CP.DTL_CNTR_NO
                   AND RI.CNTR_SN = CP.DTL_CNTR_SN
                  LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL WD
                    ON RI.CNTR_NO = WD.CNTR_NO
                   AND RI.CNTR_SN = WD.CNTR_SN
                  LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS ROW_SCNT
                                             FROM TB_FEAM_WELS_SV_FEE_BAS A
                                            WHERE A.BASE_PD_CD = CD.BASE_PD_CD
                                              AND A.VST_MCN = 0
                                              AND SUBSTR(RI.STPL_STRTDT,0,6) BETWEEN A.APY_STRT_YM AND A.APY_END_YM
                                          )WS
                    ON 1=1
                  LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS EX_SCNT
                                              FROM TB_FEDD_FEE_PERF_EXCD_OJ_BAS A
                                             WHERE A.CNTR_NO = RI.CNTR_NO
                                               AND A.CNTR_SN = RI.CNTR_SN
                                               AND A.FEE_PERF_EXCD_DV_CD = '01'
                                          )EX
                    ON 1=1
                 WHERE CB.SELL_OG_TP_CD   = 'W02'
              <if test='!@MybatisUtils@equals(schDiv, "01")'>
                   AND RI.STPL_STRTDT BETWEEN #{schDtStrt} AND  #{schDtEnd} /* 계약확정일시 */
              </if>
              <if test='@MybatisUtils@isNotEmpty(schCancDtStrt)'>
                   AND RI.STPL_CAN_DTM &gt;= #{schCancDtStrt}
              </if>
              <if test='@MybatisUtils@isNotEmpty(schCancDtEnd)'>
                   AND RI.STPL_CAN_DTM &lt;= #{schCancDtEnd}
              </if>
              </if>
               )T
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON T.SELL_TP_CD = CD1.CD_VLD_VAL
           AND CD1.TENANT_ID = 'TNT_WELLS'
           AND CD1.CD_ID = 'SELL_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD2
            ON T.FEE_PERF_TP_CD = CD2.CD_VLD_VAL
           AND CD2.TENANT_ID = 'TNT_WELLS'
           AND CD2.CD_ID = 'FEE_PERF_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD3
            ON T.RGLR_SPP_PRC_DV_CD = CD3.CD_VLD_VAL
           AND CD3.TENANT_ID = 'TNT_WELLS'
           AND CD3.CD_ID = 'RGLR_SPP_PRC_DV_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD4
            ON T.MCHN_CH_TP_CD = CD4.CD_VLD_VAL
           AND CD4.TENANT_ID = 'TNT_WELLS'
           AND CD4.CD_ID = 'MCHN_CH_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD5
            ON T.FEE_PDCT_TP_CD = CD5.CD_VLD_VAL
           AND CD5.TENANT_ID = 'TNT_WELLS'
           AND CD5.CD_ID = 'FEE_PDCT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD6
            ON T.PMOT_TP_CD = CD6.CD_VLD_VAL
           AND CD6.TENANT_ID = 'TNT_WELLS'
           AND CD6.CD_ID = 'PMOT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD7
            ON T.LCETC3 = CD7.CD_VLD_VAL
           AND CD7.TENANT_ID = 'TNT_WELLS'
           AND CD7.CD_ID = 'SELL_DSC_DV_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD8
            ON T.LCETC4 = CD8.CD_VLD_VAL
           AND CD8.TENANT_ID = 'TNT_WELLS'
           AND CD8.CD_ID = 'SELL_DSC_TP_CD'
    </select>

    <select id='selectManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchMngerSellFeeRes">
        SELECT T3.DGR1_LEVL_OG_NM AS OG1_LV
             , T3.DGR2_LEVL_OG_NM AS OG2_LV
             , T3.DGR3_LEVL_OG_NM AS OG3_LV
             , T2.PRTNR_NO
             , T2.PRTNR_KNM
             , T1.CNTR_NO||T1.CNTR_SN AS CNTR_DTL_NO
             , T1.RCPDT
             , T1.SL_DT
             , T1.CAN_DT
             , CD2.CD_CNTN AS FEE_PDCT_TP_CD
             , T1.PD_CD
             , CD3.CD_CNTN AS FEE_PERF_TP_CD
             , T4.PD_NM
             , T1.ACKMT_PERF_CT
             , T1.BFSVC_PRD_CD
             , CD1.CD_CNTN AS MCHN_CH_TP_CD
          FROM TB_FEAM_WELS_NRCTR_MM_CL T1
         INNER JOIN TB_OGBS_MM_PRTNR_IZ T2  /* 월파트너 */
            ON T1.PRTNR_NO = T2.PRTNR_NO
           AND T1.OG_TP_CD = T2.OG_TP_CD
           AND T1.BASE_YM = T2.BASE_YM
      <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
           AND T2.PRTNR_NO = #{schPrtnrNo}
      </if>
         INNER JOIN TB_OGBS_MM_OG_IZ T3  /* 월조직 */
            ON T2.BASE_YM = T3.BASE_YM
           AND T2.OG_ID = T3.OG_ID
           AND T2.OG_TP_CD = T3.OG_TP_CD
      <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
           AND T3.DGR1_LEVL_OG_ID = #{ogLevl1}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
           AND T3.DGR2_LEVL_OG_ID = #{ogLevl2}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
           AND T3.DGR3_LEVL_OG_ID = #{ogLevl3}
      </if>
         INNER JOIN TB_PDBS_PD_BAS T4
            ON T1.PD_CD = T4.PD_CD
         INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T5
            ON T1.PD_CD = T5.BASE_PD_CD
           AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
         INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T6
            ON T5.FEE_PDCT_TP_CD1 = T6.FEE_PDCT_TP_CD
           AND T1.SELL_TP_CD = T6.SELL_TP_CD
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON T1.MCHN_CH_TP_CD = CD1.CD_VLD_VAL
           AND CD1.TENANT_ID = 'TNT_WELLS'
           AND CD1.CD_ID = 'MCHN_CH_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD2
            ON T5.FEE_PDCT_TP_CD1 = CD2.CD_VLD_VAL
           AND CD2.TENANT_ID = 'TNT_WELLS'
           AND CD2.CD_ID = 'FEE_PDCT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD3
            ON T6.FEE_PERF_TP_CD = CD3.CD_VLD_VAL
           AND CD3.TENANT_ID = 'TNT_WELLS'
           AND CD3.CD_ID = 'FEE_PERF_TP_CD'
         WHERE T1.BASE_YM = #{schPerfYm}
           AND T1.FEE_TCNT_DV_CD = #{schOrdr}
           AND T1.OG_TP_CD = 'W02'
           AND T1.CNTR_PERF_CRT_DV_CD = '01'
    </select>

    <select id='selectManagerAggregation'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchMngerAgrgRes">
        SELECT T2.OG_ID
             , M.PRTNR_NO
             , T2.PRTNR_KNM
             , T2.PSTN_DV_CD
             , MAX(M.EH_CNT) AS EH_CNT
             , MAX(M.EX_CNT) AS EX_CNT
             , MAX(M.ET_CNT) AS ET_CNT
             , MAX(M.UP_CNT) AS UP_CNT
             , MAX(M.EH_CNT)+ MAX(M.EX_CNT)+ MAX(M.ET_CNT)+ MAX(M.UP_CNT) AS TOT_CNT
             , MAX(M.EH_AMT) AS EH_AMT
             , MAX(M.EX_AMT) AS EX_AMT
             , MAX(M.ET_AMT) AS ET_AMT
             , MAX(M.UP_AMT) AS UP_AMT
             , MAX(M.EH_AMT)+ MAX(M.EX_AMT)+ MAX(M.ET_AMT)+ MAX(M.UP_AMT) AS TOT_AMT
             , MAX(M.EH_CNT) AS EH_PERF_CNT
             , MAX(M.EH_AMT1) AS EH_AMT1
             , MAX(M.EH_AMT2) AS EH_AMT2
             , MAX(M.EH_MC_CNT) AS EH_MC_CNT
             , MAX(M.FXAM_CNT) AS FXAM_CNT
             , MAX(M.LPK_CNT) AS LPK_CNT
             , MAX(M.HMB_CNT) AS HMB_CNT
          FROM ( SELECT T.PRTNR_NO
                      , NVL(SUM(EH_CNT),0) AS EH_CNT
                      , NVL(SUM(EX_CNT),0) AS EX_CNT
                      , NVL(SUM(ET_CNT),0) AS ET_CNT
                      , NVL(SUM(UP_CNT),0) AS UP_CNT
                      , 0 AS EH_AMT
                      , 0 AS EX_AMT
                      , 0 AS ET_AMT
                      , 0 AS UP_AMT
                      , 0 AS EH_AMT1
                      , 0 AS EH_AMT2
                      , 0 AS EH_MC_CNT
                      , 0 AS FXAM_CNT
                      , 0 AS LPK_CNT
                      , 0 AS HMB_CNT
                   FROM ( SELECT T1.PRTNR_NO
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EH' THEN T1.ACKMT_PERF_CT END AS EH_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EX' THEN T1.ACKMT_PERF_CT END AS EX_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'ET' THEN T1.ACKMT_PERF_CT END AS ET_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'UP' THEN T1.ACKMT_PERF_CT END AS UP_CNT
                            FROM TB_FEAM_WELS_NRCTR_MM_CL T1
                           INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T2
                              ON T1.PD_CD = T2.BASE_PD_CD
                             AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
                           INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T3
                              ON T2.FEE_PDCT_TP_CD1 = T3.FEE_PDCT_TP_CD
                             AND T1.SELL_TP_CD = T3.SELL_TP_CD
                           WHERE T1.BASE_YM = #{schPerfYm}
                             AND T1.OG_TP_CD = 'W02'
                             AND T1.FEE_TCNT_DV_CD = #{schOrdr}
                             AND T1.CNTR_PERF_CRT_DV_CD = '01'
                             AND T1.ACKMT_PERF_CT > 0
                        )T
                  GROUP BY T.PRTNR_NO
                  UNION
                 SELECT T.PRTNR_NO
                      , 0 AS EH_CNT
                      , 0 AS EX_CNT
                      , 0 AS ET_CNT
                      , 0 AS UP_CNT
                      , NVL(SUM(EH_AMT),0) AS EH_AMT
                      , NVL(SUM(EX_AMT),0) AS EX_AMT
                      , NVL(SUM(ET_AMT),0) AS ET_AMT
                      , NVL(SUM(UP_AMT),0) AS UP_AMT
                      , 0 AS EH_AMT1
                      , 0 AS EH_AMT2
                      , 0 AS EH_MC_CNT
                      , 0 AS FXAM_CNT
                      , 0 AS LPK_CNT
                      , 0 AS HMB_CNT
                   FROM ( SELECT T1.PRTNR_NO
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EH' THEN T1.ACKMT_PERF_AMT END AS EH_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EX' THEN T1.ACKMT_PERF_AMT END AS EX_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'ET' THEN T1.ACKMT_PERF_AMT END AS ET_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'UP' THEN T1.ACKMT_PERF_AMT END AS UP_AMT
                            FROM TB_FEAM_WELS_NRCTR_MM_CL T1
                           INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T2
                              ON T1.PD_CD = T2.BASE_PD_CD
                             AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
                           INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T3
                              ON T2.FEE_PDCT_TP_CD1 = T3.FEE_PDCT_TP_CD
                             AND T1.SELL_TP_CD = T3.SELL_TP_CD
                           WHERE T1.BASE_YM = #{schPerfYm}
                             AND T1.OG_TP_CD = 'W02'
                             AND T1.FEE_TCNT_DV_CD = #{schOrdr}
                             AND T1.CNTR_PERF_CRT_DV_CD = '01'
                             AND T1.ACKMT_PERF_AMT > 0
                        )T
                  GROUP BY T.PRTNR_NO
                  UNION
                 SELECT T.PRTNR_NO
                      , 0 AS EH_CNT
                      , 0 AS EX_CNT
                      , 0 AS ET_CNT
                      , 0 AS UP_CNT
                      , 0 AS EH_AMT
                      , 0 AS EX_AMT
                      , 0 AS ET_AMT
                      , 0 AS UP_AMT
                      , NVL(SUM(EH_AMT1),0) AS EH_AMT1
                      , NVL(SUM(EH_AMT2),0) AS EH_AMT2
                      , NVL(SUM(EH_MC_CNT),0) AS EH_MC_CNT
                      , NVL(SUM(FXAM_CNT),0) AS FXAM_CNT
                      , NVL(SUM(LPK_CNT),0) AS LPK_CNT
                      , NVL(SUM(HMB_CNT),0) AS HMB_CNT
                   FROM ( SELECT T1.PRTNR_NO
                               , CASE WHEN T1.PERF_ATC_CD = 'W00P00003' THEN T1.PERF_VAL END AS EH_AMT1 /* 가전렌탈 */
                               , CASE WHEN T1.PERF_ATC_CD = 'W00P00004' THEN T1.PERF_VAL END AS EH_AMT2 /* 가전일시불 */
                               , CASE WHEN T1.PERF_ATC_CD = 'W02P00104' THEN T1.PERF_VAL END AS EH_MC_CNT /* 기변건수 */
                               , CASE WHEN T1.PERF_ATC_CD IN ('W00P00005','W00P00007') THEN 1 END AS FXAM_CNT /* 환경정액 , 환경외정액 */
                               , CASE WHEN T1.PERF_ATC_CD = 'W02P00105' THEN 1 END AS LPK_CNT   /* 라이브팩 */
                               , CASE WHEN T1.PERF_ATC_CD = 'W00P00081' THEN 1 END AS HMB_CNT /* 홈케어멤버십 */
                            FROM TB_FEAM_NTORP_PERF_MM_CL T1
                           WHERE T1.BASE_YM = #{schPerfYm}
                             AND T1.OG_TP_CD = 'W02'
                             AND T1.FEE_TCNT_DV_CD = #{schOrdr}
                             AND T1.PERF_AGRG_CRT_DV_CD = '201'  /* M추진단순주문실적생성 */
                             AND T1.PERF_DV_CD = '0'             /* 개인 */
                             AND T1.PERF_ATC_CD IN ('W00P00003','W00P00004','W02P00104','W00P00005','W00P00007','W02P00105','W00P00081')    /* 실적코드 */
                             AND T1.PERF_VAL > 0
                        )T
                  GROUP BY T.PRTNR_NO
               )M
         INNER JOIN TB_OGBS_MM_PRTNR_IZ T2  /* 월파트너 */
            ON M.PRTNR_NO = T2.PRTNR_NO
           AND T2.OG_TP_CD = 'W02'
           AND T2.BASE_YM = #{schPerfYm}
      <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
           AND T2.PRTNR_NO = #{schPrtnrNo}
      </if>
      <if test='@MybatisUtils@equals(schRsbDv, "00")'>
           AND T2.PSTN_DV_CD IN ('7','15')
      </if>
      <if test='!@MybatisUtils@equals(schRsbDv, "00")'>
           AND T2.PSTN_DV_CD = #{schRsbDv}
      </if>
         INNER JOIN TB_OGBS_MM_OG_IZ T3  /* 월조직 */
            ON T2.BASE_YM = T3.BASE_YM
           AND T2.OG_ID = T3.OG_ID
           AND T2.OG_TP_CD = T3.OG_TP_CD
      <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
           AND T3.DGR1_LEVL_OG_ID = #{ogLevl1}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
           AND T3.DGR2_LEVL_OG_ID = #{ogLevl2}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
           AND T3.DGR3_LEVL_OG_ID = #{ogLevl3}
      </if>
         GROUP BY T2.OG_ID, M.PRTNR_NO, T2.PRTNR_KNM, T2.PSTN_DV_CD
    </select>

    <select id='selectPlanners'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchPlarRes">
        SELECT T.OG1_LV /* 총괄단 !!!*/
             , T.OG2_LV /* 지역단 !!!*/
             , T.OG3_LV /* 지점 !!!*/
             , T.PRTNR_NO AS SEQUENCE_NUMBER /* 번호 !!!*/
             , T.PRTNR_KNM AS EMPL_NM /* 성명 !!!*/
             , CD1.CD_CNTN AS SEL_TYPE /* 판매유형 !!!*/
             , CD2.CD_CNTN AS PDCT_TP  /* 제품유형 !!!*/
             , CD4.CD_CNTN AS CHDVC_TP  /* 기변유형 !!!*/
             , CD5.CD_CNTN AS FEE  /* 수수료 실적유형 !!!*/
             , T.CNTR_DTL_CD AS CNTR_DTL_NO   /* 계약상세번호 !!!*/
             , T.LCCGUB AS CST_DV   /* 고객구분 !!!*/
             , T.PD_NM AS PRDT_NM    /* 상품명 !!!*/
             , T.PD_CD AS PRDT_CODE    /* 상품코드 !!!*/
             , '' AS USWY            /* 용도???? 일단임시*/
             , CD7.CD_CNTN AS PD_DC_CLASS /* 할인구분 !!!*/
             , CD8.CD_CNTN AS DISC_CODE /* 할인유형 !!!*/
             , CD6.CD_CNTN AS DSC_SYST /* 할인제도 !!!*/
             , T.LCST04 AS COMBI_DV /* 결합구분 !!!*/
             , T.DP_PERF        /* 입금실적 !!!*/
             , T.LCMONT AS ISTM  /* 할부 !!!*/
             , T.HOMCARE AS HOME_CARE /* 홈케어 !!!*/
             , T.HOMCARE3_YEAR AS HCR_MSH_Y3 /* 홈케어멤버십3년 !!!!*/
             , T.LCST13 AS FXAM_YN /* 정액여부 !!!*/
             , T.LEASE_YN AS FNN_LEASE /* 금융리스 ???? 일단임시 */
             , T.RSTL_YN AS RECOMMITMENT           /* 재약정여부 !!!*/
             , T.LCCRTT AS CNTR_DATE /* 계약일자 !!!*/
             , T.LCSLET AS SL_DT /* 매출일자 !!!*/
             , T.LCCANT AS CANC_DT /* 취소일자 !!!*/
             , T.AKDBON AS BRMGR_NO /* 지점장번호 !!!*/
             , T.AKDBNM AS BRMGR_FNM /* 지점장성명 !!!*/
             , T.LCAMT1 AS RTLFE /* 렌탈료 !!!*/
             , T.STPL_PTRM AS STPL_MCNT           /* 약정개월 !!!*/
             , T.LCFLG3 AS MNGT_PRD          /* 관리주기 !!!*/
             , T.LCPAMT AS PD_ACC_RSLT   /* 인정실적 !!!*/
             , T.LCCK02 AS PMOT_NO /* 프로모션번호!!!!! */
             , T.LCGSEQ AS PKG_SN    /* 패키지 일련번호??? 렌탈, 멤버십 LCET14 없음 일단 임시 */
             , T.LCRCDE AS PKG_NO /*패키지 번호!!!!!*/
             , T2.BASE_YM AS NTOR_MM
             , T.INTM_ORDR_PRDT AS MCHN_PD /* 기기코드!!! */
             , NVL(T.EX_YN,'N') AS PERF_EXCD /*실적제외등록여부!!! */
             , SUBSTR(T.CNTR_DT,0,6) AS BIZ_RGST_MM /*업무등록월 !!!*/
             , TRUNC(MONTHS_BETWEEN(SYSDATE,TO_DATE(T.CNTR_DT,'YYYY-MM-DD'))) AS BIZ_RGST_NM /*업무등록차월 !!!*/
          FROM ( SELECT MO.DGR1_LEVL_OG_NM AS OG1_LV /* 총괄단 !!!*/
                      , MO.DGR2_LEVL_OG_NM AS OG2_LV /* 지역단 !!!*/
                      , MO.DGR3_LEVL_OG_NM AS OG3_LV /* 지점 !!!*/
                      , MP.PRTNR_NO  /* 번호 !!!*/
                      , MP.PRTNR_KNM  /* 성명 !!!*/
                      , CD.SELL_TP_CD /* 판매유형 !!!*/
                      , PF.FEE_PERF_TP_CD  /* 제품유형 !!!*/
                      , MC.MCHN_CH_TP_CD  /* 기변유형 !!!*/
                      , PF.FEE_PDCT_TP_CD
                      , CD.CNTR_NO||CD.CNTR_SN AS CNTR_DTL_CD   /* 계약상세번호 !!!*/
                      , CASE WHEN CB.COPN_DV_CD = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 !!!*/
                      , PP.PD_NM     /* 상품명 !!!*/
                      , PP.PD_CD     /* 상품코드 !!!*/
                      , CD.SELL_DSC_DV_CD AS LCETC3  /* 할인구분 !!!*/
                      , CD.SELL_DSC_TP_CD AS LCETC4  /* 할인유형 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN CP.PMOT_TP_CD END AS PMOT_TP_CD /* 할인제도 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' AND PSP.RGLR_SPP_PRC_DV_CD = 4 THEN 'Y' END AS LCST04 /* 결합구분 !!!*/
                      , CPC.FNL_VAL AS DP_PERF  /* 입금실적 */
                      , CD.ISTM_MCN AS LCMONT   /* 할부 !!!*/
                      , CD.STPL_PTRM            /* 약정개월 !!!*/
                      , CD.SV_PRD AS LCFLG3           /* 관리주기 !!!*/
                      , CD.ACKMT_PERF_AMT AS LCPAMT   /* 인정실적 !!!*/
                      , CASE WHEN PF.FEE_PDCT_TP_CD = 'E' THEN ( CASE WHEN CD.SELL_TP_CD = '6' THEN (CD.SELL_AMT- CD.CNTRAM_DSC_AMT )/ CD.SV_PRD
                                                                      ELSE CD.SELL_AMT
                                                                 END )
                             ELSE 0
                        END AS HOMCARE /* 홈케어 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '3' AND CD.STPL_PTRM = 36 THEN 'Y'
                             ELSE ' '
                        END  AS HOMCARE3_YEAR /* 홈케어멤버십3년 !!!!*/
                      , CD.FEE_FXAM_YN AS LCST13 /* 정액여부 !!!*/
                      , '' AS LEASE_YN  /* 금융리스 ???? 일단임시 */
                      , CD.RSTL_YN            /* 재약정여부 !!!*/
                      , CB.CNTR_CNFM_DTM AS LCCRTT /* 계약일자 !!!*/
                      , SC.SL_RCOG_DT AS LCSLET /* 매출일자 !!!*/
                      , CD.CNTR_PD_ENDDT AS LCCANT  /* 취소일자 !!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NO AS AKDBON /* 지점장번호 !!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM /* 지점장성명 !!!*/
                      , CD.SELL_AMT AS LCAMT1 /* 렌탈료 !!!*/
                      , CASE WHEN CD.SELL_TP_CD = '2' THEN CP.PMOT_CD
                             ELSE '0'
                        END AS LCCK02 /* 프로모션번호!!!!! */
                      , CASE WHEN CD.SELL_TP_CD IN ('2','3') THEN ''
                             ELSE ''
                        END AS LCGSEQ     /* 패키지 일련번호??? 렌탈, 멤버십 LCET14 없음 일단 임시 */
                      , CASE WHEN CD.SELL_TP_CD = '2' THEN CD.HGR_PD_CD
                             ELSE '0'
                        END AS LCRCDE /*패키지 상품번호!!!!!*/
                      , CASE WHEN CD.SELL_TP_CD = '6' THEN PP.PD_CD
                        END AS INTM_ORDR_PRDT/* 기기코드!!! */
                      , CASE WHEN EX.EX_SCNT = 1 THEN 'Y'
                        END AS EX_YN  /*실적제외등록여부!!! */
                      , MP.BASE_YM
                      , MP.OG_TP_CD
                      , MP.CNTR_DT
                   FROM TB_SSCT_CNTR_BAS CB
                  INNER JOIN TB_SSCT_CNTR_DTL CD
                     ON CB.CNTR_NO = CD.CNTR_NO
               <if test='@MybatisUtils@equals(schSelType, "0")'>
                    AND CD.SELL_TP_CD IN ('1','2','3','6')
               </if>
               <if test='@MybatisUtils@equals(schSelType, "7")'>
                    AND 1 = 2 /* 재약정은 따로 조회*/
               </if>
               <if test='!@MybatisUtils@equals(schSelType, "0") and !@MybatisUtils@equals(schSelType, "7")'>
                    AND CD.SELL_TP_CD = #{schSelType}
               </if>
               <if test='@MybatisUtils@equals(schDiv, "01") or @MybatisUtils@equals(schDiv, "02")'> /* 매출, 접수 */
                    AND CD.BOO_SELL_TP_CD = '2'
               </if>
               <if test='@MybatisUtils@equals(schDiv, "03")'> /* 예약 */
                    AND CD.BOO_SELL_TP_CD = '1'
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPkgCdStrt)'>
                    AND CD.HGR_PD_CD &gt;= #{schPkgCdStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPkgCdEnd)'>
                    AND CD.HGR_PD_CD &lt;= #{schPkgCdEnd}
               </if>
               <if test='@MybatisUtils@equals(schDiv, "01")'> /* 매출 */
                  INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                     ON CD.CNTR_NO = SC.CNTR_NO
                    AND CD.CNTR_SN = SC.CNTR_SN
                    AND SC.SL_RCOG_DT BETWEEN #{schDtStrt} AND #{schDtEnd}  /* 매출 확정일자 */
               </if>
               <if test='!@MybatisUtils@equals(schDiv, "01")'> /* 전체 */
                   LEFT OUTER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                     ON CD.CNTR_NO = SC.CNTR_NO
                    AND CD.CNTR_SN = SC.CNTR_SN
               </if>
                  INNER JOIN TB_OGBS_MM_PRTNR_IZ MP  /* 월파트너 */
                     ON CB.SELL_PRTNR_NO = MP.PRTNR_NO
                    AND CB.SELL_OG_TP_CD = MP.OG_TP_CD
                    AND MP.BASE_YM = SUBSTR(#{schDtStrt},0,6)
               <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
                    AND MP.PRTNR_NO = #{schPrtnrNo}
               </if>
                  INNER JOIN TB_OGBS_MM_OG_IZ MO  /* 월조직 */
                     ON MP.BASE_YM = MO.BASE_YM
                    AND MP.OG_ID = MO.OG_ID
                    AND MP.OG_TP_CD = MO.OG_TP_CD
               <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
                    AND MO.DGR1_LEVL_OG_ID = #{ogLevl1}
               </if>
               <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
                    AND MO.DGR2_LEVL_OG_ID = #{ogLevl2}
               </if>
               <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
                    AND MO.DGR3_LEVL_OG_ID = #{ogLevl3}
               </if>
                  INNER JOIN TB_PDBS_PD_BAS PP
                     ON CD.BASE_PD_CD = PP.PD_CD
               <if test='@MybatisUtils@isNotEmpty(schPdCdStrt)'>
                    AND PP.PD_CD &gt;= #{schPdCdStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPdCdEnd)'>
                    AND PP.PD_CD &lt;=  #{schPdCdEnd}
               </if>
                  INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS PD
                     ON CD.BASE_PD_CD = PD.BASE_PD_CD
                    AND SUBSTR(#{schDtStrt},0,6) BETWEEN APY_STRT_YM AND APY_END_YM
                  INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS PF
                     ON PD.FEE_PDCT_TP_CD1 = PF.FEE_PDCT_TP_CD
                    AND CD.SELL_TP_CD = PF.SELL_TP_CD
               <if test='!@MybatisUtils@equals(schPdctTp, "00")'>
                    AND PF.FEE_PDCT_TP_CD = #{schPdctTp}
               </if>
               <if test='!@MybatisUtils@equals(schFeePerf, "00")'>
                    AND PF.FEE_PERF_TP_CD = #{schFeePerf}
               </if>
                   LEFT OUTER JOIN TB_PDBS_SDING_PRC_BAS PSP
                     ON CD.BASE_PD_CD = PSP.PDCT_PD_CD
                    AND CB.CNTR_CNFM_DTM BETWEEN PSP.APY_STRTDT AND PSP.APY_ENDDT
                   LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ MC
                     ON CD.CNTR_NO = MC.BASE_CNTR_NO
                    AND CD.CNTR_SN = MC.BASE_CNTR_SN
                   LEFT OUTER JOIN TB_SSCT_CNTR_PMOT_IZ CP
                     ON CD.CNTR_NO = CP.DTL_CNTR_NO
                    AND CD.CNTR_SN = CP.DTL_CNTR_SN
                   LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS ROW_SCNT
                                               FROM TB_FEAM_WELS_SV_FEE_BAS A
                                              WHERE A.BASE_PD_CD = CD.BASE_PD_CD
                                                AND A.VST_MCN = 0
                                                AND SUBSTR(CB.CNTR_CNFM_DTM,0,6) BETWEEN A.APY_STRT_YM AND A.APY_END_YM
                                           )WS
                     ON 1=1
                   LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS EX_SCNT
                                               FROM TB_FEDD_FEE_PERF_EXCD_OJ_BAS A
                                              WHERE A.CNTR_NO = CD.CNTR_NO
                                                AND A.CNTR_SN = CD.CNTR_SN
                                                AND A.FEE_PERF_EXCD_DV_CD = '01'
                                           )EX
                     ON 1=1
                   LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ CPC
                     ON CD.CNTR_NO = CPC.CNTR_NO
                    AND CD.CNTR_SN = CPC.CNTR_SN
                  WHERE CB.SELL_OG_TP_CD   = 'W01'
               <if test='!@MybatisUtils@equals(schDiv, "01")'>
                    AND CB.CNTR_CNFM_DTM BETWEEN #{schDtStrt} AND  #{schDtEnd} /* 계약확정일시 */
               </if>
               <if test='@MybatisUtils@isNotEmpty(schCancDtStrt)'>
                    AND CB.CNTR_CAN_DTM &gt;= #{schCancDtStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schCancDtEnd)'>
                    AND CB.CNTR_CAN_DTM &lt;= #{schCancDtEnd}
               </if>
               <if test='@MybatisUtils@equals(schSelType, "0") or @MybatisUtils@equals(schSelType, "7")'>
                 UNION
                 SELECT MO.DGR1_LEVL_OG_NM AS OG1_LV /* 총괄단 !!!*/
                      , MO.DGR2_LEVL_OG_NM AS OG2_LV /* 지역단 !!!*/
                      , MO.DGR3_LEVL_OG_NM AS OG3_LV /* 지점 !!!*/
                      , MP.PRTNR_NO  /* 번호 !!!*/
                      , MP.PRTNR_KNM  /* 성명 !!!*/
                      , CD.SELL_TP_CD /* 판매유형 !!!*/
                      , PF.FEE_PERF_TP_CD  /* 제품유형 !!!*/
                      , MC.MCHN_CH_TP_CD  /* 기변유형 !!!*/
                      , PF.FEE_PDCT_TP_CD
                      , CD.CNTR_NO||CD.CNTR_SN AS CNTR_DTL_CD    /* 계약상세번호 !!!*/
                      , CASE WHEN CB.COPN_DV_CD = '2' THEN  '사업' ELSE '개인' END AS LCCGUB    /* 고객구분 !!!*/
                      , PP.PD_NM     /* 상품명 !!!*/
                      , PP.PD_CD     /* 상품코드 !!!*/
                      , CD.SELL_DSC_DV_CD AS LCETC3  /* 할인구분 !!!*/
                      , CD.SELL_DSC_TP_CD AS LCETC4  /* 할인유형 !!!*/
                      , '' AS PMOT_TP_CD /* 할인제도 !!!*/
                      , '' AS LCST04 /* 결합구분 !!!*/
                      , CPC.FNL_VAL AS DP_PERF  /* 입금실적 */
                      , CD.ISTM_MCN AS LCMONT   /* 할부 !!!*/
                      , CD.STPL_PTRM            /* 약정개월 !!!*/
                      , CD.SV_PRD AS LCFLG3           /* 관리주기 !!!*/
                      , CD.ACKMT_PERF_AMT AS LCPAMT   /* 인정실적 !!!*/
                      , 0 AS HOMCARE /* 홈케어 !!!*/
                      , '' AS HOMCARE3_YEAR /* 홈케어멤버십3년 !!!!*/
                      , CD.FEE_FXAM_YN AS LCST13 /* 정액여부 !!!*/
                      , ''  AS LEASE_YN  /* 금융리스 ???? 일단임시 */
                      , CD.RSTL_YN            /* 재약정여부 !!!*/
                      , RI.STPL_STRTDT AS LCCRTT /* 계약일자 !!!*/
                      , SC.SL_RCOG_DT AS LCSLET /* 매출일자 !!!*/
                      , CD.CNTR_PD_ENDDT AS LCCANT  /* 취소일자 !!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NO AS AKDBON /* 지점장번호 !!!*/
                      , MO.DGR3_LEVL_DG_PRTNR_NM AS AKDBNM /* 지점장성명 !!!*/
                      , CD.SELL_AMT AS LCAMT1 /* 렌탈료 !!!*/
                      , '0' AS LCCK02 /* 프로모션번호!!!!! */
                      , '' AS LCGSEQ     /* 패키지 일련번호!!!! */
                      , '' AS LCRCDE /*패키지 상품번호!!!!!*/
                      , '' AS INTM_ORDR_PRDT/* 기기코드!!! */
                      , CASE WHEN EX.EX_SCNT = 1 THEN 'Y' END AS EX_YN  /*실적제외등록여부!!! */
                      , MP.BASE_YM
                      , MP.OG_TP_CD
                      , MP.CNTR_DT
                   FROM TB_SSCT_RENTAL_RSTL_IZ RI
                  INNER JOIN TB_SSCT_CNTR_BAS CB
                     ON RI.CNTR_NO = CB.CNTR_NO
                  INNER JOIN TB_SSCT_CNTR_DTL CD
                     ON RI.CNTR_NO = CD.CNTR_NO
                    AND RI.CNTR_SN = CD.CNTR_SN
                    AND CD.SELL_TP_CD = '2'
               <if test='@MybatisUtils@equals(schDiv, "01") or @MybatisUtils@equals(schDiv, "02")'> /* 매출, 접수 */
                    AND CD.BOO_SELL_TP_CD = '2'
               </if>
               <if test='@MybatisUtils@equals(schDiv, "03")'> /* 예약 */
                    AND CD.BOO_SELL_TP_CD = '1'
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPkgCdStrt)'>
                    AND CD.HGR_PD_CD &gt;= #{schPkgCdStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPkgCdEnd)'>
                    AND CD.HGR_PD_CD &lt;= #{schPkgCdEnd}
               </if>
               <if test='@MybatisUtils@equals(schDiv, "01")'> /* 매출 */
                  INNER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                     ON RI.CNTR_NO = SC.CNTR_NO
                    AND RI.CNTR_SN = SC.CNTR_SN
                    AND SC.SL_RCOG_DT BETWEEN #{schDtStrt} AND #{schDtEnd}  /* 매출 확정일자 */
               </if>
               <if test='!@MybatisUtils@equals(schDiv, "01")'> /* 전체 */
                   LEFT OUTER JOIN TB_CBCL_WELLS_SL_CNFM_BAS SC   /*T WELLS매출확정기본 T*/
                     ON RI.CNTR_NO = SC.CNTR_NO
                    AND RI.CNTR_SN = SC.CNTR_SN
               </if>
                  INNER JOIN TB_OGBS_MM_PRTNR_IZ MP  /* 월파트너 */
                     ON RI.RCP_PRTNR_NO = MP.PRTNR_NO
                    AND RI.RCP_OG_TP_CD = MP.OG_TP_CD
                    AND MP.BASE_YM = SUBSTR(#{schDtStrt},0,6)
               <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
                    AND MP.PRTNR_NO = #{schPrtnrNo}
               </if>
                  INNER JOIN TB_OGBS_MM_OG_IZ MO  /* 월조직 */
                     ON MP.BASE_YM = MO.BASE_YM
                    AND MP.OG_ID = MO.OG_ID
                    AND MP.OG_TP_CD = MO.OG_TP_CD
               <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
                    AND MO.DGR1_LEVL_OG_ID = #{ogLevl1}
               </if>
               <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
                    AND MO.DGR2_LEVL_OG_ID = #{ogLevl2}
               </if>
               <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
                    AND MO.DGR3_LEVL_OG_ID = #{ogLevl3}
               </if>
                  INNER JOIN TB_PDBS_PD_BAS PP
                     ON CD.BASE_PD_CD = PP.PD_CD
               <if test='@MybatisUtils@isNotEmpty(schPdCdStrt)'>
                    AND PP.PD_CD &gt;= #{schPdCdStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schPdCdEnd)'>
                    AND PP.PD_CD &lt;=  #{schPdCdEnd}
               </if>
                  INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS PD
                     ON CD.BASE_PD_CD = PD.BASE_PD_CD
                    AND SUBSTR(#{schDtStrt},0,6) BETWEEN APY_STRT_YM AND APY_END_YM
                  INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS PF
                     ON PD.FEE_PDCT_TP_CD1 = PF.FEE_PDCT_TP_CD
                    AND CD.SELL_TP_CD = PF.SELL_TP_CD
               <if test='!@MybatisUtils@equals(schPdctTp, "00")'>
                    AND PF.FEE_PDCT_TP_CD = #{schPdctTp}
               </if>
               <if test='!@MybatisUtils@equals(schFeePerf, "00")'>
                    AND PF.FEE_PERF_TP_CD = #{schFeePerf}
               </if>
                   LEFT OUTER JOIN TB_PDBS_SDING_PRC_BAS PSP
                     ON CD.BASE_PD_CD = PSP.PDCT_PD_CD
                    AND RI.STPL_STRTDT BETWEEN PSP.APY_STRTDT AND PSP.APY_ENDDT
                   LEFT OUTER JOIN TB_SSCT_MCHN_CH_IZ MC
                     ON RI.CNTR_NO = MC.BASE_CNTR_NO
                    AND RI.CNTR_SN = MC.BASE_CNTR_SN
                   LEFT OUTER JOIN TB_SSCT_CNTR_PMOT_IZ CP
                     ON RI.CNTR_NO = CP.DTL_CNTR_NO
                    AND RI.CNTR_SN = CP.DTL_CNTR_SN
                   LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS ROW_SCNT
                                               FROM TB_FEAM_WELS_SV_FEE_BAS A
                                              WHERE A.BASE_PD_CD = CD.BASE_PD_CD
                                                AND A.VST_MCN = 0
                                                AND SUBSTR(RI.STPL_STRTDT,0,6) BETWEEN A.APY_STRT_YM AND A.APY_END_YM
                                           )WS
                     ON 1=1
                   LEFT OUTER JOIN LATERAL ( SELECT COUNT(1) AS EX_SCNT
                                               FROM TB_FEDD_FEE_PERF_EXCD_OJ_BAS A
                                              WHERE A.CNTR_NO = RI.CNTR_NO
                                                AND A.CNTR_SN = RI.CNTR_SN
                                                AND A.FEE_PERF_EXCD_DV_CD = '01'
                                           )EX
                     ON 1=1
                   LEFT OUTER JOIN TB_SSCT_CNTR_PRC_CMPT_IZ CPC
                     ON CD.CNTR_NO = CPC.CNTR_NO
                    AND CD.CNTR_SN = CPC.CNTR_SN
                  WHERE CB.SELL_OG_TP_CD   = 'W01'
               <if test='!@MybatisUtils@equals(schDiv, "01")'>
                    AND RI.STPL_STRTDT BETWEEN #{schDtStrt} AND  #{schDtEnd} /* 계약확정일시 */
               </if>
               <if test='@MybatisUtils@isNotEmpty(schCancDtStrt)'>
                    AND RI.STPL_CAN_DTM &gt;= #{schCancDtStrt}
               </if>
               <if test='@MybatisUtils@isNotEmpty(schCancDtEnd)'>
                    AND RI.STPL_CAN_DTM &lt;= #{schCancDtEnd}
               </if>
               </if>
               )T
          LEFT OUTER JOIN TB_FEAM_WELS_NRCTR_MM_CL T2
            ON T.BASE_YM = T2.BASE_YM
           AND T.OG_TP_CD = T2.OG_TP_CD
           AND T.PRTNR_NO = T2.PRTNR_NO
           AND T.CNTR_DTL_CD = T2.CNTR_NO||T2.CNTR_SN
           AND T2.FEE_TCNT_DV_CD = #{schOrdr}
           AND T2.CNTR_PERF_CRT_DV_CD = '01'
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON T.SELL_TP_CD = CD1.CD_VLD_VAL
           AND CD1.TENANT_ID = 'TNT_WELLS'
           AND CD1.CD_ID = 'SELL_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD2
            ON T.FEE_PERF_TP_CD = CD2.CD_VLD_VAL
           AND CD2.TENANT_ID = 'TNT_WELLS'
           AND CD2.CD_ID = 'FEE_PERF_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD4
            ON T.MCHN_CH_TP_CD = CD4.CD_VLD_VAL
           AND CD4.TENANT_ID = 'TNT_WELLS'
           AND CD4.CD_ID = 'MCHN_CH_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD5
            ON T.FEE_PDCT_TP_CD = CD5.CD_VLD_VAL
           AND CD5.TENANT_ID = 'TNT_WELLS'
           AND CD5.CD_ID = 'FEE_PDCT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD6
            ON T.PMOT_TP_CD = CD6.CD_VLD_VAL
           AND CD6.TENANT_ID = 'TNT_WELLS'
           AND CD6.CD_ID = 'PMOT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD7
            ON T.LCETC3 = CD7.CD_VLD_VAL
           AND CD7.TENANT_ID = 'TNT_WELLS'
           AND CD7.CD_ID = 'SELL_DSC_DV_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD8
            ON T.LCETC4 = CD8.CD_VLD_VAL
           AND CD8.TENANT_ID = 'TNT_WELLS'
           AND CD8.CD_ID = 'SELL_DSC_TP_CD'
    </select>

    <select id='selectPlannerFees'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchPlarSellFeeRes">
        SELECT T3.DGR1_LEVL_OG_NM AS OG1_LV
             , T3.DGR2_LEVL_OG_NM AS OG2_LV
             , T3.DGR3_LEVL_OG_NM AS OG3_LV
             , T2.PRTNR_NO
             , T2.PRTNR_KNM
             , T1.CNTR_NO||T1.CNTR_SN AS CNTR_DTL_NO
             , T1.RCPDT
             , T1.SL_DT
             , T1.CAN_DT
             , CD2.CD_CNTN AS FEE_PDCT_TP_CD
             , T1.PD_CD
             , CD3.CD_CNTN AS FEE_PERF_TP_CD
             , T4.PD_NM
             , T1.ACKMT_PERF_CT
             , T1.BFSVC_PRD_CD
             , CD1.CD_CNTN AS MCHN_CH_TP_CD
          FROM TB_FEAM_WELS_NRCTR_MM_CL T1
         INNER JOIN TB_OGBS_MM_PRTNR_IZ T2  /* 월파트너 */
            ON T1.PRTNR_NO = T2.PRTNR_NO
           AND T1.OG_TP_CD = T2.OG_TP_CD
           AND T1.BASE_YM = T2.BASE_YM
      <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
           AND T2.PRTNR_NO = #{schPrtnrNo}
      </if>
         INNER JOIN TB_OGBS_MM_OG_IZ T3  /* 월조직 */
            ON T2.BASE_YM = T3.BASE_YM
           AND T2.OG_ID = T3.OG_ID
           AND T2.OG_TP_CD = T3.OG_TP_CD
      <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
           AND T3.DGR1_LEVL_OG_ID = #{ogLevl1}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
           AND T3.DGR2_LEVL_OG_ID = #{ogLevl2}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
           AND T3.DGR3_LEVL_OG_ID = #{ogLevl3}
      </if>
         INNER JOIN TB_PDBS_PD_BAS T4
            ON T1.PD_CD = T4.PD_CD
         INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T5
            ON T1.PD_CD = T5.BASE_PD_CD
           AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
         INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T6
            ON T5.FEE_PDCT_TP_CD1 = T6.FEE_PDCT_TP_CD
           AND T1.SELL_TP_CD = T6.SELL_TP_CD
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON T1.MCHN_CH_TP_CD = CD1.CD_VLD_VAL
           AND CD1.TENANT_ID = 'TNT_WELLS'
           AND CD1.CD_ID = 'MCHN_CH_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD2
            ON T5.FEE_PDCT_TP_CD1 = CD2.CD_VLD_VAL
           AND CD2.TENANT_ID = 'TNT_WELLS'
           AND CD2.CD_ID = 'FEE_PDCT_TP_CD'
          LEFT OUTER JOIN T_CMZ_CD_D CD3
            ON T6.FEE_PERF_TP_CD = CD3.CD_VLD_VAL
           AND CD3.TENANT_ID = 'TNT_WELLS'
           AND CD3.CD_ID = 'FEE_PERF_TP_CD'
         WHERE T1.BASE_YM = #{schPerfYm}
           AND T1.FEE_TCNT_DV_CD = #{schOrdr}
           AND T1.OG_TP_CD = 'W01'
           AND T1.CNTR_PERF_CRT_DV_CD = '01'
    </select>



    <select id='selectPlannerAggregation'
            resultType="com.kyowon.sms.wells.web.fee.aggregate.dto.WfeaOrganizationNetOrderDto$SearchPlarAgrgRes">
        SELECT T2.OG_ID
             , M.PRTNR_NO
             , T2.PRTNR_KNM
             , T2.PSTN_DV_CD
             , MAX(M.EH_CNT) AS EH_CNT
             , MAX(M.EX_CNT) AS EX_CNT
             , MAX(M.ET_CNT) AS ET_CNT
             , MAX(M.UP_CNT) AS UP_CNT
             , MAX(M.EH_CNT)+ MAX(M.EX_CNT)+ MAX(M.ET_CNT)+ MAX(M.UP_CNT) AS TOT_CNT
             , MAX(M.EH_AMT) AS EH_AMT
             , MAX(M.EX_AMT) AS EX_AMT
             , MAX(M.ET_AMT) AS ET_AMT
             , MAX(M.UP_AMT) AS UP_AMT
             , MAX(M.EH_AMT)+ MAX(M.EX_AMT)+ MAX(M.ET_AMT)+ MAX(M.UP_AMT) AS TOT_AMT
          FROM ( SELECT T.PRTNR_NO
                      , NVL(SUM(EH_CNT),0) AS EH_CNT
                      , NVL(SUM(EX_CNT),0) AS EX_CNT
                      , NVL(SUM(ET_CNT),0) AS ET_CNT
                      , NVL(SUM(UP_CNT),0) AS UP_CNT
                      , 0 AS EH_AMT
                      , 0 AS EX_AMT
                      , 0 AS ET_AMT
                      , 0 AS UP_AMT
                   FROM ( SELECT T1.PRTNR_NO
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EH' THEN T1.ACKMT_PERF_CT END AS EH_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EX' THEN T1.ACKMT_PERF_CT END AS EX_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'ET' THEN T1.ACKMT_PERF_CT END AS ET_CNT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'UP' THEN T1.ACKMT_PERF_CT END AS UP_CNT
                            FROM TB_FEAM_WELS_NRCTR_MM_CL T1
                           INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T2
                              ON T1.PD_CD = T2.BASE_PD_CD
                             AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
                           INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T3
                              ON T2.FEE_PDCT_TP_CD1 = T3.FEE_PDCT_TP_CD
                             AND T1.SELL_TP_CD = T3.SELL_TP_CD
                           WHERE T1.BASE_YM = #{schPerfYm}
                             AND T1.OG_TP_CD = 'W01'
                             AND T1.FEE_TCNT_DV_CD = #{schOrdr}
                             AND T1.CNTR_PERF_CRT_DV_CD = '01'
                             AND T1.ACKMT_PERF_CT > 0
                        )T
                  GROUP BY T.PRTNR_NO
                  UNION
                 SELECT T.PRTNR_NO
                      , 0 AS EH_CNT
                      , 0 AS EX_CNT
                      , 0 AS ET_CNT
                      , 0 AS UP_CNT
                      , NVL(SUM(EH_AMT),0) AS EH_AMT
                      , NVL(SUM(EX_AMT),0) AS EX_AMT
                      , NVL(SUM(ET_AMT),0) AS ET_AMT
                      , NVL(SUM(UP_AMT),0) AS UP_AMT
                   FROM ( SELECT T1.PRTNR_NO
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EH' THEN T1.ACKMT_PERF_AMT END AS EH_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'EX' THEN T1.ACKMT_PERF_AMT END AS EX_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'ET' THEN T1.ACKMT_PERF_AMT END AS ET_AMT
                               , CASE WHEN T3.FEE_PERF_TP_CD = 'UP' THEN T1.ACKMT_PERF_AMT END AS UP_AMT
                            FROM TB_FEAM_WELS_NRCTR_MM_CL T1
                           INNER JOIN TB_FEAM_WELS_FEE_PDCT_TP_BAS T2
                              ON T1.PD_CD = T2.BASE_PD_CD
                             AND #{schPerfYm} BETWEEN APY_STRT_YM AND APY_END_YM
                           INNER JOIN TB_FEAM_WELS_FEE_PERF_TP_BAS T3
                              ON T2.FEE_PDCT_TP_CD1 = T3.FEE_PDCT_TP_CD
                             AND T1.SELL_TP_CD = T3.SELL_TP_CD
                           WHERE T1.BASE_YM = #{schPerfYm}
                             AND T1.OG_TP_CD = 'W01'
                             AND T1.FEE_TCNT_DV_CD = #{schOrdr}
                             AND T1.CNTR_PERF_CRT_DV_CD = '01'
                             AND T1.ACKMT_PERF_AMT > 0
                        )T
                  GROUP BY T.PRTNR_NO
               )M
         INNER JOIN TB_OGBS_MM_PRTNR_IZ T2  /* 월파트너 */
            ON M.PRTNR_NO = T2.PRTNR_NO
           AND T2.OG_TP_CD = 'W01'
           AND T2.BASE_YM = #{schPerfYm}
      <if test='@MybatisUtils@isNotEmpty(schPrtnrNo)'>
           AND T2.PRTNR_NO = #{schPrtnrNo}
      </if>
      <if test='@MybatisUtils@equals(schRsbDv, "00")'>
           AND T2.PSTN_DV_CD IN ('7','15')
      </if>
      <if test='!@MybatisUtils@equals(schRsbDv, "00")'>
           AND T2.PSTN_DV_CD = #{schRsbDv}
      </if>
         INNER JOIN TB_OGBS_MM_OG_IZ T3  /* 월조직 */
            ON T2.BASE_YM = T3.BASE_YM
           AND T2.OG_ID = T3.OG_ID
           AND T2.OG_TP_CD = T3.OG_TP_CD
      <if test='@MybatisUtils@isNotEmpty(ogLevl1)'>
           AND T3.DGR1_LEVL_OG_ID = #{ogLevl1}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2)'>
           AND T3.DGR2_LEVL_OG_ID = #{ogLevl2}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3)'>
           AND T3.DGR3_LEVL_OG_ID = #{ogLevl3}
      </if>
         GROUP BY T2.OG_ID, M.PRTNR_NO, T2.PRTNR_KNM, T2.PSTN_DV_CD
    </select>

</mapper>
