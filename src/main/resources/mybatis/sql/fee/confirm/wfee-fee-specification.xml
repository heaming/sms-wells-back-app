<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.fee.confirm.mapper.WfeeFeeSpecificationMapper">


    <select id="selectFeeCodes"
            resultType="com.kyowon.sms.wells.web.fee.confirm.dto.WfeeFeeSpecificationDto$SearchFeeCdRes">
                SELECT    T2.SRN_MARK_FEE_NM  AS FEE_NM
                        , T1.FEE_CD
                        , T1.FEE_CALC_UNIT_TP_CD
                        , T1.FEE_CLSF_CD
                  FROM TB_FEAM_FEE_CD T1
                 INNER JOIN TB_FEAM_FEE_BASE_DTL T2	--수수료기준상세
                    ON (T1.FEE_CD = T2.FEE_CD)
                 WHERE #{perfDt} BETWEEN T2.APY_STRT_YM AND T2.APY_END_YM
                   AND T1.FEE_CALC_UNIT_TP_CD IS NOT NULL
                  <if test="@MybatisUtils@isNotEmpty(feeCalcUnitTpCd)">
                   AND T1.FEE_CALC_UNIT_TP_CD = #{feeCalcUnitTpCd} /* 수수료계산단위유형코드 (101 : P추진단 플래너, 102 : P추진단 지국장, 201 : M추진단-일반(15등급), 202 : M추진단 지국장,301 홈마스터 , 302 : 홈마스터 지점장  */
                  </if>
                   AND T1.FEE_CALC_UNIT_TP_CD IN ('101','102','201','202','301','302')
                   AND T1.DTA_DL_YN = 'N'
                   AND T2.DTA_DL_YN = 'N'
                 GROUP BY T2.SRN_MARK_FEE_NM , T1.FEE_CD ,T1.FEE_CALC_UNIT_TP_CD ,T1.SRN_MARK_ODR_SN ,T1.FEE_CLSF_CD
                 ORDER BY T1.SRN_MARK_ODR_SN , T1.FEE_CD
    </select>







    <!-- M 플래너 조회 -->
    <select id="selectMPlannerFeeSpecifications" resultType="camelMap">

      <choose>
            <!-- M추진단 플래너 - 합계 -->
             <when test="@MybatisUtils@equals(dto.isSum ,'Y')">

                SELECT '총 계' AS PRTNR_GD_CD
                     , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                     , SUM(DSB_VAL0) AS  DSB_VAL0    /* 수수료 지급대상금액 */

                     , SUM(PERF_VAL1) AS PERF_VAL1 /* 가전인정건수 */
                     , SUM(PERF_VAL2) AS PERF_VAL2 /* 가전기변건수 */
                     , SUM(PERF_VAL0) AS PERF_VAL0 /* 실적 합계  */

                     , SUM(DDTN_VAL1) AS DDTN_VAL1    /* 소득세 */
                     , SUM(DDTN_VAL2) AS DDTN_VAL2    /* 주민세 */
                     , SUM(DDTN_VAL3) AS DDTN_VAL3    /* 보증예치금 */
                     , SUM(DDTN_VAL4) AS DDTN_VAL4    /* 가지급금 */
                     , SUM(DDTN_VAL5) AS DDTN_VAL5    /* 부담공제 */
                     , SUM(DDTN_VAL6) AS DDTN_VAL6    /* 고용보험 */
                     , SUM(DDTN_VAL7) AS DDTN_VAL7    /* 산재보험 */
                     , SUM(DDTN_VAL0) AS  DDTN_VAL0  /* 공제계 */

                     ,${feeEachSumField}  /* 수수료 각 항목 합계*/

                     , SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                 FROM (
                        <include refid="mPlannerSql" />
                     ) TB_ORG

                  GROUP BY BASE_YM
             </when>
            <otherwise>
                 <!-- M추진단 플래너 - 리스트 -->
                 <include refid="mPlannerSql" />
            </otherwise>
      </choose>

    </select>

    <!-- M추진단 플래너 sql -->
    <sql id="mPlannerSql" >

        /* M추진단 - 플래너 조회(동적 컬럼) */
        SELECT
               O.BASE_YM /* 기준년월 */
             , O.OG_CD
             , O.PSTN_DV_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'PRTNR_GD_CD', O.PRTNR_GD_CD) AS PRTNR_GD_CD
             , FC.DSB_YM /* 실적년월 */
             , FC.CO_CD  /* 회사코드 */
             , O.OG_TP_CD /* 조직유형코드 */
             , O.DGR1_LEVL_OG_NM /* 총괄단 조직명 */
             , O.DGR2_LEVL_OG_NM /* 지역단 조직명 */
             , O.DGR3_LEVL_OG_NM /* 지점 조직명 */
             , O.PRTNR_NO /* 파트너번호 */
             , O.DGR3_LEVL_OG_CD /* 3차레벨조직코드 - 지점 코드*/
             , O.PRTNR_KNM /* 파트너명 */
             , F_CMZ_CD_NM('TNT_WELLS', 'RSB_DV_CD', O.RSB_DV_CD) AS RSB_DV_CD /* 파트너 직급 */
             , NVL(PERF.PERF02, 0) AS PERF_VAL1 /* 가전인정건수 */
             , NVL(PERF.PERF03, 0) AS PERF_VAL2 /* 가전기변건수 */
             , (NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0)) AS PERF_VAL0 /* 실적 합계 */
             , NVL(MEET.MEET_DATES, 0) AS MEET_DATES /* 미팅참석일수 */
             , ${feeCdFields}
             , ${feeSumField}
             , NVL(D.DDTN02, 0) AS DDTN_VAL1 /* 소득세 */
             , NVL(D.DDTN03, 0) AS DDTN_VAL2 /* 주민세 */
             , NVL(D.DDTN01, 0) AS DDTN_VAL3 /* 보증예치금 */
             , NVL(D.DDTN04, 0) AS DDTN_VAL4 /* 가지급금 */
             , NVL(D.DDTN07, 0) AS DDTN_VAL5 /* 부담공제 */
             , NVL(D.DDTN05, 0) AS DDTN_VAL6 /* 고용보험 */
             , NVL(D.DDTN06, 0) AS DDTN_VAL7 /* 산재보험 */
             , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) +
                NVL(D.DDTN88, 0) + NVL(D.DDTN05, 0)+ NVL(D.DDTN06, 0)) AS DDTN_VAL0 /* 공제계 */
             , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0 /* 수수료 지급대상금액 */
        FROM
            (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                  AND FBD.DTA_DL_YN = 'N'
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
        INNER JOIN
        (
                SELECT T1.BASE_YM /* 기준년월 */
                     , T1.OG_CD
                     , T2.PSTN_DV_CD
                     , T2.PRTNR_GD_CD
                     , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                     , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                     , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                     , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                     , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                     , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                     , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                     , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                     , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                     , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                     , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                     , T1.DTRC_N /* 지국수 */
                     , T2.PRTNR_NO /* 파트너번호 */
                     , T2.PRTNR_KNM /* 파트너명 */
                     , T2.RSB_DV_CD /* 직책구분코드 */
                     , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                 FROM (
                        SELECT *
                          FROM TB_OGBS_MM_OG_IZ
                         WHERE 1=1
                           AND BASE_YM   = #{dto.perfDt}
                           AND DTA_DL_YN = 'N'
                           AND OG_TP_CD  = #{dto.ogTpCd} /* 조직유형코드(W01: P추진단, W02: M추진단) */
                       ) T1
                INNER JOIN (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , PSTN_DV_CD
                                      , PRTNR_GD_CD
                                      , BASE_YM
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND RSB_DV_CD = #{dto.rsbDvCd} /* 직책구분코드(W0205 : 플래너) */
                                   AND OG_TP_CD = #{dto.ogTpCd}
                            ) T2
                   ON T1.OG_TP_CD = T2.OG_TP_CD
                  AND T1.OG_ID = T2.OG_ID
                  AND T1.BASE_YM = T2.BASE_YM
                WHERE 1 = 1
        ) O
          ON FC.DSB_YM   = O.BASE_YM /* 실적년월 = 관리년월 */
         AND FC.PRTNR_NO = O.PRTNR_NO
         AND FC.OG_TP_CD = O.OG_TP_CD
        LEFT OUTER JOIN
        (
            SELECT DDTN_YM
                 , OG_TP_CD
                 , PRTNR_NO
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '08' THEN FEE_DDTN_CNFM_AMT END) AS DDTN08
                 , SUM(CASE WHEN FEE_DDTN_TP_CD = '88' THEN FEE_DDTN_CNFM_AMT END) AS DDTN88
             FROM TB_FEAM_FEE_DDTN_IZ   /* 수수료공제내역 */
            WHERE 1 = 1
              AND DTA_DL_YN = 'N'
              AND OG_TP_CD = #{dto.ogTpCd}
              AND DDTN_YM  = #{dto.perfDt}

              <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
              AND PRTNR_NO = #{dto.prtnrNo}
              </if>
            GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
        ) D
             ON O.BASE_YM = D.DDTN_YM
            AND O.PRTNR_NO = D.PRTNR_NO
            AND O.OG_TP_CD = D.OG_TP_CD
        LEFT OUTER JOIN
            (
                SELECT BASE_YM
                     , PRTNR_NO
                     , OG_TP_CD
                     , NVL(SUM(CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL END), 0) AS PERF02 /* 가전인정건수 */
                     , NVL(SUM(CASE WHEN PERF_ATC_CD IN ( 'W00P00014','W00P00018') THEN PERF_VAL END), 0) AS PERF03  /* 가전기변건수 */
                 FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감 */
                WHERE 1 = 1
                  AND DTA_DL_YN = 'N'
                  AND BASE_YM = #{dto.perfDt}
                  AND FEE_TCNT_DV_CD = '02'
            --      AND MM_ACU_PERF_AGRG_CRT_DV_CD = '01' /* 접수-00:총주문월누적, 매출-01:순주문월누적 */
                  AND PERF_AGRG_CRT_DV_CD = '201' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                  AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단)*/
                  AND PERF_ATC_CD IN ('W02P00002', 'W00P00014','W00P00018') /* 실적항목코드  */
                GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
            ) PERF
             ON FC.DSB_YM   = PERF.BASE_YM
            AND FC.PRTNR_NO = PERF.PRTNR_NO
            AND FC.OG_TP_CD = PERF.OG_TP_CD
           LEFT JOIN (
                        SELECT BASE_YM,PRTNR_NO ,OG_TP_CD
                             , NVL(SUM(PERF_VAL), 0) AS MEET_DATES /* 미팅참석일수 */
                          FROM TB_FEAM_PRTNR_PERF_MM_CL
                         WHERE 1=1
                            AND DTA_DL_YN = 'N'
                            AND BASE_YM = #{dto.perfDt}
                            AND FEE_TCNT_DV_CD = '02'
                            AND PERF_ATC_CD = 'W02P00093'
                            AND PERF_AGRG_CRT_DV_CD = '201' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                            AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단)*/
                         GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                      ) MEET /* 파트너실적월마감 */
             ON FC.DSB_YM   = MEET.BASE_YM
            AND FC.PRTNR_NO = MEET.PRTNR_NO
            AND FC.OG_TP_CD = MEET.OG_TP_CD
           LEFT OUTER JOIN
            (
                SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                  FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                 WHERE 1=1
                   AND DTA_DL_YN = 'N'
                   AND DSB_YM = #{dto.perfDt}
                   AND OG_TP_CD = #{dto.ogTpCd}
                   AND SPMT_DSB_DV_CD = '01'
            ) DSB
             ON FC.DSB_YM = DSB.DSB_YM
            AND FC.CO_CD  = DSB.CO_CD
            AND FC.OG_TP_CD = DSB.OG_TP_CD
            AND FC.PRTNR_NO = DSB.PRTNR_NO
          WHERE 1 = 1
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
                AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
                AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
                AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                AND O.PRTNR_NO = #{dto.prtnrNo}
            </if>
        ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>





















    <!-- P추진단 플래너  -->
    <select id="selectPPlannerFeeSpecifications"  resultType="camelMap">

        <choose>
            <!-- P추진단 플래너 - 합계 -->
             <when test="@MybatisUtils@equals(dto.isSum ,'Y')">

                    SELECT '총 계' AS PRTNR_GD_CD
                          , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                          , SUM(DSB_VAL0) AS DSB_VAL0 /* 수수료 지급대상금액 */

                          , SUM(MEET_DATES) AS MEET_DATES   /* 미팅참석일수 */
                          , SUM(PERF_VAL1) AS PERF_VAL1   /* 가전 실적 */
                          , SUM(PERF_VAL2) AS PERF_VAL2   /* 가전외 실적 */
                          , SUM(PERF_VAL3) AS PERF_VAL3   /* 합산 실적 */
                          , SUM(PERF_VAL4) AS PERF_VAL4   /* 기변 실적 */
                          , SUM(PERF_VAL0) AS PERF_VAL0

                          , SUM(DDTN_VAL1) AS DDTN_VAL1 /* 소득세 */
                          , SUM(DDTN_VAL2) AS DDTN_VAL2 /* 주민세 */
                          , SUM(DDTN_VAL3) AS DDTN_VAL3 /* 보증예치금 */
                          , SUM(DDTN_VAL4) AS DDTN_VAL4 /* 가지급금 */
                          , SUM(DDTN_VAL5) AS DDTN_VAL5 /* 부담공제 */
                          , SUM(DDTN_VAL6) AS DDTN_VAL6 /* 고용보험 */
                          , SUM(DDTN_VAL7) AS DDTN_VAL7 /* 산재보험 */
                          , SUM(DDTN_VAL0) AS DDTN_VAL0 /* 공제계 */
                          , SUM(DSB_VAL0)  AS DSB_VAL0    /* 수수료 지급대상금액 */


                          , ${feeEachSumField}  /* 수수료 각 항목 합계*/

                          , SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                    FROM (
                        <include refid="pPlannerSql"/>
                        ) TB_ORG
                    GROUP BY BASE_YM
             </when>
            <otherwise>
                <!-- P추진단 플래너 - 리스트 -->
                <include refid="pPlannerSql" />
            </otherwise>
        </choose>

    </select>


    <!-- P추진단 플래너 쿼리-->
    <sql id="pPlannerSql">

        /* P추진단 - 플래너 조회(동적 컬럼) */
        SELECT
                O.BASE_YM             /* 기준년월 */
              , O.OG_CD
              , O.PSTN_DV_CD
              , F_CMZ_CD_NM('TNT_WELLS', 'PRTNR_GD_CD', O.PRTNR_GD_CD) AS PRTNR_GD_CD
              , FC.DSB_YM            /* 실적년월 */
              , FC.CO_CD              /* 회사코드 */
              , O.OG_TP_CD            /* 조직유형코드 */
              , O.DGR1_LEVL_OG_NM     /* 총괄단 조직명 */
              , O.DGR2_LEVL_OG_NM     /* 지역단 조직명 */
              , O.DGR3_LEVL_OG_NM     /* 지점 조직명 */
              , O.PRTNR_NO            /* 파트너번호 */
              , O.DGR3_LEVL_OG_CD     /* 3차레벨조직코드 - 지점 코드*/
              , O.PRTNR_KNM           /* 파트너명 */
              , O.RSB_DV_CD           /* 파트너 직급 */
              , NVL(MEET.MEET_DATES, 0) AS MEET_DATES   /* 미팅참석일수 */
              , NVL(PERF.PERF02, 0) AS PERF_VAL1   /* 가전 실적 */
              , NVL(PERF.PERF03, 0) AS PERF_VAL2   /* 가전외 실적 */
              , NVL(PERF.PERF04, 0) AS PERF_VAL3   /* 합산 실적 */
              , NVL(PERF.PERF05, 0) AS PERF_VAL4   /* 기변 실적 */
              , (NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0)+ NVL(PERF.PERF04, 0)+ NVL(PERF.PERF05, 0)) AS PERF_VAL0
              ,${feeCdFields}
              ,${feeSumField}
              , NVL(D.DDTN02, 0) AS DDTN_VAL1         /* 소득세 */
              , NVL(D.DDTN03, 0) AS DDTN_VAL2         /* 주민세 */
              , NVL(D.DDTN01, 0) AS DDTN_VAL3         /* 보증예치금 */
              , NVL(D.DDTN04, 0) AS DDTN_VAL4         /* 가지급금 */
              , NVL(D.DDTN07, 0) AS DDTN_VAL5         /* 부담공제 */
              , NVL(D.DDTN05, 0) AS DDTN_VAL6         /* 고용보험 */
              , NVL(D.DDTN06, 0) AS DDTN_VAL7         /* 산재보험 */
              , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) + NVL(D.DDTN05, 0) + NVL(D.DDTN06, 0)) AS DDTN_VAL0   /* 공제계 */
              , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0    /* 수수료 지급대상금액 */
           FROM
            (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                  AND FBD.DTA_DL_YN = 'N'
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
            INNER JOIN
            (
                SELECT T1.BASE_YM /* 기준년월 */
                     , T1.OG_CD
                     , T2.PSTN_DV_CD
                     , T2.PRTNR_GD_CD
                     , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                     , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                     , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                     , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                     , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                     , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                     , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                     , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                     , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                     , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                     , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                     , T1.DTRC_N /* 지국수 */
                     , T2.PRTNR_NO /* 파트너번호 */
                     , T2.PRTNR_KNM /* 파트너명 */
                     , T2.RSB_DV_CD /* 직책구분코드 */
                     , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                  FROM (
                        SELECT *
                          FROM TB_OGBS_MM_OG_IZ
                         WHERE 1=1
                           AND BASE_YM = #{dto.perfDt}
                           AND DTA_DL_YN = 'N'
                           AND OG_TP_CD = 'W01' /* 조직유형코드(W01: P추진단, W02: M추진단) */
                       ) T1
                     INNER JOIN (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , PSTN_DV_CD
                                      , PRTNR_GD_CD
                                      , BASE_YM
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND RSB_DV_CD = 'W0105' /* 직책구분코드(W0105 : 플래너) */
                                ) T2
                    ON T1.BASE_YM = T2.BASE_YM
                   AND T1.OG_TP_CD = T2.OG_TP_CD
                   AND T1.OG_ID = T2.OG_ID
                 WHERE 1 = 1
                   AND T1.DTA_DL_YN = 'N'
                   AND T1.OG_TP_CD = 'W01'             /* 조직유형코드(W01: P추진단, W02: M추진단) */
            ) O
                 ON FC.DSB_YM = O.BASE_YM     /* 실적년월 = 관리년월*/
                AND FC.PRTNR_NO = O.PRTNR_NO
                AND FC.OG_TP_CD = O.OG_TP_CD
               LEFT OUTER JOIN
            (
                SELECT DDTN_YM
                     , OG_TP_CD
                     , PRTNR_NO
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '08' THEN FEE_DDTN_CNFM_AMT END) AS DDTN08
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '88' THEN FEE_DDTN_CNFM_AMT END) AS DDTN88
                 FROM TB_FEAM_FEE_DDTN_IZ   /* 수수료공제내역 */
                WHERE 1 = 1
                  AND DTA_DL_YN = 'N'
                  AND OG_TP_CD = #{dto.ogTpCd}
                  AND DDTN_YM = #{dto.perfDt}

                  <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND PRTNR_NO = #{dto.prtnrNo}
                  </if>
                GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
            ) D
                 ON O.BASE_YM = D.DDTN_YM
                AND O.PRTNR_NO = D.PRTNR_NO
                AND O.OG_TP_CD = D.OG_TP_CD
               LEFT OUTER JOIN
            (
                SELECT BASE_YM
                     , PRTNR_NO
                     , OG_TP_CD
                         , NVL(SUM(CASE WHEN ( PERF_ATC_CD = 'W01P00001') THEN PERF_VAL END), 0) AS PERF02                   /* 가전실적금액 */
                         , NVL(SUM(CASE WHEN ( PERF_ATC_CD = 'W01P00004') THEN PERF_VAL END), 0) AS PERF03                   /* 가전외실적금액 */
                         , NVL(SUM(CASE WHEN ( PERF_ATC_CD IN ('W01P00001','W01P00004')) THEN PERF_VAL END), 0) AS PERF04    /* 합산  */
                         , NVL(SUM(CASE WHEN ( PERF_ATC_CD IN ('W00P00028')) THEN PERF_VAL END), 0) AS PERF05               /* 기변실적금액 */
                 FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감 */
                 -- FROM TB_FEAM_PRTNR_PERF_MM_ACU_CL /* 파트너실적월누적마감 */
                WHERE 1 = 1
                  AND DTA_DL_YN = 'N'
                  AND BASE_YM = #{dto.perfDt}
                  AND FEE_TCNT_DV_CD = '02'
--                  AND MM_ACU_PERF_AGRG_CRT_DV_CD = '01' /* 접수-00:총주문월누적, 매출-01:순주문월누적 */
                  AND PERF_AGRG_CRT_DV_CD = '101' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                  AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W01: P추진단)*/
                  AND PERF_ATC_CD IN ('W01P00001', 'W01P00004', 'W00P00028')
                GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
              ) PERF
             ON FC.DSB_YM = PERF.BASE_YM
            AND FC.PRTNR_NO = PERF.PRTNR_NO
            LEFT JOIN (
                        SELECT BASE_YM,PRTNR_NO ,OG_TP_CD
                             , NVL(SUM(PERF_VAL), 0) AS MEET_DATES /* 미팅참석일수 */
                          FROM TB_FEAM_PRTNR_PERF_MM_CL
                         WHERE 1=1
                            AND DTA_DL_YN = 'N'
                            AND BASE_YM = #{dto.perfDt}
                            AND FEE_TCNT_DV_CD = '02'
                            AND PERF_ATC_CD = 'W01P00012'
                            AND PERF_AGRG_CRT_DV_CD = '101' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                            AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단)*/
                         GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                      ) MEET /* 파트너실적월마감 */
             ON FC.DSB_YM   = MEET.BASE_YM
            AND FC.PRTNR_NO = MEET.PRTNR_NO
            AND FC.OG_TP_CD = MEET.OG_TP_CD
           LEFT OUTER JOIN (
                          SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                          FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                         WHERE 1=1
                           AND DTA_DL_YN = 'N'
                           AND DSB_YM = #{dto.perfDt}
                           AND OG_TP_CD = #{dto.ogTpCd}
                           AND SPMT_DSB_DV_CD = '01'
                            ) DSB
             ON FC.DSB_YM = DSB.DSB_YM
            AND FC.CO_CD = DSB.CO_CD
            AND FC.OG_TP_CD = DSB.OG_TP_CD
            AND FC.PRTNR_NO = DSB.PRTNR_NO
          WHERE 1 = 1
            AND FC.DSB_YM = #{dto.perfDt} /* 실적년월 */
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
                AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
                AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
                AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                AND O.PRTNR_NO = #{dto.prtnrNo}
            </if>
           ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>








    <!-- M추진단 지점장 -->
    <select id="selectMManagerFeeSpecifications"  resultType="camelMap">

        <choose>
             <!-- M추진단 지점장 - 합계 -->
             <when test="@MybatisUtils@equals(dto.isSum ,'Y')">
                    SELECT '총 계' AS PRTNR_GD_CD
                          , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                          , SUM(DSB_VAL0) AS DSB_VAL0 /* 수수료 지급대상금액 */

                          , SUM(MEET_DATES) AS MEET_DATES   /* 미팅참석일수 */
                          , SUM(PERF_VAL1) AS PERF_VAL1    /* 조직 - 가전인정건수 */
                          , SUM(PERF_VAL2) AS PERF_VAL2    /* 개인 - 가전인정건수 */
                          , SUM(PERF_VAL3) AS PERF_VAL3    /* 개인 - 가전기변건수 */

                          , SUM(PERF_VAL0) AS PERF_VAL0

                          , SUM(DDTN_VAL1) AS DDTN_VAL1 /* 소득세 */
                          , SUM(DDTN_VAL2) AS DDTN_VAL2 /* 주민세 */
                          , SUM(DDTN_VAL3) AS DDTN_VAL3 /* 보증예치금 */
                          , SUM(DDTN_VAL4) AS DDTN_VAL4 /* 가지급금 */
                          , SUM(DDTN_VAL5) AS DDTN_VAL5 /* 부담공제 */
                          , SUM(DDTN_VAL6) AS DDTN_VAL6 /* 고용보험 */
                          , SUM(DDTN_VAL7) AS DDTN_VAL7 /* 산재보험 */
                          , SUM(DDTN_VAL0) AS DDTN_VAL0 /* 공제계 */
                          , SUM(DSB_VAL0)  AS DSB_VAL0    /* 수수료 지급대상금액 */

                          , ${feeEachSumField}  /* 수수료 각 항목 합계*/

                          ,  SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                    FROM (
                        <include refid="mManagerSql"/>
                        ) TB_ORG
                    GROUP BY BASE_YM
             </when>
             <otherwise>
                    <!-- M추진단 지점장 - 리스트 -->
                    <include refid="mManagerSql" />
             </otherwise>
        </choose>

    </select>

    <!-- M추진단 지점장 sql  -->
    <sql id="mManagerSql">

            /* M추진단 - 지점장 조회(동적 컬럼) */
            SELECT /*+ ALL_ROWS  */
                    O.BASE_YM             /* 기준년월 */
                  , O.OG_CD
                  , O.PSTN_DV_CD
                  , F_CMZ_CD_NM('TNT_WELLS', 'PRTNR_GD_CD', O.PRTNR_GD_CD) AS PRTNR_GD_CD
                  , FC.DSB_YM            /* 실적년월 */
                  , FC.CO_CD              /* 회사코드 */
                  , O.OG_TP_CD            /* 조직유형코드 */
                  , O.DGR1_LEVL_OG_NM     /* 총괄단 조직명 */
                  , O.DGR2_LEVL_OG_NM     /* 지역단 조직명 */
                  , O.DGR3_LEVL_OG_NM     /* 지점 조직명 */
                  , O.PRTNR_NO            /* 파트너번호 */
                  , O.DGR3_LEVL_OG_CD     /* 3차레벨조직코드 - 지점 코드*/
                  , O.PRTNR_KNM           /* 파트너명 */
                  , O.RSB_DV_CD           /* 파트너 직급 */
                  , NVL(MEET.MEET_DATES, 0) AS MEET_DATES    /* 미팅참석일수 */
                  , NVL(PERF.PERF02, 0) AS PERF_VAL1    /* 조직 - 가전인정건수 */
                  , NVL(PERF.PERF03, 0) AS PERF_VAL2    /* 개인 - 가전인정건수 */
                  , NVL(PERF.PERF04, 0) AS PERF_VAL3    /* 개인 - 가전기변건수 */
                  , ( NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0) + NVL(PERF.PERF04, 0) ) AS PERF_VAL0
                  ,${feeCdFields}
                  ,${feeSumField}
                  , NVL(D.DDTN02, 0) AS DDTN_VAL1         /* 소득세 */
                  , NVL(D.DDTN03, 0) AS DDTN_VAL2         /* 주민세 */
                  , NVL(D.DDTN01, 0) AS DDTN_VAL3         /* 보증예치금 */
                  , NVL(D.DDTN04, 0) AS DDTN_VAL4         /* 가지급금 */
                  , NVL(D.DDTN07, 0) AS DDTN_VAL5         /* 부담공제 */
                  , NVL(D.DDTN88, 0) AS DDTN_VAL6         /* 할인판매 */
                  , NVL(D.DDTN05, 0) AS DDTN_VAL7         /* 고용보험 */
                  , NVL(D.DDTN06, 0) AS DDTN_VAL8         /* 산재보험 */
                  , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) +
                  NVL(D.DDTN88, 0) + NVL(D.DDTN05, 0)+ NVL(D.DDTN06, 0)) AS DDTN_VAL0   /* 공제계 */
                  , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0                   /* 수수료 지급대상금액 */
              FROM
             (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                  AND FBD.DTA_DL_YN = 'N'
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
            INNER JOIN
                (
                    SELECT T1.BASE_YM /* 기준년월 */
                         , T1.OG_CD
                         , T2.PSTN_DV_CD
                         , T2.PRTNR_GD_CD
                         , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                         , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                         , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                         , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                         , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                         , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                         , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                         , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                         , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                         , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                         , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                         , T1.DTRC_N /* 지국수 */
                         , T2.PRTNR_NO /* 파트너번호 */
                         , T2.PRTNR_KNM /* 파트너명 */
                         , T2.RSB_DV_CD /* 직책구분코드 */
                         , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                     FROM (
                            SELECT *
                              FROM TB_OGBS_MM_OG_IZ
                             WHERE 1=1
                               AND BASE_YM = #{dto.perfDt}
                               AND DTA_DL_YN = 'N'
                               AND OG_TP_CD = 'W02' /* 조직유형코드(W01: P추진단, W02: M추진단) */
                           ) T1
                    INNER JOIN  (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , BASE_YM
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                      , PSTN_DV_CD
                                      , PRTNR_GD_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND RSB_DV_CD = 'W0204' /* 직책구분코드(W0104 : M 지점장) */
                                )  T2
                       ON T1.BASE_YM = T2.BASE_YM
                      AND T1.OG_TP_CD = T2.OG_TP_CD
                      AND T1.OG_ID = T2.OG_ID
                    WHERE 1 = 1
                ) O
                 ON FC.DSB_YM = O.BASE_YM     /* 실적년월 = 관리년월 */
                AND FC.PRTNR_NO = O.PRTNR_NO
                AND FC.OG_TP_CD = O.OG_TP_CD
               LEFT OUTER JOIN
                (
                    SELECT DDTN_YM
                         , OG_TP_CD
                         , PRTNR_NO
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01   /* 보증예치금 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02   /* 소득세 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03   /* 주민세 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04   /* 가지급금 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05   /* 고용보험 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06   /* 산재보험 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07   /* 부담공제 */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '08' THEN FEE_DDTN_CNFM_AMT END) AS DDTN08   /* 되물림(웰스총판) */
                         , SUM(CASE WHEN FEE_DDTN_TP_CD = '88' THEN FEE_DDTN_CNFM_AMT END) AS DDTN88   /* 할인판매 */
                     FROM TB_FEAM_FEE_DDTN_IZ
                    WHERE 1 = 1
                      AND DTA_DL_YN = 'N'
                      AND DDTN_YM = #{dto.perfDt}
                    GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
                ) D
                 ON O.BASE_YM = D.DDTN_YM
                AND O.PRTNR_NO = D.PRTNR_NO
                AND O.OG_TP_CD = D.OG_TP_CD
            LEFT OUTER JOIN
                (
                    SELECT BASE_YM
                         , PRTNR_NO
                         , OG_TP_CD
                         , NVL(SUM(CASE WHEN (PERF_DV_CD = 2 AND PERF_ATC_CD = 'W02P00002') THEN PERF_VAL END), 0) AS PERF02                   /* 조직 - 가전인정건수 */
                         , NVL(SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD = 'W02P00002') THEN PERF_VAL END), 0) AS PERF03                   /* 개인 - 가전인정건수 */
                         , NVL(SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD IN('W00P00014','W00P00018') ) THEN PERF_VAL END), 0) AS PERF04                   /* 가전기변건수 */
                     FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감 */
                    WHERE 1 = 1
                      AND DTA_DL_YN = 'N'
                      AND BASE_YM = #{dto.perfDt}
                      AND FEE_TCNT_DV_CD = '02'
                --      AND MM_ACU_PERF_AGRG_CRT_DV_CD = '01' /* 접수-00:총주문월누적, 매출-01:순주문월누적 */
                      AND PERF_AGRG_CRT_DV_CD = '201' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                      AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W01: P추진단)*/
                      AND PERF_ATC_CD IN ('W02P00002', 'W00P00014','W00P00018')
                    GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                ) PERF
                 ON FC.DSB_YM = PERF.BASE_YM
                AND FC.PRTNR_NO = PERF.PRTNR_NO
                AND FC.OG_TP_CD = PERF.OG_TP_CD
              LEFT JOIN (
                            SELECT BASE_YM,PRTNR_NO ,OG_TP_CD
                                 , NVL(SUM(PERF_VAL), 0) AS MEET_DATES /* 미팅참석일수 */
                              FROM TB_FEAM_PRTNR_PERF_MM_CL /* 파트너실적월마감*/
                             WHERE 1=1
                                AND DTA_DL_YN = 'N'
                                AND BASE_YM = #{dto.perfDt}
                                AND FEE_TCNT_DV_CD = '02'
                                AND PERF_ATC_CD = 'W02P00093'
                                AND PERF_AGRG_CRT_DV_CD = '201' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                                AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단)*/
                             GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                          ) MEET /* 파트너실적월마감 */
                 ON FC.DSB_YM   = MEET.BASE_YM
                AND FC.PRTNR_NO = MEET.PRTNR_NO
                AND FC.OG_TP_CD = MEET.OG_TP_CD
               LEFT OUTER JOIN (
                                SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                                  FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                                 WHERE 1=1
                                   AND DTA_DL_YN = 'N'
                                   AND DSB_YM = #{dto.perfDt}
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND SPMT_DSB_DV_CD = '01'
                                ) DSB
                 ON FC.DSB_YM = DSB.DSB_YM
                AND FC.CO_CD = DSB.CO_CD
                AND FC.OG_TP_CD = DSB.OG_TP_CD
                AND FC.PRTNR_NO = DSB.PRTNR_NO
              WHERE 1 = 1
                AND FC.DSB_YM = #{dto.perfDt} /* 실적년월 */
                <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
                    AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
                </if>
                <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
                    AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
                </if>
                <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
                    AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
                </if>
                <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                    AND O.PRTNR_NO = #{dto.prtnrNo}
                </if>
               ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>




    <!-- P추진단 지점장 -->
    <select id="selectPManagerFeeSpecifications"  resultType="camelMap">

        <choose>
             <!-- P추진단 지점장 - 합계 -->
             <when test="@MybatisUtils@equals(dto.isSum ,'Y')">
                SELECT  '총 계' AS PRTNR_GD_CD
                      , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                      , SUM(DSB_VAL0) AS DSB_VAL0 /* 수수료 지급대상금액 */

                      , SUM(MEET_DATES) AS MEET_DATES   /* 미팅참석일수 */
                      , SUM(PERF_VAL1) AS PERF_VAL1   /* 조직 - 가전실적금액 */
                      , SUM(PERF_VAL2) AS PERF_VAL2   /* 조직 - 가전외실적금액 */
                      , SUM(PERF_VAL3) AS PERF_VAL3   /* 합산1 */
                      , SUM(PERF_VAL4) AS PERF_VAL4   /* 개인 - 가전 */
                      , SUM(PERF_VAL5) AS PERF_VAL5   /* 개인 - 가전외 */
                      , SUM(PERF_VAL6) AS PERF_VAL6   /* 합산2 */
                      , SUM(PERF_VAL7) AS PERF_VAL7   /* 개인 - 기변실적금액 */
                      , SUM(PERF_VAL0) AS PERF_VAL0

                      , SUM(DDTN_VAL1) AS DDTN_VAL1         /* 소득세 */
                      , SUM(DDTN_VAL2) AS DDTN_VAL2         /* 주민세 */
                      , SUM(DDTN_VAL3) AS DDTN_VAL3         /* 보증예치금 */
                      , SUM(DDTN_VAL4) AS DDTN_VAL4         /* 가지급금 */
                      , SUM(DDTN_VAL5) AS DDTN_VAL5         /* 부담공제 */
                      , SUM(DDTN_VAL6) AS DDTN_VAL6         /* 고용보험 */
                      , SUM(DDTN_VAL7) AS DDTN_VAL7         /* 산재보험 */

                      , SUM(DSB_VAL0)  AS DSB_VAL0    /* 수수료 지급대상금액 */
                      , SUM(DDTN_VAL0) AS DDTN_VAL0   /* 공제계 */

                      , ${feeEachSumField}  /* 수수료 각 항목 합계*/

                      ,  SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                FROM (
                    <include refid="pManagerSql"/>
                    ) TB_ORG
                GROUP BY BASE_YM
             </when>
             <otherwise>
                    <!-- P추진단 지점장 - 리스트 -->
                    <include refid="pManagerSql"/>
             </otherwise>
        </choose>
    </select>


    <!-- P추진단 지점장 쿼리 -->
    <sql id="pManagerSql" >

            /* P추진단 - 지점장 조회(동적 컬럼) */
            SELECT
                  O.BASE_YM             /* 기준년월 */
                , O.OG_CD
                , O.PSTN_DV_CD
                , F_CMZ_CD_NM('TNT_WELLS', 'PRTNR_GD_CD', O.PRTNR_GD_CD) AS DEGREE
                , HMM.HMST_GD_VAL AS DEGREE  /* 급수 */
                , FC.DSB_YM            /* 실적년월 */
                , FC.CO_CD              /* 회사코드 */
                , O.OG_TP_CD            /* 조직유형코드 */
                , O.DGR1_LEVL_OG_NM     /* 총괄단 조직명 */
                , O.DGR2_LEVL_OG_NM     /* 지역단 조직명 */
                , O.DGR3_LEVL_OG_NM     /* 지점 조직명 */
                , O.PRTNR_NO            /* 파트너번호 */
                , O.DGR3_LEVL_OG_CD     /* 3차레벨조직코드 - 지점 코드*/
                , O.PRTNR_KNM           /* 파트너명 */
                , O.RSB_DV_CD           /* 파트너 직급 */
                , NVL(MEET.MEET_DATES, 0) AS MEET_DATES   /* 미팅참석일수 */
                , NVL(PERF.PERF01, 0) AS PERF_VAL1   /* 조직 - 가전실적금액 */
                , NVL(PERF.PERF02, 0) AS PERF_VAL2   /* 조직 - 가전외실적금액 */
                , NVL(PERF.PERF03, 0) AS PERF_VAL3   /* 합산1 */
                , NVL(PERF.PERF04, 0) AS PERF_VAL4   /* 개인 - 가전 */
                , NVL(PERF.PERF05, 0) AS PERF_VAL5   /* 개인 - 가전외 */
                , NVL(PERF.PERF06, 0) AS PERF_VAL6   /* 합산2 */
                , NVL(PERF.PERF07, 0) AS PERF_VAL7   /* 개인 - 기변실적금액 */
                , ( NVL(PERF.PERF01, 0) + NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0) + NVL(PERF.PERF04, 0) +NVL(PERF.PERF05, 0) +NVL(PERF.PERF06, 0) +NVL(PERF.PERF07, 0) ) AS PERF_VAL0
                , ${feeCdFields}
                , ${feeSumField}
                , NVL(D.DDTN02, 0) AS DDTN_VAL1         /* 소득세 */
                , NVL(D.DDTN03, 0) AS DDTN_VAL2         /* 주민세 */
                , NVL(D.DDTN01, 0) AS DDTN_VAL3         /* 보증예치금 */
                , NVL(D.DDTN04, 0) AS DDTN_VAL4         /* 가지급금 */
                , NVL(D.DDTN07, 0) AS DDTN_VAL5         /* 부담공제 */
                , NVL(D.DDTN05, 0) AS DDTN_VAL6         /* 고용보험 */
                , NVL(D.DDTN06, 0) AS DDTN_VAL7         /* 산재보험 */
                , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) + NVL(D.DDTN05, 0)+ NVL(D.DDTN06, 0)) AS DDTN_VAL0   /* 공제계 */
                , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0    /* 수수료 지급대상금액 */
            FROM
            (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                  AND FBD.DTA_DL_YN = 'N'
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
            INNER JOIN
                (
                    SELECT T1.BASE_YM /* 기준년월 */
                         , T1.OG_CD
                         , T2.PSTN_DV_CD
                         , T2.PRTNR_GD_CD
                         , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                         , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                         , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                         , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                         , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                         , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                         , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                         , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                         , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                         , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                         , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                         , T1.DTRC_N /* 지국수 */
                         , T2.PRTNR_NO /* 파트너번호 */
                         , T2.PRTNR_KNM /* 파트너명 */
                         , T2.RSB_DV_CD /* 직책구분코드 */
                         , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                    FROM (
                            SELECT *
                              FROM TB_OGBS_MM_OG_IZ
                             WHERE 1=1
                               AND BASE_YM = #{dto.perfDt}
                               AND DTA_DL_YN = 'N'
                               AND OG_TP_CD = 'W01' /* 조직유형코드(W01: P추진단, W02: M추진단) */
                           ) T1
                   INNER JOIN  (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , BASE_YM
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                      , PSTN_DV_CD
                                      , PRTNR_GD_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND RSB_DV_CD = 'W0104' /* 직책구분코드(W0104 : 지점장) */
                                )  T2
                      ON T1.BASE_YM = T2.BASE_YM
                     AND T1.OG_TP_CD = T2.OG_TP_CD
                     AND T1.OG_ID = T2.OG_ID
                   WHERE 1 = 1
                ) O
                     ON FC.DSB_YM = O.BASE_YM     /* 실적년월 = 관리년월*/
                    AND FC.PRTNR_NO = O.PRTNR_NO
                    AND FC.OG_TP_CD = O.OG_TP_CD
                   LEFT OUTER JOIN
                    (
                        SELECT DDTN_YM
                            , OG_TP_CD
                            , PRTNR_NO
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '08' THEN FEE_DDTN_CNFM_AMT END) AS DDTN08
                            , SUM(CASE WHEN FEE_DDTN_TP_CD = '88' THEN FEE_DDTN_CNFM_AMT END) AS DDTN88
                        FROM TB_FEAM_FEE_DDTN_IZ
                        WHERE 1 = 1
                          AND DTA_DL_YN = 'N'
                          AND DDTN_YM = #{dto.perfDt}
                        GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
                    ) D
                     ON O.BASE_YM = D.DDTN_YM
                    AND O.PRTNR_NO = D.PRTNR_NO
                    AND O.OG_TP_CD = D.OG_TP_CD
                   LEFT OUTER JOIN
                (
                        SELECT BASE_YM
                             , PRTNR_NO
                             , OG_TP_CD
                             , SUM(CASE WHEN (PERF_DV_CD = 2 AND PERF_ATC_CD = 'W01P00001') THEN PERF_VAL END) AS PERF01        /* 조직 - 가전실적금액 */
                             , SUM(CASE WHEN (PERF_DV_CD = 2 AND PERF_ATC_CD = 'W01P00004') THEN PERF_VAL END) AS PERF02        /* 조직 - 가전외실적금액 */
                             , SUM(CASE WHEN (PERF_DV_CD = 2 AND PERF_ATC_CD IN('W01P00001','W01P00004') ) THEN PERF_VAL END) AS PERF03   /* 합산1 */
                             , SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD = 'W01P00001') THEN PERF_VAL END) AS PERF04   /* 개인 - 가전 */
                             , SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD = 'W01P00004') THEN PERF_VAL END) AS PERF05   /* 개인 - 가전외 */
                             , SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD IN('W01P00001','W01P00004') ) THEN PERF_VAL END) AS PERF06   /* 합산2 */
                             , SUM(CASE WHEN (PERF_DV_CD = 0 AND PERF_ATC_CD = 'W00P00028') THEN PERF_VAL END) AS PERF07   /* 개인 - 기변실적금액 */
                         FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감 */
                        WHERE 1 = 1
                          AND DTA_DL_YN = 'N'
                          AND BASE_YM = #{dto.perfDt}
                          AND FEE_TCNT_DV_CD = '02'
                       -- AND MM_ACU_PERF_AGRG_CRT_DV_CD = '01' /* 접수-00:총주문월누적, 매출-01:순주문월누적 */
                          AND PERF_AGRG_CRT_DV_CD = '101' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                          AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W01: P추진단)*/
                          AND PERF_ATC_CD IN ('W01P00001', 'W01P00004','W01P00001','W01P00004','W00P00028')
                        GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                ) PERF
                     ON FC.DSB_YM = PERF.BASE_YM
                    AND FC.PRTNR_NO = PERF.PRTNR_NO
                    AND FC.OG_TP_CD = PERF.OG_TP_CD
                   LEFT JOIN (
                                SELECT BASE_YM,PRTNR_NO ,OG_TP_CD
                                     , NVL(SUM(PERF_VAL), 0) AS MEET_DATES /* 미팅참석일수 */
                                  FROM TB_FEAM_PRTNR_PERF_MM_CL
                                 WHERE 1=1
                                    AND DTA_DL_YN = 'N'
                                    AND BASE_YM = #{dto.perfDt}
                                    AND FEE_TCNT_DV_CD = '02'
                                    AND PERF_ATC_CD = 'W01P00012'
                                    AND PERF_AGRG_CRT_DV_CD = '101' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
                                    AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단)*/
                                 GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD
                              ) MEET /* 파트너실적월마감 */
                     ON FC.DSB_YM   = MEET.BASE_YM
                    AND FC.PRTNR_NO = MEET.PRTNR_NO
                    AND FC.OG_TP_CD = MEET.OG_TP_CD
                   LEFT OUTER JOIN (
                                        SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                                          FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                                         WHERE 1=1
                                           AND DTA_DL_YN = 'N'
                                           AND DSB_YM = #{dto.perfDt}
                                           AND OG_TP_CD = #{dto.ogTpCd}
                                           AND SPMT_DSB_DV_CD = '01'
                                    ) DSB
                     ON FC.DSB_YM = DSB.DSB_YM
                    AND FC.CO_CD = DSB.CO_CD
                    AND FC.OG_TP_CD = DSB.OG_TP_CD
                    AND FC.PRTNR_NO = DSB.PRTNR_NO
            LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS HMM
             ON FC.DSB_YM = HMM.MNGT_YM
            AND FC.PRTNR_NO = HMM.PRTNR_NO
            WHERE 1 = 1
              AND FC.DSB_YM = #{dto.perfDt} /* 실적년월 */
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
              AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
              AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
              AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
              AND O.PRTNR_NO = #{dto.prtnrNo}
          </if>
            ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>




    <!-- 홈마스터 - 홈마스터  -->
    <select id="selectHPlannerFeeSpecifications"  resultType="camelMap">
        <choose>
             <!-- 홈마스터 - 홈마스터 - 합계 -->
             <when test="@MybatisUtils@equals(dto.isSum ,'Y')">
                SELECT  '총 계' AS PRTNR_KNM
                      , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                      , SUM(DSB_VAL0) AS DSB_VAL0 /* 수수료 지급대상금액 */

                      , SUM(MEET_DATES) AS MEET_DATES   /* 미팅참석일수 */
                      , SUM(PERF_VAL1) AS PERF_VAL1 /* 가전인정건수 */
                      , SUM(PERF_VAL2) AS PERF_VAL2 /* 서비스건수 */
                      , SUM(PERF_VAL0) AS PERF_VAL0

                       , SUM(DDTN_VAL1) AS DDTN_VAL1         /* 보증예치금 */
                       , SUM(DDTN_VAL2) AS DDTN_VAL2         /* 소득세 */
                       , SUM(DDTN_VAL3) AS DDTN_VAL3         /* 주민세 */
                       , SUM(DDTN_VAL4) AS DDTN_VAL4         /* 고용보험 */
                       , SUM(DDTN_VAL5) AS DDTN_VAL5         /* 가지급금 */
                       , SUM(DDTN_VAL6) AS DDTN_VAL6         /* 부담공제 */
                       , SUM(DDTN_VAL7) AS DDTN_VAL7         /* 기타공제 */

                      , SUM(DSB_VAL0)  AS DSB_VAL0    /* 수수료 지급대상금액 */
                      , SUM(DDTN_VAL0) AS DDTN_VAL0   /* 공제계 */

                      , ${feeEachSumField}  /* 수수료 각 항목 합계*/


                      ,  SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                FROM (
                    <include refid="hPlanagerSql"/>
                    ) TB_ORG
                GROUP BY BASE_YM
             </when>
              <otherwise>
                      <include refid="hPlanagerSql"/>
              </otherwise>
        </choose>
    </select>


        <!-- 홈마스터  플래너 -->
    <sql id="hPlanagerSql" >

        /* 홈마스터 - 플래너 조회(동적 컬럼) */
        SELECT
              O.BASE_YM             /* 기준년월 */
            , O.OG_CD
            , O.MONTHS              /*  차월수 */
            , O.PSTN_DV_CD
            , FC.DSB_YM             /* 실적년월 */
            , FC.CO_CD              /* 회사코드 */
            , O.OG_TP_CD            /* 조직유형코드 */
            , O.DGR1_LEVL_OG_NM     /* 총괄단 조직명 */
            , O.DGR2_LEVL_OG_NM     /* 지역단 조직명 */
            , O.DGR3_LEVL_OG_NM     /* 지점 조직명 */
            , O.PRTNR_NO            /* 파트너번호 */
            , O.DGR3_LEVL_OG_CD     /* 3차레벨조직코드 - 지점 코드*/
            , O.PRTNR_KNM           /* 파트너명 */
            , O.RSB_DV_CD           /* 파트너 직급 */
            , HMM.HMST_GD_VAL AS DEGREE  /* 급수 */
            , '0' AS MEET_DATES     /* 미팅참석일수 */
            , NVL(PERF.PERF02, 0) AS PERF_VAL1    /* 가전인정건수 */
            , NVL(PERF.PERF03, 0) AS PERF_VAL2    /* 서비스건수 */
            , ( NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0) ) AS PERF_VAL0
            , ${feeCdFields}
            , ${feeSumField}
            , NVL(D.DDTN01, 0) AS DDTN_VAL1         /* 보증예치금 */
            , NVL(D.DDTN02, 0) AS DDTN_VAL2         /* 소득세 */
            , NVL(D.DDTN03, 0) AS DDTN_VAL3         /* 주민세 */
            , NVL(D.DDTN05, 0) AS DDTN_VAL4         /* 고용보험 */
            , NVL(D.DDTN04, 0) AS DDTN_VAL5         /* 가지급금 */
            , NVL(D.DDTN07, 0) AS DDTN_VAL6         /* 부담공제 */
            , NVL(D.DDTN99, 0) AS DDTN_VAL7         /* 기타공제 */
            , NVL(D.DDTN06, 0) AS DDTN_VAL8         /* 산재보험 */
            , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) + NVL(D.DDTN05, 0)+ NVL(D.DDTN06, 0)+ NVL(D.DDTN99, 0)) AS DDTN_VAL0   /* 공제계 */
            , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0    /* 수수료 지급대상금액 */
            FROM
            (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                  AND FBD.DTA_DL_YN = 'N'
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
            INNER JOIN
            (
                 SELECT T1.BASE_YM /* 기준년월 */
                      , T1.OG_CD
                      , CEIL(MONTHS_BETWEEN(T1.BASE_YM || '01', T2.CNTR_DT)) + 1 AS MONTHS    /* 차월 */
                      , T2.PSTN_DV_CD
                      , T2.PRTNR_GD_CD
                      , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                      , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                      , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                      , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                      , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                      , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                      , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                      , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                      , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                      , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                      , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                      , T1.DTRC_N /* 지국수 */
                      , T2.PRTNR_NO /* 파트너번호 */
                      , T2.PRTNR_KNM /* 파트너명 */
                      , T2.RSB_DV_CD /* 직책구분코드 */
                      , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                  FROM (
                        SELECT *
                          FROM TB_OGBS_MM_OG_IZ
                         WHERE 1=1
                           AND BASE_YM = #{dto.perfDt}
                           AND DTA_DL_YN = 'N'
                           AND OG_TP_CD = 'W03' /* 조직유형코드(W01: P추진단, W02: M추진단) */
                       ) T1
                 INNER JOIN  (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , CNTR_DT
                                      , BASE_YM
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                      , PSTN_DV_CD
                                      , PRTNR_GD_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND RSB_DV_CD = 'W0302' /* 직책구분코드(W0302 : 홈마스터) */
                                )  T2
                    ON T1.BASE_YM = T2.BASE_YM
                   AND T1.OG_TP_CD = T2.OG_TP_CD
                   AND T1.OG_ID = T2.OG_ID
                 WHERE 1 = 1
            ) O
                    ON FC.DSB_YM = O.BASE_YM     /* 실적년월 = 관리년월*/
                   AND FC.PRTNR_NO = O.PRTNR_NO
                   AND FC.OG_TP_CD = O.OG_TP_CD
            LEFT OUTER JOIN
            (
                SELECT DDTN_YM
                     , OG_TP_CD
                     , PRTNR_NO
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07
                     , SUM(CASE WHEN FEE_DDTN_TP_CD = '99' THEN FEE_DDTN_CNFM_AMT END) AS DDTN99  /* 기타공제 */
                  FROM TB_FEAM_FEE_DDTN_IZ
                 WHERE 1 = 1
                   AND DTA_DL_YN = 'N'
                   AND DDTN_YM = #{dto.perfDt}
                 GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
            ) D
                 ON O.BASE_YM = D.DDTN_YM
                AND O.PRTNR_NO = D.PRTNR_NO
                AND O.OG_TP_CD = D.OG_TP_CD
         LEFT OUTER JOIN
            (
             	            /*홈마스터가전서비스건수*/
				 SELECT BASE_YM
					  , PRTNR_NO
					  , OG_TP_CD
				      , NVL(SUM(CASE WHEN PERF_ATC_CD = 'W03P00002' THEN PERF_VAL END), 0) AS PERF02 /*가전인정건수*/
				      , NVL(SUM(CASE WHEN PERF_ATC_CD = 'W03P00085' THEN PERF_VAL END), 0) AS PERF03 /*서비스건수*/

				FROM TB_FEAM_NTORP_PERF_MM_CL
				WHERE 1 = 1
				  AND BASE_YM = #{dto.perfDt}
				  AND PERF_YM = #{dto.perfDt}
				  AND FEE_TCNT_DV_CD = '02'
				  AND PERF_AGRG_CRT_DV_CD = '301' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
				  AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단,W03: 홈마스터)*/
				  AND PERF_ATC_CD IN ('W03P00085','W03P00002')
				  AND PERF_DV_CD = '0' /* 2 : 지점장, 0 : 개인 */
				  AND DTA_DL_YN = 'N'
				GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD

              ) PERF
             ON FC.DSB_YM   = PERF.BASE_YM
            AND FC.PRTNR_NO = PERF.PRTNR_NO
            AND FC.OG_TP_CD = PERF.OG_TP_CD
           LEFT OUTER JOIN (
                            SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                              FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                             WHERE 1=1
                               AND DTA_DL_YN = 'N'
                               AND DSB_YM = #{dto.perfDt}
                               AND OG_TP_CD = #{dto.ogTpCd}
                               AND SPMT_DSB_DV_CD = '01'
                            ) DSB
             ON FC.DSB_YM = DSB.DSB_YM
            AND FC.CO_CD = DSB.CO_CD
            AND FC.OG_TP_CD = DSB.OG_TP_CD
            AND FC.PRTNR_NO = DSB.PRTNR_NO
           LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS HMM
             ON FC.DSB_YM = HMM.MNGT_YM
            AND FC.PRTNR_NO = HMM.PRTNR_NO
          WHERE 1 = 1
            AND FC.DSB_YM = #{dto.perfDt} /* 실적년월 */
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
                AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
                AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
                AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
            </if>
            <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                AND O.PRTNR_NO = #{dto.prtnrNo}
            </if>
           ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>




        <!-- 홈마스터 - 지점장  -->
    <select id="selectHManagerFeeSpecifications"  resultType="camelMap">
          <choose>
                     <!-- 홈마스터 - 지점장 - 합계 -->
              <when test="@MybatisUtils@equals(dto.isSum ,'Y')">
                    SELECT  '총 계' AS PRTNR_KNM
                          , SUM(MEET_DATES) AS MEET_DATES /* 미팅참석일수 */
                          , SUM(DSB_VAL0) AS DSB_VAL0 /* 수수료 지급대상금액 */

                          , SUM(MEET_DATES) AS MEET_DATES   /* 미팅참석일수 */
                          , SUM(PERF_VAL1) AS PERF_VAL1 /* 가전인정건수 */
                          , SUM(PERF_VAL2) AS PERF_VAL2 /* 서비스건수 */
                          , SUM(PERF_VAL3) AS PERF_VAL3 /* 조직인정건수 */
                          , SUM(PERF_VAL4) AS PERF_VAL4 /* 조직서비스건수 */
                          , SUM(PERF_VAL0) AS PERF_VAL0

                          , SUM(DDTN_VAL1) AS DDTN_VAL1         /* 보증예치금 */
                          , SUM(DDTN_VAL2) AS DDTN_VAL2         /* 소득세 */
                          , SUM(DDTN_VAL3) AS DDTN_VAL3         /* 주민세 */
                          , SUM(DDTN_VAL4) AS DDTN_VAL4         /* 고용보험 */
                          , SUM(DDTN_VAL5) AS DDTN_VAL5         /* 가지급금 */
                          , SUM(DDTN_VAL6) AS DDTN_VAL6         /* 부담공제 */
                          , SUM(DDTN_VAL7) AS DDTN_VAL7         /* 기타공제 */
                          , SUM(DDTN_VAL8) AS DDTN_VAL8         /* 산재보험 */

                          , SUM(DSB_VAL0)  AS DSB_VAL0    /* 수수료 지급대상금액 */
                          , SUM(DDTN_VAL0) AS DDTN_VAL0   /* 공제계 */

                          , ${feeEachSumField}  /* 수수료 각 항목 합계*/

                          ,  SUM(NVL(FEE_VAL0,0))  AS FEE_VAL0  /*  수수료 합계 */
                    FROM (
                        <include refid="hManagerSql"/>
                        ) TB_ORG
                    GROUP BY BASE_YM

              </when>
              <otherwise>
                    <!-- 홈마스터 - 지점장 - 리스트 -->
                    <include refid="hManagerSql"/>
               </otherwise>
          </choose>
    </select>



    <!-- 홈마스터 지점장 -->
    <sql id="hManagerSql"  >

            /* 홈마스터 - 지점장 조회(동적 컬럼) */
            SELECT
                  O.BASE_YM             /* 기준년월 */
                , O.OG_CD
                , O.MONTHS             /* 차월수 */
                , HMM.HMST_GD_VAL AS DEGREE  /* 급수 */
                , O.PSTN_DV_CD
                , O.PRTNR_GD_CD
                , FC.DSB_YM            /* 실적년월 */
                , FC.CO_CD              /* 회사코드 */
                , O.OG_TP_CD            /* 조직유형코드 */
                , O.DGR1_LEVL_OG_NM     /* 총괄단 조직명 */
                , O.DGR2_LEVL_OG_NM     /* 지역단 조직명 */
                , O.DGR3_LEVL_OG_NM     /* 지점 조직명 */
                , O.PRTNR_NO            /* 파트너번호 */
                , O.DGR3_LEVL_OG_CD     /* 3차레벨조직코드 - 지점 코드*/
                , O.PRTNR_KNM           /* 파트너명 */
                , O.RSB_DV_CD           /* 파트너 직급 */
                , '0' AS MEET_DATES /* 미팅참석일수 */
                , NVL(PERF.PERF02, 0) AS PERF_VAL1    /* 가전인정건수 */
                , NVL(PERF.PERF03, 0) AS PERF_VAL2    /* 서비스건수 */
                , NVL(PERF.PERF04, 0) AS PERF_VAL3    /* 가전인정건수 */
                , NVL(PERF.PERF05, 0) AS PERF_VAL4    /* 서비스건수 */
                , ( NVL(PERF.PERF02, 0) + NVL(PERF.PERF03, 0) + NVL(PERF.PERF04, 0) + NVL(PERF.PERF05, 0) ) AS PERF_VAL0
                , ${feeCdFields}
                , ${feeSumField}
                , NVL(D.DDTN01, 0) AS DDTN_VAL1         /* 보증예치금 */
                , NVL(D.DDTN02, 0) AS DDTN_VAL2         /* 소득세 */
                , NVL(D.DDTN03, 0) AS DDTN_VAL3         /* 주민세 */
                , NVL(D.DDTN05, 0) AS DDTN_VAL4         /* 고용보험 */
                , NVL(D.DDTN04, 0) AS DDTN_VAL5         /* 가지급금 */
                , NVL(D.DDTN07, 0) AS DDTN_VAL6         /* 부담공제 */
                , NVL(D.DDTN99, 0) AS DDTN_VAL7         /* 기타공제 */
                , NVL(D.DDTN06, 0) AS DDTN_VAL8         /* 산재보험 */
                , (NVL(D.DDTN02, 0) + NVL(D.DDTN03, 0) + NVL(D.DDTN01, 0) + NVL(D.DDTN04, 0) + NVL(D.DDTN07, 0) + NVL(D.DDTN05, 0) + NVL(D.DDTN06, 0) + NVL(D.DDTN99, 0) )  AS DDTN_VAL0   /* 공제계 */
                , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_VAL0    /* 수수료 지급대상금액 */
            FROM
            (
                SELECT  DI.DSB_YM /* 기준년월 */
                      , DI.CO_CD /* 회사코드 */
                      , DI.OG_TP_CD /* 조직유형코드 */
                      , DI.PRTNR_NO /* 파트너번호 */
                      , ${feeCdCase}
                 FROM TB_FEAM_FEE_DSB_DTL_IZ DI /* 수수료지급상세내역 */
                 LEFT JOIN TB_FEAM_FEE_BASE_DTL FBD /* 수수료기준상세 */
                   ON DI.FEE_CD = FBD.FEE_CD
                WHERE 1=1
                  AND DI.DSB_YM = #{dto.perfDt}
                  AND DI.DTA_DL_YN ='N'
                  AND DI.OG_TP_CD  = #{dto.ogTpCd}
                  AND DI.FEE_ATC_DV_CD = '01'  /*수수료항목구분코드  01:수수료 , 02: 공제 , 03: 실적*/
                  AND DI.SPMT_DSB_DV_CD = '01' /* 추가지급구분코드 */
                  AND DI.FEE_TCNT_DV_CD = '02' /* 수수료 차수구분코드*/
                  AND #{dto.perfDt} BETWEEN FBD.APY_STRT_YM AND  FBD.APY_END_YM
                  AND FBD.DTA_DL_YN = 'N'
                 <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
                  AND DI.PRTNR_NO = #{dto.prtnrNo}
                 </if>
                GROUP BY DI.DSB_YM , DI.CO_CD,DI.OG_TP_CD,DI.PRTNR_NO
            ) FC
            INNER JOIN
                    (
                        SELECT T1.BASE_YM /* 기준년월 */
                             , T1.OG_CD
                             , CEIL(MONTHS_BETWEEN(T1.BASE_YM || '01', T2.CNTR_DT)) + 1 AS MONTHS    /* 차월 */
                             , T1.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                             , T1.DGR1_LEVL_OG_CD /* 1차레벨조직코드 */
                             , T1.DGR1_LEVL_OG_NM /* 1차레벨조직명 */
                             , T1.DGR1_LEVL_DG_PRTNR_NO /* 1차레벨대표파트너번호 */
                             , T1.DGR1_LEVL_DG_PRTNR_NM /* 1차레벨대표파트너명 */
                             , T1.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                             , T1.DGR2_LEVL_OG_CD /* 2차레벨조직코드 */
                             , T1.DGR2_LEVL_OG_NM /* 2차레벨조직명 */
                             , T1.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                             , T1.DGR3_LEVL_OG_CD /* 3차레벨조직코드 */
                             , T1.DGR3_LEVL_OG_NM /* 3차레벨조직명 */
                             , T1.DTRC_N /* 지국수 */
                             , T2.PRTNR_NO /* 파트너번호 */
                             , T2.PRTNR_KNM /* 파트너명 */
                             , T2.RSB_DV_CD /* 직책구분코드 */
                             , T2.PSTN_DV_CD /*직급구분코드*/
                             , T2.PRTNR_GD_CD /*파트너 등급코드*/
                             , T2.OG_TP_CD  /* 조직유형코드(W01: P추진단, W02: M추진단) */
                        FROM (
                                SELECT *
                                  FROM TB_OGBS_MM_OG_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = 'W03' /* 조직유형코드(W01: P추진단, W02: M추진단) */
                               ) T1
                       INNER JOIN  (
                                SELECT  PRTNR_NO
                                      , PRTNR_KNM
                                      , RSB_DV_CD
                                      , PRTNR_GD_CD
                                      , BASE_YM
                                      , CNTR_DT
                                      , OG_TP_CD
                                      , OG_ID
                                      , QLF_DV_CD
                                      , PSTN_DV_CD
                                  FROM TB_OGBS_MM_PRTNR_IZ
                                 WHERE 1=1
                                   AND BASE_YM = #{dto.perfDt}
                                   AND DTA_DL_YN = 'N'
                                   AND OG_TP_CD = #{dto.ogTpCd}
                                   AND RSB_DV_CD = 'W0301' /* 직책구분코드(W0301 : 지점장) */
                                )  T2
                          ON T1.BASE_YM = T2.BASE_YM
                         AND T1.OG_TP_CD = T2.OG_TP_CD
                         AND T1.OG_ID = T2.OG_ID
                       WHERE 1 = 1
                    ) O
                     ON FC.DSB_YM = O.BASE_YM     /* 실적년월 = 관리년월*/
                    AND FC.PRTNR_NO = O.PRTNR_NO
                    AND FC.OG_TP_CD = O.OG_TP_CD
                   LEFT OUTER JOIN
                (
                    SELECT DDTN_YM
                        , OG_TP_CD
                        , PRTNR_NO
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '01' THEN FEE_DDTN_CNFM_AMT END) AS DDTN01
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '02' THEN FEE_DDTN_CNFM_AMT END) AS DDTN02
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '03' THEN FEE_DDTN_CNFM_AMT END) AS DDTN03
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '04' THEN FEE_DDTN_CNFM_AMT END) AS DDTN04
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '05' THEN FEE_DDTN_CNFM_AMT END) AS DDTN05
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '06' THEN FEE_DDTN_CNFM_AMT END) AS DDTN06
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '07' THEN FEE_DDTN_CNFM_AMT END) AS DDTN07
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '08' THEN FEE_DDTN_CNFM_AMT END) AS DDTN08
                        , SUM(CASE WHEN FEE_DDTN_TP_CD = '99' THEN FEE_DDTN_CNFM_AMT END) AS DDTN99
                    FROM TB_FEAM_FEE_DDTN_IZ
                    WHERE 1 = 1
                      AND DTA_DL_YN = 'N'
                      AND DDTN_YM = #{dto.perfDt}
                    GROUP BY DDTN_YM, OG_TP_CD, PRTNR_NO
                ) D
                     ON O.BASE_YM = D.DDTN_YM
                    AND O.PRTNR_NO = D.PRTNR_NO
                    AND O.OG_TP_CD = D.OG_TP_CD
            LEFT OUTER JOIN
               (
				 SELECT BASE_YM
					  , PRTNR_NO
					  , OG_TP_CD
				      , NVL(SUM(CASE WHEN PERF_DV_CD = '0' AND PERF_ATC_CD = 'W03P00002' THEN PERF_VAL END), 0) AS PERF02 /*가전인정건수*/
                      , NVL(SUM(CASE WHEN PERF_DV_CD = '0' AND PERF_ATC_CD = 'W03P00085' THEN PERF_VAL END), 0) AS PERF03 /*서비스건수*/
                      , NVL(SUM(CASE WHEN PERF_DV_CD = '2' AND PERF_ATC_CD = 'W03P00002' THEN PERF_VAL END), 0)
                        - NVL(SUM(CASE WHEN PERF_DV_CD = '0' AND PERF_ATC_CD = 'W03P00002' THEN PERF_VAL END), 0) AS PERF04 /*조직인정건수*/
                      , NVL(SUM(CASE WHEN PERF_DV_CD = '2' AND PERF_ATC_CD = 'W03P00085' THEN PERF_VAL END), 0)
                        - NVL(SUM(CASE WHEN PERF_DV_CD = '0' AND PERF_ATC_CD = 'W03P00085' THEN PERF_VAL END), 0) AS PERF05 /*조직서비스건수*/
				FROM TB_FEAM_NTORP_PERF_MM_CL
				WHERE 1 = 1
				  AND BASE_YM = #{dto.perfDt}
				  AND PERF_YM = #{dto.perfDt}
				  AND FEE_TCNT_DV_CD = '02'
				  AND PERF_AGRG_CRT_DV_CD = '301' /*실적집계생성구분코드(101 : P추진단순주문실적생성 , 201: M추진단순주문실적생성 , 301 : 홈마스터순주문실적생성 )*/
				  AND OG_TP_CD = #{dto.ogTpCd} /*조직유형코드(W02: M추진단,W03: 홈마스터)*/
				  AND PERF_ATC_CD IN ('W03P00085','W03P00002')
				  AND PERF_DV_CD IN ('0', '2') /* 2 : 지점장, 0 : 개인 */

				  AND DTA_DL_YN = 'N'
				GROUP BY BASE_YM, PRTNR_NO, OG_TP_CD

               ) PERF
              ON FC.DSB_YM   = PERF.BASE_YM
             AND FC.PRTNR_NO = PERF.PRTNR_NO
             AND FC.OG_TP_CD = PERF.OG_TP_CD
            LEFT OUTER JOIN (
                            SELECT DSB_YM , CO_CD , OG_TP_CD ,PRTNR_NO, DSB_OJ_AMT
                              FROM TB_FEAM_FEE_DSB_IZ   /* 수수료지급내역 */
                             WHERE 1=1
                               AND DTA_DL_YN = 'N'
                               AND DSB_YM = #{dto.perfDt}
                               AND OG_TP_CD = #{dto.ogTpCd}
                               AND SPMT_DSB_DV_CD = '01'
                            ) DSB
              ON FC.DSB_YM = DSB.DSB_YM
             AND FC.CO_CD = DSB.CO_CD
             AND FC.OG_TP_CD = DSB.OG_TP_CD
             AND FC.PRTNR_NO = DSB.PRTNR_NO
            LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS HMM
             ON FC.DSB_YM = HMM.MNGT_YM
            AND FC.PRTNR_NO = HMM.PRTNR_NO
            WHERE 1 = 1
              AND FC.DSB_YM = #{dto.perfDt} /* 실적년월 */
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel1)">
              AND O.DGR1_LEVL_OG_ID = #{dto.ogLevel1} /* 조직레벨 - 총괄단 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel2)">
              AND O.DGR2_LEVL_OG_ID = #{dto.ogLevel2} /* 조직레벨 - 지역단 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.ogLevel3)">
              AND O.DGR3_LEVL_OG_ID = #{dto.ogLevel3} /* 조직레벨 - 지점 */
          </if>
          <if test="@MybatisUtils@isNotEmpty(dto.prtnrNo)">
              AND O.PRTNR_NO = #{dto.prtnrNo}
          </if>
            ORDER BY O.DGR1_LEVL_OG_CD , O.DGR2_LEVL_OG_CD , O.DGR3_LEVL_OG_CD ,O.PRTNR_NO
    </sql>

</mapper>
