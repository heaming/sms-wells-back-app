<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.fee.calculation.mapper.WfebOrganizationFeeMapper">

    <select id='selectHomeMasterFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstRes">
        SELECT B.DGR2_LEVL_OG_NM    /*지역단*/
             , B.DGR3_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , FLOOR(MONTHS_BETWEEN (#{perfYm}||'01',A.CNTR_DT)) +2 AS AKDCHA    /* 차월 */
             , H.HMST_GD_VAL AS PRTNR_GD_CD  /* 급수 */
             , G.EDUC_CRSE_CRT_BASE_YM AS EDU100            /*신입입문교육*/
             , NVL(D.AKCDA12,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA10,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , C.LCCNT1     /* 배정건수 */
             , C.C_LCCNT1   /* 취소건수 */
             , C.R_LCCNT1   /* 실배정건 */
             , C.GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , C.ELECNT     /* 가전 건수 */
             , C.SERCNT     /* 총 서비스건수 */
             , C.SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND AK17.PRTNR_NO = #{prtnrNo}
                               </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(LCCNT1) AS LCCNT1
                             , SUM(C_LCCNT1) AS C_LCCNT1
                             , SUM(LCCNT1) - SUM(C_LCCNT1) AS R_LCCNT1
                             , SUM(GD_LCCNT2) + SUM(GD_LCCNT3) AS GD_SERCNT
                             , SUM(EL_LCCNT2) + SUM(EL_LCCNT3) AS ELECNT
                             , SUM(LCCNT2) + SUM(LCCNT3) AS SERCNT
                             , SUM(LCRAT1) AS SERRYL
                          FROM ( SELECT PRTNR_NO
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999901' THEN PERF_VAL END AS LCCNT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999902' THEN PERF_VAL END AS LCCNT2
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999903' THEN PERF_VAL END AS LCCNT3
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999909' THEN PERF_VAL END AS LCRAT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01909001' THEN PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'HM01139902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01159902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01129902' ) THEN PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'HM01139903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01159903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01129903' ) THEN PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'HM01199902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01029902' ) THEN PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'HM01199903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'HM01029903' ) THEN PERF_VAL END AS EL_LCCNT3
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                  WHERE BASE_YM = #{perfYm}
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND PRTNR_NO = #{prtnrNo}
                               </if>
                                    AND CL_DV_CD = '02'
                                    AND OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = #{perfYm}
                                    AND A.OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND FEE_ATC_DV_CD = '01'
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030051', 'W030002', 'W030003', 'W030052', 'W030053',
                                                      'W030004', 'W030054', 'W030005', 'W030055', 'W030006', 'W030056',
                                                      'W030007', 'W030057', 'W030008', 'W030009', 'W030058', 'W030059',
                                                      'W030010', 'W030060', 'W030011', 'W030061', 'W030012', 'W030062',
                                                      'W030014', 'W030064', 'W030015', 'W030065' )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = #{perfYm}
                           AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                           AND A.PRTNR_NO = #{prtnrNo}
                      </if>
                           AND A.OG_TP_CD = 'W03'
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
        ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = G.PRTNR_NO
       AND A.OG_TP_CD = G.OG_TP_CD
       AND G.EDUC_CRSE_NO = '124'
       AND G.EDUC_CPC_ACKMT_YN = 'Y'
      LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS H
        ON A.BASE_YM = H.MNGT_YM
       AND A.PRTNR_NO = H.PRTNR_NO
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'
   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
       AND A.PRTNR_NO = #{prtnrNo}
   </if>
       AND A.RSB_DV_CD = 'W0302'
    </select>


    <select id='selectHomeMasterBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstBrmgrRes">
        SELECT B.DGR2_LEVL_OG_NM    /*지역단*/
             , B.DGR3_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , FLOOR(MONTHS_BETWEEN (#{perfYm}||'01',A.CNTR_DT)) +2 AS AKDCHA    /* 차월 */
             , A.PRTNR_GD_CD  /* 급수 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN 1 ELSE 0 END AS ATCNT1 /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN 1 ELSE 0 END AS ATCNT2 /* 교육수료일수 동행교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS124EDU /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS125EDU /* 교육수료일수동행교육 */
             , NVL(D.AKCDA12,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA10,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , C.LCCNT1     /* 배정건수 */
             , C.C_LCCNT1   /* 취소건수 */
             , C.R_LCCNT1   /* 실배정건 */
             , C.GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , C.ELECNT     /* 가전 건수 */
             , C.SERCNT     /* 총 서비스건수 */
             , C.SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , G.GADCNT AS GADCNT   /* 실활동인원 */
             , G.J_AKDEQ0    /* 인정건수 */
             , G.J_SERCNT    /* 서비스건수 */
             , NVL(E.AKSD51,0) AS AKSD51   /* 렌탈 */
             , NVL(E.AKSD52,0) AS AKSD52   /* 일시불/할부 */
             , NVL(E.AKSD53,0) AS AKSD53   /* 판매연계 */
             , NVL(E.AKSD54,0) AS AKSD54   /* 조직관리 */
             , NVL(E.AKSD55,0) AS AKSD55   /* 신규판매 */
             , NVL(E.AKSD56,0) AS AKSD56   /* 서비스연계 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND AK17.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(LCCNT1) AS LCCNT1
                             , SUM(C_LCCNT1) AS C_LCCNT1
                             , SUM(LCCNT1) - SUM(C_LCCNT1) AS R_LCCNT1
                             , SUM(GD_LCCNT2) + SUM(GD_LCCNT3) AS GD_SERCNT
                             , SUM(EL_LCCNT2) + SUM(EL_LCCNT3) AS ELECNT
                             , SUM(LCCNT2) + SUM(LCCNT3) AS SERCNT
                             , SUM(LCRAT1) AS SERRYL
                          FROM ( SELECT PRTNR_NO
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999901' THEN PERF_VAL END AS LCCNT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999902' THEN PERF_VAL END AS LCCNT2
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999903' THEN PERF_VAL END AS LCCNT3
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01999909' THEN PERF_VAL END AS LCRAT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'HM01909001' THEN PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'HM01139902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01159902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01129902' ) THEN PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'HM01139903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01159903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01129903' ) THEN PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'HM01199902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01029902' ) THEN PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'HM01199903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'HM01029903' ) THEN PERF_VAL END AS EL_LCCNT3
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                  WHERE BASE_YM = #{perfYm}
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND CL_DV_CD = '02'
                                    AND OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                             , SUM(M.AKSD51) AS AKSD51
                             , SUM(M.AKSD52) AS AKSD52
                             , SUM(M.AKSD53) AS AKSD53
                             , SUM(M.AKSD54) AS AKSD54
                             , SUM(M.AKSD55) AS AKSD55
                             , SUM(M.AKSD56) AS AKSD56
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                      , CASE WHEN A.FEE_CD = 'W030071' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD51
                                      , CASE WHEN A.FEE_CD = 'W030072' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD52
                                      , CASE WHEN A.FEE_CD = 'W030073' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD53
                                      , CASE WHEN A.FEE_CD = 'W030075' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD54
                                      , CASE WHEN A.FEE_CD = 'W030074' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD55
                                      , CASE WHEN A.FEE_CD = 'W030076' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD56
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = #{perfYm}
                                    AND A.OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND FEE_ATC_DV_CD = '01'
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030051', 'W030002', 'W030003', 'W030052', 'W030053'
                                                    , 'W030004', 'W030054', 'W030005', 'W030055', 'W030006', 'W030056'
                                                    , 'W030007', 'W030057', 'W030008', 'W030009', 'W030058', 'W030059'
                                                    , 'W030010', 'W030060', 'W030011', 'W030061', 'W030012', 'W030062'
                                                    , 'W030014', 'W030064', 'W030015', 'W030065', 'W030071', 'W030072'
                                                    , 'W030073', 'W030075', 'W030074', 'W030076' )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = #{perfYm}
                           AND A.OG_TP_CD = 'W03'
                           AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                           AND A.PRTNR_NO = #{prtnrNo}
                       </if>
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN ( SELECT AK05.PRTNR_NO /* 지점장 사번 */
                             , COUNT(CASE WHEN AK17.AKDEQ0 > 0 AND BS.SERCNT >= 50 THEN 1 END) GADCNT   /* 실가동 인원 */
                             , SUM(NVL(AK17.AKDEQ0,0)) J_AKDEQ0 /* 지점 실적 */
                             , SUM(NVL(BS.SERCNT,0)) J_SERCNT   /* 지점 서비스 횟수 */
                          FROM ( SELECT B.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                   FROM TB_OGBS_MM_PRTNR_IZ A
                                  INNER JOIN TB_OGBS_MM_OG_IZ B
                                     ON A.BASE_YM = B.BASE_YM
                                    AND A.OG_ID = B.OG_ID
                                  WHERE A.BASE_YM = #{perfYm}
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.OG_TP_CD = 'W03'
                                    AND A.PSTN_DV_CD = 15
                                  GROUP BY B.DGR3_LEVL_DG_PRTNR_NO
                               )AK05
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS AKDEQ0
                                              FROM TB_FEAM_NTORP_PERF_MM_CL   /*순주문 파트너 실적 월마감*/
                                             WHERE FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                               AND BASE_YM = #{perfYm}
                                               AND PERF_DV_CD = 2   /*개인판매*/
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                                               AND PERF_ATC_CD = 'W03P00002' /* 판매인정건수 */
                                             GROUP BY PRTNR_NO
                                          ) AK17
                            ON AK05.PRTNR_NO = AK17.PRTNR_NO
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS SERCNT
                                              FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                             WHERE BASE_YM = #{perfYm}
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND CL_DV_CD = '02'
                                               AND OG_TP_CD = 'W03'
                                             GROUP BY PRTNR_NO
                                          )BS
                            ON AK05.PRTNR_NO = BS.PRTNR_NO
                         GROUP BY AK05.PRTNR_NO
                      )G
        ON A.PRTNR_NO = G.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ H
        ON A.BASE_YM = H.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = H.PRTNR_NO
       AND A.OG_TP_CD = H.OG_TP_CD
       AND H.EDUC_CRSE_NO IN ('124','125')
       AND H.EDUC_CPC_ACKMT_YN = 'Y'
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'

   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
       AND A.PRTNR_NO = #{prtnrNo}
   </if>
       AND A.RSB_DV_CD = 'W0301'
    </select>


    <select id='selectManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerRes">
        SELECT T1.OG_CD AS OG_NM /*소속*/
             , T1.PRTNR_NO /*번호*/
             , T1.PRTNR_KNM /*성명*/
             , T1.RSB_DV_CD /*직책*/
             , SUBSTR(T1.FST_CNTR_DT,1,6) AS BIZ_RGST1_ARTC /*업무등록-최초업무등록월*/
             , NVL(SUBSTR(T1.RCNTR_DT,1,6),'-') AS BIZ_RGST2_ARTC /*업무등록-재등록월*/
             , NVL(SUBSTR(T1.FNL_CLTN_DT,1,6),'-') AS BIZ_RGST3_ARTC /*업무등록-최종해약월*/
             , NVL(SUBSTR(T1.CLTN_DT,1,6),'-') AS BIZ_RGST4_ARTC /*업무등록-업무해약월*/
             , NVL(T3.PERF_VAL,0) AS METG_DC /*미팅일수*/
             , T1.QLF_DV_CD AS QLF1_ATC  /*자격-수수료월*/
             , CASE WHEN T4.PSTN_DV_CD = 7 AND T4.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                    WHEN T5.PSTN_DV_CD = 7 AND T5.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                    WHEN T4.PRTNR_NO IS NOT NULL THEN T4.QLF_DV_CD
                    WHEN T5.PRTNR_NO IS NOT NULL THEN 'M->P'
                    WHEN T4.PRTNR_NO IS NULL AND T5.PRTNR_NO IS NULL THEN '해약'
               END AS QLF2_ATC /*자격-M+1*/
             , NVL(T9.EDU1_ATC,'-') AS EDU1_ATC /*교육-스타트업 */
             , NVL(T9.EDU2_ATC,'-') AS EDU2_ATC /*교육-Pre스타트업 */
             , T10.EDU3_ATC AS EDU3_ATC /*교육-보수 */
             , T10.EDU4_ATC AS EDU4_ATC /*교육-정착1 */
             , T10.EDU5_ATC AS EDU5_ATC /*교육-정착2 */
             , T10.EDU6_ATC AS EDU6_ATC /*교육-정착345 */
             , CASE WHEN T10.EDU7_ATC = 'Y' THEN '1'
                    WHEN T10.EDU8_ATC = 'Y' THEN '2'
                    WHEN T10.EDU9_ATC = 'Y' THEN '3'
                    WHEN T10.EDU10_ATC = 'Y' THEN '4'
                    WHEN T10.EDU11_ATC = 'Y' THEN '5'
                    ELSE ''
                END AS EDU7_ATC /*교육-Pre누적교육 */
             , NVL(T9.EDU8_ATC,'-') AS EDU8_ATC /*교육-수석정착*/
             , CASE WHEN T9.EDU8_ATC != NULL
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(T9.EDU8_ATC,'YYYYMM')) + 1
                         ELSE 0
                     END AS EDU9_ATC /*교육-수석차월*/
             , NVL(SUBSTR(T6.FST_OPNG,1,6),'-') AS MNGR1_ATC /*매니저개시-최초개시월*/
             , NVL(SUBSTR(T6.RE_OPNG,1,6),'-') AS MNGR2_ATC /*매니저개시-재개시월*/
             , NVL(SUBSTR(T7.FST_CV_DT,1,6),'-') AS MNGR3_ATC /*매니저개시-최종해약월*/
             , NVL(SUBSTR(T7.CV_DT,1,6),'-') AS MNGR4_ATC /*매니저개시-업무해약월*/
             , CASE WHEN NVL(T7.CV_DT,'0') != '0'
                         AND MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T7.CV_DT,1,6),'YYYYMM')) &gt;= 0
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T7.CV_DT,1,6),'YYYYMM')) + 1
                    ELSE 0
                     END AS MNGR5_ATC /*매니저개시-개시차월*/
             , NVL(T6.OPNG_CD,'9') AS MNGR6_ATC /*매니저개시-정착지급유형*/
             , '0' AS MNGR7_ATC /*매니저개시-5일배정수 추후 재확인 필요*/
             , NVL(T8.MNGT_CNT,0) AS INDV1_BS_ATC /*개인BS-배정건수*/
             , NVL(T8.VST_CNT,0) AS INDV2_BS_ATC /*개인BS-완료건수*/
             , CASE WHEN NVL(T8.VST_CNT,0) = 0 OR NVL(T8.MNGT_CNT,0) = 0 THEN 0
                    ELSE TRUNC((T8.VST_CNT / (T8.MNGT_CNT - T8.CAN_CNT))*100.00,2)
               END AS INDV3_BS_ATC /*개인BS-처리율*/
             , CASE WHEN NVL(T8.VST_CNT,0) = 0 OR NVL(T8.MNGT_CNT,0) = 0 THEN 0
                    ELSE ( CASE WHEN TRUNC((T8.VST_CNT / (T8.MNGT_CNT - T8.CAN_CNT))*100.00,2) &gt;= 90 THEN 100
                                ELSE 80
                           END
                         )
               END AS INDV4_BS_ATC /*개인BS-지급률*/
             , NVL(T8.W1_CNT,0) AS INDV5_BS_ATC /*개인BS-W1건수*/
             , NVL(T8.W2_CNT,0) AS INDV6_BS_ATC /*개인BS-W2건수*/
             , NVL(T11.INDV1_PERF,0) AS INDV1_PERF /*개인실적-가정인정건수 */
             , NVL(T11.INDV2_PERF,0) AS INDV2_PERF /*개인실적-렌탈기준가 */
             , NVL(T11.INDV3_PERF,0) AS INDV3_PERF /*개인실적-일시불기준가 */
             , NVL(T11.INDV4_PERF,0) AS INDV4_PERF /*개인실적-기변건수 */
             , NVL(T11.INDV5_PERF,0) AS INDV5_PERF /*개인실적-가전외인정실적 */
             , NVL(T11.INDV1_SELL,0) AS INDV1_SELL /*개인기타판매-정액건수*/
             , NVL(T11.INDV2_SELL,0) AS INDV2_SELL /*개인기타판매-라이브팩건수 */
             , NVL(T11.INDV3_SELL,0) AS INDV3_SELL /*개인기타판매-홈케어멤버십건수 */
             , NVL(T14.RENTAL_CAN_CT + T14.LEASE_CAN_CT + T14.MSH_SPR_CT + T14.RENTAL_EXN_CT , 0) AS INDV_ACC1_NINC
             , NVL(T14.RENTAL_NW_CT + T14.LEASE_NW_CT , 0) AS INDV_ACC2_NINC
             , NVL(T14.RENTAL_CAN_CT + T14.LEASE_CAN_CT + T14.MSH_SPR_CT + T14.RENTAL_EXN_CT , 0) - NVL(T14.RENTAL_NW_CT + T14.LEASE_NW_CT , 0) AS INDV_ACC3_NINC
             , NVL(T13.INDV1_FEE,0) AS INDV1_FEE /*개인수수료-가전비례 */
             , NVL(T13.INDV2_FEE,0) AS INDV2_FEE /*개인수수료-가전외비례 */
             , NVL(T13.INDV3_FEE,0) AS INDV3_FEE /*개인수수료-가전판매장려 */
             , NVL(T13.INDV4_FEE,0) AS INDV4_FEE /*개인수수료-미팅 */
             , NVL(T13.INDV5_FEE,0) AS INDV5_FEE /*개인수수료-교육 */
             , NVL(T13.INDV6_FEE,0) AS INDV6_FEE /*개인수수료-정착 */
             , NVL(T13.INDV7_FEE,0) AS INDV7_FEE /*개인수수료-기기변경 */
             , NVL(T13.INDV8_FEE,0) AS INDV8_FEE /*개인수수료-BS관리 */
             , NVL(T13.INDV9_FEE,0) AS INDV9_FEE /*개인수수료-BS장려 */
             , NVL(T13.INDV10_FEE,0) AS INDV10_FEE /*개인수수료-급지 */
             , NVL(T13.INDV11_FEE,0) AS INDV11_FEE /*개인수수료-WM통신 */
             , NVL(T13.INDV12_FEE,0) AS INDV12_FEE /*개인수수료-WM기타 */
             , NVL(T13.INDV13_FEE,0) AS INDV13_FEE /*개인수수료-사전방문 */
             , NVL(T13.INDV14_FEE,0) AS INDV14_FEE /*개인수수료-유니폼 */
             , NVL(T13.INDV15_FEE,0) AS INDV15_FEE /*개인수수료-자재실장 */
             , NVL(T13.INDV16_FEE,0) AS INDV16_FEE /*개인수수료-가전추가장려 */
             , NVL(T13.ETC1_ATC,0) AS ETC1_ATC /*기타-재지급 */
             , NVL(T13.ETC2_ATC,0) AS ETC2_ATC /*기타-멤버십 */
             , NVL(T13.ETC3_ATC,0) AS ETC3_ATC /*기타-기타지원 */
             , NVL(T12.INTBS_SUM,0) AS INTBS_SUM /*과표합계 */
             , NVL(T12.DDTN_SUM,0) AS DDTN_SUM /*총공제액 */
             , NVL(T12.ACL_DSB_AMT,0) AS ACL_DSB_AMT /*실지급액 */
          FROM TB_OGBS_MM_PRTNR_IZ T1
         INNER JOIN TB_OGBS_MM_OG_IZ T2
            ON T1.BASE_YM = T2.BASE_YM
           AND T1.OG_ID = T2.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND T2.DGR1_LEVL_OG_ID = #{ogLevl1Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND T2.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND T2.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
          LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL T3
            ON T1.PRTNR_NO = T3.PRTNR_NO
           AND T1.OG_TP_CD = T3.OG_TP_CD
           AND T1.BASE_YM = T3.BASE_YM
           AND T3.FEE_TCNT_DV_CD = #{feeTcntDvCd}
           AND T3.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
           AND T3.PERF_AGRG_CRT_DV_CD = '201'
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T3.PRTNR_NO = #{prtnrNo}
       </if>
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T4 /*+1 month M조직 여부*/
            ON T1.PRTNR_NO = T4.PRTNR_NO
           AND T1.OG_TP_CD = T4.OG_TP_CD
           AND T4.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T4.PRTNR_NO = #{prtnrNo}
       </if>
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T5  /*+1 month P조직 이동*/
            ON T1.PRTNR_NO = T5.PRTNR_NO
           AND T5.OG_TP_CD = 'W01'
           AND T5.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T5.PRTNR_NO = #{prtnrNo}
       </if>
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(FST_OPNG) AS FST_OPNG
                                 , MAX(RE_OPNG) AS RE_OPNG
                                 , MAX(OPNG_CD) AS OPNG_CD
                              FROM ( SELECT PRTNR_NO
                                          , OPNG_CD
                                          , CASE WHEN OPNG_CD IN ('1','2') THEN BASE_YM END AS FST_OPNG
                                          , CASE WHEN OPNG_CD IN ('3','4') THEN BASE_YM END AS RE_OPNG
                                       FROM TB_FEAM_WELS_MNGER_OPNG_BAS
                                      WHERE BASE_YM  &lt;= #{perfYm}
                                        AND OG_TP_CD = 'W02'
                                        AND TCNT_DV_CD = '02'
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T6
            ON T1.PRTNR_NO = T6.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(CV_DT) AS CV_DT
                                 , MIN(CV_DT) AS FST_CV_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                             WHERE OG_TP_CD = 'W02'
                               AND QLF_DV_CD = '3'  /* 웰스매니저 */
                               AND QLF_APLC_DV_CD = '2'  /* 자격해제 */
                               AND DTA_DL_YN = 'N'
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )T7
            ON T1.PRTNR_NO = T7.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , NVL(MAX(W1_CNT),0) AS W1_CNT
                                 , NVL(MAX(W2_CNT),0) AS W2_CNT
                                 , NVL(MAX(MNGT_CNT),0) AS MNGT_CNT
                                 , NVL(MAX(VST_CNT),0) AS VST_CNT
                                 , NVL(MAX(CAN_CNT),0) AS CAN_CNT
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W1_CNT
                                          , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W2_CNT
                                          , 0 AS MNGT_CNT
                                          , 0 AS VST_CNT
                                          , 0 AS CAN_CNT
                                       FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                      WHERE BASE_YM = #{perfYm}
                                        AND CL_DV_CD = #{feeTcntDvCd}
                                        AND OG_TP_CD = 'W02'
                                        AND PRTNR_SV_PERF_ATC_CD IN ('SV06010101','SV06010102')
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                      UNION ALL
                                     SELECT A.PRTNR_NO
                                          , 0 AS W1_CNT
                                          , 0 AS W2_CNT
                                          , NVL(SUM(A.MNGT_CNT),0) AS MNGT_CNT
                                          , NVL(SUM(A.VST_CNT),0) AS VST_CNT
                                          , NVL(SUM(A.CAN_CNT),0) AS CAN_CNT
                                       FROM ( SELECT PRTNR_NO
                                                   , MNGT_CNT AS MNGT_CNT
                                                   , VST_CNT1 + VST_CNT2 AS VST_CNT
                                                   , CAN_CNT
                                                FROM ( SELECT Z.PRTNR_NO
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                        ELSE 0
                                                              END AS MNGT_CNT
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '02'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS VST_CNT1
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '03'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS VST_CNT2
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '90'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS CAN_CNT
                                                             FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                                            INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                                               ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV2 IN ('99','90')
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV3 IN ('99','90')
                                                            WHERE Z.BASE_YM = '202306'
                                                              AND Z.CL_DV_CD = '02'
                                                              AND Z.OG_TP_CD = 'W02'
                                                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                              AND Z.PRTNR_NO = #{prtnrNo}
                                                         </if>
                                                            GROUP BY Z.PRTNR_NO, X.PRTNR_PERF_DTLP_ATC_CDV2, X.PRTNR_PERF_DTLP_ATC_CDV4
                                                     )
                                            )A
                                      INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                                         ON A.PRTNR_NO = B.PRTNR_NO
                                        AND B.BASE_YM = #{perfYm}
                                        AND B.OG_TP_CD = 'W02'
                                      INNER JOIN TB_OGBS_MM_OG_IZ C
                                         ON B.BASE_YM = C.BASE_YM
                                        AND B.OG_ID = C.OG_ID
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                                        AND C.DGR1_LEVL_OG_ID = #{ogLevl1Id}
                                   </if>
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                                        AND C.DGR2_LEVL_OG_ID = #{ogLevl2Id}
                                   </if>
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                                        AND C.DGR3_LEVL_OG_ID = #{ogLevl3Id}
                                   </if>
                                      GROUP BY A.PRTNR_NO
                                   )
                             GROUP BY PRTNR_NO
                          )T8
            ON T1.PRTNR_NO = T8.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(EDU1_ATC) AS EDU1_ATC
                                 , MAX(EDU2_ATC) AS EDU2_ATC
                                 , MAX(EDU8_ATC) AS EDU8_ATC
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN EDUC_CRSE_NO = '96' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU1_ATC
                                          , CASE WHEN EDUC_CRSE_NO = '143' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU2_ATC
                                          , CASE WHEN EDUC_CRSE_NO = '17' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU8_ATC
                                       FROM TB_PSCA_MCPTN_EDUC_IZ
                                      WHERE OG_TP_CD = 'W02'
                                        AND EDUC_CRSE_NO IN ('96','143')
                                        AND EDUC_CRSE_CRT_BASE_YM &lt;= #{perfYm}
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T9
            ON T1.PRTNR_NO = T9.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(EDU3_ATC) AS EDU3_ATC
                                 , MAX(EDU4_ATC) AS EDU4_ATC
                                 , MAX(EDU5_ATC) AS EDU5_ATC
                                 , MAX(EDU6_ATC) AS EDU6_ATC
                                 , MAX(EDU7_ATC) AS EDU7_ATC
                                 , MAX(EDU8_ATC) AS EDU8_ATC
                                 , MAX(EDU9_ATC) AS EDU9_ATC
                                 , MAX(EDU10_ATC) AS EDU10_ATC
                                 , MAX(EDU11_ATC) AS EDU11_ATC
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN PERF_ATC_CD = 'W02P00116' THEN FEE_PERF_ATC_VAL END AS EDU3_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00124' THEN FEE_PERF_ATC_VAL END AS EDU4_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00125' THEN FEE_PERF_ATC_VAL END AS EDU5_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00126' THEN FEE_PERF_ATC_VAL END AS EDU6_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00127' THEN FEE_PERF_ATC_VAL END AS EDU7_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00128' THEN FEE_PERF_ATC_VAL END AS EDU8_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00129' THEN FEE_PERF_ATC_VAL END AS EDU9_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00130' THEN FEE_PERF_ATC_VAL END AS EDU10_ATC
                                          , CASE WHEN PERF_ATC_CD = 'W02P00131' THEN FEE_PERF_ATC_VAL END AS EDU11_ATC
                                       FROM TB_FEAM_PRTNR_PERF_MM_CL
                                      WHERE BASE_YM = #{perfYm}
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND PERF_AGRG_CRT_DV_CD = '201'
                                        AND PERF_ATC_CD IN ( 'W02P00116', 'W02P00124', 'W02P00125', 'W02P00126', 'W02P00127'
                                                           , 'W02P00128', 'W02P00129', 'W02P00130', 'W02P00131')
                                        AND CO_CD = '2000'
                                        AND OG_TP_CD = 'W02'
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T10
            ON T1.PRTNR_NO = T10.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , SUM(INDV1_PERF) AS INDV1_PERF
                                 , SUM(INDV2_PERF) AS INDV2_PERF
                                 , SUM(INDV3_PERF) AS INDV3_PERF
                                 , SUM(INDV4_PERF) AS INDV4_PERF
                                 , SUM(INDV5_PERF) AS INDV5_PERF
                                 , SUM(INDV1_SELL) AS INDV1_SELL
                                 , SUM(INDV2_SELL) AS INDV2_SELL
                                 , SUM(INDV3_SELL) AS INDV3_SELL
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS INDV1_PERF
                                          , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS INDV2_PERF
                                          , CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END AS INDV3_PERF
                                          , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS INDV4_PERF
                                          , CASE WHEN PERF_ATC_CD IN ('W02P00027', 'W02P00112') THEN PERF_VAL ELSE 0 END AS INDV5_PERF
                                          , CASE WHEN PERF_ATC_CD IN ('W00P00005', 'W00P00007') THEN 1 ELSE 0 END AS INDV1_SELL
                                          , CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END AS INDV2_SELL
                                          , CASE WHEN PERF_ATC_CD = 'W02P00086' THEN PERF_VAL ELSE 0 END AS INDV3_SELL
                                       FROM TB_FEAM_NTORP_PERF_MM_CL
                                      WHERE BASE_YM = #{perfYm}
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND PERF_AGRG_CRT_DV_CD = '201'
                                        AND PERF_DV_CD = '0'
                                        AND OG_TP_CD = 'W02'
                                        AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00034', 'W00P00014'
                                                           , 'W00P00018', 'W02P00027', 'W02P00112', 'W00P00005', 'W00P00007'
                                                           , 'W02P00105', 'W00P00009', 'W02P00086'
                                                           )
                                        AND PERF_VAL &gt; 0
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T11
            ON T1.PRTNR_NO = T11.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , SUM(INTBS_AMT) AS INTBS_SUM
                                 , SUM(DDCTAM) AS DDTN_SUM
                                 , SUM(DSB_OJ_AMT) AS ACL_DSB_AMT
                              FROM TB_FEAM_FEE_DSB_IZ
                             WHERE DSB_YM = #{perfYm}
                               AND OG_TP_CD = 'W02'
                               AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )T12
            ON T1.PRTNR_NO = T12.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , SUM(INDV1_FEE) AS INDV1_FEE
                                 , SUM(INDV2_FEE) AS INDV2_FEE
                                 , SUM(INDV3_FEE) AS INDV3_FEE
                                 , SUM(INDV4_FEE) AS INDV4_FEE
                                 , SUM(INDV5_FEE) AS INDV5_FEE
                                 , SUM(INDV6_FEE) AS INDV6_FEE
                                 , SUM(INDV7_FEE) AS INDV7_FEE
                                 , SUM(INDV8_FEE) AS INDV8_FEE
                                 , SUM(INDV9_FEE) AS INDV9_FEE
                                 , SUM(INDV10_FEE) AS INDV10_FEE
                                 , SUM(INDV11_FEE) AS INDV11_FEE
                                 , SUM(INDV12_FEE) AS INDV12_FEE
                                 , SUM(INDV13_FEE) AS INDV13_FEE
                                 , SUM(INDV14_FEE) AS INDV14_FEE
                                 , SUM(INDV15_FEE) AS INDV15_FEE
                                 , SUM(INDV16_FEE) AS INDV16_FEE
                                 , SUM(ETC1_ATC) AS ETC1_ATC
                                 , SUM(ETC2_ATC) AS ETC2_ATC
                                 , SUM(ETC3_ATC) AS ETC3_ATC
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN FEE_CD = 'W020001' THEN FEE_ATC_VAL ELSE 0 END AS INDV1_FEE
                                          , CASE WHEN FEE_CD = 'W020003' THEN FEE_ATC_VAL ELSE 0 END AS INDV2_FEE
                                          , CASE WHEN FEE_CD = 'W020115' THEN FEE_ATC_VAL ELSE 0 END AS INDV3_FEE
                                          , CASE WHEN FEE_CD = 'W020117' THEN FEE_ATC_VAL ELSE 0 END AS INDV4_FEE
                                          , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV5_FEE
                                          , CASE WHEN FEE_CD = 'W020081' THEN FEE_ATC_VAL ELSE 0 END AS INDV6_FEE
                                          , CASE WHEN FEE_CD = 'W020005' THEN FEE_ATC_VAL ELSE 0 END AS INDV7_FEE
                                          , CASE WHEN FEE_CD = 'W020084' THEN FEE_ATC_VAL ELSE 0 END AS INDV8_FEE
                                          , CASE WHEN FEE_CD = 'W020122' THEN FEE_ATC_VAL ELSE 0 END AS INDV9_FEE
                                          , CASE WHEN FEE_CD = 'W020085' THEN FEE_ATC_VAL ELSE 0 END AS INDV10_FEE
                                          , CASE WHEN FEE_CD = 'W020027' THEN FEE_ATC_VAL ELSE 0 END AS INDV11_FEE
                                          , CASE WHEN FEE_CD = 'W020096' THEN FEE_ATC_VAL ELSE 0 END AS INDV12_FEE
                                          , CASE WHEN FEE_CD = 'W020086' THEN FEE_ATC_VAL ELSE 0 END AS INDV13_FEE
                                          , CASE WHEN FEE_CD = 'W020098' THEN FEE_ATC_VAL ELSE 0 END AS INDV14_FEE
                                          , CASE WHEN FEE_CD = 'W020014' THEN FEE_ATC_VAL ELSE 0 END AS INDV15_FEE
                                          , CASE WHEN FEE_CD = 'W020124' THEN FEE_ATC_VAL ELSE 0 END AS INDV16_FEE
                                          , CASE WHEN FEE_CD = 'W020090' THEN FEE_ATC_VAL ELSE 0 END AS ETC1_ATC
                                          , CASE WHEN FEE_CD = 'W020006' THEN FEE_ATC_VAL ELSE 0 END AS ETC2_ATC
                                          , CASE WHEN FEE_CD = 'W020094' THEN FEE_ATC_VAL ELSE 0 END AS ETC3_ATC
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = #{perfYm}
                                        AND OG_TP_CD = 'W02'
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND FEE_ATC_DV_CD = '01'
                                        AND FEE_CD IN ( 'W020001', 'W020003', 'W020115', 'W020117', 'W020116'
                                                      , 'W020081', 'W020005', 'W020084', 'W020122', 'W020085'
                                                      , 'W020027', 'W020096', 'W020086', 'W020098', 'W020014'
                                                      , 'W020124', 'W020090', 'W020006', 'W020094', 'W020075'
                                                      , 'W020076', 'W020077'
                                                      )
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T13
            ON T1.PRTNR_NO = T13.PRTNR_NO
          LEFT OUTER JOIN TB_FEAM_WELS_ACC_NINC_MM_CL T14
            ON T1.BASE_YM = T14.PERF_YM
           AND T1.PRTNR_NO = T14.PRTNR_NO
           AND T3.FEE_TCNT_DV_CD = T14.FEE_TCNT_DV_CD
           AND T14.CO_CD = '2000'
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T14.PRTNR_NO = #{prtnrNo}
      </if>
         WHERE T1.BASE_YM = #{perfYm}
           AND T1.PSTN_DV_CD = '15'
           AND T1.OG_TP_CD = 'W02'
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T1.PRTNR_NO = #{prtnrNo}
      </if>
    </select>

    <select id='selectManagerBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerBrmgrRes">
        SELECT T1.OG_CD AS OG_NM /*소속*/
             , T1.PRTNR_NO /*번호*/
             , T1.PRTNR_KNM /*성명*/
             , T1.RSB_DV_CD /*직책*/
             , SUBSTR(T1.FST_CNTR_DT,1,6) AS BIZ_RGST1_ARTC /*업무등록-최초업무등록월*/
             , NVL(SUBSTR(T1.RCNTR_DT,1,6),'-') AS BIZ_RGST2_ARTC /*업무등록-재등록월*/
             , NVL(SUBSTR(T1.FNL_CLTN_DT,1,6),'-') AS BIZ_RGST3_ARTC /*업무등록-최종해약월*/
             , NVL(SUBSTR(T1.CLTN_DT,1,6),'-') AS BIZ_RGST4_ARTC /*업무등록-업무해약월*/
             , NVL(SUBSTR(T3.CV_DT,1,6),'-') AS PRFMT_MM /*승진월*/
             , CASE WHEN NVL(T3.CV_DT,'0') != '0'
                         AND MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T3.CV_DT,1,6),'YYYYMM')) &gt;= 0
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T3.CV_DT,1,6),'YYYYMM')) + 1
                    ELSE 0
               END AS PRFMT_NMN /*승진차월*/
             , NVL(T14.PERF_VAL,0) AS METG_DC /*미팅일수*/
             , T1.QLF_DV_CD AS QLF1_ATC  /*자격-수수료월*/
             , CASE WHEN T4.PSTN_DV_CD = 7 AND T4.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                    WHEN T5.PSTN_DV_CD = 7 AND T5.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                    WHEN T4.PRTNR_NO IS NOT NULL THEN T4.QLF_DV_CD
                    WHEN T5.PRTNR_NO IS NOT NULL THEN 'M->P'
                    WHEN T4.PRTNR_NO IS NULL AND T5.PRTNR_NO IS NULL THEN '해약'
               END AS QLF2_ATC /*자격-M+1*/
             , NVL(T8.EDU1_ATC,'N') AS EDU1_ATC /*교육-지점온라인*/
             , NVL(T6.MNGT_CNT,0) AS INDV1_BS_ATC /*개인BS-배정건수*/
             , NVL(T6.VST_CNT,0) AS INDV2_BS_ATC /*개인BS-완료건수*/
             , CASE WHEN NVL(T6.VST_CNT,0) = 0 OR NVL(T6.MNGT_CNT,0) = 0 THEN 0
                    ELSE TRUNC((T6.VST_CNT / (T6.MNGT_CNT - T6.CAN_CNT))*100.00,2)
               END AS INDV3_BS_ATC /*개인BS-처리율*/
             , CASE WHEN NVL(T6.VST_CNT,0) = 0 OR NVL(T6.MNGT_CNT,0) = 0 THEN 0
                    ELSE ( CASE WHEN TRUNC((T6.VST_CNT / (T6.MNGT_CNT - T6.CAN_CNT))*100.00,2) &gt;= 90 THEN 100
                                ELSE 80
                           END
                         )
               END AS INDV4_BS_ATC /*개인BS-지급률*/
             , NVL(T6.W1_CNT,0) AS INDV5_BS_ATC /*개인BS-W1건수*/
             , NVL(T6.W2_CNT,0) AS INDV6_BS_ATC /*개인BS-W2건수*/
             , NVL(T7.MNGT_CNT,0) AS OG1_BS_ATC /*조직BS-배정건수 */
             , NVL(T7.VST_CNT,0) AS OG2_BS_ATC /*조직BS-완료건수 */
             , CASE WHEN NVL(T7.VST_CNT,0) = 0 OR NVL(T7.MNGT_CNT,0) = 0 THEN 0
                    ELSE TRUNC((T7.VST_CNT / (T7.MNGT_CNT - T7.CAN_CNT))*100.00,2)
               END AS OG3_BS_ATC /*조직BS-처리율 */
             , CASE WHEN NVL(T7.VST_CNT,0) = 0 OR NVL(T7.MNGT_CNT,0) = 0 THEN 0
                    ELSE ( CASE WHEN TRUNC((T7.VST_CNT / (T7.MNGT_CNT - T7.CAN_CNT))*100.00,2) &gt;= 90 THEN 100
                                ELSE 80
                           END
                         )
               END AS OG4_BS_ATC /*조직BS-지급률 */
             , NVL(T9.INDV1_PERF,0) AS INDV1_PERF /*개인실적-가정인정건수 */
             , NVL(T9.INDV2_PERF,0) AS INDV2_PERF /*개인실적-렌탈기준가 */
             , NVL(T9.INDV3_PERF,0) AS INDV3_PERF /*개인실적-일시불기준가 */
             , NVL(T9.INDV4_PERF,0) AS INDV4_PERF /*개인실적-기변건수 */
             , NVL(T9.INDV5_PERF,0) AS INDV5_PERF /*개인실적-가전외인정실적 */
             , NVL(T9.INDV1_SELL,0) AS INDV1_SELL /*개인기타판매-정액건수*/
             , NVL(T9.INDV2_SELL,0) AS INDV2_SELL /*개인기타판매-라이브팩건수 */
             , NVL(T9.INDV3_SELL,0) AS INDV3_SELL /*개인기타판매-홈케어멤버십건수 */
             , NVL(T11.RENTAL_CAN_CT + T11.LEASE_CAN_CT + T11.MSH_SPR_CT + T11.RENTAL_EXN_CT , 0) AS INDV_ACC1_NINC
             , NVL(T11.RENTAL_NW_CT + T11.LEASE_NW_CT , 0) AS INDV_ACC2_NINC
             , NVL(T11.RENTAL_CAN_CT + T11.LEASE_CAN_CT + T11.MSH_SPR_CT + T11.RENTAL_EXN_CT , 0) - NVL(T11.RENTAL_NW_CT + T11.LEASE_NW_CT , 0) AS INDV_ACC3_NINC
             , NVL(T9.OG1_PERF,0) AS OG1_PERF /*조직실적-가정인정건수 */
             , NVL(T9.OG2_PERF,0) AS OG2_PERF /*조직실적-렌탈기준가 */
             , NVL(T9.OG3_PERF,0) AS OG3_PERF /*조직실적-일시불기준가 */
             , NVL(T9.OG4_PERF,0) AS OG4_PERF /*조직실적-기변건수 */
             , NVL(T9.OG2_PERF,0) + NVL(T9.OG3_PERF,0) AS OG_PERF_SUM /*조직실적-계 */
             , NVL(T12.RENTAL_CAN_CT + T12.LEASE_CAN_CT + T12.MSH_SPR_CT + T12.RENTAL_EXN_CT , 0) AS OG_ACC1_NINC /*조직계정순증-전월취소 */
             , NVL(T12.RENTAL_NW_CT + T12.LEASE_NW_CT , 0) AS OG_ACC2_NINC /*조직계정순증-당월신규 */
             , NVL(T12.RENTAL_CAN_CT + T12.LEASE_CAN_CT + T12.MSH_SPR_CT + T12.RENTAL_EXN_CT , 0) - NVL(T12.RENTAL_NW_CT + T12.LEASE_NW_CT , 0) AS OG_ACC3_NINC /*조직계정순증-순증 */
             , NVL(T13.INDV1_FEE,0) AS INDV1_FEE /*개인수수료-가전비례 */
             , NVL(T13.INDV2_FEE,0) AS INDV2_FEE /*개인수수료-가전외비례 */
             , NVL(T13.INDV3_FEE,0) AS INDV3_FEE /*개인수수료-가전판매장려 */
             , NVL(T13.INDV4_FEE,0) AS INDV4_FEE /*개인수수료-미팅 */
             , NVL(T13.INDV5_FEE,0) AS INDV5_FEE /*개인수수료-교육 */
             , NVL(T13.INDV6_FEE,0) AS INDV6_FEE /*개인수수료-정착 */
             , NVL(T13.INDV7_FEE,0) AS INDV7_FEE /*개인수수료-기기변경 */
             , NVL(T13.INDV8_FEE,0) AS INDV8_FEE /*개인수수료-BS관리 */
             , NVL(T13.INDV9_FEE,0) AS INDV9_FEE /*개인수수료-BS장려 */
             , NVL(T13.INDV10_FEE,0) AS INDV10_FEE /*개인수수료-급지 */
             , NVL(T13.INDV11_FEE,0) AS INDV11_FEE /*개인수수료-WM통신 */
             , NVL(T13.INDV12_FEE,0) AS INDV12_FEE /*개인수수료-WM기타 */
             , NVL(T13.INDV13_FEE,0) AS INDV13_FEE /*개인수수료-사전방문 */
             , NVL(T13.INDV14_FEE,0) AS INDV14_FEE /*개인수수료-유니폼 */
             , NVL(T13.INDV15_FEE,0) AS INDV15_FEE /*개인수수료-자재실장 */
             , NVL(T13.INDV16_FEE,0) AS INDV16_FEE /*개인수수료-가전추가장려 */
             , NVL(T13.OG1_FEE,0) AS OG1_FEE /*조직수수료-가전조직비례 */
             , NVL(T13.OG2_FEE,0) AS OG2_FEE /*조직수수료-가전조직외비례 */
             , NVL(T13.OG3_FEE,0) AS OG3_FEE /*조직수수료-가전조직판매장려 */
             , NVL(T13.OG4_FEE,0) AS OG4_FEE /*조직수수료-교육 */
             , NVL(T13.OG5_FEE,0) AS OG5_FEE /*조직수수료-순증관리 */
             , NVL(T13.OG6_FEE,0) AS OG6_FEE /*조직수수료-조직배출1 */
             , NVL(T13.OG7_FEE,0) AS OG7_FEE /*조직수수료-조직배출2 */
             , NVL(T13.OG8_FEE,0) AS OG8_FEE /*조직수수료-신설지점 */
             , NVL(T13.ETC1_ATC,0) AS ETC1_ATC /*기타-재지급 */
             , NVL(T13.ETC2_ATC,0) AS ETC2_ATC /*기타-멤버십 */
             , NVL(T13.ETC3_ATC,0) AS ETC3_ATC /*기타-기타지원 */
             , NVL(T10.INTBS_SUM,0) AS INTBS_SUM /*과표합계 */
             , NVL(T10.DDTN_SUM,0) AS DDTN_SUM /*총공제액 */
             , NVL(T10.ACL_DSB_AMT,0) AS ACL_DSB_AMT /*실지급액 */
         FROM TB_OGBS_MM_PRTNR_IZ T1
        INNER JOIN TB_OGBS_MM_OG_IZ T2
           ON T1.BASE_YM = T2.BASE_YM
          AND T1.OG_ID = T2.OG_ID
     <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
          AND T2.DGR1_LEVL_OG_ID = #{ogLevl1Id}
     </if>
     <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
          AND T2.DGR2_LEVL_OG_ID = #{ogLevl2Id}
     </if>
     <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
          AND T2.DGR3_LEVL_OG_ID = #{ogLevl3Id}
     </if>
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                               , MAX(CV_DT) AS CV_DT
                            FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                           WHERE OG_TP_CD = 'W02'
                             AND QLF_DV_CD IN ('4','5')  /* 플래너, 웰스지점장 */
                             AND QLF_APLC_DV_CD = '1'  /* 승급 */
                             AND DTA_DL_YN = 'N'
                        <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                             AND PRTNR_NO = #{prtnrNo}
                        </if>
                           GROUP BY PRTNR_NO
                        )T3
           ON T1.PRTNR_NO = T3.PRTNR_NO
         LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T4 /*+1 month M조직 여부*/
           ON T1.PRTNR_NO = T4.PRTNR_NO
          AND T1.OG_TP_CD = T4.OG_TP_CD
          AND T4.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
          AND T4.PRTNR_NO = #{prtnrNo}
     </if>
         LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T5  /*+1 month P조직 이동*/
           ON T1.PRTNR_NO = T5.PRTNR_NO
          AND T5.OG_TP_CD = 'W01'
          AND T5.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
          AND T5.PRTNR_NO = #{prtnrNo}
     </if>
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                                , NVL(MAX(W1_CNT),0) AS W1_CNT
                                , NVL(MAX(W2_CNT),0) AS W2_CNT
                                , NVL(MAX(MNGT_CNT),0) AS MNGT_CNT
                                , NVL(MAX(VST_CNT),0) AS VST_CNT
                                , NVL(MAX(CAN_CNT),0) AS CAN_CNT
                             FROM ( SELECT PRTNR_NO
                                         , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W1_CNT
                                         , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W2_CNT
                                         , 0 AS MNGT_CNT
                                         , 0 AS VST_CNT
                                         , 0 AS CAN_CNT
                                      FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                     WHERE BASE_YM = #{perfYm}
                                       AND CL_DV_CD = #{feeTcntDvCd}
                                       AND OG_TP_CD = 'W02'
                                       AND PRTNR_SV_PERF_ATC_CD IN ('SV06010101','SV06010102')
                                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                       AND PRTNR_NO = #{prtnrNo}
                                  </if>
                                     UNION ALL
                                    SELECT A.PRTNR_NO
                                         , 0 AS W1_CNT
                                         , 0 AS W2_CNT
                                         , NVL(SUM(A.MNGT_CNT),0) AS MNGT_CNT
                                         , NVL(SUM(A.VST_CNT),0) AS VST_CNT
                                         , NVL(SUM(A.CAN_CNT),0) AS CAN_CNT
                                      FROM ( SELECT PRTNR_NO
                                                  , MNGT_CNT AS MNGT_CNT
                                                  , VST_CNT1 + VST_CNT2 AS VST_CNT
                                                  , CAN_CNT
                                               FROM ( SELECT Z.PRTNR_NO
                                                           , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                       AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                       THEN SUM(Z.PERF_VAL)
                                                                  ELSE 0
                                                             END AS MNGT_CNT
                                                           , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                       AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '02'
                                                                       THEN SUM(Z.PERF_VAL)
                                                                  ELSE 0
                                                             END AS VST_CNT1
                                                           , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                       AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '03'
                                                                       THEN SUM(Z.PERF_VAL)
                                                                  ELSE 0
                                                             END AS VST_CNT2
                                                           , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '90'
                                                                       AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                       THEN SUM(Z.PERF_VAL)
                                                                  ELSE 0
                                                             END AS CAN_CNT
                                                        FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                                       INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                                          ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                                         AND X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                         AND X.PRTNR_PERF_DTLP_ATC_CDV2 IN ('99','90')
                                                         AND X.PRTNR_PERF_DTLP_ATC_CDV3 IN ('99','90')
                                                       WHERE Z.BASE_YM = '202306'
                                                         AND Z.CL_DV_CD = '02'
                                                         AND Z.OG_TP_CD = 'W02'
                                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                         AND Z.PRTNR_NO = #{prtnrNo}
                                                    </if>
                                                    GROUP BY Z.PRTNR_NO, X.PRTNR_PERF_DTLP_ATC_CDV2, X.PRTNR_PERF_DTLP_ATC_CDV4
                                                    )
                                           )A
                                     INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                                        ON A.PRTNR_NO = B.PRTNR_NO
                                       AND B.BASE_YM = #{perfYm}
                                       AND B.OG_TP_CD = 'W02'
                                     INNER JOIN TB_OGBS_MM_OG_IZ C
                                        ON B.BASE_YM = C.BASE_YM
                                       AND B.OG_ID = C.OG_ID
                                  <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                                       AND C.DGR1_LEVL_OG_ID = #{ogLevl1Id}
                                  </if>
                                  <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                                       AND C.DGR2_LEVL_OG_ID = #{ogLevl2Id}
                                  </if>
                                  <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                                       AND C.DGR3_LEVL_OG_ID = #{ogLevl3Id}
                                  </if>
                                     GROUP BY A.PRTNR_NO
                                  )
                            GROUP BY PRTNR_NO
                         )T6
           ON T1.PRTNR_NO = T6.PRTNR_NO
         LEFT OUTER JOIN ( SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                , NVL(SUM(A.MNGT_CNT),0) AS MNGT_CNT
                                , NVL(SUM(A.VST_CNT),0) AS VST_CNT
                                , NVL(SUM(A.CAN_CNT),0) AS CAN_CNT
                             FROM ( SELECT PRTNR_NO
                                         , MNGT_CNT AS MNGT_CNT
                                         , VST_CNT1 + VST_CNT2 AS VST_CNT
                                         , CAN_CNT
                                      FROM ( SELECT Z.PRTNR_NO
                                                  , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                              THEN SUM(Z.PERF_VAL)
                                                         ELSE 0
                                                    END AS MNGT_CNT
                                                  , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '02'
                                                              THEN SUM(Z.PERF_VAL)
                                                         ELSE 0
                                                    END AS VST_CNT1
                                                  , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '03'
                                                              THEN SUM(Z.PERF_VAL)
                                                         ELSE 0
                                                    END AS VST_CNT2
                                                  , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '90'
                                                              AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                              THEN SUM(Z.PERF_VAL)
                                                         ELSE 0
                                                    END AS CAN_CNT
                                               FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                              INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                                 ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                                AND X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                AND X.PRTNR_PERF_DTLP_ATC_CDV2 IN ('99','90')
                                                AND X.PRTNR_PERF_DTLP_ATC_CDV3 IN ('99','90')
                                              WHERE Z.BASE_YM = '202306'
                                                AND Z.CL_DV_CD = '02'
                                                AND Z.OG_TP_CD = 'W02'
                                              GROUP BY Z.PRTNR_NO, X.PRTNR_PERF_DTLP_ATC_CDV2, X.PRTNR_PERF_DTLP_ATC_CDV4
                                           )
                                  )A
                            INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                               ON A.PRTNR_NO = B.PRTNR_NO
                              AND B.BASE_YM = #{perfYm}
                              AND B.OG_TP_CD = 'W02'
                            INNER JOIN TB_OGBS_MM_OG_IZ C
                               ON B.BASE_YM = C.BASE_YM
                              AND B.OG_ID = C.OG_ID
                              AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                              AND C.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
                         </if>
                            GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
                         )T7
           ON T1.PRTNR_NO = T7.PRTNR_NO
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                                , CASE WHEN PERF_ATC_CD = 'W02P00120' THEN FEE_PERF_ATC_VAL END AS EDU1_ATC
                             FROM TB_FEAM_PRTNR_PERF_MM_CL
                            WHERE BASE_YM = #{perfYm}
                              AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                              AND PERF_AGRG_CRT_DV_CD = '201'
                              AND PERF_ATC_CD = 'W02P00120' /*지점장교육(135)수료여부*/
                              AND CO_CD = '2000'
                              AND OG_TP_CD = 'W02'
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                              AND PRTNR_NO = #{prtnrNo}
                         </if>
                         )T8
           ON T1.PRTNR_NO = T8.PRTNR_NO
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                                , SUM(INDV1_PERF) AS INDV1_PERF
                                , SUM(INDV2_PERF) AS INDV2_PERF
                                , SUM(INDV3_PERF) AS INDV3_PERF
                                , SUM(INDV4_PERF) AS INDV4_PERF
                                , SUM(INDV5_PERF) AS INDV5_PERF
                                , SUM(INDV1_SELL) AS INDV1_SELL
                                , SUM(INDV2_SELL) AS INDV2_SELL
                                , SUM(INDV3_SELL) AS INDV3_SELL
                                , SUM(OG1_PERF) AS OG1_PERF
                                , SUM(OG2_PERF) AS OG2_PERF
                                , SUM(OG3_PERF) AS OG3_PERF
                                , SUM(OG4_PERF) AS OG4_PERF
                             FROM ( SELECT PRTNR_NO
                                         , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS INDV1_PERF
                                         , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS INDV2_PERF
                                         , CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END AS INDV3_PERF
                                         , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS INDV4_PERF
                                         , CASE WHEN PERF_ATC_CD IN ('W02P00027', 'W02P00112') THEN PERF_VAL ELSE 0 END AS INDV5_PERF
                                         , CASE WHEN PERF_ATC_CD IN ('W00P00005', 'W00P00007') THEN 1 ELSE 0 END AS INDV1_SELL
                                         , CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END AS INDV2_SELL
                                         , CASE WHEN PERF_ATC_CD = 'W02P00086' THEN PERF_VAL ELSE 0 END AS INDV3_SELL
                                         , 0 AS OG1_PERF
                                         , 0 AS OG2_PERF
                                         , 0 AS OG3_PERF
                                         , 0 AS OG4_PERF
                                      FROM TB_FEAM_NTORP_PERF_MM_CL
                                     WHERE BASE_YM = #{perfYm}
                                       AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                       AND PERF_AGRG_CRT_DV_CD = '201'
                                       AND PERF_DV_CD = '0'
                                       AND OG_TP_CD = 'W02'
                                       AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00034', 'W00P00014'
                                                          , 'W00P00018', 'W02P00027', 'W02P00112', 'W00P00005', 'W00P00007'
                                                          , 'W02P00105', 'W00P00009', 'W02P00086'
                                                          )
                                       AND PERF_VAL &gt; 0
                                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                       AND PRTNR_NO = #{prtnrNo}
                                  </if>
                                     UNION ALL
                                    SELECT PRTNR_NO
                                         , 0 AS INDV1_PERF
                                         , 0 AS INDV2_PERF
                                         , 0 AS INDV3_PERF
                                         , 0 AS INDV4_PERF
                                         , 0 AS INDV5_PERF
                                         , 0 AS INDV1_SELL
                                         , 0 AS INDV2_SELL
                                         , 0 AS INDV3_SELL
                                         , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS OG1_PERF
                                         , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS OG2_PERF
                                         , CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END AS OG3_PERF
                                         , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS OG4_PERF
                                      FROM TB_FEAM_NTORP_PERF_MM_CL
                                     WHERE BASE_YM = #{perfYm}
                                       AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                       AND PERF_AGRG_CRT_DV_CD = '201'
                                       AND PERF_DV_CD = '2'
                                       AND OG_TP_CD = 'W02'
                                       AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00034', 'W00P00014', 'W00P00018')
                                       AND PERF_VAL &gt; 0
                                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                       AND PRTNR_NO = #{prtnrNo}
                                  </if>
                                  )
                            GROUP BY PRTNR_NO
                         )T9
           ON T1.PRTNR_NO = T9.PRTNR_NO
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                                , SUM(INTBS_AMT) AS INTBS_SUM
                                , SUM(DDCTAM) AS DDTN_SUM
                                , SUM(DSB_OJ_AMT) AS ACL_DSB_AMT
                             FROM TB_FEAM_FEE_DSB_IZ
                            WHERE DSB_YM = #{perfYm}
                              AND OG_TP_CD = 'W02'
                              AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                              AND PRTNR_NO = #{prtnrNo}
                         </if>
                            GROUP BY PRTNR_NO
                         )T10
           ON T1.PRTNR_NO = T10.PRTNR_NO
         LEFT OUTER JOIN TB_FEAM_WELS_ACC_NINC_MM_CL T11
           ON T1.BASE_YM = T11.PERF_YM
          AND T1.PRTNR_NO = T11.PRTNR_NO
          AND T11.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          AND T11.CO_CD = '2000'
     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
          AND T11.PRTNR_NO = #{prtnrNo}
     </if>
         LEFT OUTER JOIN ( SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                , NVL(SUM(A.RENTAL_CAN_CT),0) AS RENTAL_CAN_CT
                                , NVL(SUM(A.LEASE_CAN_CT),0) AS LEASE_CAN_CT
                                , NVL(SUM(A.MSH_SPR_CT),0) AS MSH_SPR_CT
                                , NVL(SUM(A.RENTAL_EXN_CT),0) AS RENTAL_EXN_CT
                                , NVL(SUM(A.RENTAL_NW_CT),0) AS RENTAL_NW_CT
                                , NVL(SUM(A.LEASE_NW_CT),0) AS LEASE_NW_CT
                             FROM ( SELECT PRTNR_NO
                                         , RENTAL_CAN_CT
                                         , LEASE_CAN_CT
                                         , MSH_SPR_CT
                                         , RENTAL_EXN_CT
                                         , RENTAL_NW_CT
                                         , LEASE_NW_CT
                                      FROM TB_FEAM_WELS_ACC_NINC_MM_CL
                                     WHERE PERF_YM = #{perfYm}
                                       AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                       AND CO_CD = '2000'
                                  )A
                            INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                               ON A.PRTNR_NO = B.PRTNR_NO
                              AND B.BASE_YM = #{perfYm}
                              AND B.OG_TP_CD = 'W02'
                            INNER JOIN TB_OGBS_MM_OG_IZ C
                               ON B.BASE_YM = C.BASE_YM
                              AND B.OG_ID = C.OG_ID
                              AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                              AND C.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
                         </if>
                            GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
                         )T12
           ON T1.PRTNR_NO = T12.PRTNR_NO
         LEFT OUTER JOIN ( SELECT PRTNR_NO
                                , SUM(INDV1_FEE) AS INDV1_FEE
                                , SUM(INDV2_FEE) AS INDV2_FEE
                                , SUM(INDV3_FEE) AS INDV3_FEE
                                , SUM(INDV4_FEE) AS INDV4_FEE
                                , SUM(INDV5_FEE) AS INDV5_FEE
                                , SUM(INDV6_FEE) AS INDV6_FEE
                                , SUM(INDV7_FEE) AS INDV7_FEE
                                , SUM(INDV8_FEE) AS INDV8_FEE
                                , SUM(INDV9_FEE) AS INDV9_FEE
                                , SUM(INDV10_FEE) AS INDV10_FEE
                                , SUM(INDV11_FEE) AS INDV11_FEE
                                , SUM(INDV12_FEE) AS INDV12_FEE
                                , SUM(INDV13_FEE) AS INDV13_FEE
                                , SUM(INDV14_FEE) AS INDV14_FEE
                                , SUM(INDV15_FEE) AS INDV15_FEE
                                , SUM(INDV16_FEE) AS INDV16_FEE
                                , SUM(OG1_FEE) AS OG1_FEE
                                , SUM(OG2_FEE) AS OG2_FEE
                                , SUM(OG3_FEE) AS OG3_FEE
                                , SUM(OG4_FEE) AS OG4_FEE
                                , SUM(OG5_FEE) AS OG5_FEE
                                , SUM(OG6_FEE) AS OG6_FEE
                                , SUM(OG7_FEE) AS OG7_FEE
                                , SUM(OG8_FEE) AS OG8_FEE
                                , SUM(ETC1_ATC) AS ETC1_ATC
                                , SUM(ETC2_ATC) AS ETC2_ATC
                                , SUM(ETC3_ATC) AS ETC3_ATC
                             FROM ( SELECT PRTNR_NO
                                         , CASE WHEN FEE_CD = 'W020002' THEN FEE_ATC_VAL ELSE 0 END AS INDV1_FEE
                                         , CASE WHEN FEE_CD = 'W020004' THEN FEE_ATC_VAL ELSE 0 END AS INDV2_FEE
                                         , CASE WHEN FEE_CD = 'W020011' THEN FEE_ATC_VAL ELSE 0 END AS INDV3_FEE
                                         , 0 AS INDV4_FEE
                                         , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV5_FEE
                                         , 0 AS INDV6_FEE
                                         , CASE WHEN FEE_CD = 'W020030' THEN FEE_ATC_VAL ELSE 0 END AS INDV7_FEE
                                         , CASE WHEN FEE_CD = 'W020087' THEN FEE_ATC_VAL ELSE 0 END AS INDV8_FEE
                                         , CASE WHEN FEE_CD = 'W020123' THEN FEE_ATC_VAL ELSE 0 END AS INDV9_FEE
                                         , CASE WHEN FEE_CD = 'W020088' THEN FEE_ATC_VAL ELSE 0 END AS INDV10_FEE
                                         , CASE WHEN FEE_CD = 'W020089' THEN FEE_ATC_VAL ELSE 0 END AS INDV11_FEE
                                         , CASE WHEN FEE_CD = 'W020097' THEN FEE_ATC_VAL ELSE 0 END AS INDV12_FEE
                                         , 0 AS INDV13_FEE
                                         , CASE WHEN FEE_CD = 'W020099' THEN FEE_ATC_VAL ELSE 0 END AS INDV14_FEE
                                         , CASE WHEN FEE_CD = 'W020041' THEN FEE_ATC_VAL ELSE 0 END AS INDV15_FEE
                                         , 0 AS INDV16_FEE
                                         , CASE WHEN FEE_CD = 'W020091' THEN FEE_ATC_VAL ELSE 0 END AS ETC1_ATC
                                         , CASE WHEN FEE_CD = 'W020033' THEN FEE_ATC_VAL ELSE 0 END AS ETC2_ATC
                                         , CASE WHEN FEE_CD = 'W020095' THEN FEE_ATC_VAL ELSE 0 END AS ETC3_ATC
                                         , CASE WHEN FEE_CD = 'W020020' THEN FEE_ATC_VAL ELSE 0 END AS OG1_FEE
                                         , CASE WHEN FEE_CD = 'W020023' THEN FEE_ATC_VAL ELSE 0 END AS OG2_FEE
                                         , CASE WHEN FEE_CD = 'W020017' THEN FEE_ATC_VAL ELSE 0 END AS OG3_FEE
                                         , CASE WHEN FEE_CD = 'W020118' THEN FEE_ATC_VAL ELSE 0 END AS OG4_FEE /*교육*/
                                         , CASE WHEN FEE_CD = 'W020121' THEN FEE_ATC_VAL ELSE 0 END AS OG5_FEE /*순증관리*/
                                         , CASE WHEN FEE_CD = 'W020015' THEN FEE_ATC_VAL ELSE 0 END AS OG6_FEE /*조직배출1*/
                                         , CASE WHEN FEE_CD = 'W020016' THEN FEE_ATC_VAL ELSE 0 END AS OG7_FEE /*조직배출2*/
                                         , CASE WHEN FEE_CD = 'W020025' THEN FEE_ATC_VAL ELSE 0 END AS OG8_FEE /*신설지점*/
                                      FROM TB_FEAM_FEE_DSB_DTL_IZ
                                     WHERE DSB_YM = #{perfYm}
                                       AND OG_TP_CD = 'W02'
                                       AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                       AND FEE_ATC_DV_CD = '01'
                                       AND FEE_CD IN ( 'W020002', 'W020004', 'W020011', 'W020118', 'W020030'
                                                     , 'W020087', 'W020123', 'W020088', 'W020089', 'W020097'
                                                     , 'W020099', 'W020041', 'W020091', 'W020033', 'W020095'
                                                     , 'W020020', 'W020023', 'W020017', 'W020121', 'W020015'
                                                     , 'W020016', 'W020025', 'W020075', 'W020076', 'W020077'
                                                     , 'W020116'
                                                     )
                                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                       AND PRTNR_NO = #{prtnrNo}
                                  </if>
                                  )
                            GROUP BY PRTNR_NO
                         )T13
           ON T1.PRTNR_NO = T13.PRTNR_NO
         LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL T14
           ON T1.PRTNR_NO = T14.PRTNR_NO
          AND T1.OG_TP_CD = T14.OG_TP_CD
          AND T1.BASE_YM = T14.BASE_YM
          AND T14.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          AND T14.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
          AND T14.PERF_AGRG_CRT_DV_CD = '201'
        <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
            AND T14.PRTNR_NO = #{prtnrNo}
        </if>
        WHERE T1.BASE_YM = #{perfYm}
          AND T1.PSTN_DV_CD = '7'
          AND T1.OG_TP_CD = 'W02'
     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
          AND T1.PRTNR_NO = #{prtnrNo}
     </if>
    </select>

    <select id='selectManagerBeforeFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerBfRes">
        SELECT T.OG_CD       /*소속*/
             , T.PRTNR_NO    /*번호*/
             , T.PRTNR_KNM   /*성명*/
             , T.RSB_DV_CD   /*직책*/
             , T.AKCUIL      /*미팅일수*/
             , T.AKDMI3 	 /*  자격 수수료월    */
             , T.AKDMI32     /*  자격M+1    */
             , CASE WHEN SUBSTR(T.OG_CD,1,1) != 'P' THEN CASE WHEN T.EDU096 != '' AND T.EDU097 != '' THEN T.EDU097 ELSE '' END
                    WHEN SUBSTR(T.OG_CD,1,1) = 'P'  THEN CASE WHEN T.EDU112 != '' AND T.EDU113 != '' THEN T.EDU113 ELSE '' END
                    ELSE ''
               END EDUSTR    /* 스타트업 매니저 */
             , T.EDU011      /* 스타트업 플래너 */
             , T.EDU129      /*보수교육*/
             , T.EDU106      /*수석플래너교육정착*/
             , T.AKDCHA		 /*수석플래너 교육 차월*/
             , T.EDU017      /*수석플래너교육실전*/
             , T.OJTCNT      /*OJT일수 */
             , T.AKDSYM		 /*등록기준월*/
             , T.AKDENM		 /*최초업무등록월*/
             , T.AKDJEM		 /*재등록월*/
             , T.AKDLYM		 /*최종해약월*/
             , T.AKDCYM		 /*업무해약월*/
             , T.AKDRYM		 /*승진월*/
             , T.SUSTYM		 /*수석플래너 등록월*/
             , T.SUSCYM		 /*수석플래너 해약월*/
             , T.LCCOYM		 /*WM개시*/
             , T.LCCCYM		 /*WM해약*/
             , T.DALSYN      /*실활동달성*/
             , T.AKCDA17	 /*인정실적 렌탈*/
             , T.AKCDA18	 /*인정실적 일시불*/
             , T.AKCDA1		 /*인정실적 환경가전외*/
             , T.AKCDQ1		 /*가전순주문건수*/
             , T.AKCDQ0		 /*개인가전인정건수*/
             , T.AKCDQ7		 /*개인BS인정건수*/
             , T.AKDET3		 /*가전기변건수*/
             , T.JASAMT		 /*가전기변금액*/
             , T.AKCDA12     /*환경가전 렌탈*/
             , T.AKCDA13	 /*환경가전 일시불*/
             , T.AKCDA14	 /*환경가전 정액*/
             , T.AKCDA15	 /*환경가전외 일시불*/
             , T.AKCDA16	 /*환경가전외 정액*/
             , T.AKCDQ5		 /*라이브팩건수*/
             , T.AKCDQ6		 /*개인신규판매건수*/
             , T.AKCDA19     /*홈케어판매가*/
             , T.JAKCDQ0	 /*조직가전인정건수*/
             , T.JAKCDQ6	 /*조직신규판매건수*/
             , T.JAKCDA12	 /*조직 환경가전렌탈*/
             , T.JAKCDA13	 /*조직 환경가전 일시불*/
             , T.JAKCDA15	 /*조직 환경가전외 일시불*/
             , T.AKSD49      /*홈케어*/
             , T.AKSD43      /*라이브팩*/
             , T.AKSD26      /*가전비례*/
             , T.AKSD29      /*가전외비례*/
             , T.SD26M1      /*가전미팅*/
             , T.SD26M2      /*일시불미팅*/
             , T.SD26MT      /*가전외미팅*/
             , T.AKSD17      /*판매장려*/
             , T.AKSD50      /*교육*/
             , T.AKSD48      /*정착*/
             , T.AKSD04      /*기기변경*/
             , T.AKSD15      /*BS관리*/
             , T.AKSD23      /*급지*/
             , T.AKSD42      /*판매장려소급*/
             , T.AKSD31      /*가전조직비례*/
             , T.AKSD34      /*가전조직외비례*/
             , T.AKSD11      /*조직판매장려*/
             , T.AKSD08      /*신규판매*/
             , T.AKSD22      /*조직관리*/
             , T.AKSD13      /*조직배출1*/
             , T.AKSD09      /*조직배출2*/
             , T.AKSD36      /*신설지점*/
             , T.AKSD05      /*멤버십*/
             , T.AKSD14      /*재지급*/
             , T.AKSD39      /*기타지원*/
             , T.AKSD18      /*WM통신*/
             , T.AKSD19      /*WM기타*/
             , T.AKSD40      /*사전방문*/
             , T.AKSD16      /*유니폼*/
             , T.AKSD10      /*자재실장*/
             , T.LCCNTT      /*BS완료계정*/
             , T.INTBS_SUM   /*과표합계*/
             , T.DDTN_SUM    /*총공제액*/
             , T.ACL_DSB_AMT /*실지급액*/
          FROM ( SELECT A.OG_CD
                      , A.PRTNR_NO
                      , A.PRTNR_KNM
                      , A.RSB_DV_CD
                      , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                             ELSE 0
                        END AS AKCUIL
                      , '플래너' AS AKDMI3
                      , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                             WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                             WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                             WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                             WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                        END AS AKDMI32
                      , CASE WHEN G.EDUC_CRSE_NO = '11' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU011
                      , CASE WHEN G.EDUC_CRSE_NO = '17' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU017
                      , CASE WHEN G.EDUC_CRSE_NO = '96' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU096
                      , CASE WHEN G.EDUC_CRSE_NO = '97' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU097
                      , CASE WHEN G.EDUC_CRSE_NO = '112' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU112
                      , CASE WHEN G.EDUC_CRSE_NO = '113' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU113
                      , CASE WHEN G.EDUC_CRSE_NO = '129' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU129
                      , CASE WHEN G.EDUC_CRSE_NO = '98' THEN 1 END AS OJTCNT
                      , NVL(H.EDUC_CRSE_CRT_BASE_YM,'') AS EDU106
                      , CASE WHEN NVL(H.EDUC_CRSE_CRT_BASE_YM,'0') != '0'
                                  THEN TO_CHAR(ADD_MONTHS(TO_DATE(H.EDUC_CRSE_CRT_BASE_YM, 'YYYYMM'), 1),'YYYYMM' )
                        END AS AKDCHA		/*수석플래너 교육 차월*/
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                      , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                      , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                      , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                      , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                      , NVL(J.SUSTYM,'-') AS SUSTYM		/*수석플래너 등록월*/
                      , NVL(J.SUSCYM,'-') AS SUSCYM		/*수석플래너 해약월*/
                      , NVL(J.LCCOYM,'-') AS LCCOYM		/*WM개시*/
                      , NVL(J.LCCCYM,'-') AS LCCCYM		/*WM해약*/
                      , NVL(I.ACTI_YN,'N') AS DALSYN
                      , NVL(D.AKCDA17,0) AS AKCDA17
                      , NVL(D.AKCDA18,0) AS AKCDA18
                      , NVL(D.AKCDA1,0) AS AKCDA1
                      , NVL(D.AKCDQ1,0) AS AKCDQ1
                      , NVL(D.AKCDQ0,0) AS AKCDQ0
                      , NVL(D.AKCDQ7,0) AS AKCDQ7
                      , NVL(D.AKDET3,0) AS AKDET3
                      , NVL(D.JASAMT,0) AS JASAMT
                      , NVL(D.AKCDA12,0) AS AKCDA12
                      , NVL(D.AKCDA13,0) AS AKCDA13
                      , NVL(D.AKCDA14,0) AS AKCDA14
                      , NVL(D.AKCDA15,0) AS AKCDA15
                      , NVL(D.AKCDA16,0) AS AKCDA16
                      , NVL(D.AKCDQ5,0) AS AKCDQ5
                      , NVL(D.AKCDQ6,0) AS AKCDQ6
                      , NVL(D.AKCDA19,0) AS AKCDA19
                      , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                      , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                      , NVL(E.JAKCDA12,0) AS JAKCDA12
                      , NVL(E.JAKCDA13,0) AS JAKCDA13
                      , NVL(E.JAKCDA15,0) AS JAKCDA15
                      , NVL(F.AKSD49,0) AS AKSD49
                      , NVL(F.AKSD43,0) AS AKSD43
                      , NVL(F.AKSD26,0) AS AKSD26
                      , NVL(F.AKSD29,0) AS AKSD29
                      , CASE WHEN NVL(F.AKSD26,0) = 0 THEN 0 ELSE D.AKCDA12 END AS SD26M1
                      , CASE WHEN NVL(F.AKSD26,0) = 0 THEN 0 ELSE D.AKCDA13 END AS SD26M2
                      , CASE WHEN NVL(F.AKSD26,0) = 0 THEN 0 ELSE D.AKCDA15 END AS SD26MT
                      , NVL(F.AKSD17,0) AS AKSD17
                      , NVL(F.AKSD50,0) AS AKSD50
                      , NVL(F.AKSD48,0) AS AKSD48
                      , NVL(F.AKSD04,0) AS AKSD04
                      , NVL(F.AKSD15,0) AS AKSD15
                      , NVL(F.AKSD23,0) AS AKSD23
                      , NVL(F.AKSD42,0) AS AKSD42
                      , NVL(F.AKSD31,0) AS AKSD31
                      , NVL(F.AKSD34,0) AS AKSD34
                      , NVL(F.AKSD11,0) AS AKSD11
                      , NVL(F.AKSD08,0) AS AKSD08
                      , NVL(F.AKSD22,0) AS AKSD22
                      , NVL(F.AKSD13,0) AS AKSD13
                      , NVL(F.AKSD09,0) AS AKSD09
                      , NVL(F.AKSD36,0) AS AKSD36
                      , NVL(F.AKSD05,0) AS AKSD05
                      , NVL(F.AKSD14,0) AS AKSD14
                      , NVL(F.AKSD39,0) AS AKSD39
                      , NVL(F.AKSD18,0) AS AKSD18
                      , NVL(F.AKSD19,0) AS AKSD19
                      , NVL(F.AKSD40,0) AS AKSD40
                      , NVL(F.AKSD16,0) AS AKSD16
                      , NVL(F.AKSD10,0) AS AKSD10
                      , NVL(D.LCCNTT,0) AS LCCNTT
                      , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                      , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                      , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                   FROM TB_OGBS_MM_PRTNR_IZ A
                  INNER JOIN TB_OGBS_MM_OG_IZ O
                     ON A.BASE_YM = O.BASE_YM
                    AND A.OG_ID = O.OG_ID
                <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                    AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
                </if>
                <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                    AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
                </if>
                <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                    AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
                </if>
                   LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                     ON A.PRTNR_NO = B.PRTNR_NO
                    AND A.OG_TP_CD = B.OG_TP_CD
                    AND B.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
                   LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                     ON A.PRTNR_NO = C.PRTNR_NO
                    AND C.OG_TP_CD = 'W01'
                    AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
                   LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                     ON A.PRTNR_NO = PM.PRTNR_NO
                    AND A.OG_TP_CD = PM.OG_TP_CD
                    AND A.BASE_YM = PM.BASE_YM
                    AND PM.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                    AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                    AND PM.PERF_AGRG_CRT_DV_CD = '203'  /*P추진단순주문실적생성*/
                   LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                          , M.OG_TP_CD
                                          , SUM(AKCDA17) AS AKCDA17
                                          , SUM(AKCDA18) AS AKCDA18
                                          , SUM(AKCDA1) AS AKCDA1
                                          , SUM(AKCDQ1) AS AKCDQ1
                                          , SUM(AKCDQ0) AS AKCDQ0
                                          , SUM(AKCDQ7) AS AKCDQ7
                                          , SUM(AKDET3) AS AKDET3
                                          , SUM(JASAMT) AS JASAMT
                                          , SUM(AKCDA12) AS AKCDA12
                                          , SUM(AKCDA13) AS AKCDA13
                                          , SUM(AKCDA14) AS AKCDA14
                                          , SUM(AKCDA15) AS AKCDA15
                                          , SUM(AKCDA16) AS AKCDA16
                                          , SUM(AKCDQ5) AS AKCDQ5
                                          , SUM(AKCDQ6) AS AKCDQ6
                                          , SUM(AKCDA19) AS AKCDA19
                                          , SUM(LCCNTT) AS LCCNTT
                                       FROM ( SELECT AK17.PRTNR_NO
                                                   , AK17.OG_TP_CD
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                                FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                               WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                                 AND AK17.BASE_YM = #{perfYm}
                                                 AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                             <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                 AND AK17.PRTNR_NO = #{prtnrNo}
                                             </if>
                                                 AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                            )M
                                      GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                    )D
                     ON A.PRTNR_NO = D.PRTNR_NO
                    AND A.OG_TP_CD = D.OG_TP_CD
                   LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                          , M.OG_TP_CD
                                          , SUM(JAKCDQ0) AS JAKCDQ0
                                          , SUM(JAKCDQ6) AS JAKCDQ6
                                          , SUM(JAKCDA12) AS JAKCDA12
                                          , SUM(JAKCDA13) AS JAKCDA13
                                          , SUM(JAKCDA15) AS JAKCDA15
                                       FROM ( SELECT AK17.PRTNR_NO
                                                   , AK17.OG_TP_CD
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12/*조직 환경가전 렌탈*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13/*조직 환경가전 일시불*/
                                                   , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15/*조직 환경가전외 일시불*/
                                                FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                               WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                                 AND AK17.BASE_YM = #{perfYm}
                                                 AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                             <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                 AND AK17.PRTNR_NO = #{prtnrNo}
                                             </if>
                                                 AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                            )M
                                      GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                   )E
                     ON A.PRTNR_NO = E.PRTNR_NO
                    AND A.OG_TP_CD = E.OG_TP_CD
                   LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                          , M.OG_TP_CD
                                          , SUM(M.AKSD49) AS AKSD49
                                          , SUM(M.AKSD43) AS AKSD43
                                          , SUM(M.AKSD26) AS AKSD26
                                          , SUM(M.AKSD29) AS AKSD29
                                          , SUM(M.AKSD17) AS AKSD17
                                          , SUM(M.AKSD50) AS AKSD50
                                          , SUM(M.AKSD48) AS AKSD48
                                          , SUM(M.AKSD04) AS AKSD04
                                          , SUM(M.AKSD15) AS AKSD15
                                          , SUM(M.AKSD23) AS AKSD23
                                          , SUM(M.AKSD42) AS AKSD42
                                          , SUM(M.AKSD31) AS AKSD31
                                          , SUM(M.AKSD34) AS AKSD34
                                          , SUM(M.AKSD11) AS AKSD11
                                          , SUM(M.AKSD08) AS AKSD08
                                          , SUM(M.AKSD22) AS AKSD22
                                          , SUM(M.AKSD13) AS AKSD13
                                          , SUM(M.AKSD09) AS AKSD09
                                          , SUM(M.AKSD36) AS AKSD36
                                          , SUM(M.AKSD05) AS AKSD05
                                          , SUM(M.AKSD14) AS AKSD14
                                          , SUM(M.AKSD39) AS AKSD39
                                          , SUM(M.AKSD18) AS AKSD18
                                          , SUM(M.AKSD19) AS AKSD19
                                          , SUM(M.AKSD40) AS AKSD40
                                          , SUM(M.AKSD16) AS AKSD16
                                          , SUM(M.AKSD10) AS AKSD10
                                       FROM ( SELECT A.PRTNR_NO
                                                   , A.OG_TP_CD
                                                   , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                                   , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                                   , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                                   , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                                   , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                                   , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                                   , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                                   , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                                   , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                                   , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                                   , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                                   , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                                   , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                                   , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                                   , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                                   , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                                   , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                                   , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                                   , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                                   , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                                   , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                                   , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                                   , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                                   , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                                   , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                                   , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                                   , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                                FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                               WHERE A.DSB_YM = #{perfYm}
                                                 AND A.OG_TP_CD = 'W02'       --M조직
                                                 AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                                 AND A.FEE_ATC_DV_CD = '01'
                                             <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                 AND A.PRTNR_NO = #{prtnrNo}
                                             </if>
                                                 AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                                 , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                                 , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                                 , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                                 , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                                 , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                                 , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041'
                                                                 )
                                            )M
                                      GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                   )F
                     ON A.PRTNR_NO = F.PRTNR_NO
                    AND A.OG_TP_CD = F.OG_TP_CD
                   LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                          , E.OG_TP_CD
                                          , SUM(E.INTBS_AMT) AS INTBS_SUM
                                          , SUM(E.DDCTAM) AS DDTN_SUM
                                          , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                       FROM TB_FEAM_FEE_DSB_IZ E
                                      WHERE E.DSB_YM = #{perfYm}
                                        AND E.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND E.PRTNR_NO = #{prtnrNo}
                                    </if>
                                      GROUP BY E.PRTNR_NO, E.OG_TP_CD
                                   )FEE
                     ON A.PRTNR_NO = FEE.PRTNR_NO
                    AND A.OG_TP_CD = FEE.OG_TP_CD
                   LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
                     ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                    AND A.PRTNR_NO = G.PRTNR_NO
                    AND A.OG_TP_CD = G.OG_TP_CD
                    AND G.EDUC_CRSE_NO IN ('11','17','96','97','112','113','129','98')
                    AND G.EDUC_CPC_ACKMT_YN = 'Y'
                   LEFT OUTER JOIN ( SELECT PRTNR_NO
                                          , MAX(EDUC_CRSE_CRT_BASE_YM) AS EDUC_CRSE_CRT_BASE_YM
                                       FROM TB_PSCA_MCPTN_EDUC_IZ E
                                      WHERE EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                                        AND OG_TP_CD = 'W02'
                                        AND EDUC_CRSE_NO IN ('100','106')
                                        AND EDUC_CPC_ACKMT_YN = 'Y'
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND H.PRTNR_NO = #{prtnrNo}
                                   </if>
                                      GROUP BY PRTNR_NO
                                   )H
                     ON A.PRTNR_NO = H.PRTNR_NO
                   LEFT OUTER JOIN TB_FEAM_WELS_PAST_ACTI_IZ I
                     ON A.BASE_YM = I.PERF_YM
                    AND A.OG_TP_CD = I.OG_TP_CD
                    AND A.PRTNR_NO = I.PRTNR_NO
                    AND I.ACTI_YN = 'Y'
                   LEFT OUTER JOIN ( SELECT PRTNR_NO
                                          , MAX(SUSTYM) AS SUSTYM
                                          , MAX(SUSCYM) AS SUSCYM
                                          , MAX(LCCOYM) AS LCCOYM
                                          , MAX(LCCCYM) AS LCCCYM
                                       FROM ( SELECT PRTNR_NO
                                                   , CASE WHEN QLF_DV_CD = '1' AND QLF_APLC_DV_CD = '1' THEN CV_DT END AS SUSTYM
                                                   , CASE WHEN QLF_DV_CD = '1' AND QLF_APLC_DV_CD = '2' THEN CV_DT END AS SUSCYM
                                                   , CASE WHEN QLF_DV_CD = '3' AND QLF_APLC_DV_CD = '1' THEN CV_DT END AS LCCOYM
                                                   , CASE WHEN QLF_DV_CD = '3' AND QLF_APLC_DV_CD = '2' THEN CV_DT END AS LCCCYM
                                                FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                                               WHERE OG_TP_CD = 'W02'
                                                 AND QLF_DV_CD IN ('1','3')  /* 수석플래너, 웰스매니저 */
                                                 AND QLF_APLC_DV_CD IN ('1','2')  /* 승급,강등 */
                                                 AND DTA_DL_YN = 'N'
                                            <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                 AND PRTNR_NO = #{prtnrNo}
                                            </if>
                                            )
                                      GROUP BY PRTNR_NO
                        )J
                     ON A.PRTNR_NO = J.PRTNR_NO
                  WHERE A.BASE_YM = #{perfYm}
                    AND A.OG_TP_CD = 'W02'
                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                    AND A.PRTNR_NO = #{prtnrNo}
                </if>
                    AND A.PSTN_DV_CD = 7
               )T
    </select>

    <select id='selectManagerBranchManagerBeforeFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerBrmgrBfRes">
        SELECT T.OG_CD AS OG_NM /*소속*/
             , T.PRTNR_NO  /*번호*/
             , T.PRTNR_KNM  /*성명*/
             , T.RSB_DV_CD  /*직책*/
             , T.AKCUIL     /*미팅일수*/
             , T.AKDMI3 		/*  자격 수수료월    */
             , T.AKDMI32      /*  자격M+1    */
             , T.EDU106
             , T.AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
             , T.EDU135
             , T.AKDSYM		/*등록기준월*/
             , T.AKDENM		/*최초업무등록월*/
             , T.AKDJEM		/*재등록월*/
             , T.AKDLYM		/*최종해약월*/
             , T.AKDCYM		/*업무해약월*/
             , T.AKDRYM		/*승진월*/
             , T.SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
             , T.SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
             , T.LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
             , T.LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
             , T.BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
             , T.SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
             , T.WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
             , T.WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
             , T.SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
             , T.DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
             , T.AKCDA17	  /*인정실적 렌탈*/
             , T.AKCDA18		/*인정실적 일시불*/
             , T.AKCDA1		/*인정실적 환경가전외*/
             , T.AKCDQ1		/*가전순주문건수*/
             , T.AKCDQ0		/*개인가전인정건수*/
             , T.AKCDQ7		/*개인BS인정건수*/
             , T.AKDET3		/*가전기변건수*/
             , T.JASAMT		/*가전기변금액*/
             , T.AKCDA12		/*환경가전 렌탈*/
             , T.AKCDA13		/*환경가전 일시불*/
             , T.AKCDA14		/*환경가전 정액*/
             , T.AKCDA15		/*환경가전외 일시불*/
             , T.AKCDA16		/*환경가전외 정액*/
             , T.AKCDQ5		/*라이브팩건수*/
             , T.AKCDQ6		/*개인신규판매건수*/
             , T.AKCDA19		/*홈케어판매가*/
             , T.JAKCDQ0		/*조직가전인정건수*/
             , T.JAKCDQ6		/*조직신규판매건수*/
             , T.JAKCDA12	/*조직 환경가전렌탈*/
             , T.JAKCDA13	/*조직 환경가전 일시불*/
             , T.JAKCDA15	/*조직 환경가전외 일시불*/
             , T.AKSD49   /*홈케어*/
             , T.AKSD43   /*라이브팩*/
             , T.AKSD26   /*가전비례*/
             , T.AKSD29   /*가전외비례*/
             , T.AKSD17  /*판매장려*/
             , T.AKSD50  /*교육*/
             , T.AKSD48  /*정착*/
             , T.AKSD04  /*기기변경*/
             , T.AKSD15  /*BS관리*/
             , T.AKSD23  /*급지*/
             , T.AKSD42  /*판매장려소급*/
             , T.AKSD31  /*가전조직비례*/
             , T.AKSD34  /*가전조직외비례*/
             , T.AKSD11  /*조직판매장려*/
             , T.AKSD08  /*신규판매*/
             , T.AKSD22  /*조직관리*/
             , T.AKSD06  /*추가장려*/
             , T.AKSD13  /*조직배출1*/
             , T.AKSD09  /*조직배출2*/
             , T.AKSD36  /*신설지점*/
             , T.AKSD05  /*멤버십*/
             , T.AKSD14  /*재지급*/
             , T.AKSD39  /*기타지원*/
             , T.AKSD18  /*WM통신*/
             , T.AKSD19  /*WM기타*/
             , T.AKSD40  /*사전방문*/
             , T.AKSD16  /*유니폼*/
             , T.AKSD10  /*자재실장*/
             , T.LCCNTT  /*BS완료계정*/
             , T.INTBS_SUM       /*과표합계*/
             , T.DDTN_SUM         /*총공제액*/
             , T.ACL_DSB_AMT   /*실지급액*/
          FROM ( SELECT A.OG_CD
                      , A.PRTNR_NO
                      , A.PRTNR_KNM
                      , A.RSB_DV_CD
                      , A.OG_ID
                      , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                             ELSE 0
                        END AS AKCUIL
                      , '지점장' AS AKDMI3
                      , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                             WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                             WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                             WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                             WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                        END AS AKDMI32
                      , CASE WHEN G.EDUC_CRSE_NO IN ('100','106') THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU106
                      , '' AS AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
                      , CASE WHEN G.EDUC_CRSE_NO = '135' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU135
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                      , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                      , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                      , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                      , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
                      , 0 AS BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
                      , 0 AS SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
                      , 0 AS WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
                      , 0 AS WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
                      , 0 AS SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
                      , 0 AS DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
                      , NVL(D.AKCDA17,0) AS AKCDA17
                      , NVL(D.AKCDA18,0) AS AKCDA18
                      , NVL(D.AKCDA1,0) AS AKCDA1
                      , NVL(D.AKCDQ1,0) AS AKCDQ1
                      , NVL(D.AKCDQ0,0) AS AKCDQ0
                      , NVL(D.AKCDQ7,0) AS AKCDQ7
                      , NVL(D.AKDET3,0) AS AKDET3
                      , NVL(D.JASAMT,0) AS JASAMT
                      , NVL(D.AKCDA12,0) AS AKCDA12
                      , NVL(D.AKCDA13,0) AS AKCDA13
                      , NVL(D.AKCDA14,0) AS AKCDA14
                      , NVL(D.AKCDA15,0) AS AKCDA15
                      , NVL(D.AKCDA16,0) AS AKCDA16
                      , NVL(D.AKCDQ5,0) AS AKCDQ5
                      , NVL(D.AKCDQ6,0) AS AKCDQ6
                      , NVL(D.AKCDA19,0) AS AKCDA19
                      , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                      , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                      , NVL(E.JAKCDA12,0) AS JAKCDA12
                      , NVL(E.JAKCDA13,0) AS JAKCDA13
                      , NVL(E.JAKCDA15,0) AS JAKCDA15
                      , NVL(F.AKSD49,0) AS AKSD49
                      , NVL(F.AKSD43,0) AS AKSD43
                      , NVL(F.AKSD26,0) AS AKSD26
                      , NVL(F.AKSD29,0) AS AKSD29
                      , NVL(F.AKSD17,0) AS AKSD17
                      , NVL(F.AKSD50,0) AS AKSD50
                      , NVL(F.AKSD48,0) AS AKSD48
                      , NVL(F.AKSD04,0) AS AKSD04
                      , NVL(F.AKSD15,0) AS AKSD15
                      , NVL(F.AKSD23,0) AS AKSD23
                      , NVL(F.AKSD42,0) AS AKSD42
                      , NVL(F.AKSD31,0) AS AKSD31
                      , NVL(F.AKSD34,0) AS AKSD34
                      , NVL(F.AKSD11,0) AS AKSD11
                      , NVL(F.AKSD08,0) AS AKSD08
                      , NVL(F.AKSD22,0) AS AKSD22
                      , NVL(F.AKSD06,0) AS AKSD06
                      , NVL(F.AKSD13,0) AS AKSD13
                      , NVL(F.AKSD09,0) AS AKSD09
                      , NVL(F.AKSD36,0) AS AKSD36
                      , NVL(F.AKSD05,0) AS AKSD05
                      , NVL(F.AKSD14,0) AS AKSD14
                      , NVL(F.AKSD39,0) AS AKSD39
                      , NVL(F.AKSD18,0) AS AKSD18
                      , NVL(F.AKSD19,0) AS AKSD19
                      , NVL(F.AKSD40,0) AS AKSD40
                      , NVL(F.AKSD16,0) AS AKSD16
                      , NVL(F.AKSD10,0) AS AKSD10
                      , NVL(D.LCCNTT,0) AS LCCNTT
                      , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                      , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                      , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                   FROM TB_OGBS_MM_PRTNR_IZ A
                  INNER JOIN TB_OGBS_MM_OG_IZ O
                     ON A.BASE_YM = O.BASE_YM
                    AND A.OG_ID = O.OG_ID
                <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                    AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
                </if>
                <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                    AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
                </if>
                <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                    AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
                </if>
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                 ON A.PRTNR_NO = B.PRTNR_NO
                AND A.OG_TP_CD = B.OG_TP_CD
                AND B.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                 ON A.PRTNR_NO = C.PRTNR_NO
                AND C.OG_TP_CD = 'W01'
                AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
               LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                 ON A.PRTNR_NO = PM.PRTNR_NO
                AND A.OG_TP_CD = PM.OG_TP_CD
                AND A.BASE_YM = PM.BASE_YM
                AND PM.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                AND PM.PERF_AGRG_CRT_DV_CD = '203'  /*P추진단순주문실적생성*/
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(AKCDA17) AS AKCDA17
                                      , SUM(AKCDA18) AS AKCDA18
                                      , SUM(AKCDA1) AS AKCDA1
                                      , SUM(AKCDQ1) AS AKCDQ1
                                      , SUM(AKCDQ0) AS AKCDQ0
                                      , SUM(AKCDQ7) AS AKCDQ7
                                      , SUM(AKDET3) AS AKDET3
                                      , SUM(JASAMT) AS JASAMT
                                      , SUM(AKCDA12) AS AKCDA12
                                      , SUM(AKCDA13) AS AKCDA13
                                      , SUM(AKCDA14) AS AKCDA14
                                      , SUM(AKCDA15) AS AKCDA15
                                      , SUM(AKCDA16) AS AKCDA16
                                      , SUM(AKCDQ5) AS AKCDQ5
                                      , SUM(AKCDQ6) AS AKCDQ6
                                      , SUM(AKCDA19) AS AKCDA19
                                      , SUM(LCCNTT) AS LCCNTT
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                             AND AK17.PRTNR_NO = #{prtnrNo}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                )D
                 ON A.PRTNR_NO = D.PRTNR_NO
                AND A.OG_TP_CD = D.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(JAKCDQ0) AS JAKCDQ0
                                      , SUM(JAKCDQ6) AS JAKCDQ6
                                      , SUM(JAKCDA12) AS JAKCDA12
                                      , SUM(JAKCDA13) AS JAKCDA13
                                      , SUM(JAKCDA15) AS JAKCDA15
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12/*조직 환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13/*조직 환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15/*조직 환경가전외 일시불*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                             AND AK17.PRTNR_NO = #{prtnrNo}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                               )E
                 ON A.PRTNR_NO = E.PRTNR_NO
                AND A.OG_TP_CD = E.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(M.AKSD49) AS AKSD49
                                      , SUM(M.AKSD43) AS AKSD43
                                      , SUM(M.AKSD26) AS AKSD26
                                      , SUM(M.AKSD29) AS AKSD29
                                      , SUM(M.AKSD17) AS AKSD17
                                      , SUM(M.AKSD50) AS AKSD50
                                      , SUM(M.AKSD48) AS AKSD48
                                      , SUM(M.AKSD04) AS AKSD04
                                      , SUM(M.AKSD15) AS AKSD15
                                      , SUM(M.AKSD23) AS AKSD23
                                      , SUM(M.AKSD42) AS AKSD42
                                      , SUM(M.AKSD31) AS AKSD31
                                      , SUM(M.AKSD34) AS AKSD34
                                      , SUM(M.AKSD11) AS AKSD11
                                      , SUM(M.AKSD08) AS AKSD08
                                      , SUM(M.AKSD22) AS AKSD22
                                      , SUM(M.AKSD06) AS AKSD06
                                      , SUM(M.AKSD13) AS AKSD13
                                      , SUM(M.AKSD09) AS AKSD09
                                      , SUM(M.AKSD36) AS AKSD36
                                      , SUM(M.AKSD05) AS AKSD05
                                      , SUM(M.AKSD14) AS AKSD14
                                      , SUM(M.AKSD39) AS AKSD39
                                      , SUM(M.AKSD18) AS AKSD18
                                      , SUM(M.AKSD19) AS AKSD19
                                      , SUM(M.AKSD40) AS AKSD40
                                      , SUM(M.AKSD16) AS AKSD16
                                      , SUM(M.AKSD10) AS AKSD10
                                   FROM ( SELECT A.PRTNR_NO
                                               , A.OG_TP_CD
                                               , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                               , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                               , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                               , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                               , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                               , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                               , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                               , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                               , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                               , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                               , CASE WHEN A.FEE_CD = 'W020054' THEN A.FEE_ATC_VAL END AS AKSD06  /*추가장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                               , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                               , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                               , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                               , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                               , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                               , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                               , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                               , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                               , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                               , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                            FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                           WHERE A.DSB_YM = #{perfYm}
                                             AND A.OG_TP_CD = 'W02'       --M조직
                                             AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                             AND A.FEE_ATC_DV_CD = '01'
                                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                             AND A.PRTNR_NO = #{prtnrNo}
                                         </if>
                                             AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                             , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                             , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                             , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                             , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                             , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                            , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041', 'W020054')
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                               )F
                 ON A.PRTNR_NO = F.PRTNR_NO
                AND A.OG_TP_CD = F.OG_TP_CD
               LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                      , E.OG_TP_CD
                                      , SUM(E.INTBS_AMT) AS INTBS_SUM
                                      , SUM(E.DDCTAM) AS DDTN_SUM
                                      , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                   FROM TB_FEAM_FEE_DSB_IZ E
                                  WHERE E.DSB_YM = #{perfYm}
                                    AND E.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND E.PRTNR_NO = #{prtnrNo}
                                </if>
                                  GROUP BY E.PRTNR_NO, E.OG_TP_CD
                               )FEE
                 ON A.PRTNR_NO = FEE.PRTNR_NO
                AND A.OG_TP_CD = FEE.OG_TP_CD
               LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
                 ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                AND A.PRTNR_NO = G.PRTNR_NO
                AND A.OG_TP_CD = G.OG_TP_CD
                AND G.EDUC_CRSE_NO IN ('100','106','135')
                AND G.EDUC_CPC_ACKMT_YN = 'Y'
              WHERE A.BASE_YM = #{perfYm}
                AND A.OG_TP_CD = 'W02'
            <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                AND A.PRTNR_NO = #{prtnrNo}
            </if>
                AND A.PSTN_DV_CD = 7
               )T
    </select>

    <select id='selectManagerTotalFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerTotalRes">
        SELECT T1.OG_CD AS OG_NM /*소속*/
             , T1.PRTNR_NO /*번호*/
             , T1.PRTNR_KNM /*성명*/
             , T1.RSB_DV_CD /*직책*/
             , SUBSTR(T1.FST_CNTR_DT,1,6) AS BIZ_RGST1_ARTC /*업무등록-최초업무등록월*/
             , NVL(SUBSTR(T1.RCNTR_DT,1,6),'-') AS BIZ_RGST2_ARTC /*업무등록-재등록월*/
             , NVL(SUBSTR(T1.FNL_CLTN_DT,1,6),'-') AS BIZ_RGST3_ARTC /*업무등록-최종해약월*/
             , NVL(SUBSTR(T1.CLTN_DT,1,6),'-') AS BIZ_RGST4_ARTC /*업무등록-업무해약월*/
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(SUBSTR(T15.CV_DT,1,6),'-') END AS PRFMT_MM /*승진월*/
             , CASE WHEN T1.PSTN_DV_CD = 15
                         AND NVL(T15.CV_DT,'0') != '0'
                         AND MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T15.CV_DT,1,6),'YYYYMM')) &gt;= 0
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T15.CV_DT,1,6),'YYYYMM')) + 1
                    ELSE 0
               END AS PRFMT_NMN /*승진차월*/
             , NVL(T3.PERF_VAL,0) AS METG_DC /*미팅일수*/
             , T1.QLF_DV_CD AS QLF1_ATC  /*자격-수수료월*/
             , CASE WHEN T4.PSTN_DV_CD = 7 AND T4.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                    WHEN T5.PSTN_DV_CD = 7 AND T5.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                    WHEN T4.PRTNR_NO IS NOT NULL THEN T4.QLF_DV_CD
                    WHEN T5.PRTNR_NO IS NOT NULL THEN 'M->P'
                    WHEN T4.PRTNR_NO IS NULL AND T5.PRTNR_NO IS NULL THEN '해약'
               END AS QLF2_ATC /*자격-M+1*/
             , NVL(T9.EDU1_ATC,'-') AS EDU1_ATC /*교육-스타트업 */
             , NVL(T9.EDU2_ATC,'-') AS EDU2_ATC /*교육-Pre스타트업 */
             , T10.EDU3_ATC AS EDU3_ATC /*교육-보수 */
             , T10.EDU4_ATC AS EDU4_ATC /*교육-정착1 */
             , T10.EDU5_ATC AS EDU5_ATC /*교육-정착2 */
             , T10.EDU6_ATC AS EDU6_ATC /*교육-정착345 */
             , NVL(T10.EDU12_ATC,'N') AS EDU10_ATC /*교육-지점온라인*/
             , CASE WHEN T10.EDU7_ATC = 'Y' THEN '1'
                    WHEN T10.EDU8_ATC = 'Y' THEN '2'
                    WHEN T10.EDU9_ATC = 'Y' THEN '3'
                    WHEN T10.EDU10_ATC = 'Y' THEN '4'
                    WHEN T10.EDU11_ATC = 'Y' THEN '5'
                    ELSE ''
               END AS EDU7_ATC /*교육-Pre누적교육 */
             , NVL(T9.EDU8_ATC,'-') AS EDU8_ATC /*교육-수석정착*/
             , CASE WHEN T9.EDU8_ATC != NULL
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(T9.EDU8_ATC,'YYYYMM')) + 1
                    ELSE 0
               END AS EDU9_ATC /*교육-수석차월*/
             , NVL(SUBSTR(T6.FST_OPNG,1,6),'-') AS MNGR1_ATC /*매니저개시-최초개시월*/
             , NVL(SUBSTR(T6.RE_OPNG,1,6),'-') AS MNGR2_ATC /*매니저개시-재개시월*/
             , NVL(SUBSTR(T7.FST_CV_DT,1,6),'-') AS MNGR3_ATC /*매니저개시-최종해약월*/
             , NVL(SUBSTR(T7.CV_DT,1,6),'-') AS MNGR4_ATC /*매니저개시-업무해약월*/
             , CASE WHEN NVL(T7.CV_DT,'0') != '0'
                         AND MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T7.CV_DT,1,6),'YYYYMM')) &gt;= 0
                         THEN MONTHS_BETWEEN(TO_DATE(#{perfYm},'YYYYMM'), TO_DATE(SUBSTR(T7.CV_DT,1,6),'YYYYMM')) + 1
                    ELSE 0
               END AS MNGR5_ATC /*매니저개시-개시차월*/
             , NVL(T6.OPNG_CD,'9') AS MNGR6_ATC /*매니저개시-정착지급유형*/
             , '0' AS MNGR7_ATC /*매니저개시-5일배정수 추후 재확인 필요*/
             , NVL(T8.MNGT_CNT,0) AS INDV1_BS_ATC /*개인BS-배정건수*/
             , NVL(T8.VST_CNT,0) AS INDV2_BS_ATC /*개인BS-완료건수*/
             , CASE WHEN NVL(T8.VST_CNT,0) = 0 OR NVL(T8.MNGT_CNT,0) = 0 THEN 0
                     ELSE TRUNC((T8.VST_CNT / (T8.MNGT_CNT - T8.CAN_CNT))*100.00,2)
               END AS INDV3_BS_ATC /*개인BS-처리율*/
             , CASE WHEN NVL(T8.VST_CNT,0) = 0 OR NVL(T8.MNGT_CNT,0) = 0 THEN 0
                    ELSE ( CASE WHEN TRUNC((T8.VST_CNT / (T8.MNGT_CNT - T8.CAN_CNT))*100.00,2) &gt;= 90 THEN 100
                                ELSE 80
                           END
                         )
               END AS INDV4_BS_ATC /*개인BS-지급률*/
             , NVL(T8.W1_CNT,0) AS INDV5_BS_ATC /*개인BS-W1건수*/
             , NVL(T8.W2_CNT,0) AS INDV6_BS_ATC /*개인BS-W2건수*/
             , NVL(T16.MNGT_CNT,0) AS OG1_BS_ATC /*조직BS-배정건수 */
             , NVL(T16.VST_CNT,0) AS OG2_BS_ATC /*조직BS-완료건수 */
             , CASE WHEN NVL(T16.VST_CNT,0) = 0 OR NVL(T16.MNGT_CNT,0) = 0 THEN 0
                    ELSE TRUNC((T16.VST_CNT / (T16.MNGT_CNT - T16.CAN_CNT))*100.00,2)
               END AS OG3_BS_ATC /*조직BS-처리율 */
             , CASE WHEN NVL(T16.VST_CNT,0) = 0 OR NVL(T16.MNGT_CNT,0) = 0 THEN 0
                    ELSE ( CASE WHEN TRUNC((T16.VST_CNT / (T16.MNGT_CNT - T16.CAN_CNT))*100.00,2) &gt;= 90 THEN 100
                                ELSE 80
                           END
                         )
               END AS OG4_BS_ATC /*조직BS-지급률 */
             , NVL(T11.INDV1_PERF,0) AS INDV1_PERF /*개인실적-가정인정건수 */
             , NVL(T11.INDV2_PERF,0) AS INDV2_PERF /*개인실적-렌탈기준가 */
             , NVL(T11.INDV3_PERF,0) AS INDV3_PERF /*개인실적-일시불기준가 */
             , NVL(T11.INDV4_PERF,0) AS INDV4_PERF /*개인실적-기변건수 */
             , NVL(T11.INDV5_PERF,0) AS INDV5_PERF /*개인실적-가전외인정실적 */
             , NVL(T11.INDV1_SELL,0) AS INDV1_SELL /*개인기타판매-정액건수*/
             , NVL(T11.INDV2_SELL,0) AS INDV2_SELL /*개인기타판매-라이브팩건수 */
             , NVL(T11.INDV3_SELL,0) AS INDV3_SELL /*개인기타판매-홈케어멤버십건수 */
             , NVL(T14.RENTAL_CAN_CT + T14.LEASE_CAN_CT + T14.MSH_SPR_CT + T14.RENTAL_EXN_CT , 0) AS INDV_ACC1_NINC
             , NVL(T14.RENTAL_NW_CT + T14.LEASE_NW_CT , 0) AS INDV_ACC2_NINC
             , NVL(T14.RENTAL_CAN_CT + T14.LEASE_CAN_CT + T14.MSH_SPR_CT + T14.RENTAL_EXN_CT , 0) - NVL(T14.RENTAL_NW_CT + T14.LEASE_NW_CT , 0) AS INDV_ACC3_NINC
             , NVL(T11.OG1_PERF,0) AS OG1_PERF /*조직실적-가정인정건수 */
             , NVL(T11.OG2_PERF,0) AS OG2_PERF /*조직실적-렌탈기준가 */
             , NVL(T11.OG3_PERF,0) AS OG3_PERF /*조직실적-일시불기준가 */
             , NVL(T11.OG4_PERF,0) AS OG4_PERF /*조직실적-기변건수 */
             , NVL(T11.OG2_PERF,0) + NVL(T11.OG3_PERF,0) AS OG_PERF_SUM /*조직실적-계 */
             , NVL(T17.RENTAL_CAN_CT + T17.LEASE_CAN_CT + T17.MSH_SPR_CT + T17.RENTAL_EXN_CT , 0) AS OG_ACC1_NINC /*조직계정순증-전월취소 */
             , NVL(T17.RENTAL_NW_CT + T17.LEASE_NW_CT , 0) AS OG_ACC2_NINC /*조직계정순증-당월신규 */
             , NVL(T17.RENTAL_CAN_CT + T17.LEASE_CAN_CT + T17.MSH_SPR_CT + T17.RENTAL_EXN_CT , 0) - NVL(T17.RENTAL_NW_CT + T17.LEASE_NW_CT , 0) AS OG_ACC3_NINC /*조직계정순증-순증 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV151_FEE,0)
                    ELSE NVL(T13.INDV071_FEE,0)
               END AS INDV1_FEE /*개인수수료-가전비례 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV152_FEE,0)
                    ELSE NVL(T13.INDV072_FEE,0)
               END AS INDV2_FEE /*개인수수료-가전외비례 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV153_FEE,0)
                    ELSE NVL(T13.INDV073_FEE,0)
               END AS INDV3_FEE /*개인수수료-가전판매장려 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV154_FEE,0)
                    ELSE NVL(T13.INDV074_FEE,0)
               END AS INDV4_FEE /*개인수수료-미팅 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV155_FEE,0)
                    ELSE NVL(T13.INDV075_FEE,0)
               END AS INDV5_FEE /*개인수수료-교육 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV156_FEE,0)
                    ELSE NVL(T13.INDV076_FEE,0)
               END AS INDV6_FEE /*개인수수료-정착 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV157_FEE,0)
                    ELSE NVL(T13.INDV077_FEE,0)
               END AS INDV7_FEE /*개인수수료-기기변경 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV158_FEE,0)
                    ELSE NVL(T13.INDV078_FEE,0)
               END AS INDV8_FEE /*개인수수료-BS관리 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV159_FEE,0)
                    ELSE NVL(T13.INDV079_FEE,0)
               END AS INDV9_FEE /*개인수수료-BS장려 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1510_FEE,0)
                    ELSE NVL(T13.INDV0710_FEE,0)
               END AS INDV10_FEE /*개인수수료-급지 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1511_FEE,0)
                    ELSE NVL(T13.INDV0711_FEE,0)
               END AS INDV11_FEE /*개인수수료-WM통신 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1512_FEE,0)
                    ELSE NVL(T13.INDV0712_FEE,0)
               END AS INDV12_FEE /*개인수수료-WM기타 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1513_FEE,0)
                    ELSE NVL(T13.INDV0713_FEE,0)
               END AS INDV13_FEE /*개인수수료-사전방문 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1514_FEE,0)
                    ELSE NVL(T13.INDV0714_FEE,0)
               END AS INDV14_FEE /*개인수수료-유니폼 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1515_FEE,0)
                    ELSE NVL(T13.INDV0715_FEE,0)
               END AS INDV15_FEE /*개인수수료-자재실장 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.INDV1516_FEE,0)
                    ELSE NVL(T13.INDV0716_FEE,0)
               END AS INDV16_FEE /*개인수수료-가전추가장려 */
             , NVL(T13.OG1_FEE,0) AS OG1_FEE /*조직수수료-가전조직비례 */
             , NVL(T13.OG2_FEE,0) AS OG2_FEE /*조직수수료-가전조직외비례 */
             , NVL(T13.OG3_FEE,0) AS OG3_FEE /*조직수수료-가전조직판매장려 */
             , NVL(T13.OG4_FEE,0) AS OG4_FEE /*조직수수료-교육 */
             , NVL(T13.OG5_FEE,0) AS OG5_FEE /*조직수수료-순증관리 */
             , NVL(T13.OG6_FEE,0) AS OG6_FEE /*조직수수료-조직배출1 */
             , NVL(T13.OG7_FEE,0) AS OG7_FEE /*조직수수료-조직배출2 */
             , NVL(T13.OG8_FEE,0) AS OG8_FEE /*조직수수료-신설지점 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.ETC151_ATC,0)
                    ELSE NVL(T13.ETC071_ATC,0)
               END AS ETC1_ATC /*기타-재지급 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.ETC152_ATC,0)
                    ELSE NVL(T13.ETC072_ATC,0)
               END AS ETC2_ATC /*기타-멤버십 */
             , CASE WHEN T1.PSTN_DV_CD = 15 THEN NVL(T13.ETC153_ATC,0)
                    ELSE NVL(T13.ETC073_ATC,0)
               END AS ETC3_ATC /*기타-기타지원 */
             , NVL(T12.INTBS_SUM,0) AS INTBS_SUM /*과표합계 */
             , NVL(T12.DDTN_SUM,0) AS DDTN_SUM /*총공제액 */
             , NVL(T12.ACL_DSB_AMT,0) AS ACL_DSB_AMT /*실지급액 */
          FROM TB_OGBS_MM_PRTNR_IZ T1
         INNER JOIN TB_OGBS_MM_OG_IZ T2
            ON T1.BASE_YM = T2.BASE_YM
           AND T1.OG_ID = T2.OG_ID
      <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND T2.DGR1_LEVL_OG_ID = #{ogLevl1Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND T2.DGR2_LEVL_OG_ID = #{ogLevl2Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND T2.DGR3_LEVL_OG_ID = #{ogLevl3Id}
      </if>
          LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL T3
            ON T1.PRTNR_NO = T3.PRTNR_NO
           AND T1.OG_TP_CD = T3.OG_TP_CD
           AND T1.BASE_YM = T3.BASE_YM
           AND T3.FEE_TCNT_DV_CD = #{feeTcntDvCd}
           AND T3.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
           AND T3.PERF_AGRG_CRT_DV_CD = '201'
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T3.PRTNR_NO = #{prtnrNo}
      </if>
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T4 /*+1 month M조직 여부*/
            ON T1.PRTNR_NO = T4.PRTNR_NO
           AND T1.OG_TP_CD = T4.OG_TP_CD
           AND T4.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T4.PRTNR_NO = #{prtnrNo}
      </if>
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T5  /*+1 month P조직 이동*/
            ON T1.PRTNR_NO = T5.PRTNR_NO
           AND T5.OG_TP_CD = 'W01'
           AND T5.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND T5.PRTNR_NO = #{prtnrNo}
      </if>
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(FST_OPNG) AS FST_OPNG
                                 , MAX(RE_OPNG) AS RE_OPNG
                                 , MAX(OPNG_CD) AS OPNG_CD
                              FROM ( SELECT PRTNR_NO
                                          , OPNG_CD
                                          , CASE WHEN OPNG_CD IN ('1','2') THEN BASE_YM END AS FST_OPNG
                                          , CASE WHEN OPNG_CD IN ('3','4') THEN BASE_YM END AS RE_OPNG
                                       FROM TB_FEAM_WELS_MNGER_OPNG_BAS
                                      WHERE BASE_YM  &lt;= #{perfYm}
                                        AND OG_TP_CD = 'W02'
                                        AND TCNT_DV_CD = '02'
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                   )
                             GROUP BY PRTNR_NO
                          )T6
            ON T1.PRTNR_NO = T6.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , MAX(CV_DT) AS CV_DT
                                  , MIN(CV_DT) AS FST_CV_DT
                               FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                              WHERE OG_TP_CD = 'W02'
                                AND QLF_DV_CD = '3'  /* 웰스매니저 */
                                AND QLF_APLC_DV_CD = '2'  /* 자격해제 */
                                AND DTA_DL_YN = 'N'
                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                AND PRTNR_NO = #{prtnrNo}
                           </if>
                              GROUP BY PRTNR_NO
                          )T7
            ON T1.PRTNR_NO = T7.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , NVL(MAX(W1_CNT),0) AS W1_CNT
                                 , NVL(MAX(W2_CNT),0) AS W2_CNT
                                 , NVL(MAX(MNGT_CNT),0) AS MNGT_CNT
                                 , NVL(MAX(VST_CNT),0) AS VST_CNT
                                 , NVL(MAX(CAN_CNT),0) AS CAN_CNT
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W1_CNT
                                          , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010101' THEN PERF_VAL END AS W2_CNT
                                          , 0 AS MNGT_CNT
                                          , 0 AS VST_CNT
                                          , 0 AS CAN_CNT
                                       FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                      WHERE BASE_YM = #{perfYm}
                                        AND CL_DV_CD = #{feeTcntDvCd}
                                        AND OG_TP_CD = 'W02'
                                        AND PRTNR_SV_PERF_ATC_CD IN ('SV06010101','SV06010102')
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                      UNION ALL
                                     SELECT A.PRTNR_NO
                                          , 0 AS W1_CNT
                                          , 0 AS W2_CNT
                                          , NVL(SUM(A.MNGT_CNT),0) AS MNGT_CNT
                                          , NVL(SUM(A.VST_CNT),0) AS VST_CNT
                                          , NVL(SUM(A.CAN_CNT),0) AS CAN_CNT
                                       FROM ( SELECT PRTNR_NO
                                                   , MNGT_CNT AS MNGT_CNT
                                                   , VST_CNT1 + VST_CNT2 AS VST_CNT
                                                   , CAN_CNT
                                                FROM ( SELECT Z.PRTNR_NO
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS MNGT_CNT
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '02'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS VST_CNT1
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '03'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS VST_CNT2
                                                            , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '90'
                                                                        AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                        THEN SUM(Z.PERF_VAL)
                                                                   ELSE 0
                                                              END AS CAN_CNT
                                                              FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                                             INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                                                ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                                               AND X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                               AND X.PRTNR_PERF_DTLP_ATC_CDV2 IN ('99','90')
                                                               AND X.PRTNR_PERF_DTLP_ATC_CDV3 IN ('99','90')
                                                             WHERE Z.BASE_YM = '202306'
                                                               AND Z.CL_DV_CD = '02'
                                                               AND Z.OG_TP_CD = 'W02'
                                                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                                               AND Z.PRTNR_NO = #{prtnrNo}
                                                          </if>
                                                             GROUP BY Z.PRTNR_NO, X.PRTNR_PERF_DTLP_ATC_CDV2, X.PRTNR_PERF_DTLP_ATC_CDV4
                                                     )
                                            )A
                                      INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                                         ON A.PRTNR_NO = B.PRTNR_NO
                                        AND B.BASE_YM = #{perfYm}
                                        AND B.OG_TP_CD = 'W02'
                                      INNER JOIN TB_OGBS_MM_OG_IZ C
                                         ON B.BASE_YM = C.BASE_YM
                                        AND B.OG_ID = C.OG_ID
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                                        AND C.DGR1_LEVL_OG_ID = #{ogLevl1Id}
                                   </if>
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                                        AND C.DGR2_LEVL_OG_ID = #{ogLevl2Id}
                                   </if>
                                   <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                                        AND C.DGR3_LEVL_OG_ID = #{ogLevl3Id}
                                   </if>
                                      GROUP BY A.PRTNR_NO
                                   )
                             GROUP BY PRTNR_NO
                          )T8
             ON T1.PRTNR_NO = T8.PRTNR_NO
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , MAX(EDU1_ATC) AS EDU1_ATC
                                  , MAX(EDU2_ATC) AS EDU2_ATC
                                  , MAX(EDU8_ATC) AS EDU8_ATC
                               FROM ( SELECT PRTNR_NO
                                           , CASE WHEN EDUC_CRSE_NO = '96' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU1_ATC
                                           , CASE WHEN EDUC_CRSE_NO = '143' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU2_ATC
                                           , CASE WHEN EDUC_CRSE_NO = '17' THEN SUBSTR(EDUC_CRSE_CRT_BASE_YM,1,6) END AS EDU8_ATC
                                        FROM TB_PSCA_MCPTN_EDUC_IZ
                                       WHERE OG_TP_CD = 'W02'
                                         AND EDUC_CRSE_NO IN ('96','143')
                                         AND EDUC_CRSE_CRT_BASE_YM &lt;= #{perfYm}
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                    )
                              GROUP BY PRTNR_NO
                           )T9
             ON T1.PRTNR_NO = T9.PRTNR_NO
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , MAX(EDU3_ATC) AS EDU3_ATC
                                  , MAX(EDU4_ATC) AS EDU4_ATC
                                  , MAX(EDU5_ATC) AS EDU5_ATC
                                  , MAX(EDU6_ATC) AS EDU6_ATC
                                  , MAX(EDU7_ATC) AS EDU7_ATC
                                  , MAX(EDU8_ATC) AS EDU8_ATC
                                  , MAX(EDU9_ATC) AS EDU9_ATC
                                  , MAX(EDU10_ATC) AS EDU10_ATC
                                  , MAX(EDU11_ATC) AS EDU11_ATC
                                  , MAX(EDU12_ATC) AS EDU12_ATC
                               FROM ( SELECT PRTNR_NO
                                           , CASE WHEN PERF_ATC_CD = 'W02P00116' THEN FEE_PERF_ATC_VAL END AS EDU3_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00124' THEN FEE_PERF_ATC_VAL END AS EDU4_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00125' THEN FEE_PERF_ATC_VAL END AS EDU5_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00126' THEN FEE_PERF_ATC_VAL END AS EDU6_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00127' THEN FEE_PERF_ATC_VAL END AS EDU7_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00128' THEN FEE_PERF_ATC_VAL END AS EDU8_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00129' THEN FEE_PERF_ATC_VAL END AS EDU9_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00130' THEN FEE_PERF_ATC_VAL END AS EDU10_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00131' THEN FEE_PERF_ATC_VAL END AS EDU11_ATC
                                           , CASE WHEN PERF_ATC_CD = 'W02P00120' THEN FEE_PERF_ATC_VAL END AS EDU12_ATC
                                        FROM TB_FEAM_PRTNR_PERF_MM_CL
                                       WHERE BASE_YM = #{perfYm}
                                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                         AND PERF_AGRG_CRT_DV_CD = '201'
                                         AND PERF_ATC_CD IN ( 'W02P00116', 'W02P00124', 'W02P00125', 'W02P00126', 'W02P00127'
                                                            , 'W02P00128', 'W02P00129', 'W02P00130', 'W02P00131', 'W02P00120'
                                                            )
                                         AND CO_CD = '2000'
                                         AND OG_TP_CD = 'W02'
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                    )
                              GROUP BY PRTNR_NO
                           )T10
             ON T1.PRTNR_NO = T10.PRTNR_NO
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , SUM(INDV1_PERF) AS INDV1_PERF
                                  , SUM(INDV2_PERF) AS INDV2_PERF
                                  , SUM(INDV3_PERF) AS INDV3_PERF
                                  , SUM(INDV4_PERF) AS INDV4_PERF
                                  , SUM(INDV5_PERF) AS INDV5_PERF
                                  , SUM(INDV1_SELL) AS INDV1_SELL
                                  , SUM(INDV2_SELL) AS INDV2_SELL
                                  , SUM(INDV3_SELL) AS INDV3_SELL
                                  , SUM(OG1_PERF) AS OG1_PERF
                                  , SUM(OG2_PERF) AS OG2_PERF
                                  , SUM(OG3_PERF) AS OG3_PERF
                                  , SUM(OG4_PERF) AS OG4_PERF
                               FROM ( SELECT PRTNR_NO
                                           , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS INDV1_PERF
                                           , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS INDV2_PERF
                                           , CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END AS INDV3_PERF
                                           , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS INDV4_PERF
                                           , CASE WHEN PERF_ATC_CD IN ('W02P00027', 'W02P00112') THEN PERF_VAL ELSE 0 END AS INDV5_PERF
                                           , CASE WHEN PERF_ATC_CD IN ('W00P00005', 'W00P00007') THEN 1 ELSE 0 END AS INDV1_SELL
                                           , CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END AS INDV2_SELL
                                           , CASE WHEN PERF_ATC_CD = 'W02P00086' THEN PERF_VAL ELSE 0 END AS INDV3_SELL
                                           , 0 AS OG1_PERF
                                           , 0 AS OG2_PERF
                                           , 0 AS OG3_PERF
                                           , 0 AS OG4_PERF
                                        FROM TB_FEAM_NTORP_PERF_MM_CL
                                       WHERE BASE_YM = #{perfYm}
                                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                         AND PERF_AGRG_CRT_DV_CD = '201'
                                         AND PERF_DV_CD = '0'
                                         AND OG_TP_CD = 'W02'
                                         AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00034', 'W00P00014'
                                                            , 'W00P00018', 'W02P00027', 'W02P00112', 'W00P00005', 'W00P00007'
                                                            , 'W02P00105', 'W00P00009', 'W02P00086'
                                                            )
                                         AND PERF_VAL &gt; 0
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                       UNION ALL
                                      SELECT PRTNR_NO
                                           , 0 AS INDV1_PERF
                                           , 0 AS INDV2_PERF
                                           , 0 AS INDV3_PERF
                                           , 0 AS INDV4_PERF
                                           , 0 AS INDV5_PERF
                                           , 0 AS INDV1_SELL
                                           , 0 AS INDV2_SELL
                                           , 0 AS INDV3_SELL
                                           , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS OG1_PERF
                                           , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS OG2_PERF
                                           , CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END AS OG3_PERF
                                           , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS OG4_PERF
                                        FROM TB_FEAM_NTORP_PERF_MM_CL
                                       WHERE BASE_YM = #{perfYm}
                                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                         AND PERF_AGRG_CRT_DV_CD = '201'
                                         AND PERF_DV_CD = '2'
                                         AND OG_TP_CD = 'W02'
                                         AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00034', 'W00P00014', 'W00P00018')
                                         AND PERF_VAL &gt; 0
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                    )
                              GROUP BY PRTNR_NO
                           )T11
             ON T1.PRTNR_NO = T11.PRTNR_NO
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , SUM(INTBS_AMT) AS INTBS_SUM
                                  , SUM(DDCTAM) AS DDTN_SUM
                                  , SUM(DSB_OJ_AMT) AS ACL_DSB_AMT
                               FROM TB_FEAM_FEE_DSB_IZ
                              WHERE DSB_YM = #{perfYm}
                                AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                AND OG_TP_CD = 'W02'
                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                AND PRTNR_NO = #{prtnrNo}
                           </if>
                              GROUP BY PRTNR_NO
                           )T12
             ON T1.PRTNR_NO = T12.PRTNR_NO
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , SUM(INDV151_FEE) AS INDV151_FEE
                                  , SUM(INDV152_FEE) AS INDV152_FEE
                                  , SUM(INDV153_FEE) AS INDV153_FEE
                                  , SUM(INDV154_FEE) AS INDV154_FEE
                                  , SUM(INDV155_FEE) AS INDV155_FEE
                                  , SUM(INDV156_FEE) AS INDV156_FEE
                                  , SUM(INDV157_FEE) AS INDV157_FEE
                                  , SUM(INDV158_FEE) AS INDV158_FEE
                                  , SUM(INDV159_FEE) AS INDV159_FEE
                                  , SUM(INDV1510_FEE) AS INDV1510_FEE
                                  , SUM(INDV1511_FEE) AS INDV1511_FEE
                                  , SUM(INDV1512_FEE) AS INDV1512_FEE
                                  , SUM(INDV1513_FEE) AS INDV1513_FEE
                                  , SUM(INDV1514_FEE) AS INDV1514_FEE
                                  , SUM(INDV1515_FEE) AS INDV1515_FEE
                                  , SUM(INDV1516_FEE) AS INDV1516_FEE
                                  , SUM(ETC151_ATC) AS ETC151_ATC
                                  , SUM(ETC152_ATC) AS ETC152_ATC
                                  , SUM(ETC153_ATC) AS ETC153_ATC
                                  , SUM(INDV071_FEE) AS INDV071_FEE
                                  , SUM(INDV072_FEE) AS INDV072_FEE
                                  , SUM(INDV073_FEE) AS INDV073_FEE
                                  , SUM(INDV074_FEE) AS INDV074_FEE
                                  , SUM(INDV075_FEE) AS INDV075_FEE
                                  , SUM(INDV076_FEE) AS INDV076_FEE
                                  , SUM(INDV077_FEE) AS INDV077_FEE
                                  , SUM(INDV078_FEE) AS INDV078_FEE
                                  , SUM(INDV079_FEE) AS INDV079_FEE
                                  , SUM(INDV0710_FEE) AS INDV0710_FEE
                                  , SUM(INDV0711_FEE) AS INDV0711_FEE
                                  , SUM(INDV0712_FEE) AS INDV0712_FEE
                                  , SUM(INDV0713_FEE) AS INDV0713_FEE
                                  , SUM(INDV0714_FEE) AS INDV0714_FEE
                                  , SUM(INDV0715_FEE) AS INDV0715_FEE
                                  , SUM(INDV0716_FEE) AS INDV0716_FEE
                                  , SUM(ETC071_ATC) AS ETC071_ATC
                                  , SUM(ETC072_ATC) AS ETC072_ATC
                                  , SUM(ETC073_ATC) AS ETC073_ATC
                                  , SUM(OG1_FEE) AS OG1_FEE
                                  , SUM(OG2_FEE) AS OG2_FEE
                                  , SUM(OG3_FEE) AS OG3_FEE
                                  , SUM(OG4_FEE) AS OG4_FEE
                                  , SUM(OG5_FEE) AS OG5_FEE
                                  , SUM(OG6_FEE) AS OG6_FEE
                                  , SUM(OG7_FEE) AS OG7_FEE
                                  , SUM(OG8_FEE) AS OG8_FEE
                               FROM ( SELECT PRTNR_NO
                                           , CASE WHEN FEE_CD = 'W020001' THEN FEE_ATC_VAL ELSE 0 END AS INDV151_FEE
                                           , CASE WHEN FEE_CD = 'W020003' THEN FEE_ATC_VAL ELSE 0 END AS INDV152_FEE
                                           , CASE WHEN FEE_CD = 'W020115' THEN FEE_ATC_VAL ELSE 0 END AS INDV153_FEE
                                           , CASE WHEN FEE_CD = 'W020117' THEN FEE_ATC_VAL ELSE 0 END AS INDV154_FEE
                                           , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV155_FEE
                                           , CASE WHEN FEE_CD = 'W020081' THEN FEE_ATC_VAL ELSE 0 END AS INDV156_FEE
                                           , CASE WHEN FEE_CD = 'W020005' THEN FEE_ATC_VAL ELSE 0 END AS INDV157_FEE
                                           , CASE WHEN FEE_CD = 'W020084' THEN FEE_ATC_VAL ELSE 0 END AS INDV158_FEE
                                           , CASE WHEN FEE_CD = 'W020122' THEN FEE_ATC_VAL ELSE 0 END AS INDV159_FEE
                                           , CASE WHEN FEE_CD = 'W020085' THEN FEE_ATC_VAL ELSE 0 END AS INDV1510_FEE
                                           , CASE WHEN FEE_CD = 'W020027' THEN FEE_ATC_VAL ELSE 0 END AS INDV1511_FEE
                                           , CASE WHEN FEE_CD = 'W020096' THEN FEE_ATC_VAL ELSE 0 END AS INDV1512_FEE
                                           , CASE WHEN FEE_CD = 'W020086' THEN FEE_ATC_VAL ELSE 0 END AS INDV1513_FEE
                                           , CASE WHEN FEE_CD = 'W020098' THEN FEE_ATC_VAL ELSE 0 END AS INDV1514_FEE
                                           , CASE WHEN FEE_CD = 'W020014' THEN FEE_ATC_VAL ELSE 0 END AS INDV1515_FEE
                                           , CASE WHEN FEE_CD = 'W020124' THEN FEE_ATC_VAL ELSE 0 END AS INDV1516_FEE
                                           , CASE WHEN FEE_CD = 'W020090' THEN FEE_ATC_VAL ELSE 0 END AS ETC151_ATC
                                           , CASE WHEN FEE_CD = 'W020006' THEN FEE_ATC_VAL ELSE 0 END AS ETC152_ATC
                                           , CASE WHEN FEE_CD = 'W020094' THEN FEE_ATC_VAL ELSE 0 END AS ETC153_ATC
                                           , CASE WHEN FEE_CD = 'W020002' THEN FEE_ATC_VAL ELSE 0 END AS INDV071_FEE
                                           , CASE WHEN FEE_CD = 'W020004' THEN FEE_ATC_VAL ELSE 0 END AS INDV072_FEE
                                           , CASE WHEN FEE_CD = 'W020011' THEN FEE_ATC_VAL ELSE 0 END AS INDV073_FEE
                                           , 0 AS INDV074_FEE
                                           , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV075_FEE
                                           , 0 AS INDV076_FEE
                                           , CASE WHEN FEE_CD = 'W020030' THEN FEE_ATC_VAL ELSE 0 END AS INDV077_FEE
                                           , CASE WHEN FEE_CD = 'W020087' THEN FEE_ATC_VAL ELSE 0 END AS INDV078_FEE
                                           , CASE WHEN FEE_CD = 'W020123' THEN FEE_ATC_VAL ELSE 0 END AS INDV079_FEE
                                           , CASE WHEN FEE_CD = 'W020088' THEN FEE_ATC_VAL ELSE 0 END AS INDV0710_FEE
                                           , CASE WHEN FEE_CD = 'W020089' THEN FEE_ATC_VAL ELSE 0 END AS INDV0711_FEE
                                           , CASE WHEN FEE_CD = 'W020097' THEN FEE_ATC_VAL ELSE 0 END AS INDV0712_FEE
                                           , 0 AS INDV0713_FEE
                                           , CASE WHEN FEE_CD = 'W020099' THEN FEE_ATC_VAL ELSE 0 END AS INDV0714_FEE
                                           , CASE WHEN FEE_CD = 'W020041' THEN FEE_ATC_VAL ELSE 0 END AS INDV0715_FEE
                                           , 0 AS INDV0716_FEE
                                           , CASE WHEN FEE_CD = 'W020091' THEN FEE_ATC_VAL ELSE 0 END AS ETC071_ATC
                                           , CASE WHEN FEE_CD = 'W020033' THEN FEE_ATC_VAL ELSE 0 END AS ETC072_ATC
                                           , CASE WHEN FEE_CD = 'W020095' THEN FEE_ATC_VAL ELSE 0 END AS ETC073_ATC
                                           , CASE WHEN FEE_CD = 'W020020' THEN FEE_ATC_VAL ELSE 0 END AS OG1_FEE
                                           , CASE WHEN FEE_CD = 'W020023' THEN FEE_ATC_VAL ELSE 0 END AS OG2_FEE
                                           , CASE WHEN FEE_CD = 'W020017' THEN FEE_ATC_VAL ELSE 0 END AS OG3_FEE
                                           , CASE WHEN FEE_CD = 'W020118' THEN FEE_ATC_VAL ELSE 0 END AS OG4_FEE
                                           , CASE WHEN FEE_CD = 'W020121' THEN FEE_ATC_VAL ELSE 0 END AS OG5_FEE
                                           , CASE WHEN FEE_CD = 'W020015' THEN FEE_ATC_VAL ELSE 0 END AS OG6_FEE
                                           , CASE WHEN FEE_CD = 'W020016' THEN FEE_ATC_VAL ELSE 0 END AS OG7_FEE
                                           , CASE WHEN FEE_CD = 'W020025' THEN FEE_ATC_VAL ELSE 0 END AS OG8_FEE
                                        FROM TB_FEAM_FEE_DSB_DTL_IZ
                                       WHERE DSB_YM = #{perfYm}
                                         AND OG_TP_CD = 'W02'
                                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                         AND FEE_ATC_DV_CD = '01'
                                         AND FEE_CD IN ( 'W020001', 'W020003', 'W020115', 'W020117', 'W020116'
                                                       , 'W020081', 'W020005', 'W020084', 'W020122', 'W020085'
                                                       , 'W020027', 'W020096', 'W020086', 'W020098', 'W020014'
                                                       , 'W020124', 'W020090', 'W020006', 'W020094', 'W020002'
                                                       , 'W020004', 'W020011', 'W020118', 'W020030', 'W020087'
                                                       , 'W020123', 'W020088', 'W020089', 'W020097', 'W020099'
                                                       , 'W020041', 'W020091', 'W020033', 'W020095', 'W020020'
                                                       , 'W020023', 'W020017', 'W020121', 'W020015', 'W020016'
                                                       , 'W020025', 'W020075', 'W020076', 'W020077'
                                                       )
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                         AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                    )
                              GROUP BY PRTNR_NO
                           )T13
             ON T1.PRTNR_NO = T13.PRTNR_NO
           LEFT OUTER JOIN TB_FEAM_WELS_ACC_NINC_MM_CL T14
             ON T1.BASE_YM = T14.PERF_YM
            AND T1.PRTNR_NO = T14.PRTNR_NO
            AND T3.FEE_TCNT_DV_CD = T14.FEE_TCNT_DV_CD
            AND T14.CO_CD = '2000'
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
            AND T14.PRTNR_NO = #{prtnrNo}
       </if>
           LEFT OUTER JOIN ( SELECT PRTNR_NO
                                  , MAX(CV_DT) AS CV_DT
                               FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                              WHERE OG_TP_CD = 'W02'
                                AND QLF_DV_CD IN ('4','5')  /* 플래너, 웰스지점장 */
                                AND QLF_APLC_DV_CD = '1'  /* 승급 */
                                AND DTA_DL_YN = 'N'
                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                AND PRTNR_NO = #{prtnrNo}
                           </if>
                              GROUP BY PRTNR_NO
                           )T15
             ON T1.PRTNR_NO = T15.PRTNR_NO
           LEFT OUTER JOIN ( SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                  , NVL(SUM(A.MNGT_CNT),0) AS MNGT_CNT
                                  , NVL(SUM(A.VST_CNT),0) AS VST_CNT
                                  , NVL(SUM(A.CAN_CNT),0) AS CAN_CNT
                               FROM ( SELECT PRTNR_NO
                                           , MNGT_CNT AS MNGT_CNT
                                           , VST_CNT1 + VST_CNT2 AS VST_CNT
                                           , CAN_CNT
                                        FROM ( SELECT Z.PRTNR_NO
                                                    , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                THEN SUM(Z.PERF_VAL)
                                                           ELSE 0
                                                           END AS MNGT_CNT
                                                    , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '02'
                                                                THEN SUM(Z.PERF_VAL)
                                                           ELSE 0
                                                      END AS VST_CNT1
                                                    , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '99'
                                                                AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '03'
                                                                THEN SUM(Z.PERF_VAL)
                                                           ELSE 0
                                                      END AS VST_CNT2
                                                    , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV2 = '90'
                                                                AND X.PRTNR_PERF_DTLP_ATC_CDV4 = '01'
                                                                THEN SUM(Z.PERF_VAL)
                                                           ELSE 0
                                                      END AS CAN_CNT
                                                 FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                                INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                                   ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV2 IN ('99','90')
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV3 IN ('99','90')
                                                WHERE Z.BASE_YM = '202306'
                                                  AND Z.CL_DV_CD = '02'
                                                  AND Z.OG_TP_CD = 'W02'
                                                GROUP BY Z.PRTNR_NO, X.PRTNR_PERF_DTLP_ATC_CDV2, X.PRTNR_PERF_DTLP_ATC_CDV4
                                             )
                                    )A
                              INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                                 ON A.PRTNR_NO = B.PRTNR_NO
                                AND B.BASE_YM = #{perfYm}
                                AND B.OG_TP_CD = 'W02'
                              INNER JOIN TB_OGBS_MM_OG_IZ C
                                 ON B.BASE_YM = C.BASE_YM
                                AND B.OG_ID = C.OG_ID
                                AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                AND C.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
                           </if>
                              GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
                           )T16
             ON T1.PRTNR_NO = T16.PRTNR_NO
           LEFT OUTER JOIN ( SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                  , NVL(SUM(A.RENTAL_CAN_CT),0) AS RENTAL_CAN_CT
                                  , NVL(SUM(A.LEASE_CAN_CT),0) AS LEASE_CAN_CT
                                  , NVL(SUM(A.MSH_SPR_CT),0) AS MSH_SPR_CT
                                  , NVL(SUM(A.RENTAL_EXN_CT),0) AS RENTAL_EXN_CT
                                  , NVL(SUM(A.RENTAL_NW_CT),0) AS RENTAL_NW_CT
                                  , NVL(SUM(A.LEASE_NW_CT),0) AS LEASE_NW_CT
                               FROM ( SELECT PRTNR_NO
                                           , RENTAL_CAN_CT
                                           , LEASE_CAN_CT
                                           , MSH_SPR_CT
                                           , RENTAL_EXN_CT
                                           , RENTAL_NW_CT
                                           , LEASE_NW_CT
                                        FROM TB_FEAM_WELS_ACC_NINC_MM_CL
                                       WHERE PERF_YM = #{perfYm}
                                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                         AND CO_CD = '2000'
                                    )A
                              INNER JOIN TB_OGBS_MM_PRTNR_IZ B
                                 ON A.PRTNR_NO = B.PRTNR_NO
                                AND B.BASE_YM = #{perfYm}
                                AND B.OG_TP_CD = 'W02'
                              INNER JOIN TB_OGBS_MM_OG_IZ C
                                 ON B.BASE_YM = C.BASE_YM
                                AND B.OG_ID = C.OG_ID
                                AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                AND C.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
                           </if>
                              GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
                           )T17
             ON T1.PRTNR_NO = T17.PRTNR_NO
          WHERE T1.BASE_YM = #{perfYm}
            AND T1.PSTN_DV_CD IN ( '7', '15')
            AND T1.OG_TP_CD = 'W02'
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
            AND T1.PRTNR_NO = #{prtnrNo}
       </if>
    </select>

    <select id='selectManagerTotalBeforeFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerTotalBfRes">
        SELECT T.OG_CD AS OG_NM /*소속*/
             , T.PRTNR_NO  /*번호*/
             , T.PRTNR_KNM  /*성명*/
             , T.RSB_DV_CD  /*직책*/
             , T.AKCUIL     /*미팅일수*/
             , T.AKDMI3 		/*  자격 수수료월    */
             , T.AKDMI32      /*  자격M+1    */
             , CASE WHEN SUBSTR(T.OG_ID,0,1) != 'P' THEN CASE WHEN T.EDU096 != '' AND T.EDU097 != '' THEN T.EDU097 ELSE '' END
                    WHEN SUBSTR(T.OG_ID,0,1) = 'P'  THEN CASE WHEN T.EDU112 != '' AND T.EDU113 != '' THEN T.EDU113 ELSE '' END
                    ELSE ''
               END EDUSTR        		/* 스타트업 매니저 */
             , T.EDU011		/*스타트업 플래너*/
             , T.EDU129		/*보수교육*/
             , T.EDU106		/*수석플래너 교육 정착*/
             , T.AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
             , T.EDU017		/*수석플래너 교육 실전*/
             , T.EDU135		/*지점장 온라인*/
             , T.OJTCNT		/*OJT일수   AB2610P KSS 데이터 미정으로 일단 해당 교육번호 98로 임시처리*/
             , T.AKDSYM		/*등록기준월*/
             , T.AKDENM		/*최초업무등록월*/
             , T.AKDJEM		/*재등록월*/
             , T.AKDLYM		/*최종해약월*/
             , T.AKDCYM		/*업무해약월*/
             , T.AKDRYM		/*승진월*/
             , T.SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
             , T.SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
             , T.LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
             , T.LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
             , T.DALSYN		/*실활동달성 AB8050P 정리안됨 임시처리*/
             , T.BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
             , T.SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
             , T.WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
             , T.WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
             , T.SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
             , T.DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
             , T.AKCDA17	    /*인정실적 렌탈*/
             , T.AKCDA18		/*인정실적 일시불*/
             , T.AKCDA1		/*인정실적 환경가전외*/
             , T.AKCDQ1		/*가전순주문건수*/
             , T.AKCDQ0		/*개인가전인정건수*/
             , T.AKCDQ7		/*개인BS인정건수*/
             , T.AKDET3		/*가전기변건수*/
             , T.JASAMT		/*가전기변금액*/
             , T.AKCDA12		/*환경가전 렌탈*/
             , T.AKCDA13		/*환경가전 일시불*/
             , T.AKCDA14		/*환경가전 정액*/
             , T.AKCDA15		/*환경가전외 일시불*/
             , T.AKCDA16		/*환경가전외 정액*/
             , T.AKCDQ5		/*라이브팩건수*/
             , T.AKCDQ6		/*개인신규판매건수*/
             , T.AKCDA19		/*홈케어판매가*/
             , T.JAKCDQ0		/*조직가전인정건수*/
             , T.JAKCDQ6		/*조직신규판매건수*/
             , T.JAKCDA12	/*조직 환경가전렌탈*/
             , T.JAKCDA13	/*조직 환경가전 일시불*/
             , T.JAKCDA15	/*조직 환경가전외 일시불*/
             , T.AKSD49      /*홈케어*/
             , T.AKSD43      /*라이브팩*/
             , T.AKSD26      /*가전비례*/
             , T.AKSD29      /*가전외비례*/
             , T.SD26M1      /*가전미팅*/
             , T.SD26M2      /*일시불미팅*/
             , T.SD26MT      /*가전외미팅*/
             , T.AKSD17      /*판매장려*/
             , T.AKSD50      /*교육*/
             , T.AKSD48      /*정착*/
             , T.AKSD04      /*기기변경*/
             , T.AKSD15      /*BS관리*/
             , T.AKSD23      /*급지*/
             , T.AKSD42      /*판매장려소급*/
             , T.AKSD31      /*가전조직비례*/
             , T.AKSD34      /*가전조직외비례*/
             , T.AKSD11      /*조직판매장려*/
             , T.AKSD08      /*신규판매*/
             , T.AKSD22      /*조직관리*/
             , T.AKSD06      /*추가장려*/
             , T.AKSD13      /*조직배출1*/
             , T.AKSD09      /*조직배출2*/
             , T.AKSD36      /*신설지점*/
             , T.AKSD05      /*멤버십*/
             , T.AKSD14      /*재지급*/
             , T.AKSD39      /*기타지원*/
             , T.AKSD18      /*WM통신*/
             , T.AKSD19      /*WM기타*/
             , T.AKSD40      /*사전방문*/
             , T.AKSD16      /*유니폼*/
             , T.AKSD10      /*자재실장*/
             , T.LCCNTT      /*BS완료계정*/
             , T.INTBS_SUM   /*과표합계*/
             , T.DDTN_SUM    /*총공제액*/
             , T.ACL_DSB_AMT   /*실지급액*/
        FROM ( SELECT A.OG_CD
                    , A.PRTNR_NO
                    , A.PRTNR_KNM
                    , A.RSB_DV_CD
                    , A.OG_ID
                    , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                           ELSE 0
                      END AS AKCUIL
                    , A.QLF_DV_CD AS AKDMI3
                    , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                           WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                           WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                           WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                           WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                      END AS AKDMI32
                    , CASE WHEN G.EDUC_CRSE_NO = '11' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU011
                    , CASE WHEN G.EDUC_CRSE_NO = '129' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU129
                    , CASE WHEN G.EDUC_CRSE_NO IN ('100','106') THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU106
                    , '' AS AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
                    , CASE WHEN G.EDUC_CRSE_NO = '17' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU017
                    , CASE WHEN G.EDUC_CRSE_NO = '135' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU135
                    , CASE WHEN G.EDUC_CRSE_NO = '96' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU096
                    , CASE WHEN G.EDUC_CRSE_NO = '97' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU097
                    , CASE WHEN G.EDUC_CRSE_NO = '112' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU112
                    , CASE WHEN G.EDUC_CRSE_NO = '113' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU113
                    , CASE WHEN G.EDUC_CRSE_NO = '98' THEN 1 END AS OJTCNT
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                    , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                    , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                    , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                    , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS SUSTYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS SUSCYM
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS LCCOYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS LCCCYM
                    , 0 AS DALSYN
                    , 0 AS BONDALSYN
                    , 0 AS SUNGNM
                    , 0 AS WPSCNT
                    , 0 AS WMSCNT
                    , 0 AS SPSCNT
                    , 0 AS DANCNT
                    , NVL(D.AKCDA17,0) AS AKCDA17
                    , NVL(D.AKCDA18,0) AS AKCDA18
                    , NVL(D.AKCDA1,0) AS AKCDA1
                    , NVL(D.AKCDQ1,0) AS AKCDQ1
                    , NVL(D.AKCDQ0,0) AS AKCDQ0
                    , NVL(D.AKCDQ7,0) AS AKCDQ7
                    , NVL(D.AKDET3,0) AS AKDET3
                    , NVL(D.JASAMT,0) AS JASAMT
                    , NVL(D.AKCDA12,0) AS AKCDA12
                    , NVL(D.AKCDA13,0) AS AKCDA13
                    , NVL(D.AKCDA14,0) AS AKCDA14
                    , NVL(D.AKCDA15,0) AS AKCDA15
                    , NVL(D.AKCDA16,0) AS AKCDA16
                    , NVL(D.AKCDQ5,0) AS AKCDQ5
                    , NVL(D.AKCDQ6,0) AS AKCDQ6
                    , NVL(D.AKCDA19,0) AS AKCDA19
                    , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                    , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                    , NVL(E.JAKCDA12,0) AS JAKCDA12
                    , NVL(E.JAKCDA13,0) AS JAKCDA13
                    , NVL(E.JAKCDA15,0) AS JAKCDA15
                    , NVL(F.AKSD49,0) AS AKSD49
                    , NVL(F.AKSD43,0) AS AKSD43
                    , NVL(F.AKSD26,0) AS AKSD26
                    , NVL(F.AKSD29,0) AS AKSD29
                    , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA12,0) END AS SD26M1
                    , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA13,0) END AS SD26M2
                    , CASE WHEN F.AKSD29 IS NULL THEN 0 ELSE NVL(D.AKCDA15,0) END AS SD26MT
                    , NVL(F.AKSD17,0) AS AKSD17
                    , NVL(F.AKSD50,0) AS AKSD50
                    , NVL(F.AKSD48,0) AS AKSD48
                    , NVL(F.AKSD04,0) AS AKSD04
                    , NVL(F.AKSD15,0) AS AKSD15
                    , NVL(F.AKSD23,0) AS AKSD23
                    , NVL(F.AKSD42,0) AS AKSD42
                    , NVL(F.AKSD31,0) AS AKSD31
                    , NVL(F.AKSD34,0) AS AKSD34
                    , NVL(F.AKSD11,0) AS AKSD11
                    , NVL(F.AKSD08,0) AS AKSD08
                    , NVL(F.AKSD22,0) AS AKSD22
                    , NVL(F.AKSD06,0) AS AKSD06
                    , NVL(F.AKSD13,0) AS AKSD13
                    , NVL(F.AKSD09,0) AS AKSD09
                    , NVL(F.AKSD36,0) AS AKSD36
                    , NVL(F.AKSD05,0) AS AKSD05
                    , NVL(F.AKSD14,0) AS AKSD14
                    , NVL(F.AKSD39,0) AS AKSD39
                    , NVL(F.AKSD18,0) AS AKSD18
                    , NVL(F.AKSD19,0) AS AKSD19
                    , NVL(F.AKSD40,0) AS AKSD40
                    , NVL(F.AKSD16,0) AS AKSD16
                    , NVL(F.AKSD10,0) AS AKSD10
                    , NVL(D.LCCNTT,0) AS LCCNTT
                    , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                    , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                    , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                 FROM TB_OGBS_MM_PRTNR_IZ A
                INNER JOIN TB_OGBS_MM_OG_IZ O
                   ON A.BASE_YM = O.BASE_YM
                  AND A.OG_ID = O.OG_ID
              <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
                  AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
                  AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
              </if>
              <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
                  AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
              </if>
                 LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                   ON A.PRTNR_NO = B.PRTNR_NO
                  AND A.OG_TP_CD = B.OG_TP_CD
                  AND B.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
                 LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                   ON A.PRTNR_NO = C.PRTNR_NO
                  AND C.OG_TP_CD = 'W01'
                  AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
                 LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                   ON A.PRTNR_NO = PM.PRTNR_NO
                  AND A.OG_TP_CD = PM.OG_TP_CD
                  AND A.BASE_YM = PM.BASE_YM
                  AND PM.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                  AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                  AND PM.PERF_AGRG_CRT_DV_CD = '203'  /*P추진단순주문실적생성*/
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(AKCDA17) AS AKCDA17
                                        , SUM(AKCDA18) AS AKCDA18
                                        , SUM(AKCDA1) AS AKCDA1
                                        , SUM(AKCDQ1) AS AKCDQ1
                                        , SUM(AKCDQ0) AS AKCDQ0
                                        , SUM(AKCDQ7) AS AKCDQ7
                                        , SUM(AKDET3) AS AKDET3
                                        , SUM(JASAMT) AS JASAMT
                                        , SUM(AKCDA12) AS AKCDA12
                                        , SUM(AKCDA13) AS AKCDA13
                                        , SUM(AKCDA14) AS AKCDA14
                                        , SUM(AKCDA15) AS AKCDA15
                                        , SUM(AKCDA16) AS AKCDA16
                                        , SUM(AKCDQ5) AS AKCDQ5
                                        , SUM(AKCDQ6) AS AKCDQ6
                                        , SUM(AKCDA19) AS AKCDA19
                                        , SUM(LCCNTT) AS LCCNTT
                                     FROM ( SELECT AK17.PRTNR_NO
                                                 , AK17.OG_TP_CD
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                              FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                             WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                               AND AK17.BASE_YM = #{perfYm}
                                               AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND AK17.PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )D
                   ON A.PRTNR_NO = D.PRTNR_NO
                  AND A.OG_TP_CD = D.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(JAKCDQ0) AS JAKCDQ0
                                        , SUM(JAKCDQ6) AS JAKCDQ6
                                        , SUM(JAKCDA12) AS JAKCDA12
                                        , SUM(JAKCDA13) AS JAKCDA13
                                        , SUM(JAKCDA15) AS JAKCDA15
                                     FROM ( SELECT AK17.PRTNR_NO
                                                 , AK17.OG_TP_CD
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12 /*조직 환경가전 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13 /*조직 환경가전 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15 /*조직 환경가전외 일시불*/
                                              FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                             WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                               AND AK17.BASE_YM = #{perfYm}
                                               AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND AK17.PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )E
                   ON A.PRTNR_NO = E.PRTNR_NO
                  AND A.OG_TP_CD = E.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(M.AKSD49) AS AKSD49
                                        , SUM(M.AKSD43) AS AKSD43
                                        , SUM(M.AKSD26) AS AKSD26
                                        , SUM(M.AKSD29) AS AKSD29
                                        , SUM(M.AKSD17) AS AKSD17
                                        , SUM(M.AKSD50) AS AKSD50
                                        , SUM(M.AKSD48) AS AKSD48
                                        , SUM(M.AKSD04) AS AKSD04
                                        , SUM(M.AKSD15) AS AKSD15
                                        , SUM(M.AKSD23) AS AKSD23
                                        , SUM(M.AKSD42) AS AKSD42
                                        , SUM(M.AKSD31) AS AKSD31
                                        , SUM(M.AKSD34) AS AKSD34
                                        , SUM(M.AKSD11) AS AKSD11
                                        , SUM(M.AKSD08) AS AKSD08
                                        , SUM(M.AKSD22) AS AKSD22
                                        , SUM(M.AKSD06) AS AKSD06
                                        , SUM(M.AKSD13) AS AKSD13
                                        , SUM(M.AKSD09) AS AKSD09
                                        , SUM(M.AKSD36) AS AKSD36
                                        , SUM(M.AKSD05) AS AKSD05
                                        , SUM(M.AKSD14) AS AKSD14
                                        , SUM(M.AKSD39) AS AKSD39
                                        , SUM(M.AKSD18) AS AKSD18
                                        , SUM(M.AKSD19) AS AKSD19
                                        , SUM(M.AKSD40) AS AKSD40
                                        , SUM(M.AKSD16) AS AKSD16
                                        , SUM(M.AKSD10) AS AKSD10
                                     FROM ( SELECT A.PRTNR_NO
                                                 , A.OG_TP_CD
                                                 , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                                 , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                                 , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                                 , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                                 , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                                 , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                                 , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                                 , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                                 , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                                 , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                                 , CASE WHEN A.FEE_CD = 'W020054' THEN A.FEE_ATC_VAL END AS AKSD06  /*추가장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                                 , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                                 , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                                 , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                                 , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                                 , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                                 , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                                 , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                                 , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                                 , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                                 , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                              FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                             WHERE A.DSB_YM = #{perfYm}
                                               AND A.OG_TP_CD = 'W02'
                                               AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                               AND A.FEE_ATC_DV_CD = '01'
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND A.PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                               , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                               , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                               , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                               , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                               , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                               , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041', 'W020054')
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )F
                   ON A.PRTNR_NO = F.PRTNR_NO
                  AND A.OG_TP_CD = F.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                        , E.OG_TP_CD
                                        , SUM(E.INTBS_AMT) AS INTBS_SUM
                                        , SUM(E.DDCTAM) AS DDTN_SUM
                                        , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                     FROM TB_FEAM_FEE_DSB_IZ E
                                    WHERE E.DSB_YM = #{perfYm}
                                      AND E.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND E.PRTNR_NO = #{prtnrNo}
                                  </if>
                                    GROUP BY E.PRTNR_NO, E.OG_TP_CD
                                 )FEE
                   ON A.PRTNR_NO = FEE.PRTNR_NO
                  AND A.OG_TP_CD = FEE.OG_TP_CD
                 LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
                   ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                  AND A.PRTNR_NO = G.PRTNR_NO
                  AND A.OG_TP_CD = G.OG_TP_CD
                  AND G.EDUC_CRSE_NO IN ('11','129','100','106','17','135','96','97','112','113', '98')
                  AND G.EDUC_CPC_ACKMT_YN = 'Y'
                WHERE A.BASE_YM = #{perfYm}
                  AND A.OG_TP_CD = 'W02'
              <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                  AND A.PRTNR_NO = #{prtnrNo}
              </if>
                  AND A.PSTN_DV_CD IN ('7', '15')
               )T
    </select>

    <select id='selectPlannerFees' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , NVL(PM.PERF_VAL,0) AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
                END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                         CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                              WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                              WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , G.IS11EDU /* 플래너스타트업 */
             , G.IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT /*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT /*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT /*업무해약월*/
             , SUBSTR(A.PRFMT_DT,1,6) AS AKSTYM  /*승진월*/
             , H.CV_DT AS LCECAYMD       /*웰스매니저 개시일 */
             , MM.B_AKSD05               /* 정착수수료 = 이전 정착수수료*/
             , NVL(TRUNC(B.AKCDA0,-1),0) AS AKCDA0  /* 가전    */
             , NVL(TRUNC(B.AKCDA1,-1),0) AS AKCDA1  /* 가전외    */
             , NVL(TRUNC(B.AKCDA2,-1),0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(TRUNC(B.AKCDA3,-1),0) AS AKCDA3  /* 환경(정액)  */
             , NVL(TRUNC(B.AKCDA4,-1),0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(TRUNC(B.EC5AMT,-1),0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(TRUNC(D.AKSD23,-1),0) AS AKSD23  /* 정액 수당  */
             , NVL(TRUNC(D.AKSD24,-1),0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(TRUNC(D.AKSD25,-1),0) AS AKSD25  /* 홈케어 수장  */
             , NVL(TRUNC(D.AKSD01,-1),0) AS AKSD01  /* 개인비례 가전 */
             , NVL(TRUNC(D.AKSD02,-1),0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(TRUNC(D.AKSD03,-1),0) AS AKSD03  /* 개인 판매장려 */
             , NVL(TRUNC(D.AKSD21,-1),0) AS AKSD21  /* 개인상조   */
             , NVL(TRUNC(D.AKSD04,-1),0) AS AKSD04  /* 미팅    */
             , NVL(TRUNC(D.AKSD05,-1),0) AS AKSD05  /* 정착    */
             , NVL(TRUNC(D.AKSD20,-1),0) AS AKSD20  /* 재지급    */
             , NVL(TRUNC(D.AKSD30,-1),0) AS AKSD30  /* 기타지원  */
             , NVL(TRUNC(C.INTBS_AMT,-1),0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
            ON A.PRTNR_NO = PM.PRTNR_NO
           AND A.OG_TP_CD = PM.OG_TP_CD
           AND A.BASE_YM = PM.BASE_YM
           AND PM.FEE_TCNT_DV_CD = #{feeTcntDvCd}
           AND PM.PERF_ATC_CD = 'W01P00012'    /* 미팅참석일수 */
           AND PM.PERF_AGRG_CRT_DV_CD = '101'  /* P추진단미팅실적생성 */
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND FEE_ATC_DV_CD = '01'
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010023'
                                                     , 'W010123', 'W010024', 'W010124', 'W010025', 'W010125')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                  UNION ALL
                                 SELECT PRTNR_NO
                                      , 0 AS P_CNT
                                      , COUNT(1) AS G_CNT
                                   FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                  WHERE BASE_YM = #{perfYm}
                                    AND CAN_DT = 0
                                    AND FLPYM_TN > 1
                                    AND LIF_CNTR_STAT_CD = 0
                                  GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(IS11EDU) AS IS11EDU
                                 , MAX(IS17EDU) AS IS17EDU
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN EDUC_CRSE_NO = '14' THEN EDUC_CRSE_CRT_BASE_YM END AS IS11EDU
                                          , CASE WHEN EDUC_CRSE_NO = '19' THEN EDUC_CRSE_CRT_BASE_YM END AS IS17EDU
                                       FROM TB_PSCA_MCPTN_EDUC_IZ
                                      WHERE EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND EDUC_CRSE_NO IN ('14','19')
                                        AND EDUC_CPC_ACKMT_YN = 'Y'
                                   )
                             GROUP BY PRTNR_NO
                          )G
            ON A.PRTNR_NO = G.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(CV_DT) AS CV_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                             WHERE OG_TP_CD = 'W02'
                               AND QLF_DV_CD = '3'  /* 웰스매니저 */
                               AND QLF_APLC_DV_CD = '1'  /* 승급 */
                               AND DTA_DL_YN = 'N'
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )H
            ON A.PRTNR_NO = H.PRTNR_NO
          LEFT OUTER JOIN ( SELECT T1.PRTNR_NO
                                 , NVL(SUM(T1.B_AKSD05),0) AS B_AKSD05
                              FROM ( SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND OG_TP_CD = 'W01' /*P조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분=2차확정*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W010005', 'W010105')
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND DSB_YM &gt;= '201904'
                                        AND OG_TP_CD = 'W02' /*M조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )T1
                              INNER JOIN ( SELECT PRTNR_NO
                                                , SUBSTR(MAX(CV_DT),1,6) AS CV_DT /*수석플래너 전환년월*/
                                             FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                                            WHERE OG_TP_CD = 'W01'
                                              AND QLF_DV_CD = '1'  /* 수석플래너 */
                                              AND QLF_APLC_DV_CD = '1'  /* 승급 */
                                              AND DTA_DL_YN = 'N'
                                            GROUP BY PRTNR_NO
                                         )T2
                                ON T1.PRTNR_NO = T2.PRTNR_NO
                             WHERE T1.DSB_YM &lt; NVL(T2.CV_DT,'000001')     /*수석플래너등록 이전*/
                             GROUP BY T1.PRTNR_NO
                          )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND A.PRTNR_NO = #{prtnrNo}
       </if>
           AND A.PSTN_DV_CD = '15'
    </select>
    <select id='selectPlannerBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarBrmgrRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , '플래너지점장' AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '플래너지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT     /*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /*최초업무등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종 해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT     /*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN G.EDUC_CRSE_NO = '19' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS17EDU /* 수석(플래너)실전 */
             , CASE WHEN A.DMTN_DT > 0 THEN SUBSTR(A.DMTN_DT,1,6)
                    ELSE CASE WHEN AA.DMTN_DT > 0 THEN SUBSTR(AA.DMTN_DT,1,6) ELSE '' END
               END AS AKDRIY                    /* 승진월     */
             , SUBSTR(PAI.UPGR_YM,1,6) AS AKSTYM  /*수석승급월*/
             , A.FST_CNTR_DT AS LCECAYMD /*웰스매니저 개시일 LC1700P 정리되지 않아 임시처리 */
             , NVL(TRUNC(B.AKCDA0,-1),0) AS AKCDA0  /* 가전    */
             , NVL(TRUNC(B.AKCDA1,-1),0) AS AKCDA1  /* 가전외    */
             , NVL(TRUNC(B.AKCDA2,-1),0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(TRUNC(B1.AKCDA0,-1),0) AS AKCDAG0  /* 지점 가전    */
             , NVL(TRUNC(B1.AKCDA1,-1),0) AS AKCDAG1  /* 지점 가전외    */
             , NVL(TRUNC(B1.AKSQ02,-1),0) AS AKSQG02  /* 지점 상조    */
             , NVL(TRUNC(B.AKCDA3,-1),0) AS AKCDA3  /* 환경(정액)  */
             , NVL(TRUNC(B.AKCDA4,-1),0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(TRUNC(B.EC5AMT,-1),0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(TRUNC(D.AKSD23,-1),0) AS AKSD23  /* 정액 수당  */
             , NVL(TRUNC(D.AKSD24,-1),0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(TRUNC(D.AKSD25,-1),0) AS AKSD25  /* 홈케어 수장  */
             , NVL(TRUNC(D.AKSD01,-1),0) AS AKSD01  /* 개인비례 가전 */
             , NVL(TRUNC(D.AKSD02,-1),0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(TRUNC(D.AKSD03,-1),0) AS AKSD03  /* 개인 판매장려 */
             , NVL(TRUNC(D.AKSD11,-1),0) AS AKSD11  /* 가전조직비례 */
             , NVL(TRUNC(D.AKSD12,-1),0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(TRUNC(D.AKSD13,-1),0) AS AKSD13  /* 조직판매장려 */
             , NVL(TRUNC(D.AKSD05,-1),0) AS AKSD05  /* 정착수수료 */
             , NVL(TRUNC(D.AKSD16,-1),0) AS AKSD16  /* 조직배출1 */
             , NVL(TRUNC(D.AKSD17,-1),0) AS AKSD17  /* 조직배출2 */
             , NVL(TRUNC(D.AKSD18,-1),0) AS AKSD18  /* 승진수수료 */
             , NVL(TRUNC(D.AKSD15,-1),0) AS AKSD15  /* 신설 */
             , NVL(TRUNC(D.AKSD20,-1),0) AS AKSD20  /* 재지급    */
             , NVL(TRUNC(D.AKSD21,-1),0) AS AKSD21  /* 개인상조   */
             , NVL(TRUNC(D.AKSD22,-1),0) AS AKSD22  /* 지점장상조   */
             , NVL(TRUNC(D.AKSD30,-1),0) AS AKSD30  /* 기타지원  */
             , NVL(TRUNC(C.INTBS_AMT,-1),0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                          </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                        AND AK17.PERF_ATC_CD IN ( 'W01P00001' , 'W01P00004' , 'W00P00028' , 'W00P00029' , 'W00P00030'
                                                                , 'W00P00009' , 'W01P00016' , 'W01P00018'
                                                                )
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00010' THEN PERF_VAL END AS AKSQ02   /* 상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                     )M
                                GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
        LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                               , MAX(UPGR_YM) AS UPGR_YM
                            FROM TB_OGPS_TOPMR_PLAR_APLC_IZ A  /* 수석플래너신청내역 */
                           WHERE A.OG_TP_CD = 'W01'
                             AND A.QLF_DV_CD = '1'  /* 수석플래너 */
                             AND A.UPGR_DMTN_DV_CD = '1' /* 승급 */
                        <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                             AND A.PRTNR_NO = #{prtnrNo}
                        </if>
                           GROUP BY A.PRTNR_NO
                        )PAI
          ON A.PRTNR_NO = PAI.PRTNR_NO
        LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
          ON A.PRTNR_NO = C.PRTNR_NO
         AND A.BASE_YM = C.DSB_YM
         AND A.OG_TP_CD = C.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
        LEFT OUTER JOIN ( SELECT PRTNR_NO
                               , DSB_YM
                               , CO_CD
                               , OG_TP_CD
                               , FEE_TCNT_DV_CD
                               , SPMT_DSB_DV_CD
                               , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                               , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                               , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                               , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                               , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                               , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                               , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                               , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                               , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                               , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                               , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                               , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                               , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착 */
                               , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료 */
                               , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                               , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                               , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                               , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                            FROM ( SELECT PRTNR_NO
                                        , DSB_YM
                                        , CO_CD
                                        , OG_TP_CD
                                        , FEE_TCNT_DV_CD
                                        , SPMT_DSB_DV_CD
                                        , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                        , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                        , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                        , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                        , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                        , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                        , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                        , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                        , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                        , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD05 /* 정착    */
                                        , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                        , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                        , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                        , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18                         /* 승진수수료 */
                                        , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                        , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                        , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                        , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                     FROM TB_FEAM_FEE_DSB_DTL_IZ
                                    WHERE DSB_YM = #{perfYm}
                                      AND OG_TP_CD = 'W01'
                                      AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                      AND FEE_ATC_DV_CD = '01'
                                 <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND PRTNR_NO = #{prtnrNo}
                                 </if>
                                      AND FEE_CD IN ('W010023', 'W010123', 'W010024', 'W010124', 'W010025', 'W010125', 'W010001', 'W010101', 'W010118'
                                                   , 'W010002', 'W010102', 'W010003', 'W010103', 'W010011', 'W010012', 'W010013', 'W010016', 'W010018'
                                                   , 'W010017', 'W010015',  'W010020', 'W010120', 'W010021', 'W010021', 'W010022', 'W010030', 'W010130'
                                                   , 'W010005', 'W010105' )
                                 )
                           GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                        )D
          ON C.PRTNR_NO = D.PRTNR_NO
         AND C.DSB_YM = D.DSB_YM
         AND C.OG_TP_CD = D.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
         AND C.CO_CD = D.CO_CD
         AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
        LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                               , SUM(Z.P_CNT) AS P_CNT
                               , SUM(Z.G_CNT) AS G_CNT
                            FROM ( SELECT PRTNR_NO
                                        , COUNT(1) AS P_CNT
                                        , 0 AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT = 0
                                      AND FLPYM_TN = 1
                                      AND LIF_CNTR_STAT_CD = 0
                                    GROUP BY PRTNR_NO
                                    UNION ALL
                                   SELECT PRTNR_NO
                                        , 0 AS P_CNT
                                        , COUNT(1) AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT = 0
                                      AND FLPYM_TN > 1
                                      AND LIF_CNTR_STAT_CD = 0
                                    GROUP BY PRTNR_NO
                                 ) Z GROUP BY Z.PRTNR_NO
                        ) EE
          ON A.PRTNR_NO = EE.PRTNR_NO
        LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                               , SUM(RUNCNT) AS RUNCNT
                               , SUM(GADCNT) AS GADCNT
                            FROM ( SELECT A.PRTNR_NO
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                     FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                    WHERE A.BASE_YM = #{perfYm}
                                      AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                      AND A.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                      AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035')
                                      AND A.CO_CD = '2000'
                                      AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                 <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND A.PRTNR_NO = #{prtnrNo}
                                 </if>
                                      AND A.PERF_VAL > 0
                                 )M
                           GROUP BY M.PRTNR_NO
                        ) P_CNT
          ON A.PRTNR_NO = P_CNT.PRTNR_NO
        LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
          ON A.PRTNR_NO = F.PRTNR_NO
         AND A.OG_TP_CD = F.OG_TP_CD
         AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
        LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
          ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
         AND A.PRTNR_NO = G.PRTNR_NO
         AND A.OG_TP_CD = G.OG_TP_CD
         AND G.EDUC_CRSE_NO IN ('14','19')
         AND G.EDUC_CPC_ACKMT_YN = 'Y'
       WHERE A.BASE_YM = #{perfYm}
         AND A.OG_TP_CD = 'W01' /*P조직*/
    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
         AND A.PRTNR_NO = #{prtnrNo}
    </if>
         AND A.PSTN_DV_CD = 7
    </select>

    <select id='selectPlannerTotalFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarTotalRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(P_CNT.AKCUIL,0)
                    ELSE 0
               END AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
               END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                    END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , G.IS11EDU /* 플래너스타트업 */
             , G.IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT/*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT/*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT/*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT/*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT/*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN A.PSTN_DV_CD = 7 AND A.DMTN_DT > 0 THEN SUBSTR(A.DMTN_DT,1,6)
                    ELSE CASE WHEN A.PSTN_DV_CD = 7 AND AA.DMTN_DT > 0 THEN SUBSTR(AA.DMTN_DT,1,6)
                              ELSE ''
                         END
               END AS AKDRIY                    /* 승진월     */
             , NVL(SUBSTR(A.PRFMT_DT,1,6),0) AS AKSTYM  /*수석승급일*/
             , H.CV_DT AS LCECAYMD       /*웰스매니저 개시일 */
             , MM.B_AKSD05               /* 정착수수료 = 이전 정착수수료*/
             , NVL(TRUNC(B.AKCDA0,-1),0) AS AKCDA0        /* 가전    */
             , NVL(TRUNC(B.AKCDA1,-1),0) AS AKCDA1        /* 가전외    */
             , NVL(TRUNC(B.AKCDA2,-1),0) AS AKCDA2        /* 기변    */
             , NVL(EE.P_CNT, 0) AS AKSQ01       /* 당월 상조  */
             , NVL(EE.G_CNT, 0) AS N_AKSQ01     /* 상조 유지  */
             , NVL(TRUNC(B1.AKCDA0,-1),0) AS AKCDAG0      /* 지점 가전    */
             , NVL(TRUNC(B1.AKCDA1,-1),0) AS AKCDAG1      /* 지점 가전외    */
             , NVL(B1.AKSQ02,0) AS AKSQG02      /* 지점 상조    */
             , NVL(TRUNC(B.AKCDA3,-1),0) AS AKCDA3        /* 환경(정액)  */
             , NVL(TRUNC(B.AKCDA4,-1),0) AS AKCDA4        /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5        /* 라이브팩 건수 */
             , NVL(TRUNC(B.EC5AMT,-1),0) AS EC5AMT        /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT    /* 관리상품 판매건수 */
             , NVL(TRUNC(D.AKSD23,-1),0) AS AKSD23 /* 정액수수료 */
             , NVL(TRUNC(D.AKSD24,-1),0) AS AKSD24 /* 라이브팩 수당 */
             , NVL(TRUNC(D.AKSD25,-1),0) AS AKSD25  /* 홈케어 수장  */
             , NVL(TRUNC(D.AKSD01,-1),0) AS AKSD01  /* 개인비례 가전 */
             , NVL(TRUNC(D.AKSD02,-1),0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(TRUNC(D.AKSD03,-1),0) AS AKSD03  /* 개인 판매장려 */
             , NVL(TRUNC(D.AKSD21,-1),0) AS AKSD21  /* 개인상조   */
             , NVL(TRUNC(D.AKSD04,-1),0) AS AKSD04  /* 미팅    */
             , NVL(TRUNC(D.AKSD05,-1),0) AS AKSD05  /* 정착    */
             , NVL(TRUNC(D.AKSD20,-1),0) AS AKSD20  /* 재지급    */
             , NVL(TRUNC(D.AKSD30,-1),0) AS AKSD30  /* 기타지원  */
             , NVL(TRUNC(D.AKSD11,-1),0) AS AKSD11  /* 가전조직비례 */
             , NVL(TRUNC(D.AKSD12,-1),0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(TRUNC(D.AKSD13,-1),0) AS AKSD13  /* 조직판매장려 */
             , NVL(TRUNC(D.AKSD16,-1),0) AS AKSD16  /* 조직배출1 */
             , NVL(TRUNC(D.AKSD17,-1),0) AS AKSD17  /* 조직배출2 */
             , NVL(TRUNC(D.AKSD15,-1),0) AS AKSD15  /* 신설 */
             , NVL(TRUNC(D.AKSD18,-1),0) AS AKSD18  /* 승진수수료 */
             , NVL(TRUNC(D.AKSD22,-1),0) AS AKSD22  /* 지점장상조   */
             , NVL(TRUNC(C.INTBS_AMT,-1),0) AS AKSD99 /* 과표합계 */
             , NVL(TRUNC(C.DDCTAM,-1),0) AS DDCTAM     /* 공제 */
             , NVL(TRUNC(C.DSB_OJ_AMT,-1),0) AS DSB_OJ_AMT /* 실지급 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00010' THEN PERF_VAL END AS AKSQ02   /* 상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                                 , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                                 , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                                 , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                                 , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                                 , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                                 , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                                 , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액수수료   */
                                 , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료   */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                          , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                          , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                          , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                          , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                          , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                          , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                          , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD23 /* 정액수수료  */
                                          , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18 /* 승진수수료  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND FEE_ATC_DV_CD = '01'
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010024'
                                                     , 'W010124', 'W010025', 'W010125', 'W010011', 'W010012', 'W010013', 'W010016', 'W010017'
                                                     , 'W010015',  'W010022', 'W010023', 'W010123', 'W010018', 'W010118')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , 0 AS P_CNT
                                          , COUNT(1) AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN > 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , SUM(RUNCNT) AS RUNCNT
                                 , SUM(GADCNT) AS GADCNT
                                 , SUM(AKCUIL) AS AKCUIL
                              FROM ( SELECT A.PRTNR_NO
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00012' THEN PERF_VAL END AS AKCUIL   /* 미팅참석일수 */
                                       FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                      WHERE A.BASE_YM = #{perfYm}
                                        AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND A.PERF_AGRG_CRT_DV_CD IN ('101','103') /* P추진단순주문실적생성, P조직미팅참석집계 */
                                        AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035', 'W01P00012')
                                        AND A.CO_CD = '2000'
                                        AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND A.PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND A.PERF_VAL > 0
                                   )M
                             GROUP BY M.PRTNR_NO
                          ) P_CNT
            ON A.PRTNR_NO = P_CNT.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(IS11EDU) AS IS11EDU
                                 , MAX(IS17EDU) AS IS17EDU
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN EDUC_CRSE_NO = '14' THEN EDUC_CRSE_CRT_BASE_YM END AS IS11EDU
                                          , CASE WHEN EDUC_CRSE_NO = '19' THEN EDUC_CRSE_CRT_BASE_YM END AS IS17EDU
                                       FROM TB_PSCA_MCPTN_EDUC_IZ
                                      WHERE EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND EDUC_CRSE_NO IN ('14','19')
                                        AND EDUC_CPC_ACKMT_YN = 'Y'
                                   )
                             GROUP BY PRTNR_NO
                          )G
            ON A.PRTNR_NO = G.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(CV_DT) AS CV_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                             WHERE OG_TP_CD = 'W02'
                               AND QLF_DV_CD = '3'  /* 웰스매니저 */
                               AND QLF_APLC_DV_CD = '1'  /* 승급 */
                               AND DTA_DL_YN = 'N'
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )H
            ON A.PRTNR_NO = H.PRTNR_NO
          LEFT OUTER JOIN ( SELECT T1.PRTNR_NO
                                 , NVL(SUM(T1.B_AKSD05),0) AS B_AKSD05
                              FROM ( SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND OG_TP_CD = 'W01' /*P조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분=2차확정*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W010005', 'W010105')
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND DSB_YM &gt;= '201904'
                                        AND OG_TP_CD = 'W02' /*M조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )T1
                              INNER JOIN ( SELECT PRTNR_NO
                                                , SUBSTR(MAX(CV_DT),1,6) AS CV_DT /*수석플래너 전환년월*/
                                             FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                                            WHERE OG_TP_CD = 'W01'
                                              AND QLF_DV_CD = '1'  /* 수석플래너 */
                                              AND QLF_APLC_DV_CD = '1'  /* 승급 */
                                              AND DTA_DL_YN = 'N'
                                            GROUP BY PRTNR_NO
                                         )T2
                                ON T1.PRTNR_NO = T2.PRTNR_NO
                             WHERE T1.DSB_YM &lt; NVL(T2.CV_DT,'000001')     /*수석플래너등록 이전*/
                             GROUP BY T1.PRTNR_NO
                          )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND A.PRTNR_NO = #{prtnrNo}
       </if>
           AND ( A.PSTN_DV_CD = 7 OR A.PSTN_DV_CD = 15 )
    </select>

    <select id='selectWmFees' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchWmRes">
    SELECT '서울총괄단' AS COL1
        , '서울지역단' AS COL2
        , '김웰스지점' AS COL3
        , '1673419' AS COL4
        , '김교원' AS COL5
        , '플래너' AS COL6
        , 34 AS COL7
        , '2019-03' AS COL8
        , '-' AS COL9
        , '2014-10' AS COL10
        , 56 AS COL11
        , '미지급' AS COL12
        , 123456000 AS COL13
        , 2 AS COL14
        , 3 AS COL15
        , 0 AS COL16
        , 12 AS COL17
        , 81 AS COL18
        , 0 AS COL19
        , 129 AS COL20
        , 1234500 AS COL21
        , 100 AS COL22
        , 1234500 AS COL23
        , 0 AS COL24
        , 0 AS COL25
        , 0 AS COL26
        , 0 AS COL27
        , 0 AS COL28
        , 0 AS COL29
        , 34000 AS COL30
        , 0 AS COL31
        , 0 AS COL32
        , 0 AS COL33
        , 123450 AS COL34
        , 0 AS COL35
        , 123 AS COL36
        , 'N' AS COL37
        , 'N' AS COL38
        , 15 AS COL39
        , 'N' AS COL40
      FROM DUAL
    UNION ALL
    SELECT '경기총괄단' AS COL1
        , '경기지역단' AS COL2
        , '박웰스지점' AS COL3
        , '1673419' AS COL4
        , '박교원' AS COL5
        , '플래너' AS COL6
        , 34 AS COL7
        , '2019-03' AS COL8
        , '-' AS COL9
        , '2014-10' AS COL10
        , 56 AS COL11
        , '미지급' AS COL12
        , 123456000 AS COL13
        , 2 AS COL14
        , 3 AS COL15
        , 0 AS COL16
        , 12 AS COL17
        , 81 AS COL18
        , 0 AS COL19
        , 129 AS COL20
        , 1234500 AS COL21
        , 100 AS COL22
        , 1234500 AS COL23
        , 0 AS COL24
        , 0 AS COL25
        , 0 AS COL26
        , 0 AS COL27
        , 0 AS COL28
        , 0 AS COL29
        , 34000 AS COL30
        , 0 AS COL31
        , 0 AS COL32
        , 0 AS COL33
        , 123450 AS COL34
        , 0 AS COL35
        , 123 AS COL36
        , 'N' AS COL37
        , 'N' AS COL38
        , 15 AS COL39
        , 'N' AS COL40
      FROM DUAL
    </select>

</mapper>
