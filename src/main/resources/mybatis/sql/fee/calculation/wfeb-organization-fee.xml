<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.fee.calculation.mapper.WfebOrganizationFeeMapper">

    <select id='selectHomeMasterFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstRes">
        SELECT B.DGR1_LEVL_OG_NM    /*지역단*/
             , B.DGR2_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , FLOOR(MONTHS_BETWEEN (#{perfYm}||'01',A.CNTR_DT)) +1 AS AKDCHA    /* 차월 */
             , A.PRTNR_GD_CD  /* 급수 */
             , G.EDUC_CRSE_CRT_BASE_YM AS EDU100            /*신입입문교육*/
             , NVL(D.AKCDA10,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA12,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , C.LCCNT1     /* 배정건수 */
             , C.C_LCCNT1   /* 취소건수 */
             , C.R_LCCNT1   /* 실배정건 */
             , C.GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , C.ELECNT     /* 가전 건수 */
             , C.SERCNT     /* 총 서비스건수 */
             , C.SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test="ogLevl2 != null and ogLevl2 != ''">
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2}
       </if>
       <if test="ogLevl3 != null and ogLevl3 != ''">
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                               <if test="no != null and no != ''">
                                    AND AK17.PRTNR_NO = #{no}
                               </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(LCCNT1) AS LCCNT1
                             , SUM(C_LCCNT1) AS C_LCCNT1
                             , SUM(LCCNT1) - SUM(C_LCCNT1) AS R_LCCNT1
                             , SUM(GD_LCCNT2) + SUM(GD_LCCNT3) AS GD_SERCNT
                             , SUM(EL_LCCNT2) + SUM(EL_LCCNT3) AS ELECNT
                             , SUM(LCCNT2) + SUM(LCCNT3) AS SERCNT
                             , SUM(LCRAT1) AS SERRYL
                          FROM ( SELECT PRTNR_NO
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN PERF_VAL END AS LCCNT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999902' THEN PERF_VAL END AS LCCNT2
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999903' THEN PERF_VAL END AS LCCNT3
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999906' THEN PERF_VAL END AS LCRAT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'SV01139902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01159902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01129902' ) THEN PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'SV01139903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01159903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01129903' ) THEN PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'SV01199902' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01029902' ) THEN PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN ( PRTNR_SV_PERF_ATC_CD = 'SV01199903' OR
                                                    PRTNR_SV_PERF_ATC_CD = 'SV01029903' ) THEN PERF_VAL END AS EL_LCCNT3
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                  WHERE BASE_YM = #{perfYm}
                               <if test="no != null and no != ''">
                                    AND PRTNR_NO = #{no}
                               </if>
                                    AND CL_DV_CD = '02'
                                    AND OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                    AND A.OG_TP_CD = 'W03'
                                    AND A.FEE_TCNT_DV_CD = '02'
                                <if test="no != null and no != ''">
                                    AND A.PRTNR_NO = #{no}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030003', 'W030004', 'W030015', 'W030005', 'W030006'
                                                    , 'W030007', 'W030009', 'W030010', 'W030011', 'W030013', 'W030014'
                                                    , 'W030051', 'W030052', 'W030053', 'W030054', 'W030055', 'W030056' )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                      <if test="no != null and no != ''">
                           AND A.PRTNR_NO = #{no}
                      </if>
                           AND A.OG_TP_CD = 'W03'
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
        ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = G.PRTNR_NO
       AND G.EDUC_CRSE_NO = '124'
       AND G.EDUC_CPC_ACKMT_YN = 'Y'
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'
   <if test="no != null and no != ''">
       AND A.PRTNR_NO = #{no}
   </if>
       AND A.RSB_DV_CD = 'W0302'
    </select>


    <select id='selectHomeMasterBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstBrmgrRes">
        SELECT B.DGR1_LEVL_OG_NM    /*지역단*/
             , B.DGR2_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , FLOOR(MONTHS_BETWEEN (#{perfYm}||'01',A.CNTR_DT)) +1 AS AKDCHA    /* 차월 */
             , A.PRTNR_GD_CD  /* 급수 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN 1 ELSE 0 END AS ATCNT1 /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN 1 ELSE 0 END AS ATCNT2 /* 교육수료일수 동행교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS124EDU /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS125EDU /* 교육수료일수동행교육 */
             , NVL(D.AKCDA10,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA12,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , C.LCCNT1     /* 배정건수 */
             , C.C_LCCNT1   /* 취소건수 */
             , C.R_LCCNT1   /* 실배정건 */
             , C.GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , C.ELECNT     /* 가전 건수 */
             , C.SERCNT     /* 총 서비스건수 */
             , C.SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , G.GADCNT AS GADCNT   /* 실활동인원 */
             , G.J_AKDEQ0    /* 인정건수 */
             , G.J_SERCNT    /* 서비스건수 */
             , NVL(E.AKSD51,0) AS AKSD51   /* 렌탈 */
             , NVL(E.AKSD52,0) AS AKSD52   /* 일시불/할부 */
             , NVL(E.AKSD53,0) AS AKSD53   /* 판매연계 */
             , NVL(E.AKSD54,0) AS AKSD54   /* 조직관리 */
             , NVL(E.AKSD55,0) AS AKSD55   /* 신규판매 */
             , NVL(E.AKSD56,0) AS AKSD56   /* 서비스연계 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test="ogLevl2 != null and ogLevl2 != ''">
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2}
       </if>
       <if test="ogLevl3 != null and ogLevl3 != ''">
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                <if test="no != null and no != ''">
                                    AND AK17.PRTNR_NO = #{no}
                                </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(LCCNT1) AS LCCNT1
                             , SUM(C_LCCNT1) AS C_LCCNT1
                             , SUM(LCCNT1) - SUM(C_LCCNT1) AS R_LCCNT1
                             , SUM(GD_LCCNT2) + SUM(GD_LCCNT3) AS GD_SERCNT
                             , SUM(EL_LCCNT2) + SUM(EL_LCCNT3) AS ELECNT
                             , SUM(LCCNT2) + SUM(LCCNT3) AS SERCNT
                             , SUM(LCRAT1) AS SERRYL
                          FROM ( SELECT PRTNR_NO
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN PERF_VAL END AS LCCNT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999902' THEN PERF_VAL END AS LCCNT2
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999903' THEN PERF_VAL END AS LCCNT3
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999906' THEN PERF_VAL END AS LCRAT1
                                      , CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'SV01139902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01159902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01129902' ) THEN PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'SV01139903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01159903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01129903' ) THEN PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'SV01199902' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01029902' ) THEN PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN (PRTNR_SV_PERF_ATC_CD = 'SV01199903' OR
                                                   PRTNR_SV_PERF_ATC_CD = 'SV01029903' ) THEN PERF_VAL END AS EL_LCCNT3
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                  WHERE BASE_YM = #{perfYm}
                                <if test="no != null and no != ''">
                                    AND PRTNR_NO = #{no}
                                </if>
                                    AND CL_DV_CD = '02'
                                    AND OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                             , SUM(M.AKSD51) AS AKSD51
                             , SUM(M.AKSD52) AS AKSD52
                             , SUM(M.AKSD53) AS AKSD53
                             , SUM(M.AKSD54) AS AKSD54
                             , SUM(M.AKSD55) AS AKSD55
                             , SUM(M.AKSD56) AS AKSD56
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                      , CASE WHEN A.FEE_CD = 'W030071' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD51
                                      , CASE WHEN A.FEE_CD = 'W030072' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD52
                                      , CASE WHEN A.FEE_CD = 'W030073' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD53
                                      , CASE WHEN A.FEE_CD = 'W030075' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD54
                                      , CASE WHEN A.FEE_CD = 'W030074' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD55
                                      , CASE WHEN A.FEE_CD = 'W030076' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD56
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                    AND A.OG_TP_CD = 'W03'
                                    AND A.FEE_TCNT_DV_CD = '02'
                                <if test="no != null and no != ''">
                                    AND A.PRTNR_NO = #{no}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030051', 'W030002', 'W030003', 'W030052'
                                                    , 'W030053', 'W030004', 'W030054', 'W030005', 'W030055'
                                                    , 'W030006', 'W030056', 'W030007', 'W030057', 'W030008'
                                                    , 'W030009', 'W030058', 'W030059', 'W030010', 'W030060'
                                                    , 'W030011', 'W030061', 'W030012', 'W030062', 'W030014'
                                                    , 'W030064', 'W030015', 'W030065', 'W030071', 'W030072'
                                                    , 'W030073', 'W030075', 'W030074', 'W030076' )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                           AND A.OG_TP_CD = 'W03'
                       <if test="no != null and no != ''">
                           AND A.PRTNR_NO = #{no}
                       </if>
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN ( SELECT AK05.PRTNR_NO /* 지점장 사번 */
                             , COUNT(CASE WHEN AK17.AKDEQ0 > 0 AND BS.SERCNT >= 50 THEN 1 END) GADCNT   /* 실가동 인원 */
                             , SUM(NVL(AK17.AKDEQ0,0)) J_AKDEQ0 /* 지점 실적 */
                             , SUM(NVL(BS.SERCNT,0)) J_SERCNT   /* 지점 서비스 횟수 */
                          FROM ( SELECT B.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                                   FROM TB_OGBS_MM_PRTNR_IZ A
                                  INNER JOIN TB_OGBS_MM_OG_IZ B
                                     ON A.BASE_YM = B.BASE_YM
                                    AND A.OG_ID = B.OG_ID
                                  WHERE A.BASE_YM = #{perfYm}
                                <if test="no != null and no != ''">
                                    AND A.PRTNR_NO = #{no}
                                </if>
                                    AND A.OG_TP_CD = 'W03'
                                    AND A.PSTN_DV_CD = 15
                                  GROUP BY B.DGR3_LEVL_DG_PRTNR_NO
                               )AK05
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS AKDEQ0
                                              FROM TB_FEAM_NTORP_PERF_MM_CL   /*순주문 파트너 실적 월마감*/
                                             WHERE FEE_TCNT_DV_CD = #{schOrdr}
                                               AND BASE_YM = #{perfYm}
                                               AND PERF_DV_CD = 2   /*개인판매*/
                                           <if test="no != null and no != ''">
                                               AND PRTNR_NO = #{no}
                                           </if>
                                               AND OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                                               AND PERF_ATC_CD = 'W03P00002' /* 판매인정건수 */
                                             GROUP BY PRTNR_NO
                                          ) AK17
                            ON AK05.PRTNR_NO = AK17.PRTNR_NO
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS SERCNT
                                              FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                             WHERE BASE_YM = #{perfYm}
                                           <if test="no != null and no != ''">
                                               AND PRTNR_NO = #{no}
                                           </if>
                                               AND CL_DV_CD = '02'
                                               AND OG_TP_CD = 'W03'
                                             GROUP BY PRTNR_NO
                                          )BS
                            ON AK05.PRTNR_NO = BS.PRTNR_NO
                         GROUP BY AK05.PRTNR_NO
                      )G
        ON A.PRTNR_NO = G.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG H
        ON A.BASE_YM = H.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = H.PRTNR_NO
       AND H.EDUC_CRSE_NO IN ('124','125')
       AND H.EDUC_CPC_ACKMT_YN = 'Y'
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'
   <if test="no != null and no != ''">
       AND A.PRTNR_NO = #{no}
   </if>
       AND A.RSB_DV_CD = 'W0301'
    </select>


    <select id='selectManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerRes">
        SELECT T.OG_NM       /*소속*/
             , T.PRTNR_NO    /*번호*/
             , T.PRTNR_KNM   /*성명*/
             , T.RSB_DV_CD   /*직책*/
             , T.AKCUIL      /*미팅일수*/
             , T.AKDMI3 	 /*  자격 수수료월    */
             , T.AKDMI32     /*  자격M+1    */
             , CASE WHEN SUBSTR(T.OG_ID,0,1) != 'P' THEN CASE WHEN T.EDU096 != '' AND T.EDU097 != '' THEN T.EDU097 ELSE '' END
                    WHEN SUBSTR(T.OG_ID,0,1) = 'P'  THEN CASE WHEN T.EDU112 != '' AND T.EDU113 != '' THEN T.EDU113 ELSE '' END
                    ELSE ''
               END EDUSTR    /* 스타트업 매니저 */
             , T.EDU011
             , T.EDU129
             , T.EDU106
             , T.AKDCHA		 /*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
             , T.EDU017
             , T.OJTCNT      /*OJT일수   AB2610P KSS 데이터 미정으로 일단 해당 교육번호 98로 임시처리*/
             , T.AKDSYM		 /*등록기준월*/
             , T.AKDENM		 /*최초업무등록월*/
             , T.AKDJEM		 /*재등록월*/
             , T.AKDLYM		 /*최종해약월*/
             , T.AKDCYM		 /*업무해약월*/
             , T.AKDRYM		 /*승진월*/
             , T.SUSTYM		 /*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
             , T.SUSCYM		 /*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
             , T.LCCOYM		 /*WM개시 LC1700P 정리안됨 임시처리*/
             , T.LCCCYM		 /*WM해약 LC1700P 정리안됨 임시처리*/
             , T.DALSYN		 /*실활동달성 AB8050P 정리안됨 임시처리*/
             , T.BONDALSYN	 /*최소기준달성 AB8050P 정리안됨 임시처리*/
             , T.SUNGNM		 /*전월대비구분 AB8050P 정리안됨 임시처리*/
             , T.WPSCNT		 /*WP AB8050P 정리안됨 임시처리*/
             , T.WMSCNT		 /*WM AB8050P 정리안됨 임시처리*/
             , T.SPSCNT		 /*SP AB8050P 정리안됨 임시처리*/
             , T.DANCNT		 /*총인원 AB8050P 정리안됨 임시처리*/
             , T.AKCDA17	 /*인정실적 렌탈*/
             , T.AKCDA18	 /*인정실적 일시불*/
             , T.AKCDA1		 /*인정실적 환경가전외*/
             , T.AKCDQ1		 /*가전순주문건수*/
             , T.AKCDQ0		 /*개인가전인정건수*/
             , T.AKCDQ7		 /*개인BS인정건수*/
             , T.AKDET3		 /*가전기변건수*/
             , T.JASAMT		 /*가전기변금액*/
             , T.AKCDA12	 /*환경가전 렌탈*/
             , T.AKCDA13	 /*환경가전 일시불*/
             , T.AKCDA14	 /*환경가전 정액*/
             , T.AKCDA15	 /*환경가전외 일시불*/
             , T.AKCDA16	 /*환경가전외 정액*/
             , T.AKCDQ5		 /*라이브팩건수*/
             , T.AKCDQ6		 /*개인신규판매건수*/
             , T.AKCDA19	 /*홈케어판매가*/
             , T.JAKCDQ0	 /*조직가전인정건수*/
             , T.JAKCDQ6	 /*조직신규판매건수*/
             , T.JAKCDA12	 /*조직 환경가전렌탈*/
             , T.JAKCDA13	 /*조직 환경가전 일시불*/
             , T.JAKCDA15	 /*조직 환경가전외 일시불*/
             , T.AKSD49      /*홈케어*/
             , T.AKSD43      /*라이브팩*/
             , T.AKSD26      /*가전비례*/
             , T.AKSD29      /*가전외비례*/
             , T.SD26M1      /*가전미팅*/
             , T.SD26M2      /*일시불미팅*/
             , T.SD26MT      /*가전외미팅*/
             , T.AKSD17      /*판매장려*/
             , T.AKSD50      /*교육*/
             , T.AKSD48      /*정착*/
             , T.AKSD04      /*기기변경*/
             , T.AKSD15      /*BS관리*/
             , T.AKSD23      /*급지*/
             , T.AKSD42      /*판매장려소급*/
             , T.AKSD31      /*가전조직비례*/
             , T.AKSD34      /*가전조직외비례*/
             , T.AKSD11      /*조직판매장려*/
             , T.AKSD08      /*신규판매*/
             , T.AKSD22      /*조직관리*/
             , T.AKSD13      /*조직배출1*/
             , T.AKSD09      /*조직배출2*/
             , T.AKSD36      /*신설지점*/
             , T.AKSD05      /*멤버십*/
             , T.AKSD14      /*재지급*/
             , T.AKSD39      /*기타지원*/
             , T.AKSD18      /*WM통신*/
             , T.AKSD19      /*WM기타*/
             , T.AKSD40      /*사전방문*/
             , T.AKSD16      /*유니폼*/
             , T.AKSD10      /*자재실장*/
             , T.LCCNTT      /*BS완료계정*/
             , T.INTBS_SUM   /*과표합계*/
             , T.DDTN_SUM    /*총공제액*/
             , T.ACL_DSB_AMT /*실지급액*/
          FROM ( SELECT A.OG_NM
                      , A.PRTNR_NO
                      , A.PRTNR_KNM
                      , A.RSB_DV_CD
                      , A.OG_ID
                      , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                             ELSE 0
                        END AS AKCUIL
                      , A.QLF_DV_CD AS AKDMI3
                      , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                             WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                             WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                             WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                             WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                        END AS AKDMI32
                      , CASE WHEN G.EDUC_CRSE_NO = '11' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU011
                      , CASE WHEN G.EDUC_CRSE_NO = '129' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU129
                      , CASE WHEN G.EDUC_CRSE_NO IN ('100','106') THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU106
                      , '' AS AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
                      , CASE WHEN G.EDUC_CRSE_NO = '17' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU017
                      , CASE WHEN G.EDUC_CRSE_NO = '98' THEN G.EDUC_CRSE_CRT_BASE_YM END AS OJTCNT
                      , CASE WHEN G.EDUC_CRSE_NO = '96' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU096
                      , CASE WHEN G.EDUC_CRSE_NO = '97' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU097
                      , CASE WHEN G.EDUC_CRSE_NO = '112' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU112
                      , CASE WHEN G.EDUC_CRSE_NO = '113' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU113
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                      , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                      , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                      , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                      , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
                      , 0 AS DALSYN		/*실활동달성 AB8050P 정리안됨 임시처리*/
                      , 0 AS BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
                      , 0 AS SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
                      , 0 AS WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
                      , 0 AS WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
                      , 0 AS SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
                      , 0 AS DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
                      , NVL(D.AKCDA17,0) AS AKCDA17
                      , NVL(D.AKCDA18,0) AS AKCDA18
                      , NVL(D.AKCDA1,0) AS AKCDA1
                      , NVL(D.AKCDQ1,0) AS AKCDQ1
                      , NVL(D.AKCDQ0,0) AS AKCDQ0
                      , NVL(D.AKCDQ7,0) AS AKCDQ7
                      , NVL(D.AKDET3,0) AS AKDET3
                      , NVL(D.JASAMT,0) AS JASAMT
                      , NVL(D.AKCDA12,0) AS AKCDA12
                      , NVL(D.AKCDA13,0) AS AKCDA13
                      , NVL(D.AKCDA14,0) AS AKCDA14
                      , NVL(D.AKCDA15,0) AS AKCDA15
                      , NVL(D.AKCDA16,0) AS AKCDA16
                      , NVL(D.AKCDQ5,0) AS AKCDQ5
                      , NVL(D.AKCDQ6,0) AS AKCDQ6
                      , NVL(D.AKCDA19,0) AS AKCDA19
                      , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                      , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                      , NVL(E.JAKCDA12,0) AS JAKCDA12
                      , NVL(E.JAKCDA13,0) AS JAKCDA13
                      , NVL(E.JAKCDA15,0) AS JAKCDA15
                      , NVL(F.AKSD49,0) AS AKSD49
                      , NVL(F.AKSD43,0) AS AKSD43
                      , NVL(F.AKSD26,0) AS AKSD26
                      , NVL(F.AKSD29,0) AS AKSD29
                      , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA12,0) END AS SD26M1
                      , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA13,0) END AS SD26M2
                      , CASE WHEN F.AKSD29 IS NULL THEN 0 ELSE NVL(D.AKCDA15,0) END AS SD26MT
                      , NVL(F.AKSD17,0) AS AKSD17
                      , NVL(F.AKSD50,0) AS AKSD50
                      , NVL(F.AKSD48,0) AS AKSD48
                      , NVL(F.AKSD04,0) AS AKSD04
                      , NVL(F.AKSD15,0) AS AKSD15
                      , NVL(F.AKSD23,0) AS AKSD23
                      , NVL(F.AKSD42,0) AS AKSD42
                      , NVL(F.AKSD31,0) AS AKSD31
                      , NVL(F.AKSD34,0) AS AKSD34
                      , NVL(F.AKSD11,0) AS AKSD11
                      , NVL(F.AKSD08,0) AS AKSD08
                      , NVL(F.AKSD22,0) AS AKSD22
                      , NVL(F.AKSD13,0) AS AKSD13
                      , NVL(F.AKSD09,0) AS AKSD09
                      , NVL(F.AKSD36,0) AS AKSD36
                      , NVL(F.AKSD05,0) AS AKSD05
                      , NVL(F.AKSD14,0) AS AKSD14
                      , NVL(F.AKSD39,0) AS AKSD39
                      , NVL(F.AKSD18,0) AS AKSD18
                      , NVL(F.AKSD19,0) AS AKSD19
                      , NVL(F.AKSD40,0) AS AKSD40
                      , NVL(F.AKSD16,0) AS AKSD16
                      , NVL(F.AKSD10,0) AS AKSD10
                      , NVL(D.LCCNTT,0) AS LCCNTT
                      , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                      , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                      , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                   FROM TB_OGBS_MM_PRTNR_IZ A
                  INNER JOIN TB_OGBS_MM_OG_IZ O
                     ON A.BASE_YM = O.BASE_YM
                    AND A.OG_ID = O.OG_ID
                <if test="ogLevl1 != null and ogLevl1 != ''">
                    AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
                </if>
                <if test="ogLevl2 != null and ogLevl2 != ''">
                    AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
                </if>
                <if test="ogLevl3 != null and ogLevl3 != ''">
                    AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
                </if>
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                 ON A.PRTNR_NO = B.PRTNR_NO
                AND A.OG_TP_CD = B.OG_TP_CD
                AND B.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                 ON A.PRTNR_NO = C.PRTNR_NO
                AND C.OG_TP_CD = 'W01'
                AND C.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
               LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                 ON A.PRTNR_NO = PM.PRTNR_NO
                AND A.OG_TP_CD = PM.OG_TP_CD
                AND A.BASE_YM = PM.BASE_YM
                AND PM.FEE_TCNT_DV_CD = #{schOrdr}
                AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                AND PM.PERF_AGRG_CRT_DV_CD = '203'
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(AKCDA17) AS AKCDA17
                                      , SUM(AKCDA18) AS AKCDA18
                                      , SUM(AKCDA1) AS AKCDA1
                                      , SUM(AKCDQ1) AS AKCDQ1
                                      , SUM(AKCDQ0) AS AKCDQ0
                                      , SUM(AKCDQ7) AS AKCDQ7
                                      , SUM(AKDET3) AS AKDET3
                                      , SUM(JASAMT) AS JASAMT
                                      , SUM(AKCDA12) AS AKCDA12
                                      , SUM(AKCDA13) AS AKCDA13
                                      , SUM(AKCDA14) AS AKCDA14
                                      , SUM(AKCDA15) AS AKCDA15
                                      , SUM(AKCDA16) AS AKCDA16
                                      , SUM(AKCDQ5) AS AKCDQ5
                                      , SUM(AKCDQ6) AS AKCDQ6
                                      , SUM(AKCDA19) AS AKCDA19
                                      , SUM(LCCNTT) AS LCCNTT
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                         <if test="no != null and no != ''">
                                             AND AK17.PRTNR_NO = #{no}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                         )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                               )D
                 ON A.PRTNR_NO = D.PRTNR_NO
                AND A.OG_TP_CD = D.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(JAKCDQ0) AS JAKCDQ0
                                      , SUM(JAKCDQ6) AS JAKCDQ6
                                      , SUM(JAKCDA12) AS JAKCDA12
                                      , SUM(JAKCDA13) AS JAKCDA13
                                      , SUM(JAKCDA15) AS JAKCDA15
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12/*조직 환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13/*조직 환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15/*조직 환경가전외 일시불*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                         <if test="no != null and no != ''">
                                             AND AK17.PRTNR_NO = #{no}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                )E
                 ON A.PRTNR_NO = E.PRTNR_NO
                AND A.OG_TP_CD = E.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(M.AKSD49) AS AKSD49
                                      , SUM(M.AKSD43) AS AKSD43
                                      , SUM(M.AKSD26) AS AKSD26
                                      , SUM(M.AKSD29) AS AKSD29
                                      , SUM(M.AKSD17) AS AKSD17
                                      , SUM(M.AKSD50) AS AKSD50
                                      , SUM(M.AKSD48) AS AKSD48
                                      , SUM(M.AKSD04) AS AKSD04
                                      , SUM(M.AKSD15) AS AKSD15
                                      , SUM(M.AKSD23) AS AKSD23
                                      , SUM(M.AKSD42) AS AKSD42
                                      , SUM(M.AKSD31) AS AKSD31
                                      , SUM(M.AKSD34) AS AKSD34
                                      , SUM(M.AKSD11) AS AKSD11
                                      , SUM(M.AKSD08) AS AKSD08
                                      , SUM(M.AKSD22) AS AKSD22
                                      , SUM(M.AKSD13) AS AKSD13
                                      , SUM(M.AKSD09) AS AKSD09
                                      , SUM(M.AKSD36) AS AKSD36
                                      , SUM(M.AKSD05) AS AKSD05
                                      , SUM(M.AKSD14) AS AKSD14
                                      , SUM(M.AKSD39) AS AKSD39
                                      , SUM(M.AKSD18) AS AKSD18
                                      , SUM(M.AKSD19) AS AKSD19
                                      , SUM(M.AKSD40) AS AKSD40
                                      , SUM(M.AKSD16) AS AKSD16
                                      , SUM(M.AKSD10) AS AKSD10
                                   FROM ( SELECT A.PRTNR_NO
                                               , A.OG_TP_CD
                                               , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                               , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                               , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                               , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                               , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                               , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                               , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                               , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                               , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                               , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                               , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                               , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                               , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                               , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                               , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                               , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                               , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                               , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                               , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                               , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                               , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                            FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                           WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                             AND A.OG_TP_CD = 'W02'       --M조직
                                             AND A.FEE_TCNT_DV_CD = #{schOrdr}  --차수구분
                                         <if test="no != null and no != ''">
                                             AND A.PRTNR_NO = #{no}
                                         </if>
                                             AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                             , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                             , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                             , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                             , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                             , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                             , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041')
                                                             )M
                                           GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                        )F
                                     ON A.PRTNR_NO = F.PRTNR_NO
                                    AND A.OG_TP_CD = F.OG_TP_CD
               LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                      , E.OG_TP_CD
                                     , SUM(E.INTBS_AMT) AS INTBS_SUM
                                      , SUM(E.DDCTAM) AS DDTN_SUM
                                      , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                   FROM TB_FEAM_FEE_DSB_IZ E
                                  WHERE E.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                               <if test="no != null and no != ''">
                                    AND E.PRTNR_NO = #{no}
                               </if>
                                  GROUP BY E.PRTNR_NO, E.OG_TP_CD
                                )FEE
                 ON A.PRTNR_NO = FEE.PRTNR_NO
                AND A.OG_TP_CD = FEE.OG_TP_CD
               LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
                 ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                AND A.PRTNR_NO = G.PRTNR_NO
                AND G.EDUC_CRSE_NO IN ('11','129','100','106','17','96','97','112','113', '98')
                AND G.EDUC_CPC_ACKMT_YN = 'Y'
              WHERE A.BASE_YM = #{perfYm}
                AND A.OG_TP_CD = 'W02'
            <if test="no != null and no != ''">
                AND A.PRTNR_NO = #{no}
            </if>
                AND A.PSTN_DV_CD = '15'
               )T
    </select>

    <select id='selectManagerBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerBrmgrRes">
        SELECT T.OG_NM /*소속*/
             , T.PRTNR_NO  /*번호*/
             , T.PRTNR_KNM  /*성명*/
             , T.RSB_DV_CD  /*직책*/
             , T.AKCUIL     /*미팅일수*/
             , T.AKDMI3 		/*  자격 수수료월    */
             , T.AKDMI32      /*  자격M+1    */
             , CASE WHEN SUBSTR(T.OG_ID,0,1) != 'P' THEN CASE WHEN T.EDU096 != '' AND T.EDU097 != '' THEN T.EDU097 ELSE '' END
                    WHEN SUBSTR(T.OG_ID,0,1) = 'P'  THEN CASE WHEN T.EDU112 != '' AND T.EDU113 != '' THEN T.EDU113 ELSE '' END
                    ELSE ''
               END EDUSTR /* 스타트업 매니저 */
             , T.EDU011
             , T.EDU129
             , T.EDU106
             , T.AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
             , T.EDU017
             , T.EDU135
             , T.AKDSYM		/*등록기준월*/
             , T.AKDENM		/*최초업무등록월*/
             , T.AKDJEM		/*재등록월*/
             , T.AKDLYM		/*최종해약월*/
             , T.AKDCYM		/*업무해약월*/
             , T.AKDRYM		/*승진월*/
             , T.SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
             , T.SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
             , T.LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
             , T.LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
             , T.BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
             , T.SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
             , T.WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
             , T.WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
             , T.SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
             , T.DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
             , T.AKCDA17	  /*인정실적 렌탈*/
             , T.AKCDA18		/*인정실적 일시불*/
             , T.AKCDA1		/*인정실적 환경가전외*/
             , T.AKCDQ1		/*가전순주문건수*/
             , T.AKCDQ0		/*개인가전인정건수*/
             , T.AKCDQ7		/*개인BS인정건수*/
             , T.AKDET3		/*가전기변건수*/
             , T.JASAMT		/*가전기변금액*/
             , T.AKCDA12		/*환경가전 렌탈*/
             , T.AKCDA13		/*환경가전 일시불*/
             , T.AKCDA14		/*환경가전 정액*/
             , T.AKCDA15		/*환경가전외 일시불*/
             , T.AKCDA16		/*환경가전외 정액*/
             , T.AKCDQ5		/*라이브팩건수*/
             , T.AKCDQ6		/*개인신규판매건수*/
             , T.AKCDA19		/*홈케어판매가*/
             , T.JAKCDQ0		/*조직가전인정건수*/
             , T.JAKCDQ6		/*조직신규판매건수*/
             , T.JAKCDA12	/*조직 환경가전렌탈*/
             , T.JAKCDA13	/*조직 환경가전 일시불*/
             , T.JAKCDA15	/*조직 환경가전외 일시불*/
             , T.AKSD49   /*홈케어*/
             , T.AKSD43   /*라이브팩*/
             , T.AKSD26   /*가전비례*/
             , T.AKSD29   /*가전외비례*/
             , T.AKSD17  /*판매장려*/
             , T.AKSD50  /*교육*/
             , T.AKSD48  /*정착*/
             , T.AKSD04  /*기기변경*/
             , T.AKSD15  /*BS관리*/
             , T.AKSD23  /*급지*/
             , T.AKSD42  /*판매장려소급*/
             , T.AKSD31  /*가전조직비례*/
             , T.AKSD34  /*가전조직외비례*/
             , T.AKSD11  /*조직판매장려*/
             , T.AKSD08  /*신규판매*/
             , T.AKSD22  /*조직관리*/
             , T.AKSD06  /*추가장려*/
             , T.AKSD13  /*조직배출1*/
             , T.AKSD09  /*조직배출2*/
             , T.AKSD36  /*신설지점*/
             , T.AKSD05  /*멤버십*/
             , T.AKSD14  /*재지급*/
             , T.AKSD39  /*기타지원*/
             , T.AKSD18  /*WM통신*/
             , T.AKSD19  /*WM기타*/
             , T.AKSD40  /*사전방문*/
             , T.AKSD16  /*유니폼*/
             , T.AKSD10  /*자재실장*/
             , T.LCCNTT  /*BS완료계정*/
             , T.INTBS_SUM       /*과표합계*/
             , T.DDTN_SUM         /*총공제액*/
             , T.ACL_DSB_AMT   /*실지급액*/
          FROM ( SELECT A.OG_NM
                      , A.PRTNR_NO
                      , A.PRTNR_KNM
                      , A.RSB_DV_CD
                      , A.OG_ID
                      , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                             ELSE 0
                        END AS AKCUIL
                      , '지점장' AS AKDMI3
                      , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                             WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                             WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                             WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                             WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                        END AS AKDMI32
                      , CASE WHEN G.EDUC_CRSE_NO = '11' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU011
                      , CASE WHEN G.EDUC_CRSE_NO = '129' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU129
                      , CASE WHEN G.EDUC_CRSE_NO IN ('100','106') THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU106
                      , '' AS AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
                      , CASE WHEN G.EDUC_CRSE_NO = '17' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU017
                      , CASE WHEN G.EDUC_CRSE_NO = '135' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU135
                      , CASE WHEN G.EDUC_CRSE_NO = '96' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU096
                      , CASE WHEN G.EDUC_CRSE_NO = '97' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU097
                      , CASE WHEN G.EDUC_CRSE_NO = '112' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU112
                      , CASE WHEN G.EDUC_CRSE_NO = '113' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU113
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                      , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                      , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                      , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                      , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
                      , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
                      , 0 AS BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
                      , 0 AS SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
                      , 0 AS WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
                      , 0 AS WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
                      , 0 AS SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
                      , 0 AS DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
                      , NVL(D.AKCDA17,0) AS AKCDA17
                      , NVL(D.AKCDA18,0) AS AKCDA18
                      , NVL(D.AKCDA1,0) AS AKCDA1
                      , NVL(D.AKCDQ1,0) AS AKCDQ1
                      , NVL(D.AKCDQ0,0) AS AKCDQ0
                      , NVL(D.AKCDQ7,0) AS AKCDQ7
                      , NVL(D.AKDET3,0) AS AKDET3
                      , NVL(D.JASAMT,0) AS JASAMT
                      , NVL(D.AKCDA12,0) AS AKCDA12
                      , NVL(D.AKCDA13,0) AS AKCDA13
                      , NVL(D.AKCDA14,0) AS AKCDA14
                      , NVL(D.AKCDA15,0) AS AKCDA15
                      , NVL(D.AKCDA16,0) AS AKCDA16
                      , NVL(D.AKCDQ5,0) AS AKCDQ5
                      , NVL(D.AKCDQ6,0) AS AKCDQ6
                      , NVL(D.AKCDA19,0) AS AKCDA19
                      , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                      , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                      , NVL(E.JAKCDA12,0) AS JAKCDA12
                      , NVL(E.JAKCDA13,0) AS JAKCDA13
                      , NVL(E.JAKCDA15,0) AS JAKCDA15
                      , NVL(F.AKSD49,0) AS AKSD49
                      , NVL(F.AKSD43,0) AS AKSD43
                      , NVL(F.AKSD26,0) AS AKSD26
                      , NVL(F.AKSD29,0) AS AKSD29
                      , NVL(F.AKSD17,0) AS AKSD17
                      , NVL(F.AKSD50,0) AS AKSD50
                      , NVL(F.AKSD48,0) AS AKSD48
                      , NVL(F.AKSD04,0) AS AKSD04
                      , NVL(F.AKSD15,0) AS AKSD15
                      , NVL(F.AKSD23,0) AS AKSD23
                      , NVL(F.AKSD42,0) AS AKSD42
                      , NVL(F.AKSD31,0) AS AKSD31
                      , NVL(F.AKSD34,0) AS AKSD34
                      , NVL(F.AKSD11,0) AS AKSD11
                      , NVL(F.AKSD08,0) AS AKSD08
                      , NVL(F.AKSD22,0) AS AKSD22
                      , NVL(F.AKSD06,0) AS AKSD06
                      , NVL(F.AKSD13,0) AS AKSD13
                      , NVL(F.AKSD09,0) AS AKSD09
                      , NVL(F.AKSD36,0) AS AKSD36
                      , NVL(F.AKSD05,0) AS AKSD05
                      , NVL(F.AKSD14,0) AS AKSD14
                      , NVL(F.AKSD39,0) AS AKSD39
                      , NVL(F.AKSD18,0) AS AKSD18
                      , NVL(F.AKSD19,0) AS AKSD19
                      , NVL(F.AKSD40,0) AS AKSD40
                      , NVL(F.AKSD16,0) AS AKSD16
                      , NVL(F.AKSD10,0) AS AKSD10
                      , NVL(D.LCCNTT,0) AS LCCNTT
                      , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                      , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                      , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                   FROM TB_OGBS_MM_PRTNR_IZ A
                  INNER JOIN TB_OGBS_MM_OG_IZ O
                     ON A.BASE_YM = O.BASE_YM
                    AND A.OG_ID = O.OG_ID
                <if test="ogLevl1 != null and ogLevl1 != ''">
                    AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
                </if>
                <if test="ogLevl2 != null and ogLevl2 != ''">
                    AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
                </if>
                <if test="ogLevl3 != null and ogLevl3 != ''">
                    AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
                </if>
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                 ON A.PRTNR_NO = B.PRTNR_NO
                AND A.OG_TP_CD = B.OG_TP_CD
                AND B.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
               LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                 ON A.PRTNR_NO = C.PRTNR_NO
                AND C.OG_TP_CD = 'W01'
                AND C.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
               LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                 ON A.PRTNR_NO = PM.PRTNR_NO
                AND A.OG_TP_CD = PM.OG_TP_CD
                AND A.BASE_YM = PM.BASE_YM
                AND PM.FEE_TCNT_DV_CD = #{schOrdr}
                AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                AND PM.PERF_AGRG_CRT_DV_CD = '203'  /*P추진단순주문실적생성*/
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(AKCDA17) AS AKCDA17
                                      , SUM(AKCDA18) AS AKCDA18
                                      , SUM(AKCDA1) AS AKCDA1
                                      , SUM(AKCDQ1) AS AKCDQ1
                                      , SUM(AKCDQ0) AS AKCDQ0
                                      , SUM(AKCDQ7) AS AKCDQ7
                                      , SUM(AKDET3) AS AKDET3
                                      , SUM(JASAMT) AS JASAMT
                                      , SUM(AKCDA12) AS AKCDA12
                                      , SUM(AKCDA13) AS AKCDA13
                                      , SUM(AKCDA14) AS AKCDA14
                                      , SUM(AKCDA15) AS AKCDA15
                                      , SUM(AKCDA16) AS AKCDA16
                                      , SUM(AKCDQ5) AS AKCDQ5
                                      , SUM(AKCDQ6) AS AKCDQ6
                                      , SUM(AKCDA19) AS AKCDA19
                                      , SUM(LCCNTT) AS LCCNTT
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                         <if test="no != null and no != ''">
                                             AND AK17.PRTNR_NO = #{no}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                )D
                 ON A.PRTNR_NO = D.PRTNR_NO
                AND A.OG_TP_CD = D.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(JAKCDQ0) AS JAKCDQ0
                                      , SUM(JAKCDQ6) AS JAKCDQ6
                                      , SUM(JAKCDA12) AS JAKCDA12
                                      , SUM(JAKCDA13) AS JAKCDA13
                                      , SUM(JAKCDA15) AS JAKCDA15
                                   FROM ( SELECT AK17.PRTNR_NO
                                               , AK17.OG_TP_CD
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12/*조직 환경가전 렌탈*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13/*조직 환경가전 일시불*/
                                               , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15/*조직 환경가전외 일시불*/
                                            FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                           WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                             AND AK17.BASE_YM = #{perfYm}
                                             AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                         <if test="no != null and no != ''">
                                             AND AK17.PRTNR_NO = #{no}
                                         </if>
                                             AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                               )E
                 ON A.PRTNR_NO = E.PRTNR_NO
                AND A.OG_TP_CD = E.OG_TP_CD
               LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                      , M.OG_TP_CD
                                      , SUM(M.AKSD49) AS AKSD49
                                      , SUM(M.AKSD43) AS AKSD43
                                      , SUM(M.AKSD26) AS AKSD26
                                      , SUM(M.AKSD29) AS AKSD29
                                      , SUM(M.AKSD17) AS AKSD17
                                      , SUM(M.AKSD50) AS AKSD50
                                      , SUM(M.AKSD48) AS AKSD48
                                      , SUM(M.AKSD04) AS AKSD04
                                      , SUM(M.AKSD15) AS AKSD15
                                      , SUM(M.AKSD23) AS AKSD23
                                      , SUM(M.AKSD42) AS AKSD42
                                      , SUM(M.AKSD31) AS AKSD31
                                      , SUM(M.AKSD34) AS AKSD34
                                      , SUM(M.AKSD11) AS AKSD11
                                      , SUM(M.AKSD08) AS AKSD08
                                      , SUM(M.AKSD22) AS AKSD22
                                      , SUM(M.AKSD06) AS AKSD06
                                      , SUM(M.AKSD13) AS AKSD13
                                      , SUM(M.AKSD09) AS AKSD09
                                      , SUM(M.AKSD36) AS AKSD36
                                      , SUM(M.AKSD05) AS AKSD05
                                      , SUM(M.AKSD14) AS AKSD14
                                      , SUM(M.AKSD39) AS AKSD39
                                      , SUM(M.AKSD18) AS AKSD18
                                      , SUM(M.AKSD19) AS AKSD19
                                      , SUM(M.AKSD40) AS AKSD40
                                      , SUM(M.AKSD16) AS AKSD16
                                      , SUM(M.AKSD10) AS AKSD10
                                   FROM ( SELECT A.PRTNR_NO
                                               , A.OG_TP_CD
                                               , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                               , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                               , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                               , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                               , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                               , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                               , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                               , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                               , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                               , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                               , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                               , CASE WHEN A.FEE_CD = 'W020054' THEN A.FEE_ATC_VAL END AS AKSD06  /*추가장려*/
                                               , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                               , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                               , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                               , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                               , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                               , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                               , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                               , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                               , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                               , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                               , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                            FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                           WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                             AND A.OG_TP_CD = 'W02'       --M조직
                                             AND A.FEE_TCNT_DV_CD = #{schOrdr}  --차수구분
                                         <if test="no != null and no != ''">
                                             AND A.PRTNR_NO = #{no}
                                         </if>
                                             AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                             , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                             , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                             , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                             , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                             , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                            , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041', 'W020054')
                                        )M
                                  GROUP BY M.PRTNR_NO, M.OG_TP_CD
                               )F
                 ON A.PRTNR_NO = F.PRTNR_NO
                AND A.OG_TP_CD = F.OG_TP_CD
               LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                      , E.OG_TP_CD
                                      , SUM(E.INTBS_AMT) AS INTBS_SUM
                                      , SUM(E.DDCTAM) AS DDTN_SUM
                                      , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                   FROM TB_FEAM_FEE_DSB_IZ E
                                  WHERE E.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                <if test="no != null and no != ''">
                                    AND E.PRTNR_NO = #{no}
                                </if>
                                  GROUP BY E.PRTNR_NO, E.OG_TP_CD
                               )FEE
                 ON A.PRTNR_NO = FEE.PRTNR_NO
                AND A.OG_TP_CD = FEE.OG_TP_CD
               LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
                 ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                AND A.PRTNR_NO = G.PRTNR_NO
                AND G.EDUC_CRSE_NO IN ('11','129','100','106','17','135','96','97','112','113')
                AND G.EDUC_CPC_ACKMT_YN = 'Y'
              WHERE A.BASE_YM = #{perfYm}
                AND A.OG_TP_CD = 'W02'
            <if test="no != null and no != ''">
                AND A.PRTNR_NO = #{no}
            </if>
                AND A.PSTN_DV_CD = 7
               )T
    </select>

    <select id='selectManagerTotalFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchMngerTotalRes">
        SELECT T.OG_NM /*소속*/
             , T.PRTNR_NO  /*번호*/
             , T.PRTNR_KNM  /*성명*/
             , T.RSB_DV_CD  /*직책*/
             , T.AKCUIL     /*미팅일수*/
             , T.AKDMI3 		/*  자격 수수료월    */
             , T.AKDMI32      /*  자격M+1    */
             , CASE WHEN SUBSTR(T.OG_ID,0,1) != 'P' THEN CASE WHEN T.EDU096 != '' AND T.EDU097 != '' THEN T.EDU097 ELSE '' END
                    WHEN SUBSTR(T.OG_ID,0,1) = 'P'  THEN CASE WHEN T.EDU112 != '' AND T.EDU113 != '' THEN T.EDU113 ELSE '' END
                    ELSE ''
               END EDUSTR        		/* 스타트업 매니저 */
             , T.EDU011		/*스타트업 플래너*/
             , T.EDU129		/*보수교육*/
             , T.EDU106		/*수석플래너 교육 정착*/
             , T.AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
             , T.EDU017		/*수석플래너 교육 실전*/
             , T.EDU135		/*지점장 온라인*/
             , T.OJTCNT		/*OJT일수   AB2610P KSS 데이터 미정으로 일단 해당 교육번호 98로 임시처리*/
             , T.AKDSYM		/*등록기준월*/
             , T.AKDENM		/*최초업무등록월*/
             , T.AKDJEM		/*재등록월*/
             , T.AKDLYM		/*최종해약월*/
             , T.AKDCYM		/*업무해약월*/
             , T.AKDRYM		/*승진월*/
             , T.SUSTYM		/*수석플래너 등록월  AK0600P 정리안됨 임시처리*/
             , T.SUSCYM		/*수석플래너 해약월  AK0600P 정리안됨 임시처리*/
             , T.LCCOYM		/*WM개시 LC1700P 정리안됨 임시처리*/
             , T.LCCCYM		/*WM해약 LC1700P 정리안됨 임시처리*/
             , T.DALSYN		/*실활동달성 AB8050P 정리안됨 임시처리*/
             , T.BONDALSYN	/*최소기준달성 AB8050P 정리안됨 임시처리*/
             , T.SUNGNM		/*전월대비구분 AB8050P 정리안됨 임시처리*/
             , T.WPSCNT		/*WP AB8050P 정리안됨 임시처리*/
             , T.WMSCNT		/*WM AB8050P 정리안됨 임시처리*/
             , T.SPSCNT		/*SP AB8050P 정리안됨 임시처리*/
             , T.DANCNT		/*총인원 AB8050P 정리안됨 임시처리*/
             , T.AKCDA17	    /*인정실적 렌탈*/
             , T.AKCDA18		/*인정실적 일시불*/
             , T.AKCDA1		/*인정실적 환경가전외*/
             , T.AKCDQ1		/*가전순주문건수*/
             , T.AKCDQ0		/*개인가전인정건수*/
             , T.AKCDQ7		/*개인BS인정건수*/
             , T.AKDET3		/*가전기변건수*/
             , T.JASAMT		/*가전기변금액*/
             , T.AKCDA12		/*환경가전 렌탈*/
             , T.AKCDA13		/*환경가전 일시불*/
             , T.AKCDA14		/*환경가전 정액*/
             , T.AKCDA15		/*환경가전외 일시불*/
             , T.AKCDA16		/*환경가전외 정액*/
             , T.AKCDQ5		/*라이브팩건수*/
             , T.AKCDQ6		/*개인신규판매건수*/
             , T.AKCDA19		/*홈케어판매가*/
             , T.JAKCDQ0		/*조직가전인정건수*/
             , T.JAKCDQ6		/*조직신규판매건수*/
             , T.JAKCDA12	/*조직 환경가전렌탈*/
             , T.JAKCDA13	/*조직 환경가전 일시불*/
             , T.JAKCDA15	/*조직 환경가전외 일시불*/
             , T.AKSD49      /*홈케어*/
             , T.AKSD43      /*라이브팩*/
             , T.AKSD26      /*가전비례*/
             , T.AKSD29      /*가전외비례*/
             , T.SD26M1      /*가전미팅*/
             , T.SD26M2      /*일시불미팅*/
             , T.SD26MT      /*가전외미팅*/
             , T.AKSD17      /*판매장려*/
             , T.AKSD50      /*교육*/
             , T.AKSD48      /*정착*/
             , T.AKSD04      /*기기변경*/
             , T.AKSD15      /*BS관리*/
             , T.AKSD23      /*급지*/
             , T.AKSD42      /*판매장려소급*/
             , T.AKSD31      /*가전조직비례*/
             , T.AKSD34      /*가전조직외비례*/
             , T.AKSD11      /*조직판매장려*/
             , T.AKSD08      /*신규판매*/
             , T.AKSD22      /*조직관리*/
             , T.AKSD06      /*추가장려*/
             , T.AKSD13      /*조직배출1*/
             , T.AKSD09      /*조직배출2*/
             , T.AKSD36      /*신설지점*/
             , T.AKSD05      /*멤버십*/
             , T.AKSD14      /*재지급*/
             , T.AKSD39      /*기타지원*/
             , T.AKSD18      /*WM통신*/
             , T.AKSD19      /*WM기타*/
             , T.AKSD40      /*사전방문*/
             , T.AKSD16      /*유니폼*/
             , T.AKSD10      /*자재실장*/
             , T.LCCNTT      /*BS완료계정*/
             , T.INTBS_SUM   /*과표합계*/
             , T.DDTN_SUM    /*총공제액*/
             , T.ACL_DSB_AMT   /*실지급액*/
        FROM ( SELECT A.OG_NM
                    , A.PRTNR_NO
                    , A.PRTNR_KNM
                    , A.RSB_DV_CD
                    , A.OG_ID
                    , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(PM.PERF_VAL,0)
                           ELSE 0
                      END AS AKCUIL
                    , A.QLF_DV_CD AS AKDMI3
                    , CASE WHEN B.PSTN_DV_CD = 7 AND B.RSB_DV_CD = 'W0204' THEN '매니저지점장'
                           WHEN C.PSTN_DV_CD = 7 AND C.RSB_DV_CD = 'W0104' THEN '플래너지점장'
                           WHEN B.PRTNR_NO IS NOT NULL THEN B.QLF_DV_CD
                           WHEN C.PRTNR_NO IS NOT NULL THEN 'M->P'
                           WHEN B.PRTNR_NO IS NULL AND C.PRTNR_NO IS NULL THEN '해약'
                      END AS AKDMI32
                    , CASE WHEN G.EDUC_CRSE_NO = '11' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU011
                    , CASE WHEN G.EDUC_CRSE_NO = '129' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU129
                    , CASE WHEN G.EDUC_CRSE_NO IN ('100','106') THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU106
                    , '' AS AKDCHA		/*수석플래너 교육 차월   AK0600P AKDCHA 데이터 미정으로 임시처리*/
                    , CASE WHEN G.EDUC_CRSE_NO = '17' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU017
                    , CASE WHEN G.EDUC_CRSE_NO = '135' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU135
                    , CASE WHEN G.EDUC_CRSE_NO = '96' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU096
                    , CASE WHEN G.EDUC_CRSE_NO = '97' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU097
                    , CASE WHEN G.EDUC_CRSE_NO = '112' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU112
                    , CASE WHEN G.EDUC_CRSE_NO = '113' THEN G.EDUC_CRSE_CRT_BASE_YM END AS EDU113
                    , CASE WHEN G.EDUC_CRSE_NO = '98' THEN 1 END AS OJTCNT
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM
                    , TO_CHAR(TO_DATE(A.FST_CNTR_DT),'YYYY-MM') AS AKDENM
                    , TO_CHAR(TO_DATE(A.RCNTR_DT),'YYYY-MM') AS AKDJEM
                    , TO_CHAR(TO_DATE(A.FNL_CLTN_DT),'YYYY-MM') AS AKDLYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS AKDCYM
                    , TO_CHAR(TO_DATE(A.PRFMT_DT),'YYYY-MM') AS AKDRYM
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS SUSTYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS SUSCYM
                    , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS LCCOYM
                    , TO_CHAR(TO_DATE(A.CLTN_DT),'YYYY-MM') AS LCCCYM
                    , 0 AS DALSYN
                    , 0 AS BONDALSYN
                    , 0 AS SUNGNM
                    , 0 AS WPSCNT
                    , 0 AS WMSCNT
                    , 0 AS SPSCNT
                    , 0 AS DANCNT
                    , NVL(D.AKCDA17,0) AS AKCDA17
                    , NVL(D.AKCDA18,0) AS AKCDA18
                    , NVL(D.AKCDA1,0) AS AKCDA1
                    , NVL(D.AKCDQ1,0) AS AKCDQ1
                    , NVL(D.AKCDQ0,0) AS AKCDQ0
                    , NVL(D.AKCDQ7,0) AS AKCDQ7
                    , NVL(D.AKDET3,0) AS AKDET3
                    , NVL(D.JASAMT,0) AS JASAMT
                    , NVL(D.AKCDA12,0) AS AKCDA12
                    , NVL(D.AKCDA13,0) AS AKCDA13
                    , NVL(D.AKCDA14,0) AS AKCDA14
                    , NVL(D.AKCDA15,0) AS AKCDA15
                    , NVL(D.AKCDA16,0) AS AKCDA16
                    , NVL(D.AKCDQ5,0) AS AKCDQ5
                    , NVL(D.AKCDQ6,0) AS AKCDQ6
                    , NVL(D.AKCDA19,0) AS AKCDA19
                    , NVL(E.JAKCDQ0,0) AS JAKCDQ0
                    , NVL(E.JAKCDQ6,0) AS JAKCDQ6
                    , NVL(E.JAKCDA12,0) AS JAKCDA12
                    , NVL(E.JAKCDA13,0) AS JAKCDA13
                    , NVL(E.JAKCDA15,0) AS JAKCDA15
                    , NVL(F.AKSD49,0) AS AKSD49
                    , NVL(F.AKSD43,0) AS AKSD43
                    , NVL(F.AKSD26,0) AS AKSD26
                    , NVL(F.AKSD29,0) AS AKSD29
                    , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA12,0) END AS SD26M1
                    , CASE WHEN F.AKSD26 IS NULL THEN 0 ELSE NVL(D.AKCDA13,0) END AS SD26M2
                    , CASE WHEN F.AKSD29 IS NULL THEN 0 ELSE NVL(D.AKCDA15,0) END AS SD26MT
                    , NVL(F.AKSD17,0) AS AKSD17
                    , NVL(F.AKSD50,0) AS AKSD50
                    , NVL(F.AKSD48,0) AS AKSD48
                    , NVL(F.AKSD04,0) AS AKSD04
                    , NVL(F.AKSD15,0) AS AKSD15
                    , NVL(F.AKSD23,0) AS AKSD23
                    , NVL(F.AKSD42,0) AS AKSD42
                    , NVL(F.AKSD31,0) AS AKSD31
                    , NVL(F.AKSD34,0) AS AKSD34
                    , NVL(F.AKSD11,0) AS AKSD11
                    , NVL(F.AKSD08,0) AS AKSD08
                    , NVL(F.AKSD22,0) AS AKSD22
                    , NVL(F.AKSD06,0) AS AKSD06
                    , NVL(F.AKSD13,0) AS AKSD13
                    , NVL(F.AKSD09,0) AS AKSD09
                    , NVL(F.AKSD36,0) AS AKSD36
                    , NVL(F.AKSD05,0) AS AKSD05
                    , NVL(F.AKSD14,0) AS AKSD14
                    , NVL(F.AKSD39,0) AS AKSD39
                    , NVL(F.AKSD18,0) AS AKSD18
                    , NVL(F.AKSD19,0) AS AKSD19
                    , NVL(F.AKSD40,0) AS AKSD40
                    , NVL(F.AKSD16,0) AS AKSD16
                    , NVL(F.AKSD10,0) AS AKSD10
                    , NVL(D.LCCNTT,0) AS LCCNTT
                    , NVL(FEE.INTBS_SUM,0) AS INTBS_SUM
                    , NVL(FEE.DDTN_SUM,0) AS DDTN_SUM
                    , NVL(FEE.ACL_DSB_AMT,0) AS ACL_DSB_AMT
                 FROM TB_OGBS_MM_PRTNR_IZ A
                INNER JOIN TB_OGBS_MM_OG_IZ O
                   ON A.BASE_YM = O.BASE_YM
                  AND A.OG_ID = O.OG_ID
              <if test="ogLevl1 != null and ogLevl1 != ''">
                  AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
              </if>
              <if test="ogLevl2 != null and ogLevl2 != ''">
                  AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
              </if>
              <if test="ogLevl3 != null and ogLevl3 != ''">
                  AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
              </if>
                 LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B /*+1 month M조직 여부*/
                   ON A.PRTNR_NO = B.PRTNR_NO
                  AND A.OG_TP_CD = B.OG_TP_CD
                  AND B.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
                 LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ C  /*+1 month P조직 이동*/
                   ON A.PRTNR_NO = C.PRTNR_NO
                  AND C.OG_TP_CD = 'W01'
                  AND C.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
                 LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
                   ON A.PRTNR_NO = PM.PRTNR_NO
                  AND A.OG_TP_CD = PM.OG_TP_CD
                  AND A.BASE_YM = PM.BASE_YM
                  AND PM.FEE_TCNT_DV_CD = #{schOrdr}
                  AND PM.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                  AND PM.PERF_AGRG_CRT_DV_CD = '203'  /*P추진단순주문실적생성*/
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(AKCDA17) AS AKCDA17
                                        , SUM(AKCDA18) AS AKCDA18
                                        , SUM(AKCDA1) AS AKCDA1
                                        , SUM(AKCDQ1) AS AKCDQ1
                                        , SUM(AKCDQ0) AS AKCDQ0
                                        , SUM(AKCDQ7) AS AKCDQ7
                                        , SUM(AKDET3) AS AKDET3
                                        , SUM(JASAMT) AS JASAMT
                                        , SUM(AKCDA12) AS AKCDA12
                                        , SUM(AKCDA13) AS AKCDA13
                                        , SUM(AKCDA14) AS AKCDA14
                                        , SUM(AKCDA15) AS AKCDA15
                                        , SUM(AKCDA16) AS AKCDA16
                                        , SUM(AKCDQ5) AS AKCDQ5
                                        , SUM(AKCDQ6) AS AKCDQ6
                                        , SUM(AKCDA19) AS AKCDA19
                                        , SUM(LCCNTT) AS LCCNTT
                                     FROM ( SELECT AK17.PRTNR_NO
                                                 , AK17.OG_TP_CD
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00033' THEN AK17.PERF_VAL END AS AKCDA17/*인정실적 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00034' THEN AK17.PERF_VAL END AS AKCDA18/*인정실적 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00027' THEN AK17.PERF_VAL END AS AKCDA1/*인정실적 환경가전외*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00102' THEN AK17.PERF_VAL END AS AKCDQ1	 /*가전순주문건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS AKCDQ0	 /*개인가전인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00011' THEN AK17.PERF_VAL END AS AKCDQ7	 /*개인BS인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00104' THEN AK17.PERF_VAL END AS AKDET3	 /*가전기변건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00008' THEN AK17.PERF_VAL END AS JASAMT/*가전기변금액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS AKCDA12/*환경가전 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS AKCDA13/*환경가전 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14/*환경가전 정액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS AKCDA15/*환경가전외 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00007' THEN AK17.PERF_VAL END AS AKCDA16/*환경가전외 정액*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00105' THEN AK17.PERF_VAL END AS AKCDQ5	 /*라이브팩건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS AKCDQ6	 /*개인신규판매건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00035' THEN AK17.PERF_VAL END AS AKCDA19/*홈케어판매가*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00085' THEN AK17.PERF_VAL END AS LCCNTT/*BS완료계정*/
                                              FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                             WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                               AND AK17.BASE_YM = #{perfYm}
                                               AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                           <if test="no != null and no != ''">
                                               AND AK17.PRTNR_NO = #{no}
                                           </if>
                                               AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )D
                   ON A.PRTNR_NO = D.PRTNR_NO
                  AND A.OG_TP_CD = D.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(JAKCDQ0) AS JAKCDQ0
                                        , SUM(JAKCDQ6) AS JAKCDQ6
                                        , SUM(JAKCDA12) AS JAKCDA12
                                        , SUM(JAKCDA13) AS JAKCDA13
                                        , SUM(JAKCDA15) AS JAKCDA15
                                     FROM ( SELECT AK17.PRTNR_NO
                                                 , AK17.OG_TP_CD
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00103' THEN AK17.PERF_VAL END AS JAKCDQ0	 /*조직가전인정건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W02P00106' THEN AK17.PERF_VAL END AS JAKCDQ6	 /*조직신규판매건수*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00003' THEN AK17.PERF_VAL END AS JAKCDA12 /*조직 환경가전 렌탈*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL END AS JAKCDA13 /*조직 환경가전 일시불*/
                                                 , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL END AS JAKCDA15 /*조직 환경가전외 일시불*/
                                              FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                             WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                               AND AK17.BASE_YM = #{perfYm}
                                               AND AK17.PERF_DV_CD = 2   /*지점판매*/
                                           <if test="no != null and no != ''">
                                               AND AK17.PRTNR_NO = #{no}
                                           </if>
                                               AND AK17.OG_TP_CD = 'W02'  /*웰스 M조직*/
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )E
                   ON A.PRTNR_NO = E.PRTNR_NO
                  AND A.OG_TP_CD = E.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                        , M.OG_TP_CD
                                        , SUM(M.AKSD49) AS AKSD49
                                        , SUM(M.AKSD43) AS AKSD43
                                        , SUM(M.AKSD26) AS AKSD26
                                        , SUM(M.AKSD29) AS AKSD29
                                        , SUM(M.AKSD17) AS AKSD17
                                        , SUM(M.AKSD50) AS AKSD50
                                        , SUM(M.AKSD48) AS AKSD48
                                        , SUM(M.AKSD04) AS AKSD04
                                        , SUM(M.AKSD15) AS AKSD15
                                        , SUM(M.AKSD23) AS AKSD23
                                        , SUM(M.AKSD42) AS AKSD42
                                        , SUM(M.AKSD31) AS AKSD31
                                        , SUM(M.AKSD34) AS AKSD34
                                        , SUM(M.AKSD11) AS AKSD11
                                        , SUM(M.AKSD08) AS AKSD08
                                        , SUM(M.AKSD22) AS AKSD22
                                        , SUM(M.AKSD06) AS AKSD06
                                        , SUM(M.AKSD13) AS AKSD13
                                        , SUM(M.AKSD09) AS AKSD09
                                        , SUM(M.AKSD36) AS AKSD36
                                        , SUM(M.AKSD05) AS AKSD05
                                        , SUM(M.AKSD14) AS AKSD14
                                        , SUM(M.AKSD39) AS AKSD39
                                        , SUM(M.AKSD18) AS AKSD18
                                        , SUM(M.AKSD19) AS AKSD19
                                        , SUM(M.AKSD40) AS AKSD40
                                        , SUM(M.AKSD16) AS AKSD16
                                        , SUM(M.AKSD10) AS AKSD10
                                     FROM ( SELECT A.PRTNR_NO
                                                 , A.OG_TP_CD
                                                 , CASE WHEN A.FEE_CD IN ('W020078', 'W020079') THEN A.FEE_ATC_VAL END AS AKSD49  /*홈케어*/
                                                 , CASE WHEN A.FEE_CD IN ('W020007', 'W020034', 'W020035') THEN A.FEE_ATC_VAL END AS AKSD43  /*라이브팩*/
                                                 , CASE WHEN A.FEE_CD IN ('W020001', 'W020002') THEN A.FEE_ATC_VAL END AS AKSD26  /*가전비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020003', 'W020004') THEN A.FEE_ATC_VAL END AS AKSD29  /*가전외비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN A.FEE_ATC_VAL END AS AKSD17  /*판매장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN A.FEE_ATC_VAL END AS AKSD50  /*교육*/
                                                 , CASE WHEN A.FEE_CD IN ('W020080', 'W020081', 'W020082') THEN A.FEE_ATC_VAL END AS AKSD48  /*정착*/
                                                 , CASE WHEN A.FEE_CD IN ('W020005', 'W020031', 'W020032') THEN A.FEE_ATC_VAL END AS AKSD04  /*기기변경*/
                                                 , CASE WHEN A.FEE_CD IN ('W020084', 'W020087') THEN A.FEE_ATC_VAL END AS AKSD15  /*BS관리*/
                                                 , CASE WHEN A.FEE_CD IN ('W020085', 'W020088') THEN A.FEE_ATC_VAL END AS AKSD23  /*급지*/
                                                 , CASE WHEN A.FEE_CD ='W020083' THEN A.FEE_ATC_VAL END AS AKSD42  /*판매장려소급*/
                                                 , CASE WHEN A.FEE_CD IN ('W020019', 'W020020', 'W020021') THEN A.FEE_ATC_VAL END AS AKSD31  /*가전조직비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020022', 'W020023', 'W020024') THEN A.FEE_ATC_VAL END AS AKSD34  /*가전조직외비례*/
                                                 , CASE WHEN A.FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN A.FEE_ATC_VAL END AS AKSD11  /*조직판매장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020013', 'W020039', 'W020040') THEN A.FEE_ATC_VAL END AS AKSD08  /*신규판매*/
                                                 , CASE WHEN A.FEE_CD IN ('W020018', 'W020047', 'W020048') THEN A.FEE_ATC_VAL END AS AKSD22  /*조직관리*/
                                                 , CASE WHEN A.FEE_CD = 'W020054' THEN A.FEE_ATC_VAL END AS AKSD06  /*추가장려*/
                                                 , CASE WHEN A.FEE_CD IN ('W020015', 'W020042') THEN A.FEE_ATC_VAL END AS AKSD13  /*조직배출1*/
                                                 , CASE WHEN A.FEE_CD = 'W020016' THEN A.FEE_ATC_VAL END AS AKSD09  /*조직배출2*/
                                                 , CASE WHEN A.FEE_CD = 'W020025' THEN A.FEE_ATC_VAL END AS AKSD36  /*신설지점*/
                                                 , CASE WHEN A.FEE_CD IN ('W020006', 'W020033') THEN A.FEE_ATC_VAL END AS AKSD05  /*멤버십*/
                                                 , CASE WHEN A.FEE_CD IN ('W020090', 'W020091') THEN A.FEE_ATC_VAL END AS AKSD14  /*재지급*/
                                                 , CASE WHEN A.FEE_CD IN ('W020094', 'W020095') THEN A.FEE_ATC_VAL END AS AKSD39  /*기타지원*/
                                                 , CASE WHEN A.FEE_CD IN ('W020027', 'W020089') THEN A.FEE_ATC_VAL END AS AKSD18  /*WM통신*/
                                                 , CASE WHEN A.FEE_CD IN ('W020096', 'W020097') THEN A.FEE_ATC_VAL END AS AKSD19  /*WM기타*/
                                                 , CASE WHEN A.FEE_CD = 'W020086' THEN A.FEE_ATC_VAL END AS AKSD40  /*사전방문*/
                                                 , CASE WHEN A.FEE_CD IN ('W020098', 'W020099')  THEN A.FEE_ATC_VAL END AS AKSD16  /*유니폼*/
                                                 , CASE WHEN A.FEE_CD IN ('W020014', 'W020041') THEN A.FEE_ATC_VAL END AS AKSD10  /*자재실장*/
                                              FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                             WHERE A.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                               AND A.OG_TP_CD = 'W02'       --M조직
                                               AND A.FEE_TCNT_DV_CD = #{schOrdr}  --차수구분
                                           <if test="no != null and no != ''">
                                               AND A.PRTNR_NO = #{no}
                                           </if>
                                               AND A.FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                                               , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                                               , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                                               , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                                               , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                                               , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                                               , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041', 'W020054')
                                          )M
                                    GROUP BY M.PRTNR_NO, M.OG_TP_CD
                                 )F
                   ON A.PRTNR_NO = F.PRTNR_NO
                  AND A.OG_TP_CD = F.OG_TP_CD
                 LEFT OUTER JOIN ( SELECT E.PRTNR_NO
                                        , E.OG_TP_CD
                                        , SUM(E.INTBS_AMT) AS INTBS_SUM
                                        , SUM(E.DDCTAM) AS DDTN_SUM
                                        , SUM(E.DSB_OJ_AMT) AS ACL_DSB_AMT
                                     FROM TB_FEAM_FEE_DSB_IZ E
                                    WHERE E.DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                  <if test="no != null and no != ''">
                                      AND E.PRTNR_NO = #{no}
                                  </if>
                                    GROUP BY E.PRTNR_NO, E.OG_TP_CD
                                 )FEE
                   ON A.PRTNR_NO = FEE.PRTNR_NO
                  AND A.OG_TP_CD = FEE.OG_TP_CD
                 LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
                   ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
                  AND A.PRTNR_NO = G.PRTNR_NO
                  AND G.EDUC_CRSE_NO IN ('11','129','100','106','17','135','96','97','112','113', '98')
                  AND G.EDUC_CPC_ACKMT_YN = 'Y'
                WHERE A.BASE_YM = #{perfYm}
                  AND A.OG_TP_CD = 'W02'
              <if test="no != null and no != ''">
                  AND A.PRTNR_NO = #{no}
              </if>
                  AND ( A.PSTN_DV_CD = 7 OR A.PSTN_DV_CD = 15 )
               )T
    </select>

    <select id='selectPlannerFees' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarRes">
        SELECT A.OG_ID AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , CD1.CD_CNTN AS RSB_DV_CD /*직책*/
             , NVL(PM.PERF_VAL,0) AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
                END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                         CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                              WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                              WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , CASE WHEN G.EDUC_CRSE_NO = '14' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS11EDU /* 플래너스타트업 */
             , CASE WHEN G.EDUC_CRSE_NO = '19' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT /*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT /*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT /*업무해약월*/
             , SUBSTR(A.PRFMT_DT,1,6) AS AKSTYM  /*승진월*/
             , A.FST_CNTR_DT AS LCECAYMD /*웰스매니저 개시일 LC1700P 정리되지 않아 임시처리 */
             , MM.B_AKSD05 /*정착수수료 = 이전 정착수수료*/
             , NVL(B.AKCDA0,0) AS AKCDA0  /* 가전    */
             , NVL(B.AKCDA1,0) AS AKCDA1  /* 가전외    */
             , NVL(B.AKCDA2,0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(B.AKCDA3,0) AS AKCDA3  /* 환경(정액)  */
             , NVL(B.AKCDA4,0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(B.EC5AMT,0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(D.AKSD23,0) AS AKSD23  /* 정액 수당  */
             , NVL(D.AKSD24,0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(D.AKSD25,0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01,0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02,0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03,0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD21,0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD04,0) AS AKSD04  /* 미팅    */
             , NVL(D.AKSD05,0) AS AKSD05  /* 정착    */
             , NVL(D.AKSD20,0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD30,0) AS AKSD30  /* 기타지원  */
             , NVL(C.DSB_OJ_AMT,0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test="ogLevl1 != null and ogLevl1 != ''">
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
        </if>
        <if test="ogLevl2 != null and ogLevl2 != ''">
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
        </if>
        <if test="ogLevl3 != null and ogLevl3 != ''">
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test="no != null and no != ''">
                                        AND AK17.PRTNR_NO = #{no}
                                    </if>
                                         AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
            ON A.PRTNR_NO = PM.PRTNR_NO
           AND A.OG_TP_CD = PM.OG_TP_CD
           AND A.BASE_YM = PM.BASE_YM
           AND PM.FEE_TCNT_DV_CD = #{schOrdr}
           AND PM.PERF_ATC_CD = 'W01P00012'    /* 미팅참석일수 */
           AND PM.PERF_AGRG_CRT_DV_CD = '103'  /* P추진단미팅실적생성 */
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = '02'
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = '02'  --차수구분
                                    <if test="no != null and no != ''">
                                        AND PRTNR_NO = #{no}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010023'
                                                     , 'W010123', 'W010024', 'W010124', 'W010025', 'W010125')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                  UNION ALL
                                 SELECT PRTNR_NO
                                      , 0 AS P_CNT
                                      , COUNT(1) AS G_CNT
                                   FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                  WHERE BASE_YM = #{perfYm}
                                    AND CAN_DT = 0
                                    AND FLPYM_TN > 1
                                    AND LIF_CNTR_STAT_CD = 0
                                  GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , NVL(SUM(B_AKSD05),0) AS B_AKSD05
                             FROM ( SELECT PRTNR_NO
                                         , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                      FROM TB_FEAM_FEE_DSB_DTL_IZ
                                     WHERE DSB_YM &lt; #{perfYm}
                                       AND OG_TP_CD = 'W01' /*P조직*/
                                       AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                   <if test="no != null and no != ''">
                                       AND PRTNR_NO = #{no}
                                   </if>
                                   AND FEE_CD IN ('W010005', 'W010105')
                                 UNION
                                SELECT PRTNR_NO
                                     , FEE_ATC_VAL AS B_AKSD05  /* M조직 기준일 이전수수료 */
                                  FROM TB_FEAM_FEE_DSB_DTL_IZ
                                 WHERE DSB_YM &lt; #{perfYm}
                                   AND DSB_YM &gt;= '201904'
                                   AND OG_TP_CD = 'W02' /*M조직*/
                                   AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                               <if test="no != null and no != ''">
                                   AND PRTNR_NO = #{no}
                               </if>
                                   AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )
                             GROUP BY PRTNR_NO
                           )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
          LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
            ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
           AND A.PRTNR_NO = G.PRTNR_NO
           AND G.EDUC_CRSE_NO IN ('14','19')
           AND G.EDUC_CPC_ACKMT_YN = 'Y'
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON A.RSB_DV_CD = CD1.CD_VLD_VAL
           AND CD1.CD_ID = 'RSB_DV_CD'
           AND CD1.TENANT_ID = 'TNT_WELLS'
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test="no != null and no != ''">
           AND A.PRTNR_NO = #{no}
       </if>
           AND A.PSTN_DV_CD = '15'
    </select>
    <select id='selectPlannerBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarBrmgrRes">
        SELECT A.OG_ID AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , CD1.CD_CNTN AS RSB_DV_CD /*직책*/
             , '플래너지점장' AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '플래너지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT     /*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /*최초업무등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종 해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT     /*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN G.EDUC_CRSE_NO = '19' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS17EDU /* 수석(플래너)실전 */
             , CASE WHEN A.DMTN_DT > 0 THEN SUBSTR(A.DMTN_DT,1,6)
                    ELSE CASE WHEN AA.DMTN_DT > 0 THEN SUBSTR(AA.DMTN_DT,1,6) ELSE '' END
               END AS AKDRIY                    /* 승진월     */
             , SUBSTR(PAI.UPGR_YM,1,6) AS AKSTYM  /*수석승급월*/
             , A.FST_CNTR_DT AS LCECAYMD /*웰스매니저 개시일 LC1700P 정리되지 않아 임시처리 */
             , NVL(B.AKCDA0,0) AS AKCDA0  /* 가전    */
             , NVL(B.AKCDA1,0) AS AKCDA1  /* 가전외    */
             , NVL(B.AKCDA2,0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(B1.AKCDA0,0) AS AKCDAG0  /* 지점 가전    */
             , NVL(B1.AKCDA1,0) AS AKCDAG1  /* 지점 가전외    */
             , NVL(B1.AKSQ02,0) AS AKSQG02  /* 지점 상조    */
             , NVL(B.AKCDA3,0) AS AKCDA3  /* 환경(정액)  */
             , NVL(B.AKCDA4,0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(B.EC5AMT,0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(D.AKSD23,0) AS AKSD23  /* 정액 수당  */
             , NVL(D.AKSD24,0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(D.AKSD25,0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01,0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02,0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03,0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD11,0) AS AKSD11  /* 가전조직비례 */
             , NVL(D.AKSD12,0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(D.AKSD13,0) AS AKSD13  /* 조직판매장려 */
             , NVL(D.AKSD05,0) AS AKSD05  /* 정착수수료 */
             , NVL(D.AKSD16,0) AS AKSD16  /* 조직배출1 */
             , NVL(D.AKSD17,0) AS AKSD17  /* 조직배출2 */
             , NVL(D.AKSD18,0) AS AKSD18  /* 승진수수료 */
             , NVL(D.AKSD15,0) AS AKSD15  /* 신설 */
             , NVL(D.AKSD20,0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD21,0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD22,0) AS AKSD22  /* 지점장상조   */
             , NVL(D.AKSD30,0) AS AKSD30  /* 기타지원  */
             , NVL(C.DSB_OJ_AMT,0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test="ogLevl1 != null and ogLevl1 != ''">
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
        </if>
        <if test="ogLevl2 != null and ogLevl2 != ''">
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
        </if>
        <if test="ogLevl3 != null and ogLevl3 != ''">
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                          <if test="no != null and no != ''">
                                        AND AK17.PRTNR_NO = #{no}
                                          </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                        AND AK17.PERF_ATC_CD IN ( 'W01P00001' , 'W01P00004' , 'W00P00028' , 'W00P00029' , 'W00P00030'
                                                                , 'W00P00009' , 'W01P00016' , 'W01P00018'
                                                                )
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00010' THEN PERF_VAL END AS AKSQ02   /* 상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                    <if test="no != null and no != ''">
                                        AND AK17.PRTNR_NO = #{no}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                     )M
                                GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
        LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                               , MAX(UPGR_YM) AS UPGR_YM
                            FROM TB_OGPS_TOPMR_PLAR_APLC_IZ A  /* 수석플래너신청내역 */
                           WHERE A.OG_TP_CD = 'W01'
                             AND A.QLF_DV_CD = '1'  /* 수석플래너 */
                             AND A.UPGR_DMTN_DV_CD = '1' /* 승급 */
                        <if test="no != null and no != ''">
                             AND A.PRTNR_NO = #{no}
                        </if>
                           GROUP BY A.PRTNR_NO
                        )PAI
          ON A.PRTNR_NO = PAI.PRTNR_NO
        LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
          ON A.PRTNR_NO = C.PRTNR_NO
         AND A.BASE_YM = C.DSB_YM
         AND A.OG_TP_CD = C.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = '02'
        LEFT OUTER JOIN ( SELECT PRTNR_NO
                               , DSB_YM
                               , CO_CD
                               , OG_TP_CD
                               , FEE_TCNT_DV_CD
                               , SPMT_DSB_DV_CD
                               , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                               , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                               , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                               , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                               , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                               , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                               , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                               , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                               , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                               , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                               , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                               , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                               , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착 */
                               , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료 */
                               , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                               , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                               , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                               , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                            FROM ( SELECT PRTNR_NO
                                        , DSB_YM
                                        , CO_CD
                                        , OG_TP_CD
                                        , FEE_TCNT_DV_CD
                                        , SPMT_DSB_DV_CD
                                        , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                        , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                        , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                        , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                        , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                        , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                        , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                        , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                        , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                        , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD05 /* 정착    */
                                        , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                        , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                        , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                        , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18                         /* 승진수수료 */
                                        , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                        , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                        , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                        , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                     FROM TB_FEAM_FEE_DSB_DTL_IZ
                                    WHERE DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                      AND OG_TP_CD = 'W01'
                                      AND FEE_TCNT_DV_CD = '02'  /* 확정 */
                                 <if test="no != null and no != ''">
                                      AND PRTNR_NO = #{no}
                                 </if>
                                      AND FEE_CD IN ('W010023', 'W010123', 'W010024', 'W010124', 'W010025', 'W010125', 'W010001', 'W010101', 'W010118'
                                                   , 'W010002', 'W010102', 'W010003', 'W010103', 'W010011', 'W010012', 'W010013', 'W010016', 'W010018'
                                                   , 'W010017', 'W010015',  'W010020', 'W010120', 'W010021', 'W010021', 'W010022', 'W010030', 'W010130'
                                                   , 'W010005', 'W010105' )
                                 )
                           GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                        )D
          ON C.PRTNR_NO = D.PRTNR_NO
         AND C.DSB_YM = D.DSB_YM
         AND C.OG_TP_CD = D.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
         AND C.CO_CD = D.CO_CD
         AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
        LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                               , SUM(Z.P_CNT) AS P_CNT
                               , SUM(Z.G_CNT) AS G_CNT
                            FROM ( SELECT PRTNR_NO
                                        , COUNT(1) AS P_CNT
                                        , 0 AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT = 0
                                      AND FLPYM_TN = 1
                                      AND LIF_CNTR_STAT_CD = 0
                                    GROUP BY PRTNR_NO
                                    UNION ALL
                                   SELECT PRTNR_NO
                                        , 0 AS P_CNT
                                        , COUNT(1) AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT = 0
                                      AND FLPYM_TN > 1
                                      AND LIF_CNTR_STAT_CD = 0
                                    GROUP BY PRTNR_NO
                                 ) Z GROUP BY Z.PRTNR_NO
                        ) EE
          ON A.PRTNR_NO = EE.PRTNR_NO
        LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                               , SUM(RUNCNT) AS RUNCNT
                               , SUM(GADCNT) AS GADCNT
                            FROM ( SELECT A.PRTNR_NO
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                     FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                    WHERE A.BASE_YM = #{perfYm}
                                      AND A.FEE_TCNT_DV_CD = #{schOrdr}
                                      AND A.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                      AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035')
                                      AND A.CO_CD = '2000'
                                      AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                 <if test="no != null and no != ''">
                                      AND A.PRTNR_NO = #{no}
                                 </if>
                                      AND A.PERF_VAL > 0
                                 )M
                           GROUP BY M.PRTNR_NO
                        ) P_CNT
          ON A.PRTNR_NO = P_CNT.PRTNR_NO
        LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
          ON A.PRTNR_NO = F.PRTNR_NO
         AND A.OG_TP_CD = F.OG_TP_CD
         AND F.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
        LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
          ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
         AND A.PRTNR_NO = G.PRTNR_NO
         AND G.EDUC_CRSE_NO IN ('14','19')
         AND G.EDUC_CPC_ACKMT_YN = 'Y'
        LEFT OUTER JOIN T_CMZ_CD_D CD1
          ON A.RSB_DV_CD = CD1.CD_VLD_VAL
         AND CD1.CD_ID = 'RSB_DV_CD'
         AND CD1.TENANT_ID = 'TNT_WELLS'
       WHERE A.BASE_YM = #{perfYm}
         AND A.OG_TP_CD = 'W01' /*P조직*/
    <if test="no != null and no != ''">
         AND A.PRTNR_NO = #{no}
    </if>
         AND A.PSTN_DV_CD = 7
    </select>

    <select id='selectPlannerTotalFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarTotalRes">
        SELECT A.OG_ID AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , CD1.CD_CNTN AS RSB_DV_CD /*직책*/
             , CASE WHEN A.PSTN_DV_CD = 15 THEN NVL(P_CNT.AKCUIL,0)
                    ELSE 0
               END AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
               END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                    END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , CASE WHEN G.EDUC_CRSE_NO = '14' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS11EDU /* 플래너스타트업 */
             , CASE WHEN G.EDUC_CRSE_NO = '19' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT/*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT/*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT/*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT/*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT/*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN A.PSTN_DV_CD = 7 AND A.DMTN_DT > 0 THEN SUBSTR(A.DMTN_DT,1,6)
                    ELSE CASE WHEN A.PSTN_DV_CD = 7 AND AA.DMTN_DT > 0 THEN SUBSTR(AA.DMTN_DT,1,6)
                              ELSE ''
                         END
               END AS AKDRIY                    /* 승진월     */
             , NVL(SUBSTR(A.PRFMT_DT,1,6),0) AS AKSTYM  /*수석승급일*/
             , NVL(A.FST_CNTR_DT,0) AS LCECAYMD /*웰스매니저 개시일 LC1700P 정리되지 않아 임시처리 */
             , NVL(MM.B_AKSD05,0) AS B_AKSD05   /*정착수수료 = 이전 정착수수료*/
             , NVL(B.AKCDA0,0) AS AKCDA0        /* 가전    */
             , NVL(B.AKCDA1,0) AS AKCDA1        /* 가전외    */
             , NVL(B.AKCDA2,0) AS AKCDA2        /* 기변    */
             , NVL(EE.P_CNT, 0) AS AKSQ01       /* 당월 상조  */
             , NVL(EE.G_CNT, 0) AS N_AKSQ01     /* 상조 유지  */
             , NVL(B1.AKCDA0,0) AS AKCDAG0      /* 지점 가전    */
             , NVL(B1.AKCDA1,0) AS AKCDAG1      /* 지점 가전외    */
             , NVL(B1.AKSQ02,0) AS AKSQG02      /* 지점 상조    */
             , NVL(B.AKCDA3,0) AS AKCDA3        /* 환경(정액)  */
             , NVL(B.AKCDA4,0) AS AKCDA4        /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5        /* 라이브팩 건수 */
             , NVL(B.EC5AMT,0) AS EC5AMT        /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT    /* 관리상품 판매건수 */
             , NVL(D.AKSD23,0) AS AKSD23 /* 정액수수료 */
             , NVL(D.AKSD24,0) AS AKSD24 /* 라이브팩 수당 */
             , NVL(D.AKSD25,0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01,0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02,0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03,0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD21,0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD04,0) AS AKSD04  /* 미팅    */
             , NVL(D.AKSD05,0) AS AKSD05  /* 정착    */
             , NVL(D.AKSD20,0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD30,0) AS AKSD30  /* 기타지원  */
             , NVL(D.AKSD11,0) AS AKSD11  /* 가전조직비례 */
             , NVL(D.AKSD12,0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(D.AKSD13,0) AS AKSD13  /* 조직판매장려 */
             , NVL(D.AKSD16,0) AS AKSD16  /* 조직배출1 */
             , NVL(D.AKSD17,0) AS AKSD17  /* 조직배출2 */
             , NVL(D.AKSD15,0) AS AKSD15  /* 신설 */
             , NVL(D.AKSD18,0) AS AKSD18  /* 승진수수료 */
             , NVL(D.AKSD22,0) AS AKSD22  /* 지점장상조   */
             , NVL(C.DSB_OJ_AMT,0) AS AKSD99 /* 과표 */
             , NVL(C.DDCTAM,0) AS DDCTAM     /* 공제 */
             , NVL(C.DSB_OJ_AMT,0) AS DSB_OJ_AMT /* 실지급 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
       <if test="ogLevl1 != null and ogLevl1 != ''">
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1}
       </if>
       <if test="ogLevl2 != null and ogLevl2 != ''">
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2}
       </if>
       <if test="ogLevl3 != null and ogLevl3 != ''">
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3}
       </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                    <if test="no != null and no != ''">
                                        AND AK17.PRTNR_NO = #{no}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00010' THEN PERF_VAL END AS AKSQ02   /* 상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                    <if test="no != null and no != ''">
                                        AND AK17.PRTNR_NO = #{no}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = '02'
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                                 , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                                 , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                                 , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                                 , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                                 , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                                 , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                                 , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액수수료   */
                                 , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료   */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010021') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                          , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                          , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                          , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                          , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                          , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                          , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                          , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD23 /* 정액수수료  */
                                          , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18 /* 승진수수료  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = TO_CHAR(ADD_MONTHS( #{perfYm}||'01', '1' ),'YYYYMM' )
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = '02'  --차수구분
                                    <if test="no != null and no != ''">
                                        AND PRTNR_NO = #{no}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010024'
                                                     , 'W010124', 'W010025', 'W010125', 'W010011', 'W010012', 'W010013', 'W010016', 'W010017'
                                                     , 'W010015',  'W010022', 'W010023', 'W010123', 'W010018', 'W010118')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , 0 AS P_CNT
                                          , COUNT(1) AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT = 0
                                        AND FLPYM_TN > 1
                                        AND LIF_CNTR_STAT_CD = 0
                                      GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(#{perfYm}||'01', '1' ),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , NVL(SUM(B_AKSD05),0) AS B_AKSD05
                              FROM ( SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND OG_TP_CD = 'W01' /*P조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                    <if test="no != null and no != ''">
                                        AND PRTNR_NO = #{no}
                                    </if>
                                        AND FEE_CD IN ('W010005', 'W010105')
                                      UNION
                                     SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* M조직 기준일 이전수수료 */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND DSB_YM &gt;= '201904'
                                        AND OG_TP_CD = 'W02' /*M조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                    <if test="no != null and no != ''">
                                        AND PRTNR_NO = #{no}
                                    </if>
                                        AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )
                             GROUP BY PRTNR_NO
                           )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , SUM(RUNCNT) AS RUNCNT
                                 , SUM(GADCNT) AS GADCNT
                                 , SUM(AKCUIL) AS AKCUIL
                              FROM ( SELECT A.PRTNR_NO
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00012' THEN PERF_VAL END AS AKCUIL   /* 미팅참석일수 */
                                       FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                      WHERE A.BASE_YM = #{perfYm}
                                        AND A.FEE_TCNT_DV_CD = #{schOrdr}
                                        AND A.PERF_AGRG_CRT_DV_CD IN ('101','103') /* P추진단순주문실적생성, P조직미팅참석집계 */
                                        AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035', 'W01P00012')
                                        AND A.CO_CD = '2000'
                                        AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   <if test="no != null and no != ''">
                                        AND A.PRTNR_NO = #{no}
                                   </if>
                                        AND A.PERF_VAL > 0
                                   )M
                             GROUP BY M.PRTNR_NO
                          ) P_CNT
            ON A.PRTNR_NO = P_CNT.PRTNR_NO
          LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_AGRG G
            ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
           AND A.PRTNR_NO = G.PRTNR_NO
           AND G.EDUC_CRSE_NO IN ('14','19')
           AND G.EDUC_CPC_ACKMT_YN = 'Y'
          LEFT OUTER JOIN T_CMZ_CD_D CD1
            ON A.RSB_DV_CD = CD1.CD_VLD_VAL
           AND CD1.CD_ID = 'RSB_DV_CD'
           AND CD1.TENANT_ID = 'TNT_WELLS'
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test="no != null and no != ''">
           AND A.PRTNR_NO = #{no}
       </if>
           AND ( A.PSTN_DV_CD = 7 OR A.PSTN_DV_CD = 15 )
    </select>

    <select id='selectWmFees' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchWmRes">
    SELECT '서울총괄단' AS COL1
        , '서울지역단' AS COL2
        , '김웰스지점' AS COL3
        , '1673419' AS COL4
        , '김교원' AS COL5
        , '플래너' AS COL6
        , 34 AS COL7
        , '2019-03' AS COL8
        , '-' AS COL9
        , '2014-10' AS COL10
        , 56 AS COL11
        , '미지급' AS COL12
        , 123456000 AS COL13
        , 2 AS COL14
        , 3 AS COL15
        , 0 AS COL16
        , 12 AS COL17
        , 81 AS COL18
        , 0 AS COL19
        , 129 AS COL20
        , 1234500 AS COL21
        , 100 AS COL22
        , 1234500 AS COL23
        , 0 AS COL24
        , 0 AS COL25
        , 0 AS COL26
        , 0 AS COL27
        , 0 AS COL28
        , 0 AS COL29
        , 34000 AS COL30
        , 0 AS COL31
        , 0 AS COL32
        , 0 AS COL33
        , 123450 AS COL34
        , 0 AS COL35
        , 123 AS COL36
        , 'N' AS COL37
        , 'N' AS COL38
        , 15 AS COL39
        , 'N' AS COL40
      FROM DUAL
    UNION ALL
    SELECT '경기총괄단' AS COL1
        , '경기지역단' AS COL2
        , '박웰스지점' AS COL3
        , '1673419' AS COL4
        , '박교원' AS COL5
        , '플래너' AS COL6
        , 34 AS COL7
        , '2019-03' AS COL8
        , '-' AS COL9
        , '2014-10' AS COL10
        , 56 AS COL11
        , '미지급' AS COL12
        , 123456000 AS COL13
        , 2 AS COL14
        , 3 AS COL15
        , 0 AS COL16
        , 12 AS COL17
        , 81 AS COL18
        , 0 AS COL19
        , 129 AS COL20
        , 1234500 AS COL21
        , 100 AS COL22
        , 1234500 AS COL23
        , 0 AS COL24
        , 0 AS COL25
        , 0 AS COL26
        , 0 AS COL27
        , 0 AS COL28
        , 0 AS COL29
        , 34000 AS COL30
        , 0 AS COL31
        , 0 AS COL32
        , 0 AS COL33
        , 123450 AS COL34
        , 0 AS COL35
        , 123 AS COL36
        , 'N' AS COL37
        , 'N' AS COL38
        , 15 AS COL39
        , 'N' AS COL40
      FROM DUAL
    </select>

    <select id='selectdsbCnst' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchDsbCnstRes">
        SELECT CASE WHEN T2.APRV_PRGS_STT_CD = 'A04003' THEN 'Y'  /* 승인 */
                    WHEN T2.APRV_PRGS_STT_CD IN ('A04002','A04005') THEN 'N' /*  진행, 보류 = 품의 진행 중 */
                    WHEN T2.APRV_PRGS_STT_CD IN ('A04004','A04006','A99999') THEN 'P' /*  반송, 회수, 존재하지 않는 문서ID = 신규품의 재결재 가능 */
                    ELSE '' /* 최초 신규 품의 */
               END AS DSB_CNST_YN
          FROM TB_FEAM_FEE_DSB_CNST_IZ T1    /*T 수수료지급품의내역 T*/
         INNER JOIN T_CML_APRV_MNGT_M T2     /*T 결재이력관리 T  공통쪽 배치를 통해 결재상태 업데이트 */
            ON T1.FEE_CNST_NO = T2.APP_KEY
         WHERE T1.DSB_YM = #{perfYm}   /* 지급년월 */
           AND T1.OG_TP_CD = #{ogTp}   /* 조직유형 */
           AND T1.DTA_DL_YN = 'N'      /* 데이터 삭제여부 */
           AND T1.FNL_YN = 'N'         /* 최종여부 */
    </select>

    <update id="updateDsbIz">
        UPDATE TB_FEAM_FEE_DSB_IZ
           SET APRV_ID = #{appKey}   /* 결재ID  */
        <include refid="COMMON.updateSystemField"/>
         WHERE DSB_YM = #{perfYm}    /* 지급년월 */
           AND OG_TP_CD = #{ogTp}    /* 조직유형 */
           AND FEE_TCNT_DV_CD = '02' /* 2차 실지급*/
    </update>

    <insert id="insertDsbCnstIz">
        INSERT INTO TB_FEAM_FEE_DSB_CNST_IZ
               ( FEE_CNST_NO
               , DCB_YM
               , CO_CD
               , OG_TP_CD
               , FEE_CNST_UNIT_CD
               , DRFTR_ID
               , APRV_ID
               , FNL_YN
               , DTA_DL_YN
        <include refid="COMMON.insertSystemField" />
               )
        VALUES ( #{appKey}
               , #{perfYm}
               , '2000'
               , #{ogTp}
               , #{unitCd}
               , #{session.userId}
               , #{appKey}
               , 'Y'
               , 'N'
        <include refid="COMMON.insertSystemFieldValue" />
               )
    </insert>

    <update id="updateDsbCnstIz">
        UPDATE TB_FEAM_FEE_DSB_CNST_IZ
           SET FNL_YN = 'N'  /* 최종여부  */
        <include refid="COMMON.updateSystemField"/>
         WHERE DSB_YM = #{perfYm}    /* 지급년월 */
           AND OG_TP_CD = #{ogTp}    /* 조직유형 */
    </update>


    <!-- 수수료생성관리 - 홈마스터 품의 내용 조회-->
    <select id="selectHmstFeeFormDtl" resultType="Hashmap" >

            SELECT #{perfYm} AS perfYm
                 , W030001 + W030051 + W030005 + W030055 + W030004 + W030054 + W030006 + W030056 + W030002 + W030003 + W030053 + W030016
                   + W030007 + W030057 +  W030008 + W030058 +  W030009 + W030058 +  W030010 + W030060
                   + W030011 + W030061 +  W030012 + W030062 +  W030014 + W030064 AS tax_std_tam
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]>  202301 THEN W030001 + W030051 + W030005 + W030055
                        ELSE W030001 + W030005
                   END AS atc1_amt1
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030004 + W030054 + W030006 + W030056
                        ELSE W030004 + W030006
                   END AS atc1_amt2
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202209 THEN W030003 + W030053
                        WHEN #{perfYm}  <![CDATA[  > ]]> 202209 AND 202305 <![CDATA[ <=  ]]> 202301 THEN W030002 + W030053
                        ELSE W030002
                   END AS atc1_amt3
                 , CASE WHEN #{perfYm}  <![CDATA[  < ]]>   202310 THEN 0
                        ELSE W030016
                   END AS atc1_amt4
                 , W030001 + W030051 + W030005 + W030055 + W030004 + W030054 + W030006 + W030056 + W030002 + W030003 + W030053 + W030016 AS sbsum1
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030007 + W030057
                        ELSE W030007
                   END AS act2_amt1
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202209 THEN W030008 + W030058
                        WHEN #{perfYm}  <![CDATA[  > ]]>  202209 AND 202305 <![CDATA[ <=  ]]> 202301 THEN W030009 + W030058
                        ELSE W030009
                   END AS act2_amt2
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030010 + W030060
                        ELSE W030010
                   END AS act2_amt3
                 , W030007 + W030057 +  W030008 + W030058 +  W030009 + W030058 +  W030010 + W030060 AS sbsum2
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030011 + W030061
                        ELSE W030011
                   END AS atc3_amt1
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030012 + W030062
                        ELSE W030012
                   END AS atc3_amt2
                 , CASE WHEN #{perfYm}  <![CDATA[ <=  ]]> 202301 THEN W030014 + W030064
                        ELSE W030014
                   END AS atc3_amt3
                 , W030011 + W030061 +  W030012 + W030062 +  W030014 + W030064 AS sbsum3
                 , DDTN.ATC4_AMT1   AS atc4_amt1
                 , DDTN.ATC4_AMT2   AS atc4_amt2
                 , DDTN.ATC4_AMT3   AS atc4_amt3
                 , DDTN.ATC4_AMT4   AS atc4_amt4
                 , PNPYAM.ATC4_AMT5 AS atc4_amt5
                 , PNPYAM.ATC4_AMT6 AS atc4_amt6
                 , (DDTN.ATC4_AMT1+DDTN.ATC4_AMT2   +DDTN.ATC4_AMT3   +DDTN.ATC4_AMT4   + PNPYAM.ATC4_AMT5 +PNPYAM.ATC4_AMT6 ) AS sbsum4	-- 공제 소계
                 , W030001 + W030051 + W030005 + W030055 + W030004 + W030054 + W030006 + W030056 + W030002 + W030003 + W030053 + W030016
                    + W030007 + W030057 +  W030008 + W030058 +  W030009 + W030058 +  W030010 + W030060
                    + W030011 + W030061 +  W030012 + W030062 +  W030014 + W030064 AS txstdSumAmt
                 , W030001 + W030051 + W030005 + W030055 + W030004 + W030054 + W030006 + W030056 + W030002 + W030003 + W030053 + W030016
                      + W030007 + W030057 +  W030008 + W030058 +  W030009 + W030058 +  W030010 + W030060
                      + W030011 + W030061 +  W030012 + W030062 +  W030014 + W030064
                        - (DDTN.ATC4_AMT1 + DDTN.ATC4_AMT2 + DDTN.ATC4_AMT3 + DDTN.ATC4_AMT4 + PNPYAM.ATC4_AMT5 +PNPYAM.ATC4_AMT6 ) AS acpySumAmt
                 , INCEN.INCEN_1 AS baseAmt
                 , INCEN.INCEN_2 AS ddtnAmt
                 , INCEN.INCEN_1 - INCEN.INCEN_2 AS calAmt
            FROM ( SELECT W030001, W030051, W030005, W030055, W030004
                          , W030054, W030006, W030056, W030003, W030053
                          , W030007, W030057, W030008, W030058, W030010
                          , W030060, W030011, W030061, W030012, W030062
                          , W030014, W030064, W030016, W030002, W030009
                        FROM ( SELECT FEE_CD
                                   , FEE_ATC_VAL
                               FROM TB_FEAM_FEE_DSB_DTL_IZ A    /* 수수료지급상세내역 */
                              WHERE A.DSB_YM = #{perfYm}        /* 지급년월 */
                                AND A.OG_TP_CD = 'W03'          /* 조직구분 = 홈마스터 */
                                AND A.FEE_TCNT_DV_CD = '02'     /* 실제지급 */
                            )
                        PIVOT ( SUM(FEE_ATC_VAL)
                                FOR FEE_CD IN (     'W030001' AS W030001, 'W030051' AS W030051, 'W030005' AS W030005, 'W030055' AS W030055, 'W030004' AS W030004
                                                  , 'W030054' AS W030054, 'W030006' AS W030006, 'W030056' AS W030056, 'W030003' AS W030003, 'W030053' AS W030053
                                                  , 'W030007' AS W030007, 'W030057' AS W030057, 'W030008' AS W030008, 'W030058' AS W030058, 'W030010' AS W030010
                                                  , 'W030060' AS W030060, 'W030011' AS W030011, 'W030061' AS W030061, 'W030012' AS W030012, 'W030062' AS W030062
                                                  , 'W030014' AS W030014, 'W030064' AS W030064, 'W030016' AS W030016, 'W030002' AS W030002, 'W030009' AS W030009

                                              )
                              )
                   ) AA
            LEFT OUTER JOIN (
                                /*  공제내역 - 가지급금 */
                                SELECT
                                     CASE WHEN FEE_DDTN_TP_CD ='01' THEN SUM(NVL(FEE_DDTN_CNFM_AMT,0)) END AS ATC4_AMT1--- 수수료공제확정금액 -  보증예치금(RDS)
                                    ,CASE WHEN FEE_DDTN_TP_CD ='02' THEN SUM(NVL(FEE_DDTN_CNFM_AMT,0)) END AS ATC4_AMT2--- 수수료공제확정금액 -  소득세
                                    ,CASE WHEN FEE_DDTN_TP_CD ='03' THEN SUM(NVL(FEE_DDTN_CNFM_AMT,0)) END AS ATC4_AMT3--- 수수료공제확정금액 -  주민세
                                    ,CASE WHEN FEE_DDTN_TP_CD ='05' THEN SUM(NVL(FEE_DDTN_CNFM_AMT,0)) END AS ATC4_AMT4--- 수수료공제확정금액 -  고용보험
                                FROM TB_FEAM_FEE_DDTN_IZ    -- 수수료공제내역
                                WHERE 1=1
                                    AND DDTN_YM = #{perfYm}
                                    AND OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = '02' -- 수수료차수구분코드
                                GROUP BY DDTN_YM , OG_TP_CD , FEE_DDTN_TP_CD
                              ) DDTN
                  ON 1=1
                LEFT OUTER JOIN
                             (  /* 공제내역 - 가지급금 상세 */
                                SELECT
                                    CASE WHEN PNPYAM_ATC_CD = '20' THEN SUM(NVL(FEE_DDCTAM,0)) END AS ATC4_AMT5 -- 가지급금 산재보험
                                    ,CASE WHEN PNPYAM_ATC_CD = '29' THEN SUM(NVL(FEE_DDCTAM,0)) END AS ATC4_AMT6 -- 가지급금 유니폼공제
                                FROM TB_FEAM_FEE_DDTN_DTL_IZ    -- 수수료공제상세내역
                                WHERE 1=1
                                    AND DDTN_YM = #{perfYm}
                                    AND OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = '02' -- 수수료차수구분코드
                                    GROUP BY DDTN_YM , OG_TP_CD , FEE_DDTN_TP_CD , PNPYAM_ATC_CD
                             ) PNPYAM
                ON 1=1
            LEFT OUTER JOIN (
                                SELECT SUM(AWD_INTBS_AMT) AS INCEN_1-- 시상소득과표금액
                                        ,SUM(AWD_ERN_WHTX) AS INCEN_2 --원천세
                                FROM TB_PSEV_AWD_ERN_WHTX_IZ          -- 시상소득원천세내역
                                WHERE PERF_YM = #{perfYm}
                                GROUP BY PERF_YM
                              ) INCEN
                ON 1=1


    </select>

</mapper>
