<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.fee.calculation.mapper.WfebOrganizationFeeMapper">

    <select id='selectHomeMasterFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstRes">
        SELECT B.DGR2_LEVL_OG_NM    /*지역단*/
             , B.DGR3_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , CEIL(MONTHS_BETWEEN(A.BASE_YM || '01', A.CNTR_DT)) + 1 AS AKDCHA    /* 차월 */
             , H.HMST_GD_VAL AS PRTNR_GD_CD  /* 급수 */
             , G.EDUC_CRSE_CRT_BASE_YM AS EDU100            /*신입입문교육*/
             , NVL(D.AKCDA10,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA12,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , NVL(C.LCCNT1, 0) AS LCCNT1    /* 배정건수 */
             , NVL(C.C_LCCNT1, 0) AS C_LCCNT1  /* 취소건수 */
             , NVL(C.R_LCCNT1, 0) AS R_LCCNT1   /* 실배정건 */
             , NVL(C.GD_SERCNT, 0) AS GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , NVL(C.ELECNT, 0) AS ELECNT     /* 가전 건수 */
             , NVL(C.NELECNT, 0) AS NELECNT     /* 가전외 건수 */
             , NVL(C.SERCNT, 0) AS SERCNT     /* 총 서비스건수 */
             , NVL(C.SERRYL, 0) AS SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.EARL_SETTLE_FEE, 0) AS EARL_SETTLE_FEE  /* 조기정착수수료 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , NVL(E.AKSD16,0) AS AKSD16   /* 유니폼 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00031' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND AK17.PRTNR_NO = #{prtnrNo}
                               </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                                    AND AK17.PERF_AGRG_CRT_DV_CD = '301'   /* 홈마스터순주문실적생성 */
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(NVL(LCCNT1, 0)) AS LCCNT1
                             , SUM(NVL(C_LCCNT1, 0)) AS C_LCCNT1
                             , SUM(NVL(LCCNT1, 0)) - SUM(NVL(C_LCCNT1, 0)) AS R_LCCNT1
                             , SUM(NVL(GD_LCCNT2, 0)) + SUM(NVL(GD_LCCNT3, 0)) AS GD_SERCNT
                             , SUM(NVL(EL_LCCNT2, 0)) + SUM(NVL(EL_LCCNT3, 0)) AS NELECNT   /*메트리스,비데 = 가전 외*/
                             , SUM(NVL(EL_LCCNT4, 0)) AS ELECNT /*메트리스, 비데 외 = 가전*/
                             , SUM(NVL(LCCNT2, 0)) + SUM(NVL(LCCNT3, 0)) AS SERCNT
                             , SUM(NVL(LCRAT1, 0)) AS SERRYL
                          FROM ( SELECT Z.PRTNR_NO
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999901' THEN Z.PERF_VAL END AS LCCNT1
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999902' THEN Z.PERF_VAL END AS LCCNT2
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999903' THEN Z.PERF_VAL END AS LCCNT3
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999909' THEN Z.PERF_VAL END AS LCRAT1
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01909001' THEN Z.PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01139902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01159902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01129902'
                                                  ) THEN Z.PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01139903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01159903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01129903'
                                                  ) THEN Z.PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01199902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01029902'
                                                  ) THEN Z.PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01199903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01029903'
                                                  ) THEN Z.PERF_VAL END AS EL_LCCNT3
                                      , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV2 &lt; '90'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV2 NOT IN ('19','02')
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV3 = '99'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV4 IN ('02','03')
                                                  THEN Z.PERF_VAL
                                        END AS EL_LCCNT4
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                  INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                     ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                    AND SUBSTR(X.PRTNR_SV_PERF_ATC_CD,1,2) = 'HM'
                                  WHERE Z.BASE_YM = #{perfYm}
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND Z.PRTNR_NO = #{prtnrNo}
                               </if>
                                    AND Z.CL_DV_CD = '02'
                                    AND Z.OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                             , SUM(M.AKSD16) AS AKSD16
                             , SUM(M.EARL_SETTLE_FEE) AS EARL_SETTLE_FEE
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                      , CASE WHEN A.FEE_CD IN ('W030013', 'W030063') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD16
                                      , CASE WHEN A.FEE_CD IN ('W030016') THEN A.FEE_ATC_VAL ELSE 0 END AS EARL_SETTLE_FEE
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = #{perfYm}
                                    AND A.OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND FEE_ATC_DV_CD = '01'
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030051', 'W030002', 'W030003', 'W030052', 'W030053',
                                                      'W030004', 'W030054', 'W030005', 'W030055', 'W030006', 'W030056',
                                                      'W030007', 'W030057', 'W030008', 'W030009', 'W030058', 'W030059',
                                                      'W030010', 'W030060', 'W030011', 'W030061', 'W030012', 'W030062',
                                                      'W030014', 'W030064', 'W030015', 'W030065', 'W030013', 'W030063', 'W030016'
                                                    )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = #{perfYm}
                           AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                           AND A.PRTNR_NO = #{prtnrNo}
                      </if>
                           AND A.OG_TP_CD = 'W03'
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
        ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = G.PRTNR_NO
       AND A.OG_TP_CD = G.OG_TP_CD
       AND G.EDUC_CRSE_NO = '124'
       AND G.EDUC_CPC_ACKMT_YN = 'Y'
      LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS H
        ON A.BASE_YM = H.MNGT_YM
       AND A.PRTNR_NO = H.PRTNR_NO
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'
   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
       AND A.PRTNR_NO = #{prtnrNo}
   </if>
       AND A.RSB_DV_CD = 'W0302'
    </select>


    <select id='selectHomeMasterBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchHmstBrmgrRes">
        SELECT B.DGR2_LEVL_OG_NM    /*지역단*/
             , B.DGR3_LEVL_OG_NM    /*지점*/
             , A.PRTNR_NO  /*번호*/
             , A.PRTNR_KNM  /*성명*/
             , A.RSB_DV_CD  /*직책*/
             , TO_CHAR(TO_DATE(A.CNTR_DT),'YYYY-MM') AS AKDSYM		/* 업무 등록월 */
             , CEIL(MONTHS_BETWEEN(A.BASE_YM || '01', A.CNTR_DT)) + 1 AKDCHA    /* 차월 */
             , I.HMST_GD_VAL AS PRTNR_GD_CD  /* 급수 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN 1 ELSE 0 END AS ATCNT1 /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN 1 ELSE 0 END AS ATCNT2 /* 교육수료일수 동행교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '124' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS124EDU /* 교육수료일수 집합교육 */
             , CASE WHEN H.EDUC_CRSE_NO = '125' THEN H.EDUC_CRSE_CRT_BASE_YM END AS IS125EDU /* 교육수료일수동행교육 */
             , NVL(D.AKCDA10,0) AS AKCDA10	  /* 매트리스 */
             , NVL(D.AKCDA12,0) AS AKCDA12	  /* 매트리스 외*/
             , NVL(D.AKCDA14,0) AS AKCDA14	  /* 정액 */
             , NVL(D.AKCDA13,0) AS AKCDA13	  /* 환경가전 */
             , NVL(D.AKCDA15,0) AS AKCDA15	  /* 환경가전 외 */
             , NVL(D.AKCDA11,0) AS AKCDA11	  /* 홈케어패키지 */
             , NVL(D.AKCDA19,0) AS AKCDA19	  /* 홈케어 멤버십*/
             , NVL(D.DEDEQ3,0) + NVL(D.EC3DET,0) AS DEDEQ3	  /* 기변(1)건수 */
             , NVL(D.AKDEQ0,0) AS AKDEQ0	  /* 총 판매건수 */
             , NVL(C.LCCNT1, 0) AS LCCNT1     /* 배정건수 */
             , NVL(C.C_LCCNT1, 0) AS C_LCCNT1   /* 취소건수 */
             , NVL(C.R_LCCNT1, 0) AS R_LCCNT1   /* 실배정건 */
             , NVL(C.GD_SERCNT, 0) AS GD_SERCNT  /* 세탁기/에어컨/건조기 건수 */
             , NVL(C.ELECNT, 0) AS ELECNT     /* 가전 건수 */
             , NVL(C.NELECNT, 0) AS NELECNT     /* 가전외 건수 */
             , NVL(C.SERCNT, 0) AS SERCNT     /* 총 서비스건수 */
             , NVL(C.SERRYL, 0) AS SERRYL     /* 처리율 */
             , NVL(E.AKSD01,0) AS AKSD01   /* 비례 */
             , NVL(E.AKSD03,0) AS AKSD03   /* 장려 */
             , NVL(E.AKSD04,0) AS AKSD04   /* 일시불 */
             , NVL(E.AKSD15,0) AS AKSD15   /* 기변 */
             , NVL(E.AKSD05,0) AS AKSD05   /* 홈케어멤버십 */
             , NVL(E.AKSD06,0) AS AKSD06   /* 서비스현장 */
             , NVL(E.AKSD07,0) AS AKSD07   /* 서비스활동 */
             , NVL(E.AKSD09,0) AS AKSD09   /* 서비스누적 */
             , NVL(E.AKSD10,0) AS AKSD10   /* 교육 */
             , NVL(E.AKSD11,0) AS AKSD11   /* 급지 */
             , NVL(E.AKSD13,0) AS AKSD13   /* 기타지원 */
             , NVL(E.AKSD14,0) AS AKSD14   /* 재지급 */
             , NVL(E.AKSD16,0) AS AKSD16   /* 유니폼 */
             , G.GADCNT AS GADCNT   /* 실활동인원 */
             , G.J_AKDEQ0    /* 인정건수 */
             , G.J_SERCNT    /* 서비스건수 */
             , NVL(E.AKSD51,0) AS AKSD51   /* 렌탈 */
             , NVL(E.AKSD52,0) AS AKSD52   /* 일시불/할부 */
             , NVL(E.AKSD53,0) AS AKSD53   /* 판매연계 */
             , NVL(E.AKSD54,0) AS AKSD54   /* 조직관리 */
             , NVL(E.AKSD55,0) AS AKSD55   /* 신규판매 */
             , NVL(E.AKSD56,0) AS AKSD56   /* 서비스연계 */
             , NVL(F.INTBS_SUM,0) AS INTBS_SUM       /*과표합계*/
             , NVL(F.DDTN_SUM,0) AS DDTN_SUM         /*총공제액*/
             , NVL(F.ACL_DSB_AMT,0) AS ACL_DSB_AMT   /*실지급액*/
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.BASE_YM = B.BASE_YM
           AND A.OG_ID = B.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND B.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND B.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(AKCDA10) AS AKCDA10
                             , SUM(AKCDA12) AS AKCDA12
                             , SUM(AKCDA14) AS AKCDA14
                             , SUM(AKCDA13) AS AKCDA13
                             , SUM(AKCDA15) AS AKCDA15
                             , SUM(AKCDA11) AS AKCDA11
                             , SUM(AKCDA19) AS AKCDA19
                             , SUM(DEDEQ3) AS DEDEQ3
                             , SUM(EC3DET) AS EC3DET
                             , SUM(AKDEQ0) AS AKDEQ0
                          FROM ( SELECT AK17.PRTNR_NO
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00031' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA10
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00122' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA12
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00005' THEN AK17.PERF_VAL END AS AKCDA14
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00004' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA13
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00006' THEN AK17.PERF_VAL ELSE 0 END AS AKCDA15
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00032' THEN AK17.PERF_VAL END AS AKCDA11
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00123' THEN AK17.PERF_VAL END AS AKCDA19
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00014' THEN AK17.PERF_VAL END AS DEDEQ3
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W00P00018' THEN AK17.PERF_VAL END AS EC3DET
                                      , CASE WHEN AK17.PERF_ATC_CD = 'W03P00002' THEN AK17.PERF_VAL END AS AKDEQ0
                                   FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                  WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND AK17.BASE_YM = #{perfYm}
                                    AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND AK17.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND AK17.OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                                    AND AK17.PERF_AGRG_CRT_DV_CD = '301'   /* 홈마스터순주문실적생성 */
                               )M
                         GROUP BY M.PRTNR_NO
                      )D
        ON A.PRTNR_NO = D.PRTNR_NO
      LEFT OUTER JOIN ( SELECT PRTNR_NO
                             , SUM(NVL(LCCNT1, 0)) AS LCCNT1
                             , SUM(NVL(C_LCCNT1, 0)) AS C_LCCNT1
                             , SUM(NVL(LCCNT1, 0)) - SUM(NVL(C_LCCNT1, 0)) AS R_LCCNT1
                             , SUM(NVL(GD_LCCNT2, 0)) + SUM(NVL(GD_LCCNT3, 0)) AS GD_SERCNT
                             , SUM(NVL(EL_LCCNT2, 0)) + SUM(NVL(EL_LCCNT3, 0)) AS NELECNT   /*메트리스,비데 = 가전 외*/
                             , SUM(NVL(EL_LCCNT4, 0)) AS ELECNT /*메트리스, 비데 외 = 가전*/
                             , SUM(NVL(LCCNT2, 0)) + SUM(NVL(LCCNT3, 0)) AS SERCNT
                             , SUM(NVL(LCRAT1, 0)) AS SERRYL
                          FROM ( SELECT Z.PRTNR_NO
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999901' THEN Z.PERF_VAL END AS LCCNT1
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999902' THEN Z.PERF_VAL END AS LCCNT2
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999903' THEN Z.PERF_VAL END AS LCCNT3
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01999909' THEN Z.PERF_VAL END AS LCRAT1
                                      , CASE WHEN Z.PRTNR_SV_PERF_ATC_CD = 'HM01909001' THEN Z.PERF_VAL END AS C_LCCNT1
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01139902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01159902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01129902'
                                                  ) THEN Z.PERF_VAL END AS GD_LCCNT2
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01139903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01159903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01129903'
                                                  ) THEN Z.PERF_VAL END AS GD_LCCNT3
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01199902' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01029902'
                                                  ) THEN Z.PERF_VAL END AS EL_LCCNT2
                                      , CASE WHEN ( Z.PRTNR_SV_PERF_ATC_CD = 'HM01199903' OR
                                                    Z.PRTNR_SV_PERF_ATC_CD = 'HM01029903'
                                                  ) THEN Z.PERF_VAL END AS EL_LCCNT3
                                      , CASE WHEN X.PRTNR_PERF_DTLP_ATC_CDV1 = '01'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV2 &lt; '90'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV2 NOT IN ('19','02')
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV3 = '99'
                                                  AND X.PRTNR_PERF_DTLP_ATC_CDV4 IN ('02','03')
                                                  THEN Z.PERF_VAL
                                        END AS EL_LCCNT4
                                   FROM TB_FEAM_WPTN_SV_PERF_AGRG Z
                                  INNER JOIN TB_FEAM_WPTN_SV_PERF_ATC_CD X
                                     ON Z.PRTNR_SV_PERF_ATC_CD = X.PRTNR_SV_PERF_ATC_CD
                                    AND SUBSTR(X.PRTNR_SV_PERF_ATC_CD,1,2) = 'HM'
                                  WHERE Z.BASE_YM = #{perfYm}
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND Z.PRTNR_NO = #{prtnrNo}
                               </if>
                                    AND Z.CL_DV_CD = '02'
                                    AND Z.OG_TP_CD = 'W03'
                               )
                         GROUP BY PRTNR_NO
                      )C
        ON A.PRTNR_NO = C.PRTNR_NO
      LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                             , SUM(M.AKSD01) AS AKSD01
                             , SUM(M.AKSD03) AS AKSD03
                             , SUM(M.AKSD04) AS AKSD04
                             , SUM(M.AKSD15) AS AKSD15
                             , SUM(M.AKSD05) AS AKSD05
                             , SUM(M.AKSD06) AS AKSD06
                             , SUM(M.AKSD07) AS AKSD07
                             , SUM(M.AKSD09) AS AKSD09
                             , SUM(M.AKSD10) AS AKSD10
                             , SUM(M.AKSD11) AS AKSD11
                             , SUM(M.AKSD13) AS AKSD13
                             , SUM(M.AKSD14) AS AKSD14
                             , SUM(M.AKSD16) AS AKSD16
                             , SUM(M.AKSD51) AS AKSD51
                             , SUM(M.AKSD52) AS AKSD52
                             , SUM(M.AKSD53) AS AKSD53
                             , SUM(M.AKSD54) AS AKSD54
                             , SUM(M.AKSD55) AS AKSD55
                             , SUM(M.AKSD56) AS AKSD56
                          FROM ( SELECT A.PRTNR_NO
                                      , CASE WHEN A.FEE_CD IN ('W030001', 'W030051') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD01
                                      , CASE WHEN A.FEE_CD IN ('W030002', 'W030003', 'W030052', 'W030053') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD03
                                      , CASE WHEN A.FEE_CD IN ('W030004', 'W030054')  THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD04
                                      , CASE WHEN A.FEE_CD IN ('W030005', 'W030055') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD15
                                      , CASE WHEN A.FEE_CD IN ('W030006', 'W030056') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD05
                                      , CASE WHEN A.FEE_CD IN ('W030007', 'W030057') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD06
                                      , CASE WHEN A.FEE_CD IN ('W030008', 'W030009', 'W030058', 'W030059') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD07
                                      , CASE WHEN A.FEE_CD IN ('W030010', 'W030060') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD09
                                      , CASE WHEN A.FEE_CD IN ('W030011', 'W030061') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD10
                                      , CASE WHEN A.FEE_CD IN ('W030012', 'W030062') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD11
                                      , CASE WHEN A.FEE_CD IN ('W030014', 'W030064') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD13
                                      , CASE WHEN A.FEE_CD IN ('W030015', 'W030065') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD14
                                      , CASE WHEN A.FEE_CD IN ('W030013', 'W030063') THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD16
                                      , CASE WHEN A.FEE_CD = 'W030071' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD51
                                      , CASE WHEN A.FEE_CD = 'W030072' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD52
                                      , CASE WHEN A.FEE_CD = 'W030073' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD53
                                      , CASE WHEN A.FEE_CD = 'W030075' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD54
                                      , CASE WHEN A.FEE_CD = 'W030074' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD55
                                      , CASE WHEN A.FEE_CD = 'W030076' THEN A.FEE_ATC_VAL ELSE 0 END AS AKSD56
                                   FROM TB_FEAM_FEE_DSB_DTL_IZ A
                                  WHERE A.DSB_YM = #{perfYm}
                                    AND A.OG_TP_CD = 'W03'
                                    AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                    AND FEE_ATC_DV_CD = '01'
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.FEE_CD IN ( 'W030001', 'W030051', 'W030002', 'W030003', 'W030052', 'W030053'
                                                    , 'W030004', 'W030054', 'W030005', 'W030055', 'W030006', 'W030056'
                                                    , 'W030007', 'W030057', 'W030008', 'W030009', 'W030058', 'W030059'
                                                    , 'W030010', 'W030060', 'W030011', 'W030061', 'W030012', 'W030062'
                                                    , 'W030014', 'W030064', 'W030015', 'W030065', 'W030071', 'W030072'
                                                    , 'W030073', 'W030075', 'W030074', 'W030076', 'W030013', 'W030063'
                                                    )
                               )M
                         GROUP BY M.PRTNR_NO
                      )E
        ON A.PRTNR_NO = E.PRTNR_NO
      LEFT OUTER JOIN ( SELECT A.PRTNR_NO
                             , SUM(A.INTBS_AMT) AS INTBS_SUM
                             , SUM(A.DDCTAM) AS DDTN_SUM
                             , SUM(A.DSB_OJ_AMT) AS ACL_DSB_AMT
                          FROM TB_FEAM_FEE_DSB_IZ A
                         WHERE A.DSB_YM = #{perfYm}
                           AND A.OG_TP_CD = 'W03'
                           AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                           AND A.PRTNR_NO = #{prtnrNo}
                       </if>
                         GROUP BY A.PRTNR_NO
                      )F
        ON A.PRTNR_NO = F.PRTNR_NO
      LEFT OUTER JOIN ( SELECT AK05.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO /* 지점장 사번 */
                             , COUNT(CASE WHEN AK17.AKDEQ0 > 0 AND BS.SERCNT <![CDATA[>=]]> 50 THEN 1 END) GADCNT   /* 실가동 인원 */
                             , SUM(NVL(AK17.AKDEQ0,0)) J_AKDEQ0 /* 지점 실적 */
                             , SUM(NVL(BS.SERCNT,0)) J_SERCNT   /* 지점 서비스 횟수 */
                          FROM ( SELECT B.DGR3_LEVL_DG_PRTNR_NO
                                      , A.PRTNR_NO
                                   FROM TB_OGBS_MM_PRTNR_IZ A
                                  INNER JOIN TB_OGBS_MM_OG_IZ B
                                     ON A.BASE_YM = B.BASE_YM
                                    AND A.OG_ID = B.OG_ID
                                  WHERE A.BASE_YM = #{perfYm}
                                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                    AND A.PRTNR_NO = #{prtnrNo}
                                </if>
                                    AND A.OG_TP_CD = 'W03'
                                    AND A.PSTN_DV_CD = 15
                                  GROUP BY B.DGR3_LEVL_DG_PRTNR_NO, A.PRTNR_NO
                               )AK05
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS AKDEQ0
                                              FROM TB_FEAM_NTORP_PERF_MM_CL   /*순주문 파트너 실적 월마감*/
                                             WHERE FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                               AND BASE_YM = #{perfYm}
                                               AND PERF_DV_CD = 0   /*개인판매*/
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND OG_TP_CD = 'W03'  /*웰스 홈마스터 조직*/
                                               AND PERF_ATC_CD = 'W03P00002' /* 판매인정건수 */
                                             GROUP BY PRTNR_NO
                                          ) AK17
                            ON AK05.PRTNR_NO = AK17.PRTNR_NO
                          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                                 , SUM(PERF_VAL) AS SERCNT
                                              FROM TB_FEAM_WPTN_SV_PERF_AGRG
                                             WHERE BASE_YM = #{perfYm}
                                           <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                               AND PRTNR_NO = #{prtnrNo}
                                           </if>
                                               AND CL_DV_CD = '02'
                                               AND OG_TP_CD = 'W03'
                                               AND PRTNR_SV_PERF_ATC_CD IN ('HM01999902','HM01999903') /* 홈마스터방문-합계-합계-방문건수, 홈마스터방문-합계-합계-전월건수 */
                                             GROUP BY PRTNR_NO
                                          )BS
                            ON AK05.PRTNR_NO = BS.PRTNR_NO
                         GROUP BY AK05.DGR3_LEVL_DG_PRTNR_NO
                      )G
        ON A.PRTNR_NO = G.PRTNR_NO
      LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ H
        ON A.BASE_YM = H.EDUC_CRSE_CRT_BASE_YM
       AND A.PRTNR_NO = H.PRTNR_NO
       AND A.OG_TP_CD = H.OG_TP_CD
       AND H.EDUC_CRSE_NO IN ('124','125')
       AND H.EDUC_CPC_ACKMT_YN = 'Y'
      LEFT OUTER JOIN TB_FEAM_HMST_GD_BAS I
        ON A.BASE_YM = I.MNGT_YM
       AND A.PRTNR_NO = I.PRTNR_NO
     WHERE A.BASE_YM = #{perfYm}
       AND A.OG_TP_CD = 'W03'

   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
       AND A.PRTNR_NO = #{prtnrNo}
   </if>
       AND A.RSB_DV_CD = 'W0301'
    </select>


    <select id='selectManagerFees' resultType="camelMap">
        SELECT BASE_YM	/* 기준년월 */
             , OG_CD	/* 조직코드 */
             , OG_NM   /* 조직명 */
             , PRTNR_NO	/* 파트너번호 */
             , PRTNR_KNM	/* 성명 */
             , RSB_DV_CD	/* 직책구분코드 */
             , CASE WHEN PSTN_DV_CD = '7' THEN CASE WHEN PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    ELSE F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', QLF_DV_CD) END AS QLF_DV_NM
             , CASE WHEN NMN_PSTN_DV_CD = '7' THEN
                    	 CASE WHEN NMN_PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    WHEN NMN_PSTN_DV_CD = '15' THEN F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', NMN_QLF_DV_CD)
                    WHEN NMN_PSTN_DV_CD = '4'  THEN '지역단장'
                    WHEN NMN_PSTN_DV_CD = '2'  THEN '총괄단장'
                    ELSE '해약' END AS NMN_QLF_DV_NM /*  수수료실적년월+1개월의 직책    */
             , OG_ID	/* 조직ID */
             , DGR1_LEVL_OG_ID /* 총괄단조직ID */
             , DGR2_LEVL_OG_ID /* 지역단조직ID */
             , DGR3_LEVL_OG_ID /* 지점조직ID */
             , FST_BIZ_RGST	/* 업무등록-최초업무등록월 */
             , BIZ_RGST	/* 업무등록-재등록월 */
             , BIZ_FNL_CLTN	/* 업무등록-최종해약월 */
             , BIZ_CLTN	/* 업무등록-업무해약월 */
             , PRFMT_MM	/* 승진월-지점장은 승진월, 플래너는 강등월*/
             , PRFMT_NMN /*승진차월*/
             , CASE WHEN RSB_DV_CD = 'W0205' THEN NVL(INDV_METG_PRSC_DC, 0) ELSE NVL(OG_METG_PRSC_DC, 0) END AS METG_PRSC_DC	/* 미팅참석일수 */
             , STRTUP	/* 교육-스타트업 */
             , PRE_STRTUP	/* 교육-프리스타트업 */
             , EDU_CMPF	/* 교육-보수교육최종(129)수료여부 */
             , EDU_MNGER_SETTLE1	/* 교육-매니저정착1(4)수료여부 */
             , EDU_MNGER_SETTLE2	/* 교육-매니저정착2(119)수료여부 */
             , EDU_MNGER_SETTLE345	/* 교육-매니저정착345(140)수료여부 */
             , EDU_BRMGR_ONL	/* 교육-지점장교육(135) */
             , EDU2_PRE /*교육-Pre누적교육 */
             , TOPMR_SETTLE	/* 교육-수석정착 */
             , TOPMR_NMN /*교육-수석차월*/
             , SUBSTR(MNGER_FST_OPNG, 1, 6) AS MNGER_FST_OPNG	/* 매니저개시사항-최초개시일 */
             , SUBSTR(MNGER_OPNG, 1, 6) AS MNGER_OPNG	/* 매니저개시사항-재개시월 */
             , MNGER_FNL_CLTN	/* 매니저개시사항-최종해약월 */
             , MNGER_BIZ_CLTN /* 매니저개시사항-업무해약월 */
             , CASE WHEN MNGER_OPNG IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(BASE_YM||'01', 'YYYYMMDD'), TO_DATE(MNGER_OPNG, 'YYYYMMDD')))+1
                    WHEN MNGER_FST_OPNG IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(BASE_YM||'01', 'YYYYMMDD'), TO_DATE(MNGER_FST_OPNG, 'YYYYMMDD')))+1
               ELSE 0 END AS MNGER_BLTN_NMN /* 매니저개시사항-매니저 개시차월 */
             , MNGER_SETTLE_DSB_TP /* 매니저개시사항-정착지급유형 */
             , INDV_D5_ASN_CNT  /* 5일배정건수 */
             , (INDV_ASN_CNT - INDV_BS_CAN_CNT) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
             , INDV_FSH_CNT	/* 개인BS-완료건수 */
             , INDV_PROCS_RAT	/* 개인BS-처리율 */
             , CASE WHEN INDV_PROCS_RAT = 0 THEN 0
                    WHEN RSB_DV_CD = 'W0204' AND INDV_PROCS_RAT <![CDATA[>=]]> 90 AND INDV_FSH_CNT <![CDATA[>=]]> 120 THEN 70    /*지점장은 처리율90이상 완료건수 120건이상일 경우 70*/
                    WHEN RSB_DV_CD = 'W0204' AND INDV_PROCS_RAT <![CDATA[<]]> 90 AND INDV_FSH_CNT <![CDATA[>=]]> 120 THEN 56    /*지점장은 처리율90미만 완료건수 120건이상일 경우 56*/
                    WHEN INDV_PROCS_RAT <![CDATA[>]]> 0 AND INDV_PROCS_RAT <![CDATA[<]]> 90 THEN 80
                    WHEN INDV_PROCS_RAT <![CDATA[>=]]> 90 THEN 100 END AS INDV_DBS_RAT	/*개인BS-지급률*/
             , INDV_W1_CNT	/* 개인BS-W1급지건수 */
             , INDV_W2_CNT	/* 개인BS-W2급지건수 */
             , (OG_ASN_CNT - OG_BS_CAN_CNT) AS OG_ASN_CNT	/* 조직BS-배정건수 취소건수를 뺀 값 */
             , OG_FSH_CNT	/* 조직BS-완료건수 */
             , CASE WHEN OG_ASN_CNT <![CDATA[>]]> 0 THEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) ELSE 0 END AS OG_PROCS_RAT	/* 조직BS-처리율 */
             , CASE WHEN OG_ASN_CNT <![CDATA[>]]> 0 THEN
                    CASE WHEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) <![CDATA[>=]]> 90 THEN 100
                         WHEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) <![CDATA[<]]> 90 THEN 80
                         ELSE 0
                    END
               ELSE 0 END AS OG_DBS_RAT	/*조직BS-순증관리지급률*/
             , INDV_ELHM_ACKMT_CNT	/* 개인실적-가전인정건수 */
             , INDV_RENTAL_BASE_PRC	/* 개인실적-렌잘기준가 */
             , INDV_SPAY_BASE_PRC	/* 개인실적-일시불기준가 */
             , INDV_CHDVC_CNT	/* 개인실적-기변건수 */
             , INDV_ELHM_EXCP_ACKMT_PERF	/* 개인실적-가전외인정실적 */
             , INDV_FXAM_CT	/* 개인실적-정액건수 */
             , INDV_LIVE_PAKG_CNT	/* 개인실적-라이브팩건수 */
             , INDV_HCR_MSH_CNT	/* 개인실적-홈케어멤버십건수 */
             , OG_ELHM_ACKMT_CNT	/* 조직실적-가전인정건수 */
             , OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
             , OG_RENTAL_BASE_PRC	/* 조직실적-렌탈기준가 */
             , OG_SPAY_BASE_PRC	/* 조직실적-일시불기준가 */
             , OG_CHDVC_CNT	/* 조직실적-기변건수 */
             , OG_ELHM_EXCP_ACKMT_PERF + OG_RENTAL_BASE_PRC + OG_SPAY_BASE_PRC AS OG_PERF_SUM	/*조직실적-계*/
             , INDV_NW_CNT	/* 개인순증-신규건수*/
             , INDV_CAN_CNT	/* 개인순증-취소건수 */
             , INDV_NW_CNT - INDV_CAN_CNT AS INDV_NINC	/* 개인순증-순증 */
             , OG_NW_CNT	/* 조직순증-신규건수*/
             , OG_CAN_CNT	/* 조직순증-취소건수 */
             , OG_NW_CNT - OG_CAN_CNT AS OG_NINC	/* 조직순증-순증 */
             , INTBS_AMT	/* 소득과표금액 */
             , DDCTAM	/* 공제금액 */
             , DSB_OJ_AMT	/* 지급대상금액 */
             <if test='@MybatisUtils@isNotEmpty(feeArticles)'>
             <foreach collection="feeArticles" item='feeArticle' open=', ' close='' separator=', ' >
               FEE_${feeArticle.dtaCrtFeeCd}
             </foreach>
             </if>
          FROM
             ( SELECT PRTNR.BASE_YM	/* 기준년월 */
                    , PRTNR.OG_CD	/* 조직코드 */
                    , PRTNR.OG_NM   /* 조직명 */
                    , PRTNR.PRTNR_NO	/* 파트너번호 */
                    , PRTNR.PRTNR_KNM	/* 성명 */
                    , PRTNR.RSB_DV_CD	/* 직책구분코드 */
                    , PRTNR.QLF_DV_CD	/* 수수료월자격구분코드 */
                    , PRTNR.PSTN_DV_CD  /* 수수료월직급구분코드 */
                    , PRTNR.PRTNR_GD_CD     /* 수수료월파트너등급코드 */
                    , NMNQLF.PSTN_DV_CD AS NMN_PSTN_DV_CD	/* 차월직급구분코드 */
                    , NMNQLF.QLF_DV_CD AS NMN_QLF_DV_CD	/* M+1 자격구분코드 */
                    , NMNQLF.PRTNR_GD_CD AS NMN_PRTNR_GD_CD	/* M+1 등급구분코드 */
                    , OG.OG_ID	/* 조직ID */
                    , OG.DGR1_LEVL_OG_ID /* 총괄단조직ID */
                    , OG.DGR2_LEVL_OG_ID /* 지역단조직ID */
                    , OG.DGR3_LEVL_OG_ID /* 지점조직ID */
                    , SUBSTR(PRTNR.FST_CNTR_DT, 1, 6) AS FST_BIZ_RGST	/* 업무등록-최초업무등록월 */
                    , SUBSTR(PRTNR.RCNTR_DT, 1, 6) AS BIZ_RGST	/* 업무등록-재등록월 */
                    , SUBSTR(PRTNR.FNL_CLTN_DT, 1, 6) AS BIZ_FNL_CLTN	/* 업무등록-최종해약월 */
                    , SUBSTR(PRTNR.CLTN_DT, 1, 6) AS BIZ_CLTN	/* 업무등록-업무해약월 */
                    , CASE WHEN PRTNR.RSB_DV_CD = 'W0204' THEN SUBSTR(PRTNR.PRFMT_DT, 1, 6)
    	                   ELSE SUBSTR(PRTNR.DMTN_DT, 1, 6) END AS PRFMT_MM	/* 승진월-지점장은 승진월 플래너는 강등월 */
                    , CASE WHEN PRTNR.PRFMT_DT IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(PRTNR.BASE_YM||'01', 'YYYYMMDD'), TO_DATE(PRTNR.PRFMT_DT, 'YYYYMMDD')))+1
                           ELSE 0 END AS PRFMT_NMN /*승진차월*/
                    , NVL(INDVMT.PERF_VAL, 0) AS INDV_METG_PRSC_DC	/* 개인미팅참석일수 */
                    , NVL(OGMT.PERF_VAL, 0) AS OG_METG_PRSC_DC	/* 지점장미팅참석일수 */
                    , EDU.EDU96_YM AS STRTUP	/* 스타트업 */
                    , EDU.EDU143_YM AS PRE_STRTUP	/* 프리스타트업 */
                    , EDU.EDU100_YM AS TOPMR_SETTLE	/* 수석정착 */
                    , CASE WHEN EDU.EDU100_YM IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(PRTNR.BASE_YM||'01', 'YYYYMMDD'), TO_DATE(EDU.EDU100_YM||'01', 'YYYYMMDD')))+1
                           ELSE 0 END AS TOPMR_NMN /*수석차월*/
                    , NVL(EDU2.EDU_CMPF, 'N') AS EDU_CMPF	/* 보수교육최종(129)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE1, 'N') AS EDU_MNGER_SETTLE1	/* 매니저정착1(4)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE2, 'N') AS EDU_MNGER_SETTLE2	/* 매니저정착2(119)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE345, 'N') AS EDU_MNGER_SETTLE345	/* 매니저정착345(140)수료여부 */
                    , NVL(EDU2.EDU_PRE1, 'N') AS EDU_PRE1	/* 프리1정수기(144)수료여부 */
                    , NVL(EDU2.EDU_PRE2, 'N') AS EDU_PRE2	/* 프리2비데 기타(145)수료여부 */
                    , NVL(EDU2.EDU_PRE3, 'N') AS EDU_PRE3	/* 프리3세일즈(146)수료여부 */
                    , NVL(EDU2.EDU_PRE4, 'N') AS EDU_PRE4	/* 프리4Wells live(147)수료여부 */
                    , NVL(EDU2.EDU_PRE5, 'N') AS EDU_PRE5	/* 프리5Wells live(148)수료여부 */
                    , EDU135.EDU135_YM AS EDU_BRMGR_ONL	/* 지점장교육(135) */
                    , CASE WHEN EDU2.EDU_PRE1 = 'Y' THEN '1'
                           WHEN EDU2.EDU_PRE2 = 'Y' THEN '2'
                           WHEN EDU2.EDU_PRE3 = 'Y' THEN '3'
                           WHEN EDU2.EDU_PRE4 = 'Y' THEN '4'
                           WHEN EDU2.EDU_PRE5 = 'Y' THEN '5'
                           ELSE ''
                      END AS EDU2_PRE /*교육-Pre누적교육 */
                    , MNGER1.MNGER_FST_OPNG AS MNGER_FST_OPNG	/* 매니저 최초개시일 */
                    , MNGER2.RESTRT_DT AS MNGER_OPNG	/* 매니저 재개시월 */
                    , SUBSTR(MNGER3.MNGER_FNL_CLTN, 1, 6) AS MNGER_FNL_CLTN	/* 매니저 최종해약월 */
                    , SUBSTR(MNGER4.MNGER_BIZ_CLTN, 1, 6) AS MNGER_BIZ_CLTN /* 매니저 업무해약월 */
                    , F_CMZ_CD_NM('TNT_WELLS', 'OPNG_CD', MNGER5.OPNG_CD) AS MNGER_SETTLE_DSB_TP /* 매니저개시 정착지급유형 */
                    , NVL(INDVD5.INDV_D5_ASN_CNT, 0) AS INDV_D5_ASN_CNT     /* 개인BS-5일배정건수 */
                    , NVL(INDVBS.INDV_ASN_CNT, 0) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
                    , NVL(INDVBS.INDV_BS_CAN_CNT, 0) AS INDV_BS_CAN_CNT     /* 개인BS-취소건수 */
                    , NVL(INDVBS.INDV_FSH_CNT, 0) AS INDV_FSH_CNT	/* 개인BS-완료건수 */
                    , NVL(INDVBS.INDV_PROCS_RAT, 0) AS INDV_PROCS_RAT	/* 개인BS-처리율 */
                    , NVL(INDVBS.INDV_W1_CNT, 0) AS INDV_W1_CNT	/* 개인BS-W1급지건수 */
                    , NVL(INDVBS.INDV_W2_CNT, 0) AS INDV_W2_CNT	/* 개인BS-W2급지건수 */
                    , NVL(OGBS.OG_ASN_CNT, 0) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                    , NVL(OGBS.OG_BS_CAN_CNT, 0) AS OG_BS_CAN_CNT	/* 조직BS-취소건수 */
                    , NVL(OGBS.OG_FSH_CNT, 0) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                    , NVL(PERF.INDV_ELHM_ACKMT_CNT, 0) AS INDV_ELHM_ACKMT_CNT	/* 개인실적-가전인정건수 */
                    , NVL(PERF.INDV_RENTAL_BASE_PRC, 0) AS INDV_RENTAL_BASE_PRC	/* 개인실적-렌잘기준가 */
                    , NVL(PERF.INDV_SPAY_BASE_PRC, 0) AS INDV_SPAY_BASE_PRC	/* 개인실적-일시불기준가 */
                    , NVL(PERF.INDV_CHDVC_CNT, 0) AS INDV_CHDVC_CNT	/* 개인실적-기변건수 */
                    , NVL(PERF.INDV_ELHM_EXCP_ACKMT_PERF, 0) AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인실적-가전외인정실적 */
                    , NVL(PERF.INDV_FXAM_CT, 0) AS INDV_FXAM_CT	/* 개인실적-정액건수 */
                    , NVL(PERF.INDV_LIVE_PAKG_CNT, 0) AS INDV_LIVE_PAKG_CNT	/* 개인실적-라이브팩건수 */
                    , NVL(PERF.INDV_HCR_MSH_CNT, 0) AS INDV_HCR_MSH_CNT	/* 개인실적-홈케어멤버십건수 */
                    , NVL(PERF.OG_ELHM_ACKMT_CNT, 0) AS OG_ELHM_ACKMT_CNT	/* 조직실적-가전인정건수 */
                    , NVL(PERF.OG_ELHM_EXCP_ACKMT_PERF, 0) AS OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
                    , NVL(PERF.OG_RENTAL_BASE_PRC, 0) AS OG_RENTAL_BASE_PRC	/* 조직실적-렌탈기준가 */
                    , NVL(PERF.OG_SPAY_BASE_PRC, 0) AS OG_SPAY_BASE_PRC	/* 조직실적-일시불기준가 */
                    , NVL(PERF.OG_CHDVC_CNT, 0) AS OG_CHDVC_CNT	/* 조직실적-기변건수 */
                    , NVL(INDVNINC.INDV_RENTAL_NW_CT, 0) + NVL(INDVNINC.INDV_SPAY_NW_CT, 0) AS INDV_NW_CNT	/* 개인순증-신규건수*/
                    , NVL(INDVNINC.INDV_RENTAL_CAN_CT, 0) + NVL(INDVNINC.INDV_RENTAL_EXN_CT, 0) + NVL(INDVNINC.INDV_RENTAL_BOO_CAN_CT, 0)
                        + NVL(INDVNINC.INDV_SPAY_RSG_CT, 0) + NVL(INDVNINC.INDV_SPAY_BOO_CAN_CT, 0) + NVL(INDVNINC.INDV_MSH_SPR_CT, 0) AS INDV_CAN_CNT	/* 개인순증-취소건수 */
                    , NVL(OGNINC.OG_RENTAL_NW_CT, 0) + NVL(OGNINC.OG_SPAY_NW_CT, 0) AS OG_NW_CNT	/* 조직순증-신규건수*/
                    , NVL(OGNINC.OG_RENTAL_CAN_CT, 0) + NVL(OGNINC.OG_RENTAL_EXN_CT, 0) + NVL(OGNINC.OG_RENTAL_BOO_CAN_CT, 0)
                        + NVL(OGNINC.OG_SPAY_RSG_CT, 0) + NVL(OGNINC.OG_SPAY_BOO_CAN_CT, 0) + NVL(OGNINC.OG_MSH_SPR_CT, 0) AS OG_CAN_CNT	/* 조직순증-취소건수 */
                    , NVL(DSB.INTBS_AMT, 0) AS INTBS_AMT	/* 소득과표금액 */
                    , NVL(DSB.DDCTAM, 0) AS DDCTAM	/* 공제금액 */
                    , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_OJ_AMT	/* 지급대상금액 */
                    <if test='@MybatisUtils@isNotEmpty(feeArticles)'>
                     <foreach collection="feeArticles" item='feeArticle' open=', ' close='' separator=', ' >
                        NVL(FEE.FEE_${feeArticle.dtaCrtFeeCd}, 0) AS FEE_${feeArticle.dtaCrtFeeCd}
                     </foreach>
                     </if>
                 FROM TB_OGBS_MM_PRTNR_IZ PRTNR	/* 월파트너내역*/
                INNER JOIN TB_OGBS_MM_OG_IZ OG	/* 월조직내역 */
                   ON PRTNR.BASE_YM = OG.BASE_YM
                  AND PRTNR.OG_ID = OG.OG_ID
                  AND OG.DTA_DL_YN = 'N'
                 LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL INDVMT	/* 파트너실적월마감 */
                   ON PRTNR.BASE_YM = INDVMT.BASE_YM
                  AND PRTNR.BASE_YM = INDVMT.PERF_YM
                  AND PRTNR.OG_TP_CD = INDVMT.OG_TP_CD
                  AND PRTNR.PRTNR_NO = INDVMT.PRTNR_NO
                  AND INDVMT.FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                  AND INDVMT.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                 LEFT OUTER JOIN
                 	( SELECT AGRG_YM
                 		   , OG_TP_CD
                 		   , PRTNR_NO
                 		   , METG_PRSC_DC AS PERF_VAL
                 	    FROM TB_PSCA_MCPTN_METG_AGRG
                 	   WHERE DTA_DL_YN = 'N'
                 	     AND AGRG_YM = #{dto.perfYm}
                 	     AND OG_TP_CD = 'W02'
                 	) OGMT
                   ON PRTNR.BASE_YM = OGMT.AGRG_YM
                  AND PRTNR.OG_TP_CD = OGMT.OG_TP_CD
                  AND PRTNR.PRTNR_NO = OGMT.PRTNR_NO
                 LEFT OUTER JOIN
                    ( SELECT MIN(STRTDT) AS MNGER_FST_OPNG /* 매니저 최초개시일 */
                           , PRTNR_NO
                        FROM TB_OGPS_PLAR_QLF_CH_IZ     /* 플래너자격변경내역 */
                       WHERE DTA_DL_YN = 'N'
                         AND SUBSTR(STRTDT, 0, 6) <![CDATA[<=]]> #{dto.perfYm}
                         AND OG_TP_CD = 'W02'
                         AND QLF_DV_CD IN (3, 6)
                         AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제(과거)  3:보류 제외 */
                         <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                         AND PRTNR_NO = #{dto.prtnrNo}
                         </if>
                       GROUP BY PRTNR_NO
                   ) MNGER1
                  ON PRTNR.PRTNR_NO = MNGER1.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT A.PRTNR_NO
                   		  , A.PSTN_DV_CD
                   	      , QLF.QLF_DV_CD
                          , A.PRTNR_GD_CD
                       FROM TB_OGBS_MM_PRTNR_IZ A
                       LEFT OUTER JOIN TB_OGPS_PLAR_QLF_CH_IZ QLF  /* 웰스매니저 자격정보 M+1 자격 */
                       ON A.OG_TP_CD = QLF.OG_TP_CD
                        AND A.PRTNR_NO = QLF.PRTNR_NO
                        AND NVL(QLF.QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제  3: 보류 제외*/
                 		AND TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#{dto.perfYm},'YYYYMM'),1)),'YYYYMMDD') BETWEEN STRTDT AND ENDDT
                 		AND QLF.DTA_DL_YN = 'N'
                      WHERE A.OG_TP_CD = 'W02'
                        AND A.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{dto.perfYm}, 'YYYYMM'), 1),'YYYYMM')
                  ) NMNQLF
                 ON PRTNR.PRTNR_NO = NMNQLF.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT OG_TP_CD
                          , PRTNR_NO
                          , MIN(STRTDT) AS FST_CNTR_DT  /* 최초계약일 */
                          , MAX(NVL2(STRT_PREV_DT,STRTDT,'')) AS RESTRT_DT    /* 재등록개시일 */
                       FROM
                          ( SELECT OG_TP_CD
                                 , PRTNR_NO
                                 , STRTDT
                                 , ENDDT
                                 , CV_DT
                                 , DSB_AMT
                                 , LAG(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT)  AS STRT_PREV_DT
                                 , LEAD(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT) AS STRT_NEXT_DT
                                 , LAG(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT)  AS END_PREV_DT
                                 , LEAD(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT) AS END_NEXT_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ   /* 플래너자격변경내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND OG_TP_CD  = 'W02'
                               AND QLF_DV_CD = 3
                               AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')  -- 승격,자격해제  3 : 보류 제외
                          ) A
                      WHERE 1=1
                      GROUP BY OG_TP_CD, PRTNR_NO
                  ) MNGER2
                 ON PRTNR.OG_TP_CD = MNGER2.OG_TP_CD
                AND PRTNR.PRTNR_NO = MNGER2.PRTNR_NO
               LEFT OUTER JOIN
                  ( SELECT MAX (ENDDT) AS MNGER_FNL_CLTN /* 매니저 최종해약월 */
                         , PRTNR_NO
                      FROM TB_OGPS_PLAR_QLF_CH_IZ	/* 플래너자격변경내역 */
                     WHERE DTA_DL_YN = 'N'
                       AND SUBSTR(ENDDT, 0, 6) <![CDATA[<=]]> #{dto.perfYm}
                       AND OG_TP_CD = 'W02'
                       AND QLF_DV_CD IN (3, 6)
                       AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')   /* 승격,자격해제(과거)  3: 보류 제외 */
                       <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                       AND PRTNR_NO = #{dto.prtnrNo}
                       </if>
                     GROUP BY PRTNR_NO
                 ) MNGER3
                ON PRTNR.PRTNR_NO = MNGER3.PRTNR_NO
              LEFT OUTER JOIN
                 ( SELECT CASE WHEN MAX(ENDDT) = '99991231' THEN '' ELSE MAX(ENDDT) END AS MNGER_BIZ_CLTN /* 매니저 업무해약월 */
                        , PRTNR_NO
                     FROM TB_OGPS_PLAR_QLF_CH_IZ	/* 플래너자격변경내역 */
                    WHERE DTA_DL_YN = 'N'
                      AND OG_TP_CD = 'W02'
                      AND QLF_DV_CD IN (3, 6)
                      AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')    /* 승격,자격해제(과거)  3: 보류 제외 */
                      <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                      AND PRTNR_NO = #{dto.prtnrNo}
                      </if>
                    GROUP BY PRTNR_NO
                ) MNGER4
               ON PRTNR.PRTNR_NO = MNGER4.PRTNR_NO
             LEFT OUTER JOIN
                ( SELECT NVL(OPNG_CD, '9') AS OPNG_CD /* 매니저개시 정착지급유형 */
                       , PRTNR_NO
                    FROM TB_FEAM_WELS_MNGER_OPNG_BAS	/* 웰스매니저개시기본 */
                   WHERE DTA_DL_YN = 'N'
                     AND BASE_YM = #{dto.perfYm}
                     AND OG_TP_CD = 'W02'
                     AND TCNT_DV_CD = #{dto.feeTcntDvCd}
                     <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                     AND PRTNR_NO = #{dto.prtnrNo}
                     </if>
               ) MNGER5
              ON PRTNR.PRTNR_NO = MNGER5.PRTNR_NO
            LEFT OUTER JOIN
               ( SELECT OG_TP_CD
                      , PRTNR_NO
                      , EDU96_YM
                      , EDU143_YM
                      , EDU17_YM
                      , CASE WHEN NVL(EDU106_YM, 0)  <![CDATA[>]]>  NVL(EDU100_YM, 0) THEN EDU106_YM
                        ELSE EDU100_YM END AS EDU100_YM
                   FROM
                      ( SELECT A.OG_TP_CD
                             , A.PRTNR_NO
                             , A.EDUC_CRSE_NO
                             , A.EDUC_CRSE_CRT_BASE_YM
                          FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                         WHERE A.DTA_DL_YN = 'N'
                           AND A.EDUC_CRSE_CRT_BASE_YM <![CDATA[<=]]> #{dto.perfYm}
                           AND A.EDUC_CRSE_NO IN ('96','143', '17', '100', '106')
                           AND A.EDUC_CPC_ACKMT_YN = 'Y'
                     ) A
                 PIVOT ( MAX(EDUC_CRSE_CRT_BASE_YM) FOR EDUC_CRSE_NO IN
                         ( '96' AS EDU96_YM
                          , '143' AS EDU143_YM
                          , '17' AS EDU17_YM
                          , '100' AS EDU100_YM
                          , '106' AS EDU106_YM ))
              ) EDU
             ON PRTNR.OG_TP_CD = EDU.OG_TP_CD
            AND PRTNR.PRTNR_NO = EDU.PRTNR_NO
           LEFT OUTER JOIN
               ( SELECT OG_TP_CD
                      , PRTNR_NO
                      , EDU135_YM
                   FROM
                      ( SELECT A.OG_TP_CD
                             , A.PRTNR_NO
                             , A.EDUC_CRSE_NO
                             , A.EDUC_CRSE_CRT_BASE_YM
                          FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                         WHERE A.DTA_DL_YN = 'N'
                           AND A.EDUC_CRSE_CRT_BASE_YM = #{dto.perfYm}
                           AND A.EDUC_CRSE_NO = '135'
                           AND A.EDUC_CPC_ACKMT_YN = 'Y'
                     ) A
                 PIVOT ( MAX(EDUC_CRSE_CRT_BASE_YM) FOR EDUC_CRSE_NO IN
                         ( '135' AS EDU135_YM))
              ) EDU135
             ON PRTNR.OG_TP_CD = EDU135.OG_TP_CD
            AND PRTNR.PRTNR_NO = EDU135.PRTNR_NO
           LEFT OUTER JOIN
              ( SELECT PRTNR_NO
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00116' THEN FEE_PERF_ATC_VAL END) AS EDU_CMPF	/* 보수교육최종(129)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00124' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE1	/* 매니저정착1(4)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00125' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE2	/* 매니저정착2(119)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00126' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE345	/* 매니저정착345(140)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00127' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE1	/* 프리1정수기(144)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00128' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE2	/* 프리2비데 기타(145)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00129' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE3	/* 프리3세일즈(146)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00130' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE4	/* 프리4Wells live(147)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00131' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE5	/* 프리5Wells live(148)수료여부 */
                  FROM TB_FEAM_PRTNR_PERF_MM_CL	/* 파트너실적월마감 */
                 WHERE DTA_DL_YN = 'N'
                   AND BASE_YM = #{dto.perfYm}
                   AND PERF_YM = #{dto.perfYm}
                   AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                   AND PERF_AGRG_CRT_DV_CD = '201'
                   AND PERF_ATC_CD IN ( 'W02P00116', 'W02P00124', 'W02P00125', 'W02P00126', 'W02P00127',
                                      'W02P00128', 'W02P00129', 'W02P00130', 'W02P00131')
                   AND CO_CD = '2000'
                   AND OG_TP_CD = 'W02'
                   <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                   AND PRTNR_NO = #{dto.prtnrNo}
                   </if>
                 GROUP BY PRTNR_NO
             ) EDU2
            ON PRTNR.PRTNR_NO = EDU2.PRTNR_NO
          LEFT OUTER JOIN
             ( SELECT PRTNR_NO
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN PERF_VAL ELSE 0 END ) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN PERF_VAL ELSE 0 END ) AS INDV_BS_CAN_CNT    /* 개인BS-취소건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD IN ('SV01999902', 'SV01999903') THEN PERF_VAL ELSE 0 END ) AS INDV_FSH_CNT	/* 개인BS-완료건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999910' THEN PERF_VAL ELSE 0 END ) AS INDV_PROCS_RAT	/* 개인BS-처리율 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010102' THEN PERF_VAL ELSE 0 END ) AS INDV_W1_CNT	/* 개인BS-W1급지건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010103' THEN PERF_VAL ELSE 0 END ) AS INDV_W2_CNT	/* 개인BS-W2급지건수 */
                 FROM TB_FEAM_WPTN_SV_PERF_AGRG T1	/* 웰스파트너서비스실적집계 */
                WHERE DTA_DL_YN = 'N'
                  AND BASE_YM = #{dto.perfYm}
                  AND CL_DV_CD = #{dto.feeTcntDvCd}
                  AND OG_TP_CD = 'W02'
                  AND PRTNR_SV_PERF_ATC_CD IN ('SV01999901', 'SV01999902', 'SV01999903', 'SV01999910', 'SV06010102', 'SV06010103', 'SV01909001')	/* 배정건수, 당월완료건수, 전월완료건수, 비율, W1급지건수, W2급지건수 */
                  <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                  AND PRTNR_NO = #{dto.prtnrNo}
                  </if>
                GROUP BY PRTNR_NO
             ) INDVBS
            ON PRTNR.PRTNR_NO = INDVBS.PRTNR_NO
          LEFT OUTER JOIN
          	  (  SELECT PRTNR_NO
                      , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV24010101' THEN PERF_VAL ELSE 0 END ) AS INDV_D5_ASN_CNT	/* 개인BS-5일배정건수 */
                   FROM TB_FEAM_WPTN_SV_PED_AGRG T1	/* 웰스파트너서비스일집계 */
                  WHERE DTA_DL_YN = 'N'
                    AND BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{dto.perfYm},'YYYYMM'), 1), 'YYYYMM')
                    AND OG_TP_CD = 'W02'
                    AND PRTNR_SV_PERF_ATC_CD = 'SV24010101'	/* 5일배정건수 */
                    <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                    AND PRTNR_NO = #{dto.prtnrNo}
                    </if>
                GROUP BY PRTNR_NO
          	  ) INDVD5
            ON PRTNR.PRTNR_NO = INDVD5.PRTNR_NO
          LEFT OUTER JOIN
             ( SELECT T3.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                    , SUM(T1.OG_ASN_CNT) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                    , SUM(T1.OG_BS_CAN_CNT) AS OG_BS_CAN_CNT	/* 조직BS-취소건수 */
                    , SUM(T1.OG_FSH_CNT) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                 FROM
                    ( SELECT A.BASE_YM
                           , A.OG_TP_CD
                           , A.PRTNR_NO
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN A.PERF_VAL ELSE 0 END ) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN A.PERF_VAL ELSE 0 END) AS OG_BS_CAN_CNT	/*조직BS-취소건수*/
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD IN ('SV01999902', 'SV01999903') THEN A.PERF_VAL ELSE 0 END ) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                        FROM TB_FEAM_WPTN_SV_PERF_AGRG A	/* 웰스파트너서비스실적집계 */
                       INNER JOIN TB_OGBS_MM_PRTNR_IZ B    /*월파트너내역*/
                          ON A.BASE_YM = B.BASE_YM
                         AND A.OG_TP_CD = B.OG_TP_CD
                         AND A.PRTNR_NO = B.PRTNR_NO
                       WHERE A.DTA_DL_YN = 'N'
                         AND A.BASE_YM = #{dto.perfYm}
                         AND A.CL_DV_CD = #{dto.feeTcntDvCd}
                         AND A.OG_TP_CD = 'W02'
                         AND A.PRTNR_SV_PERF_ATC_CD IN ('SV01999901', 'SV01999902', 'SV01999903', 'SV01909001')	/* 배정건수, 당월완료건수, 전월완료건수, 취소건수 */
                         AND B.PSTN_DV_CD = '15'   /* 지점장 실적 제외 */
                       GROUP BY A.BASE_YM, A.OG_TP_CD, A.PRTNR_NO
                   ) T1	/* 파트너별 개인BS */
               INNER JOIN TB_OGBS_MM_PRTNR_IZ T2	/* 월파트너내역 */
                  ON T1.BASE_YM = T2.BASE_YM
                 AND T1.OG_TP_CD = T2.OG_TP_CD
                 AND T1.PRTNR_NO = T2.PRTNR_NO
               INNER JOIN TB_OGBS_MM_OG_IZ T3	/* 월조직내역 */
                  ON T2.BASE_YM = T3.BASE_YM
                 AND T2.OG_ID = T3.OG_ID
                 AND T3.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                 <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                 AND T3.DGR3_LEVL_DG_PRTNR_NO = #{dto.prtnrNo}
                 </if>
               GROUP BY T3.DGR3_LEVL_DG_PRTNR_NO
            ) OGBS	/* 조직BS */
           ON PRTNR.PRTNR_NO = OGBS.PRTNR_NO
         LEFT OUTER JOIN
            ( SELECT PRTNR_NO
                   , SUM(INDV_ELHM_ACKMT_CNT) AS INDV_ELHM_ACKMT_CNT    /* 개인가전인정건수 */
                   , SUM(INDV_RENTAL_BASE_PRC) AS INDV_RENTAL_BASE_PRC  /* 개인렌탈기준가 */
                   , SUM(INDV_SPAY_BASE_PRC) AS INDV_SPAY_BASE_PRC  /* 개인일시불기준가 */
                   , SUM(INDV_CHDVC_CNT) AS INDV_CHDVC_CNT  /* 개인기변건수 */
                   , SUM(INDV_ELHM_EXCP_ACKMT_PERF) AS INDV_ELHM_EXCP_ACKMT_PERF    /* 개인가전외인정실적 */
                   , SUM(INDV_FXAM_CT) AS INDV_FXAM_CT  /* 개인정액건수 */
                   , SUM(INDV_LIVE_PAKG_CNT) AS INDV_LIVE_PAKG_CNT  /* 개인라이브팩건수 */
                   , SUM(INDV_HCR_MSH_CNT) AS INDV_HCR_MSH_CNT  /* 개인홈케어멤버십건수 */
                   , SUM(OG_ELHM_ACKMT_CNT) AS OG_ELHM_ACKMT_CNT /* 조직가전인정건수 */
                   , SUM(OG_ELHM_EXCP_ACKMT_PERF) AS OG_ELHM_EXCP_ACKMT_PERF /* 조직가전외인정실적 */
                   , SUM(OG_RENTAL_BASE_PRC) AS OG_RENTAL_BASE_PRC /* 조직렌탈기준가 */
                   , SUM(OG_SPAY_BASE_PRC) AS OG_SPAY_BASE_PRC /* 조직일시불기준가 */
                   , SUM(OG_CHDVC_CNT) AS OG_CHDVC_CNT /* 조직기변건수 */
                FROM
                   ( SELECT PRTNR_NO
                          , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS INDV_ELHM_ACKMT_CNT	/* 개인가전인정건수 */
                          , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS INDV_RENTAL_BASE_PRC	/* 개인렌탈기준가 */
                          , CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS INDV_SPAY_BASE_PRC	/* 개인일시불기준가 */
                          , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS INDV_CHDVC_CNT	/* 개인기변건수 */
                          , CASE WHEN PERF_ATC_CD = 'W02P00112' THEN PERF_VAL ELSE 0 END AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인가전외인정실적 */
                          , CASE WHEN PERF_ATC_CD IN ('W00P00005', 'W00P00007') THEN PERF_VAL ELSE 0 END AS INDV_FXAM_CT	/* 개인정액건수 */
                          , CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END AS INDV_LIVE_PAKG_CNT	/* 개인라이브팩건수 */
                          , CASE WHEN PERF_ATC_CD = 'W02P00086' THEN PERF_VAL ELSE 0 END AS INDV_HCR_MSH_CNT	/* 개인홈케어멤버십건수 */
                          , 0 AS OG_ELHM_ACKMT_CNT	/* 조직가전인정건수 */
                          , 0 AS OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
                          , 0 AS OG_RENTAL_BASE_PRC	/* 조직렌탈기준가 */
                          , 0 AS OG_SPAY_BASE_PRC	/* 조직일시불기준가 */
                          , 0 AS OG_CHDVC_CNT	/* 조직기변건수 */
                       FROM TB_FEAM_NTORP_PERF_MM_CL	/* 순주문실적월마감 */
                      WHERE DTA_DL_YN = 'N'
                        AND BASE_YM = #{dto.perfYm}
                        AND PERF_YM = #{dto.perfYm}
                        AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                        AND PERF_AGRG_CRT_DV_CD = '201'
                        AND PERF_DV_CD = '0'	/* 실적구분코드 0-개인 */
                        AND OG_TP_CD = 'W02'
                        AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00004', 'W00P00014',
                                             'W00P00018', 'W02P00027', 'W02P00112', 'W00P00005', 'W00P00007',
                                             'W02P00105', 'W00P00009', 'W02P00086' )
                        <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                        AND PRTNR_NO = #{dto.prtnrNo}
                        </if>
                      UNION ALL
                      SELECT PRTNR_NO
                           , 0 AS INDV_ELHM_ACKMT_CNT	/* 개인가전인정건수 */
                           , 0 AS INDV_RENTAL_BASE_PRC	/* 개인렌탈기준가 */
                           , 0 AS INDV_SPAY_BASE_PRC	/* 개인일시불기준가 */
                           , 0 AS INDV_CHDVC_CNT	/* 개인기변건수 */
                           , 0 AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인가전외인정실적 */
                           , 0 AS INDV_FXAM_CT	/* 개인정액건수 */
                           , 0 AS INDV_LIVE_PAKG_CNT	/* 개인라이브팩건수 */
                           , 0 AS INDV_HCR_MSH_CNT	/* 개인홈케어멤버십건수 */
                           , CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL ELSE 0 END AS OG_ELHM_ACKMT_CNT	/* 조직가전인정건수 */
                           , CASE WHEN PERF_ATC_CD = 'W02P00112' THEN PERF_VAL ELSE 0 END AS OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
                           , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS OG_RENTAL_BASE_PRC	/* 조직렌탈기준가 */
                           , CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS OG_SPAY_BASE_PRC	/* 조직일시불기준가 */
                           , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS OG_CHDVC_CNT	/* 조직기변건수 */
                        FROM TB_FEAM_NTORP_PERF_MM_CL	/* 순주문실적월마감 */
                       WHERE DTA_DL_YN = 'N'
                         AND BASE_YM = #{dto.perfYm}
                         AND PERF_YM = #{dto.perfYm}
                         AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                         AND PERF_AGRG_CRT_DV_CD = '201'
                         AND PERF_DV_CD = '2'	/* 실적구분코드 2-지점 */
                         AND OG_TP_CD = 'W02'
                         AND PERF_ATC_CD IN ( 'W02P00002', 'W00P00003', 'W00P00004', 'W00P00014', 'W00P00018', 'W02P00112')
                         <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                         AND PRTNR_NO = #{dto.prtnrNo}
                         </if>
                  )
              GROUP BY PRTNR_NO
           ) PERF
          ON PRTNR.PRTNR_NO = PERF.PRTNR_NO
        LEFT OUTER JOIN
           ( SELECT PRTNR_NO
                  , RENTAL_NW_CT AS INDV_RENTAL_NW_CT	/* 개인렌탈신규건수 */
                  , SPAY_NW_CT AS INDV_SPAY_NW_CT	/* 개인일시불신규건수 */
                  , RENTAL_CAN_CT AS INDV_RENTAL_CAN_CT	/* 개인렌탈취소건수 */
                  , RENTAL_EXN_CT AS INDV_RENTAL_EXN_CT	/* 개인렌탈만료건수 */
                  , RENTAL_BOO_CAN_CT AS INDV_RENTAL_BOO_CAN_CT	/* 개인렌탈예약취소건수 */
                  , SPAY_RSG_CT AS INDV_SPAY_RSG_CT	/* 개인일시불해지건수 */
                  , SPAY_BOO_CAN_CT AS INDV_SPAY_BOO_CAN_CT	/* 개인일시불예약취소건수 */
                  , MSH_SPR_CT AS INDV_MSH_SPR_CT	/* 개인멤버십이탈건수 */
               FROM TB_FEAM_WELS_ACC_NINC_MM_CL	/* 웰스계정순증월마감 */
              WHERE DTA_DL_YN = 'N'
                AND PERF_YM = #{dto.perfYm}
                AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                AND CO_CD = '2000'
                AND OG_TP_CD = 'W02'
                <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                AND PRTNR_NO = #{dto.prtnrNo}
                </if>
           ) INDVNINC
          ON PRTNR.PRTNR_NO = INDVNINC.PRTNR_NO
        LEFT OUTER JOIN
           ( SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                  , SUM(NVL(RENTAL_NW_CT, 0)) AS OG_RENTAL_NW_CT	/* 조직렌탈신규건수 */
                  , SUM(NVL(SPAY_NW_CT, 0)) AS OG_SPAY_NW_CT	/* 조직일시불신규건수 */
                  , SUM(NVL(RENTAL_CAN_CT, 0)) AS OG_RENTAL_CAN_CT	/* 조직렌탈취소건수 */
                  , SUM(NVL(RENTAL_EXN_CT, 0)) AS OG_RENTAL_EXN_CT	/* 조직렌탈만료건수 */
                  , SUM(NVL(RENTAL_BOO_CAN_CT, 0)) AS OG_RENTAL_BOO_CAN_CT	/* 조직렌탈예약취소건수 */
                  , SUM(NVL(SPAY_RSG_CT, 0)) AS OG_SPAY_RSG_CT	/* 조직일시불해지건수 */
                  , SUM(NVL(SPAY_BOO_CAN_CT, 0)) AS OG_SPAY_BOO_CAN_CT	/* 조직일시불예약취소건수 */
                  , SUM(NVL(MSH_SPR_CT, 0)) AS OG_MSH_SPR_CT	/* 조직멤버십이탈건수 */
               FROM
                  ( SELECT PERF_YM
                         , OG_TP_CD
                         , PRTNR_NO
                         , RENTAL_NW_CT
                         , SPAY_NW_CT
                         , RENTAL_CAN_CT
                         , RENTAL_EXN_CT
                         , RENTAL_BOO_CAN_CT
                         , SPAY_RSG_CT
                         , SPAY_BOO_CAN_CT
                         , MSH_SPR_CT
                      FROM TB_FEAM_WELS_ACC_NINC_MM_CL	/* 웰스계정순증월마감 */
                     WHERE DTA_DL_YN = 'N'
                       AND PERF_YM = #{dto.perfYm}
                       AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                       AND CO_CD = '2000'
                       AND OG_TP_CD = 'W02'
                       <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
                       AND PRTNR_NO = #{dto.prtnrNo}
                       </if>
                 ) A
             INNER JOIN TB_OGBS_MM_PRTNR_IZ B	/* 월파트너내역 */
                ON A.PERF_YM = B.BASE_YM
               AND A.OG_TP_CD = B.OG_TP_CD
               AND A.PRTNR_NO = B.PRTNR_NO
             INNER JOIN TB_OGBS_MM_OG_IZ C	/* 월조직내역 */
                ON B.BASE_YM = C.BASE_YM
               AND B.OG_ID = C.OG_ID
               AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
               <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
               AND C.DGR3_LEVL_DG_PRTNR_NO = #{dto.prtnrNo}
               </if>
             GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
          ) OGNINC	/* 계정순증 */
         ON PRTNR.PRTNR_NO = OGNINC.PRTNR_NO
       LEFT OUTER JOIN
          ( SELECT PRTNR_NO
                   <if test='@MybatisUtils@isNotEmpty(feeArticles)'>
                   <foreach collection="feeArticles" item='feeArticle' open=', ' close='' separator=', ' >
                   FEE_${feeArticle.dtaCrtFeeCd}
                   </foreach>
                   </if>
              FROM
                 ( SELECT PRTNR_NO
                        , FEE_CD
                        , NVL(FEE_ATC_VAL, 0) AS FEE_AMT
                     FROM TB_FEAM_FEE_DSB_DTL_IZ	/*수수료지급상세내역*/
                    WHERE DTA_DL_YN = 'N'
                      AND DSB_YM = #{dto.perfYm}
                      AND CO_CD = '2000'
                      AND OG_TP_CD = 'W02'
                      <if test='@MybatisUtils@isNotEmpty(feeArticles)'>
                      AND FEE_CD IN
                      <foreach collection="feeArticles" item='feeArticle' open='(' close=')' separator=', ' >
                      '${feeArticle.dtaCrtFeeCd}'
                      </foreach>
                      </if>
                      AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
                      AND SPMT_DSB_DV_CD = '01'	/*추가지급구분코드 - 정상지급*/
                      AND FEE_ATC_DV_CD = '01'   /*수수료항목구분코드 - 01 수수료계산*/
                ) A
                PIVOT (SUM(FEE_AMT) FOR FEE_CD IN (
                    <if test='@MybatisUtils@isNotEmpty(feeArticles)'>
                    <foreach collection="feeArticles" item='feeArticle' open='' close='' separator=', ' >
                        '${feeArticle.dtaCrtFeeCd}' AS FEE_${feeArticle.dtaCrtFeeCd}
                    </foreach>
                    </if>
                ))
         ) FEE	/* 수수료 */
        ON PRTNR.PRTNR_NO = FEE.PRTNR_NO
      LEFT OUTER JOIN
         ( SELECT PRTNR_NO
                , INTBS_AMT	/* 소득과표금액 */
                , DDCTAM	/* 공제금액 */
                , DSB_OJ_AMT	/* 지급대상금액 */
             FROM TB_FEAM_FEE_DSB_IZ	/* 수수료지급내역 */
            WHERE DTA_DL_YN = 'N'
              AND DSB_YM = #{dto.perfYm}
              AND CO_CD = '2000'
              AND OG_TP_CD = 'W02'
              AND FEE_TCNT_DV_CD = #{dto.feeTcntDvCd}
              AND SPMT_DSB_DV_CD = '01'	/*추가지급구분코드 - 정상지급*/
        ) DSB
       ON PRTNR.PRTNR_NO = DSB.PRTNR_NO
    WHERE PRTNR.DTA_DL_YN = 'N'
      AND PRTNR.BASE_YM = #{dto.perfYm}
      AND PRTNR.OG_TP_CD = 'W02'
      <if test='@MybatisUtils@isEmpty(dto.rsbDvCd)'>
      AND PRTNR.RSB_DV_CD IN ('W0204', 'W0205')
      </if>
      <if test='@MybatisUtils@isNotEmpty(dto.rsbDvCd)'>
      AND PRTNR.RSB_DV_CD = #{dto.rsbDvCd}
      </if>
      <if test='@MybatisUtils@isNotEmpty(dto.prtnrNo)'>
      AND PRTNR.PRTNR_NO = #{dto.prtnrNo}
      </if>
      <if test='@MybatisUtils@isNotEmpty(dto.ogLevl1Id)'>
      AND OG.DGR1_LEVL_OG_ID = #{dto.ogLevl1Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(dto.ogLevl2Id)'>
      AND OG.DGR2_LEVL_OG_ID = #{dto.ogLevl2Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(dto.ogLevl3Id)'>
      AND OG.DGR3_LEVL_OG_ID = #{dto.ogLevl3Id}
      </if>
    ORDER BY OG_CD, TO_NUMBER(PRTNR_NO)
   )
    </select>

    <select id='selectManagerTotalFees' resultType="camelMap">
        SELECT BASE_YM	/* 기준년월 */
             , OG_CD	/* 조직코드 */
             , OG_NM   /* 조직명 */
             , PRTNR_NO	/* 파트너번호 */
             , PRTNR_KNM	/* 성명 */
             , RSB_DV_CD	/* 직책구분코드 */
             , CASE WHEN PSTN_DV_CD = '7' THEN CASE WHEN PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    ELSE F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', QLF_DV_CD) END AS QLF_DV_NM
             , CASE WHEN NMN_PSTN_DV_CD = '7' THEN
                    	 CASE WHEN NMN_PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    WHEN NMN_PSTN_DV_CD = '15' THEN F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', NMN_QLF_DV_CD)
                    WHEN NMN_PSTN_DV_CD = '4'  THEN '지역단장'
                    WHEN NMN_PSTN_DV_CD = '2'  THEN '총괄단장'
                    ELSE '해약' END AS NMN_QLF_DV_NM /*  수수료실적년월+1개월의 직책    */
             , OG_ID	/* 조직ID */
             , DGR1_LEVL_OG_ID /* 총괄단조직ID */
             , DGR2_LEVL_OG_ID /* 지역단조직ID */
             , DGR3_LEVL_OG_ID /* 지점조직ID */
             , FST_BIZ_RGST	/* 업무등록-최초업무등록월 */
             , BIZ_RGST	/* 업무등록-재등록월 */
             , BIZ_FNL_CLTN	/* 업무등록-최종해약월 */
             , BIZ_CLTN	/* 업무등록-업무해약월 */
             , PRFMT_MM	/* 승진월-지점장은 승진월, 플래너는 강등월*/
             , PRFMT_NMN /*승진차월*/
             , CASE WHEN RSB_DV_CD = 'W0205' THEN NVL(INDV_METG_PRSC_DC, 0) ELSE NVL(OG_METG_PRSC_DC, 0) END AS METG_PRSC_DC	/* 미팅참석일수 */
             , STRTUP	/* 교육-스타트업 */
             , PRE_STRTUP	/* 교육-프리스타트업 */
             , EDU_CMPF	/* 교육-보수교육최종(129)수료여부 */
             , EDU_MNGER_SETTLE1	/* 교육-매니저정착1(4)수료여부 */
             , EDU_MNGER_SETTLE2	/* 교육-매니저정착2(119)수료여부 */
             , EDU_MNGER_SETTLE345	/* 교육-매니저정착345(140)수료여부 */
             , EDU_BRMGR_ONL	/* 교육-지점장교육(135)수료여부 */
             , EDU2_PRE /*교육-Pre누적교육 */
             , TOPMR_SETTLE	/* 교육-수석정착 */
             , TOPMR_NMN /*교육-수석차월*/
             , SUBSTR(MNGER_FST_OPNG, 1, 6) AS MNGER_FST_OPNG	/* 매니저개시사항-최초개시일 */
             , SUBSTR(MNGER_OPNG, 1, 6) AS MNGER_OPNG	/* 매니저개시사항-재개시월 */
             , MNGER_FNL_CLTN	/* 매니저개시사항-최종해약월 */
             , MNGER_BIZ_CLTN /* 매니저개시사항-업무해약월 */
             , CASE WHEN MNGER_OPNG IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(BASE_YM||'01', 'YYYYMMDD'), TO_DATE(MNGER_OPNG, 'YYYYMMDD')))+1
                    WHEN MNGER_FST_OPNG IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(BASE_YM||'01', 'YYYYMMDD'), TO_DATE(MNGER_FST_OPNG, 'YYYYMMDD')))+1
               ELSE 0 END AS MNGER_BLTN_NMN /* 매니저개시사항-매니저 개시차월 */
             , MNGER_SETTLE_DSB_TP /* 매니저개시사항-정착지급유형 */
             , INDV_D5_ASN_CNT  /* 5일배정건수 */
             , (INDV_ASN_CNT - INDV_BS_CAN_CNT) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
             , INDV_FSH_CNT	/* 개인BS-완료건수 */
             , INDV_PROCS_RAT	/* 개인BS-처리율 */
             , CASE WHEN INDV_PROCS_RAT = 0 THEN 0
                    WHEN RSB_DV_CD = 'W0204' AND INDV_PROCS_RAT <![CDATA[>=]]> 90 AND INDV_FSH_CNT <![CDATA[>=]]> 120 THEN 70    /*지점장은 처리율90이상 완료건수 120건이상일 경우 70*/
                    WHEN RSB_DV_CD = 'W0204' AND INDV_PROCS_RAT <![CDATA[<]]> 90 AND INDV_FSH_CNT <![CDATA[>=]]> 120 THEN 56    /*지점장은 처리율90미만 완료건수 120건이상일 경우 56*/
                    WHEN INDV_PROCS_RAT <![CDATA[>]]> 0 AND INDV_PROCS_RAT <![CDATA[<]]> 90 THEN 80
                    WHEN INDV_PROCS_RAT <![CDATA[>=]]> 90 THEN 100 END AS INDV_DBS_RAT	/*개인BS-지급률*/
             , INDV_W1_CNT	/* 개인BS-W1급지건수 */
             , INDV_W2_CNT	/* 개인BS-W2급지건수 */
             , (OG_ASN_CNT - OG_BS_CAN_CNT) AS OG_ASN_CNT	/* 조직BS-배정건수 */
             , OG_FSH_CNT	/* 조직BS-완료건수 */
             , CASE WHEN OG_ASN_CNT <![CDATA[>]]> 0 THEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) ELSE 0 END AS OG_PROCS_RAT	/* 조직BS-처리율 */
             , CASE WHEN OG_ASN_CNT <![CDATA[>]]> 0 THEN
                    CASE WHEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) <![CDATA[>=]]> 90 THEN 100
                         WHEN TRUNC(OG_FSH_CNT / (OG_ASN_CNT - OG_BS_CAN_CNT) * 100.00, 1) <![CDATA[<]]> 90 THEN 80
                         ELSE 0
                    END
               ELSE 0 END AS OG_DBS_RAT	/*조직BS-순증관리지급률*/
             , INDV_ELHM_ACKMT_CNT	/* 개인실적-가전인정건수 */
             , INDV_RENTAL_BASE_PRC	/* 개인실적-렌잘기준가 */
             , INDV_SPAY_BASE_PRC	/* 개인실적-일시불기준가 */
             , INDV_CHDVC_CNT	/* 개인실적-기변건수 */
             , INDV_ELHM_EXCP_ACKMT_PERF	/* 개인실적-가전외인정실적 */
             , INDV_FXAM_CT	/* 개인실적-정액건수 */
             , INDV_LIVE_PAKG_CNT	/* 개인실적-라이브팩건수 */
             , INDV_HCR_MSH_CNT	/* 개인실적-홈케어멤버십건수 */
             , OG_ELHM_ACKMT_CNT	/* 조직실적-가전인정건수 */
             , OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
             , OG_RENTAL_BASE_PRC	/* 조직실적-렌탈기준가 */
             , OG_SPAY_BASE_PRC	/* 조직실적-일시불기준가 */
             , OG_CHDVC_CNT	/* 조직실적-기변건수 */
             , OG_ELHM_EXCP_ACKMT_PERF + OG_RENTAL_BASE_PRC + OG_SPAY_BASE_PRC AS OG_PERF_SUM	/*조직실적-계*/
             , INDV_NW_CNT	/* 개인순증-신규건수*/
             , INDV_CAN_CNT	/* 개인순증-취소건수 */
             , INDV_NW_CNT - INDV_CAN_CNT AS INDV_NINC	/* 개인순증-순증 */
             , OG_NW_CNT	/* 조직순증-신규건수*/
             , OG_CAN_CNT	/* 조직순증-취소건수 */
             , OG_NW_CNT - OG_CAN_CNT AS OG_NINC	/* 조직순증-순증 */
             , INTBS_AMT	/* 소득과표금액 */
             , DDCTAM	/* 공제금액 */
             , DSB_OJ_AMT	/* 지급대상금액 */
             , INDV1_FEE /*개인수수료-가전비례 */
             , INDV2_FEE /*개인수수료-가전외비례 */
             , INDV3_FEE /*개인수수료-가전판매장려 */
             , INDV4_FEE /*개인수수료-미팅 */
             , INDV5_FEE /*개인수수료-교육 */
             , INDV6_FEE /*개인수수료-정착 */
             , INDV7_FEE /*개인수수료-기기변경 */
             , INDV8_FEE /*개인수수료-BS관리 */
             , INDV9_FEE /*개인수수료-BS장려 */
             , INDV10_FEE /*개인수수료-급지 */
             , INDV11_FEE /*개인수수료-WM통신 */
             , INDV12_FEE /*개인수수료-WM기타 */
             , INDV13_FEE /*개인수수료-사전방문 */
             , INDV14_FEE /*개인수수료-유니폼 */
             , INDV15_FEE /*개인수수료-자재실장 */
             , INDV16_FEE /*개인수수료-가전추가장려 */
             , OG1_FEE /*조직수수료-가전조직비례 */
             , OG2_FEE /*조직수수료-가전조직외비례 */
             , OG3_FEE /*조직수수료-가전조직판매장려 */
             , OG4_FEE /*조직수수료-교육 */
             , OG5_FEE /*조직수수료-순증관리 */
             , OG6_FEE /*조직수수료-조직배출1 */
             , OG7_FEE /*조직수수료-조직배출2 */
             , OG8_FEE /*조직수수료-신설지점 */
             , ETC1_ATC /*기타-재지급 */
             , ETC2_ATC /*기타-멤버십 */
             , ETC3_ATC /*기타-기타지원 */
             , HOME_CARE /* 홈케어 */
             , RSTL /* 재약정 */
             , LIVE_PAKG /* 라이브팩 */
          FROM
             ( SELECT PRTNR.BASE_YM	/* 기준년월 */
                    , PRTNR.OG_CD	/* 조직코드 */
                    , PRTNR.OG_NM   /* 조직명 */
                    , PRTNR.PRTNR_NO	/* 파트너번호 */
                    , PRTNR.PRTNR_KNM	/* 성명 */
                    , PRTNR.RSB_DV_CD	/* 직책구분코드 */
                    , PRTNR.QLF_DV_CD	/* 수수료월자격구분코드 */
                    , PRTNR.PSTN_DV_CD  /* 수수료월직급구분코드 */
                    , PRTNR.PRTNR_GD_CD     /* 수수료월파트너등급코드 */
                    , NMNQLF.PSTN_DV_CD AS NMN_PSTN_DV_CD	/* 차월직급구분코드 */
                    , NMNQLF.QLF_DV_CD AS NMN_QLF_DV_CD	/* M+1 자격구분코드 */
                    , NMNQLF.PRTNR_GD_CD AS NMN_PRTNR_GD_CD	/* M+1 등급구분코드 */
                    , OG.OG_ID	/* 조직ID */
                    , OG.DGR1_LEVL_OG_ID /* 총괄단조직ID */
                    , OG.DGR2_LEVL_OG_ID /* 지역단조직ID */
                    , OG.DGR3_LEVL_OG_ID /* 지점조직ID */
                    , SUBSTR(PRTNR.FST_CNTR_DT, 1, 6) AS FST_BIZ_RGST	/* 업무등록-최초업무등록월 */
                    , SUBSTR(PRTNR.RCNTR_DT, 1, 6) AS BIZ_RGST	/* 업무등록-재등록월 */
                    , SUBSTR(PRTNR.FNL_CLTN_DT, 1, 6) AS BIZ_FNL_CLTN	/* 업무등록-최종해약월 */
                    , SUBSTR(PRTNR.CLTN_DT, 1, 6) AS BIZ_CLTN	/* 업무등록-업무해약월 */
                    , CASE WHEN PRTNR.RSB_DV_CD = 'W0204' THEN SUBSTR(PRTNR.PRFMT_DT, 1, 6)
    	                   ELSE SUBSTR(PRTNR.DMTN_DT, 1, 6) END AS PRFMT_MM	/* 승진월-지점장은 승진월 플래너는 강등월 */
                    , CASE WHEN PRTNR.PRFMT_DT IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(PRTNR.BASE_YM||'01', 'YYYYMMDD'), TO_DATE(PRTNR.PRFMT_DT, 'YYYYMMDD')))+1
                           ELSE 0 END AS PRFMT_NMN /*승진차월*/
                    , NVL(INDVMT.PERF_VAL, 0) AS INDV_METG_PRSC_DC	/* 미팅참석일수 */
                    , NVL(OGMT.PERF_VAL, 0) AS OG_METG_PRSC_DC	/* 미팅참석일수 */
                    , EDU.EDU96_YM AS STRTUP	/* 스타트업 */
                    , EDU.EDU143_YM AS PRE_STRTUP	/* 프리스타트업 */
                    , EDU.EDU100_YM AS TOPMR_SETTLE	/* 수석정착 */
                    , CASE WHEN EDU.EDU100_YM IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(PRTNR.BASE_YM||'01', 'YYYYMMDD'), TO_DATE(EDU.EDU100_YM||'01', 'YYYYMMDD')))+1
                           ELSE 0 END AS TOPMR_NMN /*수석차월*/
                    , NVL(EDU2.EDU_CMPF, 'N') AS EDU_CMPF	/* 보수교육최종(129)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE1, 'N') AS EDU_MNGER_SETTLE1	/* 매니저정착1(4)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE2, 'N') AS EDU_MNGER_SETTLE2	/* 매니저정착2(119)수료여부 */
                    , NVL(EDU2.EDU_MNGER_SETTLE345, 'N') AS EDU_MNGER_SETTLE345	/* 매니저정착345(140)수료여부 */
                    , NVL(EDU2.EDU_PRE1, 'N') AS EDU_PRE1	/* 프리1정수기(144)수료여부 */
                    , NVL(EDU2.EDU_PRE2, 'N') AS EDU_PRE2	/* 프리2비데 기타(145)수료여부 */
                    , NVL(EDU2.EDU_PRE3, 'N') AS EDU_PRE3	/* 프리3세일즈(146)수료여부 */
                    , NVL(EDU2.EDU_PRE4, 'N') AS EDU_PRE4	/* 프리4Wells live(147)수료여부 */
                    , NVL(EDU2.EDU_PRE5, 'N') AS EDU_PRE5	/* 프리5Wells live(148)수료여부 */
                    , EDU135.EDU135_YM AS EDU_BRMGR_ONL	/* 지점장교육(135)수료여부 */
                    , CASE WHEN EDU2.EDU_PRE1 = 'Y' THEN '1'
                           WHEN EDU2.EDU_PRE2 = 'Y' THEN '2'
                           WHEN EDU2.EDU_PRE3 = 'Y' THEN '3'
                           WHEN EDU2.EDU_PRE4 = 'Y' THEN '4'
                           WHEN EDU2.EDU_PRE5 = 'Y' THEN '5'
                           ELSE ''
                      END AS EDU2_PRE /*교육-Pre누적교육 */
                    , MNGER1.MNGER_FST_OPNG AS MNGER_FST_OPNG	/* 매니저 최초개시일 */
                    , MNGER2.RESTRT_DT AS MNGER_OPNG    /* 매니저 재개시월 */
                    , SUBSTR(MNGER3.MNGER_FNL_CLTN, 1, 6) AS MNGER_FNL_CLTN	/* 매니저 최종해약월 */
                    , SUBSTR(MNGER4.MNGER_BIZ_CLTN, 1, 6) AS MNGER_BIZ_CLTN /* 매니저 업무해약월 */
                    , F_CMZ_CD_NM('TNT_WELLS', 'OPNG_CD', MNGER5.OPNG_CD) AS MNGER_SETTLE_DSB_TP /* 매니저개시 정착지급유형 */
                    , NVL(INDVD5.INDV_D5_ASN_CNT, 0) AS INDV_D5_ASN_CNT     /* 개인BS-5일배정건수 */
                    , NVL(INDVBS.INDV_ASN_CNT, 0) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
                    , NVL(INDVBS.INDV_BS_CAN_CNT, 0) AS INDV_BS_CAN_CNT     /* 개인BS-취소건수 */
                    , NVL(INDVBS.INDV_FSH_CNT, 0) AS INDV_FSH_CNT	/* 개인BS-완료건수 */
                    , NVL(INDVBS.INDV_PROCS_RAT, 0) AS INDV_PROCS_RAT	/* 개인BS-처리율 */
                    , NVL(INDVBS.INDV_W1_CNT, 0) AS INDV_W1_CNT	/* 개인BS-W1급지건수 */
                    , NVL(INDVBS.INDV_W2_CNT, 0) AS INDV_W2_CNT	/* 개인BS-W2급지건수 */
                    , NVL(OGBS.OG_ASN_CNT, 0) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                    , NVL(OGBS.OG_BS_CAN_CNT, 0) AS OG_BS_CAN_CNT	/* 조직BS-취소건수 */
                    , NVL(OGBS.OG_FSH_CNT, 0) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                    , NVL(PERF.INDV_ELHM_ACKMT_CNT, 0) AS INDV_ELHM_ACKMT_CNT	/* 개인실적-가전인정건수 */
                    , NVL(PERF.INDV_RENTAL_BASE_PRC, 0) AS INDV_RENTAL_BASE_PRC	/* 개인실적-렌잘기준가 */
                    , NVL(PERF.INDV_SPAY_BASE_PRC, 0) AS INDV_SPAY_BASE_PRC	/* 개인실적-일시불기준가 */
                    , NVL(PERF.INDV_CHDVC_CNT, 0) AS INDV_CHDVC_CNT	/* 개인실적-기변건수 */
                    , NVL(PERF.INDV_ELHM_EXCP_ACKMT_PERF, 0) AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인실적-가전외인정실적 */
                    , NVL(PERF.INDV_FXAM_CT, 0) AS INDV_FXAM_CT	/* 개인실적-정액건수 */
                    , NVL(PERF.INDV_LIVE_PAKG_CNT, 0) AS INDV_LIVE_PAKG_CNT	/* 개인실적-라이브팩건수 */
                    , NVL(PERF.INDV_HCR_MSH_CNT, 0) AS INDV_HCR_MSH_CNT	/* 개인실적-홈케어멤버십건수 */
                    , NVL(PERF.OG_ELHM_ACKMT_CNT, 0) AS OG_ELHM_ACKMT_CNT	/* 조직실적-가전인정건수 */
                    , NVL(PERF.OG_ELHM_EXCP_ACKMT_PERF, 0) AS OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
                    , NVL(PERF.OG_RENTAL_BASE_PRC, 0) AS OG_RENTAL_BASE_PRC	/* 조직실적-렌탈기준가 */
                    , NVL(PERF.OG_SPAY_BASE_PRC, 0) AS OG_SPAY_BASE_PRC	/* 조직실적-일시불기준가 */
                    , NVL(PERF.OG_CHDVC_CNT, 0) AS OG_CHDVC_CNT	/* 조직실적-기변건수 */
                    , NVL(INDVNINC.INDV_RENTAL_NW_CT, 0) + NVL(INDVNINC.INDV_SPAY_NW_CT, 0) AS INDV_NW_CNT	/* 개인순증-신규건수*/
                    , NVL(INDVNINC.INDV_RENTAL_CAN_CT, 0) + NVL(INDVNINC.INDV_RENTAL_EXN_CT, 0) + NVL(INDVNINC.INDV_RENTAL_BOO_CAN_CT, 0)
                        + NVL(INDVNINC.INDV_SPAY_RSG_CT, 0) + NVL(INDVNINC.INDV_SPAY_BOO_CAN_CT, 0) + NVL(INDVNINC.INDV_MSH_SPR_CT, 0) AS INDV_CAN_CNT	/* 개인순증-취소건수 */
                    , NVL(OGNINC.OG_RENTAL_NW_CT, 0) + NVL(OGNINC.OG_SPAY_NW_CT, 0) AS OG_NW_CNT	/* 조직순증-신규건수*/
                    , NVL(OGNINC.OG_RENTAL_CAN_CT, 0) + NVL(OGNINC.OG_RENTAL_EXN_CT, 0) + NVL(OGNINC.OG_RENTAL_BOO_CAN_CT, 0)
                        + NVL(OGNINC.OG_SPAY_RSG_CT, 0) + NVL(OGNINC.OG_SPAY_BOO_CAN_CT, 0) + NVL(OGNINC.OG_MSH_SPR_CT, 0) AS OG_CAN_CNT	/* 조직순증-취소건수 */
                    , NVL(DSB.INTBS_AMT, 0) AS INTBS_AMT	/* 소득과표금액 */
                    , NVL(DSB.DDCTAM, 0) AS DDCTAM	/* 공제금액 */
                    , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_OJ_AMT	/* 지급대상금액 */
                    , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV151_FEE, 0)
                           ELSE NVL(FEE.INDV071_FEE,0) END AS INDV1_FEE /*개인수수료-가전비례 */
                    , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV152_FEE, 0)
                           ELSE NVL(FEE.INDV072_FEE,0) END AS INDV2_FEE /*개인수수료-가전외비례 */
                    , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV153_FEE,0)
                           ELSE NVL(FEE.INDV073_FEE,0) END AS INDV3_FEE /*개인수수료-가전판매장려 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV154_FEE,0)
                            ELSE NVL(FEE.INDV074_FEE,0) END AS INDV4_FEE /*개인수수료-미팅 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV155_FEE,0)
                            ELSE NVL(FEE.INDV075_FEE,0) END AS INDV5_FEE /*개인수수료-교육 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV156_FEE,0)
                            ELSE NVL(FEE.INDV076_FEE,0) END AS INDV6_FEE /*개인수수료-정착 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV157_FEE,0)
                            ELSE NVL(FEE.INDV077_FEE,0) END AS INDV7_FEE /*개인수수료-기기변경 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV158_FEE,0)
                            ELSE NVL(FEE.INDV078_FEE,0) END AS INDV8_FEE /*개인수수료-BS관리 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV159_FEE,0)
                            ELSE NVL(FEE.INDV079_FEE,0) END AS INDV9_FEE /*개인수수료-BS장려 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1510_FEE,0)
                            ELSE NVL(FEE.INDV0710_FEE,0) END AS INDV10_FEE /*개인수수료-급지 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1511_FEE,0)
                            ELSE NVL(FEE.INDV0711_FEE,0) END AS INDV11_FEE /*개인수수료-WM통신 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1512_FEE,0)
                            ELSE NVL(FEE.INDV0712_FEE,0) END AS INDV12_FEE /*개인수수료-WM기타 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1513_FEE,0)
                            ELSE NVL(FEE.INDV0713_FEE,0) END AS INDV13_FEE /*개인수수료-사전방문 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1514_FEE,0)
                            ELSE NVL(FEE.INDV0714_FEE,0) END AS INDV14_FEE /*개인수수료-유니폼 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1515_FEE,0)
                            ELSE NVL(FEE.INDV0715_FEE,0) END AS INDV15_FEE /*개인수수료-자재실장 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.INDV1516_FEE,0)
                            ELSE NVL(FEE.INDV0716_FEE,0) END AS INDV16_FEE /*개인수수료-가전추가장려 */
                     , NVL(FEE.OG1_FEE,0) AS OG1_FEE /*조직수수료-가전조직비례 */
                     , NVL(FEE.OG2_FEE,0) AS OG2_FEE /*조직수수료-가전조직외비례 */
                     , NVL(FEE.OG3_FEE,0) AS OG3_FEE /*조직수수료-가전조직판매장려 */
                     , NVL(FEE.OG4_FEE,0) AS OG4_FEE /*조직수수료-교육 */
                     , NVL(FEE.OG5_FEE,0) AS OG5_FEE /*조직수수료-순증관리 */
                     , NVL(FEE.OG6_FEE,0) AS OG6_FEE /*조직수수료-조직배출1 */
                     , NVL(FEE.OG7_FEE,0) AS OG7_FEE /*조직수수료-조직배출2 */
                     , NVL(FEE.OG8_FEE,0) AS OG8_FEE /*조직수수료-신설지점 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.ETC151_ATC,0)
                            ELSE NVL(FEE.ETC071_ATC,0) END AS ETC1_ATC /*기타-재지급 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.ETC152_ATC,0)
                            ELSE NVL(FEE.ETC072_ATC,0) END AS ETC2_ATC /*기타-멤버십 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.ETC153_ATC,0)
                            ELSE NVL(FEE.ETC073_ATC,0) END AS ETC3_ATC /*기타-기타지원 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.P_HOME_CARE,0)
                            ELSE NVL(FEE.HOME_CARE,0) END AS HOME_CARE /* 홈케어 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.P_RSTL,0)
                            ELSE NVL(FEE.RSTL,0) END AS RSTL /* 재약정 */
                     , CASE WHEN PRTNR.PSTN_DV_CD = '15' THEN NVL(FEE.P_LIVE_PAKG,0)
                            ELSE NVL(FEE.LIVE_PAKG,0) END AS LIVE_PAKG /* 라이브팩 */
                 FROM TB_OGBS_MM_PRTNR_IZ PRTNR	/* 월파트너내역*/
                INNER JOIN TB_OGBS_MM_OG_IZ OG	/* 월조직내역 */
                   ON PRTNR.BASE_YM = OG.BASE_YM
                  AND PRTNR.OG_ID = OG.OG_ID
                  AND OG.DTA_DL_YN = 'N'
                 LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL INDVMT	/* 파트너실적월마감 */
                   ON PRTNR.BASE_YM = INDVMT.BASE_YM
                  AND PRTNR.BASE_YM = INDVMT.PERF_YM
                  AND PRTNR.OG_TP_CD = INDVMT.OG_TP_CD
                  AND PRTNR.PRTNR_NO = INDVMT.PRTNR_NO
                  AND INDVMT.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                  AND INDVMT.PERF_ATC_CD = 'W02P00093'    /*미팅참석일수*/
                 LEFT OUTER JOIN
                 	( SELECT AGRG_YM
                 		   , OG_TP_CD
                 		   , PRTNR_NO
                 		   , METG_PRSC_DC AS PERF_VAL
                 	    FROM TB_PSCA_MCPTN_METG_AGRG
                 	   WHERE DTA_DL_YN = 'N'
                 	     AND AGRG_YM = #{perfYm}
                 	     AND OG_TP_CD = 'W02'
                 	) OGMT
                   ON PRTNR.BASE_YM = OGMT.AGRG_YM
                  AND PRTNR.OG_TP_CD = OGMT.OG_TP_CD
                  AND PRTNR.PRTNR_NO = OGMT.PRTNR_NO
                 LEFT OUTER JOIN
                    ( SELECT MIN(STRTDT) AS MNGER_FST_OPNG /* 매니저 최초개시일 */
                           , PRTNR_NO
                        FROM TB_OGPS_PLAR_QLF_CH_IZ     /* 플래너자격변경내역 */
                       WHERE DTA_DL_YN = 'N'
                         AND SUBSTR(STRTDT, 0, 6) <![CDATA[<=]]> #{perfYm}
                         AND OG_TP_CD = 'W02'
                         AND QLF_DV_CD IN (3, 6)
                         AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제(과거)  3:보류 제외 */
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                         AND PRTNR_NO = #{prtnrNo}
                         </if>
                       GROUP BY PRTNR_NO
                   ) MNGER1
                  ON PRTNR.PRTNR_NO = MNGER1.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT A.PRTNR_NO
                   		  , A.PSTN_DV_CD
                   	      , QLF.QLF_DV_CD
                          , A.PRTNR_GD_CD
                       FROM TB_OGBS_MM_PRTNR_IZ A
                       LEFT OUTER JOIN TB_OGPS_PLAR_QLF_CH_IZ QLF  /* 웰스매니저 자격정보 M+1 자격 */
                       ON A.OG_TP_CD = QLF.OG_TP_CD
                        AND A.PRTNR_NO = QLF.PRTNR_NO
                        AND NVL(QLF.QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제  3: 보류 제외*/
                 		AND TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'),1)),'YYYYMMDD') BETWEEN STRTDT AND ENDDT
                 		AND QLF.DTA_DL_YN = 'N'
                      WHERE A.OG_TP_CD = 'W02'
                        AND A.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM')
                  ) NMNQLF
                 ON PRTNR.PRTNR_NO = NMNQLF.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT OG_TP_CD
                          , PRTNR_NO
                          , MIN(STRTDT) AS FST_CNTR_DT  /* 최초계약일 */
                          , MAX(NVL2(STRT_PREV_DT,STRTDT,'')) AS RESTRT_DT    /* 재등록개시일 */
                       FROM
                          ( SELECT OG_TP_CD
                                 , PRTNR_NO
                                 , STRTDT
                                 , ENDDT
                                 , CV_DT
                                 , DSB_AMT
                                 , LAG(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT)  AS STRT_PREV_DT
                                 , LEAD(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT) AS STRT_NEXT_DT
                                 , LAG(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT)  AS END_PREV_DT
                                 , LEAD(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT) AS END_NEXT_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ   /* 플래너자격변경내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND OG_TP_CD  = 'W02'
                               AND QLF_DV_CD = 3
                               AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')  -- 승격,자격해제  3 : 보류 제외
                          ) A
                      WHERE 1=1
                      GROUP BY OG_TP_CD, PRTNR_NO
                  ) MNGER2
                 ON PRTNR.OG_TP_CD = MNGER2.OG_TP_CD
                AND PRTNR.PRTNR_NO = MNGER2.PRTNR_NO
               LEFT OUTER JOIN
                  ( SELECT MAX (ENDDT) AS MNGER_FNL_CLTN /* 매니저 최종해약월 */
                         , PRTNR_NO
                      FROM TB_OGPS_PLAR_QLF_CH_IZ	/* 플래너자격변경내역 */
                     WHERE DTA_DL_YN = 'N'
                       AND SUBSTR(ENDDT, 0, 6) <![CDATA[<=]]> #{perfYm}
                       AND OG_TP_CD = 'W02'
                       AND QLF_DV_CD IN (3, 6)
                       AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')   /* 승격,자격해제(과거)  3: 보류 제외 */
                       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                       AND PRTNR_NO = #{prtnrNo}
                       </if>
                     GROUP BY PRTNR_NO
                 ) MNGER3
                ON PRTNR.PRTNR_NO = MNGER3.PRTNR_NO
              LEFT OUTER JOIN
                 ( SELECT CASE WHEN MAX(ENDDT) = '99991231' THEN '' ELSE MAX(ENDDT) END AS MNGER_BIZ_CLTN /* 매니저 업무해약월 */
                        , PRTNR_NO
                     FROM TB_OGPS_PLAR_QLF_CH_IZ	/* 플래너자격변경내역 */
                    WHERE DTA_DL_YN = 'N'
                      AND OG_TP_CD = 'W02'
                      AND QLF_DV_CD IN (3, 6)
                      AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')    /* 승격,자격해제(과거)  3: 보류 제외 */
                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                      AND PRTNR_NO = #{prtnrNo}
                      </if>
                    GROUP BY PRTNR_NO
                ) MNGER4
               ON PRTNR.PRTNR_NO = MNGER4.PRTNR_NO
             LEFT OUTER JOIN
                ( SELECT NVL(OPNG_CD, '9') AS OPNG_CD /* 매니저개시 정착지급유형 */
                       , PRTNR_NO
                    FROM TB_FEAM_WELS_MNGER_OPNG_BAS	/* 웰스매니저개시기본 */
                   WHERE DTA_DL_YN = 'N'
                     AND BASE_YM = #{perfYm}
                     AND OG_TP_CD = 'W02'
                     AND TCNT_DV_CD = #{feeTcntDvCd}
                     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                     AND PRTNR_NO = #{prtnrNo}
                     </if>
               ) MNGER5
              ON PRTNR.PRTNR_NO = MNGER5.PRTNR_NO
            LEFT OUTER JOIN
               ( SELECT OG_TP_CD
                      , PRTNR_NO
                      , EDU96_YM
                      , EDU143_YM
                      , EDU17_YM
                      , CASE WHEN NVL(EDU106_YM, 0)  <![CDATA[>]]>  NVL(EDU100_YM, 0) THEN EDU106_YM
                        ELSE EDU100_YM END AS EDU100_YM
                   FROM
                      ( SELECT A.OG_TP_CD
                             , A.PRTNR_NO
                             , A.EDUC_CRSE_NO
                             , A.EDUC_CRSE_CRT_BASE_YM
                          FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                         WHERE A.DTA_DL_YN = 'N'
                           AND A.EDUC_CRSE_CRT_BASE_YM <![CDATA[<=]]> #{perfYm}
                           AND A.EDUC_CRSE_NO IN ('96','143', '17', '100', '106')
                           AND A.EDUC_CPC_ACKMT_YN = 'Y'
                     ) A
                 PIVOT ( MAX(EDUC_CRSE_CRT_BASE_YM) FOR EDUC_CRSE_NO IN ('96' AS EDU96_YM,'143' AS EDU143_YM, '17' AS EDU17_YM, '100' AS EDU100_YM, '106' AS EDU106_YM))
              ) EDU
             ON PRTNR.OG_TP_CD = EDU.OG_TP_CD
            AND PRTNR.PRTNR_NO = EDU.PRTNR_NO
           LEFT OUTER JOIN
               ( SELECT OG_TP_CD
                      , PRTNR_NO
                      , EDU135_YM
                   FROM
                      ( SELECT A.OG_TP_CD
                             , A.PRTNR_NO
                             , A.EDUC_CRSE_NO
                             , A.EDUC_CRSE_CRT_BASE_YM
                          FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                         WHERE A.DTA_DL_YN = 'N'
                           AND A.EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                           AND A.EDUC_CRSE_NO = '135'
                           AND A.EDUC_CPC_ACKMT_YN = 'Y'
                     ) A
                 PIVOT ( MAX(EDUC_CRSE_CRT_BASE_YM) FOR EDUC_CRSE_NO IN ('135' AS EDU135_YM))
              ) EDU135
             ON PRTNR.OG_TP_CD = EDU135.OG_TP_CD
            AND PRTNR.PRTNR_NO = EDU135.PRTNR_NO
           LEFT OUTER JOIN
              ( SELECT PRTNR_NO
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00116' THEN FEE_PERF_ATC_VAL END) AS EDU_CMPF	/* 보수교육최종(129)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00124' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE1	/* 매니저정착1(4)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00125' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE2	/* 매니저정착2(119)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00126' THEN FEE_PERF_ATC_VAL END) AS EDU_MNGER_SETTLE345	/* 매니저정착345(140)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00127' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE1	/* 프리1정수기(144)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00128' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE2	/* 프리2비데 기타(145)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00129' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE3	/* 프리3세일즈(146)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00130' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE4	/* 프리4Wells live(147)수료여부 */
                     , MAX(CASE WHEN PERF_ATC_CD = 'W02P00131' THEN FEE_PERF_ATC_VAL END) AS EDU_PRE5	/* 프리5Wells live(148)수료여부 */
                  FROM TB_FEAM_PRTNR_PERF_MM_CL	/* 파트너실적월마감 */
                 WHERE DTA_DL_YN = 'N'
                   AND BASE_YM = #{perfYm}
                   AND PERF_YM = #{perfYm}
                   AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                   AND PERF_AGRG_CRT_DV_CD = '201'
                   AND PERF_ATC_CD IN ( 'W02P00116', 'W02P00124', 'W02P00125', 'W02P00126', 'W02P00127',
                                      'W02P00128', 'W02P00129', 'W02P00130', 'W02P00131')
                   AND CO_CD = '2000'
                   AND OG_TP_CD = 'W02'
                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                   AND PRTNR_NO = #{prtnrNo}
                   </if>
                 GROUP BY PRTNR_NO
             ) EDU2
            ON PRTNR.PRTNR_NO = EDU2.PRTNR_NO
          LEFT OUTER JOIN
             ( SELECT PRTNR_NO
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN PERF_VAL ELSE 0 END ) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN PERF_VAL ELSE 0 END ) AS INDV_BS_CAN_CNT	/* 개인BS-취소건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD IN ('SV01999902', 'SV01999903') THEN PERF_VAL ELSE 0 END ) AS INDV_FSH_CNT	/* 개인BS-완료건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999910' THEN PERF_VAL ELSE 0 END ) AS INDV_PROCS_RAT	/* 개인BS-처리율 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010102' THEN PERF_VAL ELSE 0 END ) AS INDV_W1_CNT	/* 개인BS-W1급지건수 */
                    , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV06010103' THEN PERF_VAL ELSE 0 END ) AS INDV_W2_CNT	/* 개인BS-W2급지건수 */
                 FROM TB_FEAM_WPTN_SV_PERF_AGRG T1	/* 웰스파트너서비스실적집계 */
                WHERE DTA_DL_YN = 'N'
                  AND BASE_YM = #{perfYm}
                  AND CL_DV_CD = #{feeTcntDvCd}
                  AND OG_TP_CD = 'W02'
                  AND PRTNR_SV_PERF_ATC_CD IN ('SV01999901', 'SV01999902', 'SV01999903', 'SV01999910', 'SV06010102', 'SV06010103', 'SV01909001')	/* 배정건수, 당월완료건수, 전월완료건수, 비율, W1급지건수, W2급지건수 */
                  <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                  AND PRTNR_NO = #{prtnrNo}
                  </if>
                GROUP BY PRTNR_NO
             ) INDVBS
            ON PRTNR.PRTNR_NO = INDVBS.PRTNR_NO
          LEFT OUTER JOIN
          	  (  SELECT PRTNR_NO
                      , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV24010101' THEN PERF_VAL ELSE 0 END ) AS INDV_D5_ASN_CNT	/* 개인BS-5일배정건수 */
                   FROM TB_FEAM_WPTN_SV_PED_AGRG T1	/* 웰스파트너서비스일집계 */
                  WHERE DTA_DL_YN = 'N'
                    AND BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'), 1), 'YYYYMM')
                    AND OG_TP_CD = 'W02'
                    AND PRTNR_SV_PERF_ATC_CD = 'SV24010101'	/* 5일배정건수 */
                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                    AND PRTNR_NO = #{prtnrNo}
                    </if>
                GROUP BY PRTNR_NO
          	  ) INDVD5
            ON PRTNR.PRTNR_NO = INDVD5.PRTNR_NO
          LEFT OUTER JOIN
             ( SELECT T3.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                    , SUM(T1.OG_ASN_CNT) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                    , SUM(T1.OG_BS_CAN_CNT) AS OG_BS_CAN_CNT	/* 조직BS-취소건수 */
                    , SUM(T1.OG_FSH_CNT) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                 FROM
                    ( SELECT A.BASE_YM
                           , A.OG_TP_CD
                           , A.PRTNR_NO
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN A.PERF_VAL ELSE 0 END ) AS OG_ASN_CNT	/* 조직BS-배정건수 */
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD = 'SV01909001' THEN A.PERF_VAL ELSE 0 END) AS OG_BS_CAN_CNT	/*조직BS-취소건수*/
                           , SUM(CASE WHEN A.PRTNR_SV_PERF_ATC_CD IN ('SV01999902', 'SV01999903') THEN A.PERF_VAL ELSE 0 END ) AS OG_FSH_CNT	/* 조직BS-완료건수 */
                        FROM TB_FEAM_WPTN_SV_PERF_AGRG A	/* 웰스파트너서비스실적집계 */
                       INNER JOIN TB_OGBS_MM_PRTNR_IZ B    /*월파트너내역*/
                          ON A.BASE_YM = B.BASE_YM
                         AND A.OG_TP_CD = B.OG_TP_CD
                         AND A.PRTNR_NO = B.PRTNR_NO
                       WHERE A.DTA_DL_YN = 'N'
                         AND A.BASE_YM = #{perfYm}
                         AND A.CL_DV_CD = #{feeTcntDvCd}
                         AND A.OG_TP_CD = 'W02'
                         AND A.PRTNR_SV_PERF_ATC_CD IN ('SV01999901', 'SV01999902', 'SV01999903', 'SV01909001')	/* 배정건수, 당월완료건수, 전월완료건수, 취소건수 */
                         AND B.PSTN_DV_CD = '15'   /* 지점장 실적 제외 */
                       GROUP BY A.BASE_YM, A.OG_TP_CD, A.PRTNR_NO
                   ) T1	/* 파트너별 개인BS */
               INNER JOIN TB_OGBS_MM_PRTNR_IZ T2	/* 월파트너내역 */
                  ON T1.BASE_YM = T2.BASE_YM
                 AND T1.OG_TP_CD = T2.OG_TP_CD
                 AND T1.PRTNR_NO = T2.PRTNR_NO
               INNER JOIN TB_OGBS_MM_OG_IZ T3	/* 월조직내역 */
                  ON T2.BASE_YM = T3.BASE_YM
                 AND T2.OG_ID = T3.OG_ID
                 AND T3.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
                 <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                 AND T3.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
                 </if>
               GROUP BY T3.DGR3_LEVL_DG_PRTNR_NO
            ) OGBS	/* 조직BS */
           ON PRTNR.PRTNR_NO = OGBS.PRTNR_NO
         LEFT OUTER JOIN
            ( SELECT PRTNR_NO
                   , SUM(INDV_ELHM_ACKMT_CNT) AS INDV_ELHM_ACKMT_CNT    /* 개인가전인정건수 */
                   , SUM(INDV_RENTAL_BASE_PRC) AS INDV_RENTAL_BASE_PRC  /* 개인렌탈기준가 */
                   , SUM(INDV_SPAY_BASE_PRC) AS INDV_SPAY_BASE_PRC  /* 개인일시불기준가 */
                   , SUM(INDV_CHDVC_CNT) AS INDV_CHDVC_CNT  /* 개인기변건수 */
                   , SUM(INDV_ELHM_EXCP_ACKMT_PERF) AS INDV_ELHM_EXCP_ACKMT_PERF    /* 개인가전외인정실적 */
                   , SUM(INDV_FXAM_CT) AS INDV_FXAM_CT  /* 개인정액건수 */
                   , SUM(INDV_LIVE_PAKG_CNT) AS INDV_LIVE_PAKG_CNT  /* 개인라이브팩건수 */
                   , SUM(INDV_HCR_MSH_CNT) AS INDV_HCR_MSH_CNT  /* 개인홈케어멤버십건수 */
                   , SUM(OG_ELHM_ACKMT_CNT) AS OG_ELHM_ACKMT_CNT /* 조직가전인정건수 */
                   , SUM(OG_ELHM_EXCP_ACKMT_PERF) AS OG_ELHM_EXCP_ACKMT_PERF    /*조직가전외인정실적*/
                   , SUM(OG_RENTAL_BASE_PRC) AS OG_RENTAL_BASE_PRC /* 조직렌탈기준가 */
                   , SUM(OG_SPAY_BASE_PRC) AS OG_SPAY_BASE_PRC /* 조직일시불기준가 */
                   , SUM(OG_CHDVC_CNT) AS OG_CHDVC_CNT /* 조직기변건수 */
                FROM
                   ( SELECT PRTNR_NO
                          , CASE WHEN PERF_ATC_CD IN ('W02P00103', 'W02P00002') THEN PERF_VAL ELSE 0 END AS INDV_ELHM_ACKMT_CNT	/* 개인가전인정건수 */
                          , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS INDV_RENTAL_BASE_PRC	/* 개인렌탈기준가 */
                          , CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS INDV_SPAY_BASE_PRC	/* 개인일시불기준가 */
                          , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS INDV_CHDVC_CNT	/* 개인기변건수 */
                          , CASE WHEN PERF_ATC_CD = 'W02P00112' THEN PERF_VAL ELSE 0 END AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인가전외인정실적 */
                          , CASE WHEN PERF_ATC_CD IN ('W00P00005', 'W00P00007') THEN PERF_VAL ELSE 0 END AS INDV_FXAM_CT	/* 개인정액건수 */
                          , CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END AS INDV_LIVE_PAKG_CNT	/* 개인라이브팩건수 */
                          , CASE WHEN PERF_ATC_CD = 'W02P00086' THEN PERF_VAL ELSE 0 END AS INDV_HCR_MSH_CNT	/* 개인홈케어멤버십건수 */
                          , 0 AS OG_ELHM_ACKMT_CNT	/* 조직가전인정건수 */
                          , 0 AS OG_ELHM_EXCP_ACKMT_PERF    /*조직가전외인정실적*/
                          , 0 AS OG_RENTAL_BASE_PRC	/* 조직렌탈기준가 */
                          , 0 AS OG_SPAY_BASE_PRC	/* 조직일시불기준가 */
                          , 0 AS OG_CHDVC_CNT	/* 조직기변건수 */
                       FROM TB_FEAM_NTORP_PERF_MM_CL	/* 순주문실적월마감 */
                      WHERE DTA_DL_YN = 'N'
                        AND BASE_YM = #{perfYm}
                        AND PERF_YM = #{perfYm}
                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                        AND PERF_AGRG_CRT_DV_CD = '201'
                        AND PERF_DV_CD = '0'	/* 실적구분코드 0-개인 */
                        AND OG_TP_CD = 'W02'
                        AND PERF_ATC_CD IN ( 'W02P00103', 'W02P00002', 'W00P00003', 'W00P00004', 'W00P00014',
                                             'W00P00018', 'W02P00027', 'W02P00112', 'W00P00005', 'W00P00007',
                                             'W02P00105', 'W00P00009', 'W02P00086' )
                        <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                        AND PRTNR_NO = #{prtnrNo}
                        </if>
                      UNION ALL
                      SELECT PRTNR_NO
                           , 0 AS INDV_ELHM_ACKMT_CNT	/* 개인가전인정건수 */
                           , 0 AS INDV_RENTAL_BASE_PRC	/* 개인렌탈기준가 */
                           , 0 AS INDV_SPAY_BASE_PRC	/* 개인일시불기준가 */
                           , 0 AS INDV_CHDVC_CNT	/* 개인기변건수 */
                           , 0 AS INDV_ELHM_EXCP_ACKMT_PERF	/* 개인가전외인정실적 */
                           , 0 AS INDV_FXAM_CT	/* 개인정액건수 */
                           , 0 AS INDV_LIVE_PAKG_CNT	/* 개인라이브팩건수 */
                           , 0 AS INDV_HCR_MSH_CNT	/* 개인홈케어멤버십건수 */
                           , CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL ELSE 0 END AS OG_ELHM_ACKMT_CNT	/* 조직가전인정건수 */
                           , CASE WHEN PERF_ATC_CD = 'W02P00112' THEN PERF_VAL ELSE 0 END AS OG_ELHM_EXCP_ACKMT_PERF	/* 조직가전외인정실적 */
                           , CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END AS OG_RENTAL_BASE_PRC	/* 조직렌탈기준가 */
                           , CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END AS OG_SPAY_BASE_PRC	/* 조직일시불기준가 */
                           , CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END AS OG_CHDVC_CNT	/* 조직기변건수 */
                        FROM TB_FEAM_NTORP_PERF_MM_CL	/* 순주문실적월마감 */
                       WHERE DTA_DL_YN = 'N'
                         AND BASE_YM = #{perfYm}
                         AND PERF_YM = #{perfYm}
                         AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                         AND PERF_AGRG_CRT_DV_CD = '201'
                         AND PERF_DV_CD = '2'	/* 실적구분코드 2-지점 */
                         AND OG_TP_CD = 'W02'
                         AND PERF_ATC_CD IN ( 'W02P00002', 'W00P00003', 'W00P00004', 'W00P00014', 'W00P00018', 'W02P00112')
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                         AND PRTNR_NO = #{prtnrNo}
                         </if>
                  )
              GROUP BY PRTNR_NO
           ) PERF
          ON PRTNR.PRTNR_NO = PERF.PRTNR_NO
        LEFT OUTER JOIN
           ( SELECT PRTNR_NO
                  , RENTAL_NW_CT AS INDV_RENTAL_NW_CT	/* 개인렌탈신규건수 */
                  , SPAY_NW_CT AS INDV_SPAY_NW_CT	/* 개인일시불신규건수 */
                  , RENTAL_CAN_CT AS INDV_RENTAL_CAN_CT	/* 개인렌탈취소건수 */
                  , RENTAL_EXN_CT AS INDV_RENTAL_EXN_CT	/* 개인렌탈만료건수 */
                  , RENTAL_BOO_CAN_CT AS INDV_RENTAL_BOO_CAN_CT	/* 개인렌탈예약취소건수 */
                  , SPAY_RSG_CT AS INDV_SPAY_RSG_CT	/* 개인일시불해지건수 */
                  , SPAY_BOO_CAN_CT AS INDV_SPAY_BOO_CAN_CT	/* 개인일시불예약취소건수 */
                  , MSH_SPR_CT AS INDV_MSH_SPR_CT	/* 개인멤버십이탈건수 */
               FROM TB_FEAM_WELS_ACC_NINC_MM_CL	/* 웰스계정순증월마감 */
              WHERE DTA_DL_YN = 'N'
                AND PERF_YM = #{perfYm}
                AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                AND CO_CD = '2000'
                AND OG_TP_CD = 'W02'
                <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                AND PRTNR_NO = #{prtnrNo}
                </if>
          ) INDVNINC
         ON PRTNR.PRTNR_NO = INDVNINC.PRTNR_NO
       LEFT OUTER JOIN
          (  SELECT C.DGR3_LEVL_DG_PRTNR_NO AS PRTNR_NO
                  , SUM(NVL(RENTAL_NW_CT, 0)) AS OG_RENTAL_NW_CT	/* 조직렌탈신규건수 */
                  , SUM(NVL(SPAY_NW_CT, 0)) AS OG_SPAY_NW_CT	/* 조직일시불신규건수 */
                  , SUM(NVL(RENTAL_CAN_CT, 0)) AS OG_RENTAL_CAN_CT	/* 조직렌탈취소건수 */
                  , SUM(NVL(RENTAL_EXN_CT, 0)) AS OG_RENTAL_EXN_CT	/* 조직렌탈만료건수 */
                  , SUM(NVL(RENTAL_BOO_CAN_CT, 0)) AS OG_RENTAL_BOO_CAN_CT	/* 조직렌탈예약취소건수 */
                  , SUM(NVL(SPAY_RSG_CT, 0)) AS OG_SPAY_RSG_CT	/* 조직일시불해지건수 */
                  , SUM(NVL(SPAY_BOO_CAN_CT, 0)) AS OG_SPAY_BOO_CAN_CT	/* 조직일시불예약취소건수 */
                  , SUM(NVL(MSH_SPR_CT, 0)) AS OG_MSH_SPR_CT	/* 조직멤버십이탈건수 */
               FROM
                  ( SELECT PERF_YM
                         , OG_TP_CD
                         , PRTNR_NO
                         , RENTAL_NW_CT
                         , SPAY_NW_CT
                         , RENTAL_CAN_CT
                         , RENTAL_EXN_CT
                         , RENTAL_BOO_CAN_CT
                         , SPAY_RSG_CT
                         , SPAY_BOO_CAN_CT
                         , MSH_SPR_CT
                      FROM TB_FEAM_WELS_ACC_NINC_MM_CL	/* 웰스계정순증월마감 */
                     WHERE DTA_DL_YN = 'N'
                       AND PERF_YM = #{perfYm}
                       AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                       AND CO_CD = '2000'
                       AND OG_TP_CD = 'W02'
                       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                       AND PRTNR_NO = #{prtnrNo}
                       </if>
                 ) A
             INNER JOIN TB_OGBS_MM_PRTNR_IZ B	/* 월파트너내역 */
                ON A.PERF_YM = B.BASE_YM
               AND A.OG_TP_CD = B.OG_TP_CD
               AND A.PRTNR_NO = B.PRTNR_NO
             INNER JOIN TB_OGBS_MM_OG_IZ C	/* 월조직내역 */
                ON B.BASE_YM = C.BASE_YM
               AND B.OG_ID = C.OG_ID
               AND C.DGR3_LEVL_DG_PRTNR_NO IS NOT NULL
               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
               AND C.DGR3_LEVL_DG_PRTNR_NO = #{prtnrNo}
               </if>
             GROUP BY C.DGR3_LEVL_DG_PRTNR_NO
          ) OGNINC	/* 계정순증 */
         ON PRTNR.PRTNR_NO = OGNINC.PRTNR_NO
       LEFT OUTER JOIN
          ( SELECT PRTNR_NO
                 , SUM(INDV151_FEE) AS INDV151_FEE
                 , SUM(INDV152_FEE) AS INDV152_FEE
                 , SUM(INDV153_FEE) AS INDV153_FEE
                 , SUM(INDV154_FEE) AS INDV154_FEE
                 , SUM(INDV155_FEE) AS INDV155_FEE
                 , SUM(INDV156_FEE) AS INDV156_FEE
                 , SUM(INDV157_FEE) AS INDV157_FEE
                 , SUM(INDV158_FEE) AS INDV158_FEE
                 , SUM(INDV159_FEE) AS INDV159_FEE
                 , SUM(INDV1510_FEE) AS INDV1510_FEE
                 , SUM(INDV1511_FEE) AS INDV1511_FEE
                 , SUM(INDV1512_FEE) AS INDV1512_FEE
                 , SUM(INDV1513_FEE) AS INDV1513_FEE
                 , SUM(INDV1514_FEE) AS INDV1514_FEE
                 , SUM(INDV1515_FEE) AS INDV1515_FEE
                 , SUM(INDV1516_FEE) AS INDV1516_FEE
                 , SUM(ETC151_ATC) AS ETC151_ATC
                 , SUM(ETC152_ATC) AS ETC152_ATC
                 , SUM(ETC153_ATC) AS ETC153_ATC
                 , SUM(INDV071_FEE) AS INDV071_FEE
                 , SUM(INDV072_FEE) AS INDV072_FEE
                 , SUM(INDV073_FEE) AS INDV073_FEE
                 , SUM(INDV074_FEE) AS INDV074_FEE
                 , SUM(INDV075_FEE) AS INDV075_FEE
                 , SUM(INDV076_FEE) AS INDV076_FEE
                 , SUM(INDV077_FEE) AS INDV077_FEE
                 , SUM(INDV078_FEE) AS INDV078_FEE
                 , SUM(INDV079_FEE) AS INDV079_FEE
                 , SUM(INDV0710_FEE) AS INDV0710_FEE
                 , SUM(INDV0711_FEE) AS INDV0711_FEE
                 , SUM(INDV0712_FEE) AS INDV0712_FEE
                 , SUM(INDV0713_FEE) AS INDV0713_FEE
                 , SUM(INDV0714_FEE) AS INDV0714_FEE
                 , SUM(INDV0715_FEE) AS INDV0715_FEE
                 , SUM(INDV0716_FEE) AS INDV0716_FEE
                 , SUM(ETC071_ATC) AS ETC071_ATC
                 , SUM(ETC072_ATC) AS ETC072_ATC
                 , SUM(ETC073_ATC) AS ETC073_ATC
                 , SUM(OG1_FEE) AS OG1_FEE
                 , SUM(OG2_FEE) AS OG2_FEE
                 , SUM(OG3_FEE) AS OG3_FEE
                 , SUM(OG4_FEE) AS OG4_FEE
                 , SUM(OG5_FEE) AS OG5_FEE
                 , SUM(OG6_FEE) AS OG6_FEE
                 , SUM(OG7_FEE) AS OG7_FEE
                 , SUM(OG8_FEE) AS OG8_FEE
                 , SUM(P_HOME_CARE) AS P_HOME_CARE
                 , SUM(HOME_CARE) AS HOME_CARE
                 , SUM(P_RSTL) AS P_RSTL
                 , SUM(RSTL) AS RSTL
                 , SUM(P_LIVE_PAKG) AS P_LIVE_PAKG
                 , SUM(LIVE_PAKG) AS LIVE_PAKG
              FROM
                ( SELECT PRTNR_NO
                       , CASE WHEN FEE_CD = 'W020001' THEN FEE_ATC_VAL ELSE 0 END AS INDV151_FEE
                       , CASE WHEN FEE_CD = 'W020003' THEN FEE_ATC_VAL ELSE 0 END AS INDV152_FEE
                       , CASE WHEN FEE_CD = 'W020115' THEN FEE_ATC_VAL ELSE 0 END AS INDV153_FEE
                       , CASE WHEN FEE_CD = 'W020117' THEN FEE_ATC_VAL ELSE 0 END AS INDV154_FEE
                       , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV155_FEE
                       , CASE WHEN FEE_CD = 'W020081' THEN FEE_ATC_VAL ELSE 0 END AS INDV156_FEE
                       , CASE WHEN FEE_CD = 'W020005' THEN FEE_ATC_VAL ELSE 0 END AS INDV157_FEE
                       , CASE WHEN FEE_CD = 'W020084' THEN FEE_ATC_VAL ELSE 0 END AS INDV158_FEE
                       , CASE WHEN FEE_CD = 'W020122' THEN FEE_ATC_VAL ELSE 0 END AS INDV159_FEE
                       , CASE WHEN FEE_CD = 'W020085' THEN FEE_ATC_VAL ELSE 0 END AS INDV1510_FEE
                       , CASE WHEN FEE_CD = 'W020027' THEN FEE_ATC_VAL ELSE 0 END AS INDV1511_FEE
                       , CASE WHEN FEE_CD = 'W020096' THEN FEE_ATC_VAL ELSE 0 END AS INDV1512_FEE
                       , CASE WHEN FEE_CD = 'W020086' THEN FEE_ATC_VAL ELSE 0 END AS INDV1513_FEE
                       , CASE WHEN FEE_CD = 'W020098' THEN FEE_ATC_VAL ELSE 0 END AS INDV1514_FEE
                       , CASE WHEN FEE_CD = 'W020014' THEN FEE_ATC_VAL ELSE 0 END AS INDV1515_FEE
                       , CASE WHEN FEE_CD = 'W020124' THEN FEE_ATC_VAL ELSE 0 END AS INDV1516_FEE
                       , CASE WHEN FEE_CD = 'W020090' THEN FEE_ATC_VAL ELSE 0 END AS ETC151_ATC
                       , CASE WHEN FEE_CD = 'W020006' THEN FEE_ATC_VAL ELSE 0 END AS ETC152_ATC
                       , CASE WHEN FEE_CD = 'W020094' THEN FEE_ATC_VAL ELSE 0 END AS ETC153_ATC
                       , CASE WHEN FEE_CD = 'W020002' THEN FEE_ATC_VAL ELSE 0 END AS INDV071_FEE
                       , CASE WHEN FEE_CD = 'W020004' THEN FEE_ATC_VAL ELSE 0 END AS INDV072_FEE
                       , CASE WHEN FEE_CD = 'W020011' THEN FEE_ATC_VAL ELSE 0 END AS INDV073_FEE
                       , 0 AS INDV074_FEE
                       , CASE WHEN FEE_CD IN ('W020116', 'W020077', 'W020076', 'W020075') THEN FEE_ATC_VAL ELSE 0 END AS INDV075_FEE
                       , 0 AS INDV076_FEE
                       , CASE WHEN FEE_CD = 'W020030' THEN FEE_ATC_VAL ELSE 0 END AS INDV077_FEE
                       , CASE WHEN FEE_CD = 'W020087' THEN FEE_ATC_VAL ELSE 0 END AS INDV078_FEE
                       , CASE WHEN FEE_CD = 'W020123' THEN FEE_ATC_VAL ELSE 0 END AS INDV079_FEE
                       , CASE WHEN FEE_CD = 'W020088' THEN FEE_ATC_VAL ELSE 0 END AS INDV0710_FEE
                       , CASE WHEN FEE_CD = 'W020089' THEN FEE_ATC_VAL ELSE 0 END AS INDV0711_FEE
                       , CASE WHEN FEE_CD = 'W020097' THEN FEE_ATC_VAL ELSE 0 END AS INDV0712_FEE
                       , 0 AS INDV0713_FEE
                       , CASE WHEN FEE_CD = 'W020099' THEN FEE_ATC_VAL ELSE 0 END AS INDV0714_FEE
                       , CASE WHEN FEE_CD = 'W020041' THEN FEE_ATC_VAL ELSE 0 END AS INDV0715_FEE
                       , 0 AS INDV0716_FEE
                       , CASE WHEN FEE_CD = 'W020091' THEN FEE_ATC_VAL ELSE 0 END AS ETC071_ATC
                       , CASE WHEN FEE_CD = 'W020033' THEN FEE_ATC_VAL ELSE 0 END AS ETC072_ATC
                       , CASE WHEN FEE_CD = 'W020095' THEN FEE_ATC_VAL ELSE 0 END AS ETC073_ATC
                       , CASE WHEN FEE_CD = 'W020020' THEN FEE_ATC_VAL ELSE 0 END AS OG1_FEE
                       , CASE WHEN FEE_CD = 'W020023' THEN FEE_ATC_VAL ELSE 0 END AS OG2_FEE
                       , CASE WHEN FEE_CD = 'W020017' THEN FEE_ATC_VAL ELSE 0 END AS OG3_FEE
                       , CASE WHEN FEE_CD = 'W020118' THEN FEE_ATC_VAL ELSE 0 END AS OG4_FEE
                       , CASE WHEN FEE_CD = 'W020121' THEN FEE_ATC_VAL ELSE 0 END AS OG5_FEE
                       , CASE WHEN FEE_CD = 'W020015' THEN FEE_ATC_VAL ELSE 0 END AS OG6_FEE
                       , CASE WHEN FEE_CD = 'W020016' THEN FEE_ATC_VAL ELSE 0 END AS OG7_FEE
                       , CASE WHEN FEE_CD = 'W020025' THEN FEE_ATC_VAL ELSE 0 END AS OG8_FEE
                       , CASE WHEN FEE_CD = 'W020078' THEN FEE_ATC_VAL ELSE 0 END AS P_HOME_CARE
                       , CASE WHEN FEE_CD = 'W020079' THEN FEE_ATC_VAL ELSE 0 END AS HOME_CARE
                       , CASE WHEN FEE_CD = 'W020119' THEN FEE_ATC_VAL ELSE 0 END AS P_RSTL
                       , CASE WHEN FEE_CD = 'W020120' THEN FEE_ATC_VAL ELSE 0 END AS RSTL
                       , CASE WHEN FEE_CD = 'W020007' THEN FEE_ATC_VAL ELSE 0 END AS P_LIVE_PAKG
                       , CASE WHEN FEE_CD = 'W020035' THEN FEE_ATC_VAL ELSE 0 END AS LIVE_PAKG
                    FROM TB_FEAM_FEE_DSB_DTL_IZ
                   WHERE DTA_DL_YN = 'N'
                     AND DSB_YM = #{perfYm}
                     AND OG_TP_CD = 'W02'
                     AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                     AND FEE_ATC_DV_CD = '01'
                     AND FEE_CD IN ( 'W020001', 'W020003', 'W020115', 'W020117', 'W020116',
                                     'W020081', 'W020005', 'W020084', 'W020122', 'W020085',
                                     'W020027', 'W020096', 'W020086', 'W020098', 'W020014',
                                     'W020124', 'W020090', 'W020006', 'W020094', 'W020002',
                                     'W020004', 'W020011', 'W020118', 'W020030', 'W020087',
                                     'W020123', 'W020088', 'W020089', 'W020097', 'W020099',
                                     'W020041', 'W020091', 'W020033', 'W020095', 'W020020',
                                     'W020023', 'W020017', 'W020121', 'W020015', 'W020016',
                                     'W020025', 'W020075', 'W020076', 'W020077', 'W020078',
                                     'W020079', 'W020119', 'W020120', 'W020007', 'W020035'
                                   )
                     <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                     AND PRTNR_NO = #{prtnrNo}
                     </if>
                )
            GROUP BY PRTNR_NO
         ) FEE	/* 수수료 */
        ON PRTNR.PRTNR_NO = FEE.PRTNR_NO
      LEFT OUTER JOIN
         ( SELECT PRTNR_NO
                , INTBS_AMT	/* 소득과표금액 */
                , DDCTAM	/* 공제금액 */
                , DSB_OJ_AMT	/* 지급대상금액 */
             FROM TB_FEAM_FEE_DSB_IZ	/* 수수료지급내역 */
            WHERE DTA_DL_YN = 'N'
              AND DSB_YM = #{perfYm}
              AND CO_CD = '2000'
              AND OG_TP_CD = 'W02'
              AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
              AND SPMT_DSB_DV_CD = '01'	/*추가지급구분코드 - 정상지급*/
        ) DSB
       ON PRTNR.PRTNR_NO = DSB.PRTNR_NO
    WHERE PRTNR.DTA_DL_YN = 'N'
      AND PRTNR.BASE_YM = #{perfYm}
      AND PRTNR.OG_TP_CD = 'W02'
      <if test='@MybatisUtils@isEmpty(rsbDvCd)'>
      AND PRTNR.RSB_DV_CD IN ('W0204', 'W0205')
      </if>
      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
      AND PRTNR.PRTNR_NO = #{prtnrNo}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
      AND OG.DGR1_LEVL_OG_ID = #{ogLevl1Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
      AND OG.DGR2_LEVL_OG_ID = #{ogLevl2Id}
      </if>
      <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
      AND OG.DGR3_LEVL_OG_ID = #{ogLevl3Id}
      </if>
    ORDER BY OG_CD, TO_NUMBER(PRTNR_NO)
   )
    </select>

    <select id='selectManagerTotalBeforeFees' resultType="camelMap">
        SELECT BASE_YM	/* 기준년월 */
             , OG_ID	/* 조직ID */
             , DGR1_LEVL_OG_ID /* 총괄단조직ID */
             , DGR2_LEVL_OG_ID /* 지역단조직ID */
             , DGR3_LEVL_OG_ID /* 지점조직ID */
			 , OG_CD	/* 조직코드 */
             , OG_NM   /* 조직명 */
             , PRTNR_NO	/* 파트너번호 */
             , PRTNR_KNM	/* 성명 */
             , RSB_DV_CD	/* 직책구분코드 */
             , CASE WHEN RSB_DV_CD = 'W0205' THEN NVL(INDV_METG_PRSC_DC, 0) ELSE NVL(OG_METG_PRSC_DC, 0) END AS METG_PRSC_DC	/* 미팅참석일수 */
             , CASE WHEN PSTN_DV_CD = '7' THEN CASE WHEN PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    ELSE F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', QLF_DV_CD) END AS QLF_DV_NM
             , CASE WHEN NMN_PSTN_DV_CD = '7' THEN
                    	 CASE WHEN NMN_PRTNR_GD_CD = '12' THEN '플래너지점장' ELSE '매니저지점장' END
                    WHEN NMN_PSTN_DV_CD = '15' THEN F_CMZ_CD_NM('TNT_WELLS', 'QLF_DV_CD', NMN_QLF_DV_CD)
                    WHEN NMN_PSTN_DV_CD = '4'  THEN '지역단장'
                    WHEN NMN_PSTN_DV_CD = '2'  THEN '총괄단장'
                    ELSE '해약' END AS NMN_QLF_DV_NM /*  수수료실적년월+1개월의 직책    */
             , STRTUP	/* 교육-스타트업 */
             , PLAR_STRTUP	/* 스타트업-플래너*/
             , EDU_CMPF_YN	/* 보수교육 */
             , TOPMR_SETTLE	/* 수석플래너-정착 */
             , TOPMR_NMN /* 수석플래너-차월 */
             , TOPMR_PRTIC  /* 수석플래너-실전 */
             , EDU_BRMGR_ONL	/* 지점장교육(135)수료여부 */
             , OJT	/* OJT일수 */
             , CASE WHEN BIZ_RGST IS NULL THEN FST_BIZ_RGST ELSE BIZ_RGST END AS BIZ_RGST	/* 등록기준월 */
             , FST_BIZ_RGST	/* 최초업무등록월 */
             , BIZ_RGST AS RE_BIZ_RGST	/* 재등록월 */
             , BIZ_FNL_CLTN	/* 최종해약월 */
             , BIZ_CLTN	/* 업무해약월 */
             , PRFMT_MM	/* 승진월-지점장은 승진월, 플래너는 강등월*/
             , PLAR_RGST_MM /* 수석플래너 등록월 */
             , PLAR_CLTN_MM /* 수석플래너 해약월 */
             , WM_RESTRT_DT    /* WM - 재개시월*/
             , WM_CLTN_DT  /* WM - 해약월 */
             , ACL_ACTI_ACHV	/* 실활동인원 - 실활동달성 */
   	      	 , ACL_ACTI_MIN_BASE_ACHV	/* 실활동인원 - 최소기준조건달성여부 */
			 , LSTMM_CPR_DV	/* 실활동인원 - 전월대비구분 */
     		 , SPCNT	/* 실활동인원 - SP */
     		 , WPCNT	/* 실활동인원 - WP */
     		 , WMCNT	/* 실활동인원 - WM */
             , TOT_PPL     /* 실활동인원-총인원 */
             , INDV_RENTAL	/*인정실적 렌탈*/
			 , INDV_SPAY	/*인정실적 일시불*/
			 , INDV_ENVR_ELHM_EXCP	/*인정실적 환경가전외*/
			 , INDV_ELHM_NTOR	/*가전순주문건수*/
			 , INDV_ELHM_ACKMT	/*개인가전인정건수*/
			 , INDV_BS_ACKMT	/*개인BS인정건수*/
			 , INDV_ELHM_CHDVC_CNT	/*가전기변건수*/
			 , INDV_ELHM_CHDVC_AMT	/*가전기변금액*/
			 , INDV_ENVR_ELHM_RENTAL	/*환경가전 렌탈*/
			 , INDV_ENVR_ELHM_SPAY	/*환경가전 일시불*/
			 , INDV_ENVR_ELHM_FXAM	/*환경가전 정액*/
			 , INDV_ENVR_ELHM_EXCP_SPAY	/*환경가전외 일시불*/
			 , INDV_ENVR_ELHM_EXCP_FXAM	/*환경가전외 정액*/
			 , INDV_LIVE_PAKG_CNT	/*라이브팩건수*/
			 , INDV_NW_SELL_CNT	/*개인신규판매건수*/
			 , INDV_HCR_SELL_CNT	/*홈케어판매가*/
			 , INDV_BS_FSH_CT	/*BS완료계정*/
             /*****************************/
			 --삭제검토
			 --, INDV_ASN_CNT	/*개인BS배정건수*/
             --, INDV_FSH_CNT	/*개인BS완료건수*/
			 /*****************************/
			 , OG_ELHM_ACKMT	 /*조직가전인정건수*/
			 , OG_NW_SELL_CNT	 /*조직신규판매건수*/
			 , OG_ENVR_ELHM_RENTAL /*조직 환경가전 렌탈*/
			 , OG_ENVR_ELHM_SPAY /*조직 환경가전 일시불*/
			 , OG_ENVR_ELHM_EXCP_SPAY /*조직 환경가전외 일시불*/
			 , FEE_HCR  /*홈케어*/
			 , FEE_LIVE_PAKG  /*라이브팩*/
			 , FEE_ELHM_PRPN_BASE - (TRUNC(INDV_ENVR_ELHM_RENTAL * SIGN(PER),-1) + TRUNC(INDV_ENVR_ELHM_SPAY * PER,-1)) AS FEE_ELHM_PRPN  /*가전비례*/
			 , FEE_ELHM_EXCP_PRPN_BASE - TRUNC(INDV_ENVR_ELHM_EXCP_SPAY * PER,-1) AS FEE_ELHM_EXCP_PRPN  /*가전외비례*/
			 , FEE_SELL_ENCRG  /*판매장려*/
			 , FEE_EDU  /*교육*/
			 , FEE_SETTLE  /*정착*/
			 , FEE_MCHN_CH  /*기기변경*/
			 , FEE_BS_MNGT  /*BS관리*/
			 , FEE_RGLVL  /*급지*/
			 , FEE_SELL_ENCRG_RETT  /*판매장려소급*/
			 , FEE_ELHM_OG_PRPN  /*가전조직비례*/
			 , FEE_ELHM_OG_EXCP_PRPN  /*가전조직외비례*/
			 , FEE_OG_SELL_ENCRG  /*조직판매장려*/
			 , FEE_NW_SELL  /*신규판매*/
			 , FEE_OG_MNGT  /*조직관리*/
			 , FEE_SPMT_ENCRG  /*추가장려*/
			 , FEE_OG_EJT1  /*조직배출1*/
			 , FEE_OG_EJT2  /*조직배출2*/
			 , FEE_NB_BRCH  /*신설지점*/
			 , FEE_MSH  /*멤버십*/
			 , FEE_ADSB  /*재지급*/
			 , FEE_ETC_SPPT  /*기타지원*/
			 , FEE_WM_TELC  /*WM통신*/
			 , FEE_WM_ETC  /*WM기타*/
			 , FEE_PRR_VST  /*사전방문*/
			 , FEE_UNIFORM  /*유니폼*/
			 , FEE_MAT_GRMG  /*자재실장*/
             , NVL(CASE WHEN FEE_ELHM_PRPN_BASE = 0 THEN 0 ELSE TRUNC(INDV_ENVR_ELHM_RENTAL * SIGN(PER), -1) END, 0) AS ELHM_METG   /* 가전미팅(환경가전 렌탈 기준금액 1개월) */
             , NVL(CASE WHEN FEE_ELHM_PRPN_BASE = 0 THEN 0 ELSE TRUNC(INDV_ENVR_ELHM_SPAY * PER, -1) END, 0) AS SPAY_METG   /* 일시불미팅(환경가전 일시불 기준금액 * 미팅수수료율) */
             , NVL(CASE WHEN FEE_ELHM_PRPN_BASE = 0 THEN 0 ELSE TRUNC(INDV_ENVR_ELHM_EXCP_SPAY * PER, -1) END, 0) AS ELHM_EXCP_METG	/* 가전외미팅 */
             , INTBS_AMT	/* 소득과표금액 */
             , DDCTAM	/* 공제금액 */
             , DSB_OJ_AMT	/* 지급대상금액 */
          FROM
             ( SELECT PRTNR.BASE_YM	/* 기준년월 */
                    , PRTNR.OG_CD	/* 조직코드 */
                    , PRTNR.OG_NM   /* 조직명 */
                    , PRTNR.PRTNR_NO	/* 파트너번호 */
                    , PRTNR.PRTNR_KNM	/* 성명 */
                    , PRTNR.RSB_DV_CD	/* 직책구분코드 */
                    , PRTNR.QLF_DV_CD	/* 수수료월자격구분코드 */
                    , PRTNR.PSTN_DV_CD  /* 수수료월직급구분코드 */
                    , PRTNR.PRTNR_GD_CD     /* 수수료월파트너등급코드 */
                    , NMNQLF.PSTN_DV_CD AS NMN_PSTN_DV_CD	/* 차월직급구분코드 */
                    , NMNQLF.QLF_DV_CD AS NMN_QLF_DV_CD	/* M+1 자격구분코드 */
                    , NMNQLF.PRTNR_GD_CD AS NMN_PRTNR_GD_CD	/* M+1 등급구분코드 */
                    , OG.OG_ID	/* 조직ID */
                    , OG.DGR1_LEVL_OG_ID /* 총괄단조직ID */
                    , OG.DGR2_LEVL_OG_ID /* 지역단조직ID */
                    , OG.DGR3_LEVL_OG_ID /* 지점조직ID */
                    , SUBSTR(PRTNR.FST_CNTR_DT, 1, 6) AS FST_BIZ_RGST	/* 업무등록-최초업무등록월 */
                    , SUBSTR(PRTNR.RCNTR_DT, 1, 6) AS BIZ_RGST	/* 업무등록-재등록월 */
                    , SUBSTR(PRTNR.FNL_CLTN_DT, 1, 6) AS BIZ_FNL_CLTN	/* 업무등록-최종해약월 */
                    , SUBSTR(PRTNR.CLTN_DT, 1, 6) AS BIZ_CLTN	/* 업무등록-업무해약월 */
                    , CASE WHEN PRTNR.RSB_DV_CD = 'W0204' THEN SUBSTR(PRTNR.PRFMT_DT, 1, 6)
    	                   ELSE SUBSTR(PRTNR.DMTN_DT, 1, 6) END AS PRFMT_MM	/* 승진월-지점장은 승진월 플래너는 강등월 */
                    , NVL(INDVMT.METG_PRSC_DC, 0) AS INDV_METG_PRSC_DC	/* 미팅참석일수 */
                    , NVL(OGMT.PERF_VAL, 0) AS OG_METG_PRSC_DC	/* 미팅참석일수 */
                    , EDU.EDU11_YM AS PLAR_STRTUP 	/* 스타트업-플래너*/
                    , EDU.EDU96_YM AS STRTUP	/* 스타트업 */
                    , CASE WHEN EDU.EDU129_YM IS NOT NULL THEN 'Y' ELSE 'N' END AS EDU_CMPF_YN	/* 보수교육 */
                    , EDU.EDU100_YM AS TOPMR_SETTLE	/* 수석플래너-정착 */
                    , CASE WHEN EDU.EDU17_YM IS NULL THEN 'N' ELSE 'Y' END AS TOPMR_PRTIC  /* 수석플래너-실전 */
                    , CASE WHEN PLAR.PLAR_RGST_MM IS NOT NULL THEN CEIL(MONTHS_BETWEEN(TO_DATE(PRTNR.BASE_YM||'01', 'YYYYMMDD'), TO_DATE(PLAR.PLAR_RGST_MM, 'YYYYMMDD')))+1
                           ELSE 0 END AS TOPMR_NMN /*수석플래너-차월*/
                    , NVL(OJT.OJT_CNT, 0) AS OJT 	/* OJT일수 */
             		, CASE WHEN MNGER.RESTRT_DT IS NULL THEN SUBSTR(MNGER.FST_CNTR_DT, 1, 6) ELSE SUBSTR(MNGER.RESTRT_DT, 1, 6) END AS WM_RESTRT_DT    /* WM - 재개시월*/
             		, SUBSTR(MNGER.CLTN_DT, 1, 6) AS WM_CLTN_DT  /* WM - 최종해약월 */
                    , EDU.EDU135_YM AS EDU_BRMGR_ONL	/* 지점장교육(135)수료여부 */
                    , SUBSTR(PLAR.PLAR_RGST_MM, 1, 6) AS PLAR_RGST_MM /* 수석플래너 등록월 */
                    , SUBSTR(PLAR.PLAR_CLTN_MM, 1, 6) AS PLAR_CLTN_MM /* 수석플래너 해약월 */
                    , NVL(PAST_ACTI.ACTI_YN, 'N') AS ACL_ACTI_ACHV	/* 실활동인원 - 실활동달성 */
             		, NVL(PAST.CNDT_ACHV_YN, 'N') AS ACL_ACTI_MIN_BASE_ACHV	/* 실활동인원 - 최소기준조건달성여부 */
   	      	     	, CASE WHEN NVL(PAST.NINC_CT, 99) = 0 THEN '유지'
   	      	     		   WHEN NVL(PAST.NINC_CT, 99) = 1 THEN '순감'
   	      	     		   WHEN NVL(PAST.NINC_CT, 99) = 2 THEN '순증'
   	      	     		   ELSE ' ' END AS LSTMM_CPR_DV	/* 실활동인원 - 전월대비구분 */
             		, NVL(ACTI.TOT_PPL, 0) AS TOT_PPL	/* 실활동인원 - 총인원 */
             		, NVL(ACTI.SPCNT, 0) AS SPCNT	/* 실활동인원 - SP */
             		, NVL(ACTI.WPCNT, 0) AS WPCNT	/* 실활동인원 - WP */
             		, NVL(ACTI.WMCNT, 0) AS WMCNT	/* 실활동인원 - WM */
                    , NVL(INDVBS.INDV_ASN_CNT, 0) AS INDV_ASN_CNT	/*개인BS배정건수*/
                    , NVL(INDVBS.INDV_FSH_CNT, 0) AS INDV_FSH_CNT	/*개인BS완료건수*/
                    , NVL(INDVPERF.RENTAL, 0) AS INDV_RENTAL	/*인정실적 렌탈*/
				    , NVL(INDVPERF.SPAY, 0) AS INDV_SPAY	/*인정실적 일시불*/
				    , NVL(INDVPERF.ENVR_ELHM_EXCP, 0) AS INDV_ENVR_ELHM_EXCP	/*인정실적 환경가전외*/
				    , NVL(INDVPERF.ELHM_NTOR, 0) AS INDV_ELHM_NTOR	/*가전순주문건수*/
				    , NVL(INDVPERF.ELHM_ACKMT, 0) AS INDV_ELHM_ACKMT	/*개인가전인정건수*/
				    , NVL(INDVPERF.BS_ACKMT, 0) AS INDV_BS_ACKMT	/*개인BS인정건수*/
				    , NVL(INDVPERF.ELHM_CHDVC_CNT, 0) AS INDV_ELHM_CHDVC_CNT	/*가전기변건수*/
				    , NVL(INDVPERF.ELHM_CHDVC_AMT, 0) AS INDV_ELHM_CHDVC_AMT	/*가전기변금액*/
				    , NVL(INDVPERF.ENVR_ELHM_RENTAL, 0) AS INDV_ENVR_ELHM_RENTAL	/*환경가전 렌탈*/
				    , NVL(INDVPERF.ENVR_ELHM_SPAY, 0) AS INDV_ENVR_ELHM_SPAY	/*환경가전 일시불*/
				    , NVL(INDVPERF.ENVR_ELHM_FXAM, 0) AS INDV_ENVR_ELHM_FXAM	/*환경가전 정액*/
				    , NVL(INDVPERF.ENVR_ELHM_EXCP_SPAY, 0) AS INDV_ENVR_ELHM_EXCP_SPAY	/*환경가전외 일시불*/
				    , NVL(INDVPERF.ENVR_ELHM_EXCP_FXAM, 0) AS INDV_ENVR_ELHM_EXCP_FXAM	/*환경가전외 정액*/
				    , NVL(INDVPERF.LIVE_PAKG_CNT, 0) AS INDV_LIVE_PAKG_CNT	/*라이브팩건수*/
				    , NVL(INDVPERF.INDV_NW_SELL_CNT, 0) AS INDV_NW_SELL_CNT	/*개인신규판매건수*/
				    , NVL(INDVPERF.HCR_SELL_CNT, 0) AS INDV_HCR_SELL_CNT	/*홈케어판매가*/
				    , NVL(INDVPERF.BS_FSH_CT, 0) AS INDV_BS_FSH_CT	/*BS완료계정*/
				    , NVL(OGPERF.OG_ELHM_ACKMT, 0) AS OG_ELHM_ACKMT	 /*조직가전인정건수*/
					, NVL(OGPERF.OG_NW_SELL_CNT, 0) AS OG_NW_SELL_CNT	 /*조직신규판매건수*/
					, NVL(OGPERF.OG_ENVR_ELHM_RENTAL, 0) AS OG_ENVR_ELHM_RENTAL /*조직 환경가전 렌탈*/
					, NVL(OGPERF.OG_ENVR_ELHM_SPAY, 0) AS OG_ENVR_ELHM_SPAY /*조직 환경가전 일시불*/
					, NVL(OGPERF.OG_ENVR_ELHM_EXCP_SPAY, 0) AS OG_ENVR_ELHM_EXCP_SPAY  /*조직 환경가전외 일시불*/
					, NVL(FEE.FEE_HCR, 0) AS FEE_HCR  /*홈케어*/
					, NVL(FEE.FEE_LIVE_PAKG, 0) AS FEE_LIVE_PAKG  /*라이브팩*/
					, NVL(FEE.FEE_ELHM_PRPN, 0) AS FEE_ELHM_PRPN_BASE  /*가전비례*/
					, NVL(FEE.FEE_ELHM_EXCP_PRPN, 0) AS FEE_ELHM_EXCP_PRPN_BASE  /*가전외비례*/
					, NVL(FEE.FEE_SELL_ENCRG, 0) AS FEE_SELL_ENCRG  /*판매장려*/
					, NVL(FEE.FEE_EDU, 0) AS FEE_EDU  /*교육*/
					, NVL(FEE.FEE_SETTLE, 0) AS FEE_SETTLE  /*정착*/
					, NVL(FEE.FEE_MCHN_CH, 0) AS FEE_MCHN_CH  /*기기변경*/
					, NVL(FEE.FEE_BS_MNGT, 0) AS FEE_BS_MNGT  /*BS관리*/
					, NVL(FEE.FEE_RGLVL, 0) AS FEE_RGLVL  /*급지*/
					, NVL(FEE.FEE_SELL_ENCRG_RETT, 0) AS FEE_SELL_ENCRG_RETT  /*판매장려소급*/
					, NVL(FEE.FEE_ELHM_OG_PRPN, 0) AS FEE_ELHM_OG_PRPN  /*가전조직비례*/
					, NVL(FEE.FEE_ELHM_OG_EXCP_PRPN, 0) AS FEE_ELHM_OG_EXCP_PRPN  /*가전조직외비례*/
					, NVL(FEE.FEE_OG_SELL_ENCRG, 0) AS FEE_OG_SELL_ENCRG  /*조직판매장려*/
					, NVL(FEE.FEE_NW_SELL, 0) AS FEE_NW_SELL  /*신규판매*/
					, NVL(FEE.FEE_OG_MNGT, 0) AS FEE_OG_MNGT  /*조직관리*/
					, NVL(FEE.FEE_SPMT_ENCRG, 0) AS FEE_SPMT_ENCRG  /*추가장려*/
					, NVL(FEE.FEE_OG_EJT1, 0) AS FEE_OG_EJT1  /*조직배출1*/
					, NVL(FEE.FEE_OG_EJT2, 0) AS FEE_OG_EJT2  /*조직배출2*/
					, NVL(FEE.FEE_NB_BRCH, 0) AS FEE_NB_BRCH  /*신설지점*/
					, NVL(FEE.FEE_MSH , 0) AS FEE_MSH	/*멤버십*/
					, NVL(FEE.FEE_ADSB, 0) AS FEE_ADSB  /*재지급*/
					, NVL(FEE.FEE_ETC_SPPT, 0) AS FEE_ETC_SPPT  /*기타지원*/
					, NVL(FEE.FEE_WM_TELC, 0) AS FEE_WM_TELC  /*WM통신*/
					, NVL(FEE.FEE_WM_ETC, 0) AS FEE_WM_ETC  /*WM기타*/
					, NVL(FEE.FEE_PRR_VST, 0) AS FEE_PRR_VST  /*사전방문*/
					, NVL(FEE.FEE_UNIFORM , 0) AS FEE_UNIFORM /*유니폼*/
					, NVL(FEE.FEE_MAT_GRMG , 0) AS FEE_MAT_GRMG /*자재실장*/
                    , CASE WHEN PRTNR.PSTN_DV_CD = '7' THEN 0.05	/* 7직급, 지점장님은 무조건 0.05 */
				           WHEN PRTNR.PSTN_DV_CD != '7' AND INDVMT.METG_CPC_YN = 'Y' THEN 0.05	/* 15직급은 미팅 수료하면 0.05 */
				           ELSE 0 END PER	/* 미팅수수료율 */
                    , NVL(DSB.INTBS_AMT, 0) AS INTBS_AMT	/* 소득과표금액 */
                    , NVL(DSB.DDCTAM, 0) AS DDCTAM	/* 공제금액 */
                    , NVL(DSB.DSB_OJ_AMT, 0) AS DSB_OJ_AMT	/* 지급대상금액 */
                 FROM TB_OGBS_MM_PRTNR_IZ PRTNR	/* 월파트너내역*/
                INNER JOIN TB_OGBS_MM_OG_IZ OG	/* 월조직내역 */
                   ON PRTNR.BASE_YM = OG.BASE_YM
                  AND PRTNR.OG_ID = OG.OG_ID
                  AND OG.DTA_DL_YN = 'N'
                 LEFT OUTER JOIN
                    ( SELECT PRTNR_NO
                    	   , MAX(PERF_VAL) AS METG_PRSC_DC	/* 미팅참석일수 */
                    	   , CASE WHEN MAX(PERF_VAL) <![CDATA[>=]]> 15 THEN 'Y' ELSE 'N' END AS METG_CPC_YN	/* 미팅수료여부 */
                 		FROM TB_FEAM_PRTNR_PERF_MM_CL	/* 파트너실적월마감 */
                 	   WHERE BASE_YM = #{perfYm}
                 	     AND PERF_YM = #{perfYm}
                 	     AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                 	     AND CO_CD = '2000'
                 	     AND OG_TP_CD = 'W02'
                 	     AND PERF_ATC_CD = 'W02P00093'    /* 미팅참석일수 */
                 	   GROUP BY PRTNR_NO
                 	) INDVMT	/* 미팅 */
                   ON PRTNR.PRTNR_NO = INDVMT.PRTNR_NO
                 LEFT OUTER JOIN
                 	( SELECT AGRG_YM
                 		   , OG_TP_CD
                 		   , PRTNR_NO
                 		   , METG_PRSC_DC AS PERF_VAL
                 	    FROM TB_PSCA_MCPTN_METG_AGRG
                 	   WHERE DTA_DL_YN = 'N'
                 	     AND AGRG_YM = #{perfYm}
                 	     AND OG_TP_CD = 'W02'
                 	) OGMT
                   ON PRTNR.BASE_YM = OGMT.AGRG_YM
                  AND PRTNR.OG_TP_CD = OGMT.OG_TP_CD
                  AND PRTNR.PRTNR_NO = OGMT.PRTNR_NO
                 LEFT OUTER JOIN
                    ( SELECT MAX(CASE WHEN QLF_DV_CD = '1' AND QLF_APLC_DV_CD = '1' THEN STRTDT END) AS PLAR_CLTN_MM /* 수석플래너 해약월 */
                    	   , MAX(CASE WHEN QLF_DV_CD = '1' AND QLF_APLC_DV_CD = '2' THEN STRTDT END) AS PLAR_RGST_MM /* 수석플래너 등록월 */
                           , PRTNR_NO
                        FROM TB_OGPS_PLAR_QLF_CH_IZ     /* 플래너자격변경내역 */
                       WHERE DTA_DL_YN = 'N'
                         AND OG_TP_CD = 'W02'
                         AND QLF_DV_CD IN ('1','3')  /* 수석플래너, 웰스매니저 */
                         AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제(과거)  3:보류 제외 */
                         <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                         AND PRTNR_NO = #{prtnrNo}
                         </if>
                       GROUP BY PRTNR_NO
                   ) PLAR
                  ON PRTNR.PRTNR_NO = PLAR.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT A.PRTNR_NO
                   		  , A.PSTN_DV_CD
                   	      , QLF.QLF_DV_CD
                          , A.PRTNR_GD_CD
                       FROM TB_OGBS_MM_PRTNR_IZ A
                       LEFT OUTER JOIN TB_OGPS_PLAR_QLF_CH_IZ QLF  /* 웰스매니저 자격정보 M+1 자격 */
                       ON A.OG_TP_CD = QLF.OG_TP_CD
                        AND A.PRTNR_NO = QLF.PRTNR_NO
                        AND NVL(QLF.QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제  3: 보류 제외*/
                 		AND TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'),1)),'YYYYMMDD') BETWEEN STRTDT AND ENDDT
                 		AND QLF.DTA_DL_YN = 'N'
                      WHERE A.OG_TP_CD = 'W02'
                        AND A.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM')
                  ) NMNQLF
                 ON PRTNR.PRTNR_NO = NMNQLF.PRTNR_NO
                LEFT OUTER JOIN
                   ( SELECT OG_TP_CD
                          , PRTNR_NO
                          , MAX(CASE WHEN TO_CHAR(SYSDATE,'YYYYMM') BETWEEN STRTDT AND ENDDT THEN STRTDT ELSE '' END) AS CUR_CTNR_DT /* 활동여부 확인용 현계약일 */
                          , MAX(CASE WHEN TO_CHAR(LAST_DAY(TO_DATE(#{perfYm},'YYYYMM')),'YYYYMMDD') BETWEEN STRTDT AND ENDDT THEN STRTDT ELSE '' END)  AS CNTR_DT /* 계약일 */
                          , MAX(CASE WHEN ENDDT = '99991231' THEN '' ELSE ENDDT END) AS CLTN_DT   /* 해약일 */
                          , MIN(STRTDT) AS FST_CNTR_DT  /* 최초계약일 */
                          , MAX(END_PREV_DT) AS FNL_CLTN_DT  /* 최종해약일 */
                          , MAX(NVL2(STRT_PREV_DT,STRTDT,'')) AS RESTRT_DT    /* 재등록개시일 */
                          , MAX(DSB_AMT) AS DSB_AMT      /* 통신비지급액 */
                          , MAX(SUBSTR(CV_DT,1,6)) AS CV_DT        /* WM전환월 */
                       FROM
                          ( SELECT OG_TP_CD
                                 , PRTNR_NO
                                 , STRTDT
                                 , ENDDT
                                 , CV_DT
                                 , DSB_AMT
                                 , LAG(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT)  AS STRT_PREV_DT
                                 , LEAD(STRTDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, STRTDT) AS STRT_NEXT_DT
                                 , LAG(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT)  AS END_PREV_DT
                                 , LEAD(ENDDT) OVER(PARTITION BY PRTNR_NO ORDER BY PRTNR_NO, ENDDT) AS END_NEXT_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ   /* 플래너자격변경내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND OG_TP_CD  = 'W02'
                               AND QLF_DV_CD = 3
                               AND NVL(QLF_APLC_DV_CD, '0') IN ('1', '2')  -- 승격,자격해제  3 : 보류 제외
                               <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                               </if>
                          ) A
                      WHERE 1=1
                      GROUP BY OG_TP_CD, PRTNR_NO
                  ) MNGER
                 ON PRTNR.OG_TP_CD = MNGER.OG_TP_CD
                AND PRTNR.PRTNR_NO = MNGER.PRTNR_NO
               LEFT OUTER JOIN
                  ( SELECT OG_TP_CD
                         , PRTNR_NO
                         , EDU96_YM
                         , EDU17_YM
                         , EDU11_YM
                         , EDU129_YM
                         , EDU135_YM
                         , CASE WHEN NVL(EDU106_YM, 0)  <![CDATA[>]]>  NVL(EDU100_YM, 0) THEN EDU106_YM
                           ELSE EDU100_YM END AS EDU100_YM
                      FROM
                         ( SELECT OG_TP_CD
                                , PRTNR_NO
                                , EDUC_CRSE_NO
                                , EDUC_CRSE_CRT_BASE_YM
                             FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                            WHERE DTA_DL_YN = 'N'
                              AND EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                              AND OG_TP_CD = 'W02'
                              AND EDUC_CRSE_NO IN ('96', '143', '17', '11', '129', '106', '135', '100')
                              AND EDUC_CPC_ACKMT_YN = 'Y'
                         ) A
                     PIVOT ( MAX(EDUC_CRSE_CRT_BASE_YM) FOR EDUC_CRSE_NO IN (
                                '96' AS EDU96_YM
                                ,'143' AS EDU143_YM
                                , '17' AS EDU17_YM
                                , '11' AS EDU11_YM
                                , '129' AS EDU129_YM
                                , '106' AS EDU106_YM
                                , '135' AS EDU135_YM
                                , '100' AS EDU100_YM
                     ))
                  ) EDU
                 ON PRTNR.OG_TP_CD = EDU.OG_TP_CD
                AND PRTNR.PRTNR_NO = EDU.PRTNR_NO
               LEFT OUTER JOIN
           	      ( SELECT OG_TP_CD
           	  		     , PRTNR_NO
           	  		     , EDUC_PRSC_DC AS OJT_CNT	/* OJT일수 */
                      FROM TB_PSCA_MCPTN_EDUC_IZ A	/* 월별파트너교육내역 */
                     WHERE DTA_DL_YN = 'N'
                       AND EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                       AND OG_TP_CD = 'W02'
                       AND EDUC_CRSE_NO = '98'
                       AND EDUC_CPC_ACKMT_YN = 'Y'
           	      ) OJT
                 ON PRTNR.OG_TP_CD = OJT.OG_TP_CD
                AND PRTNR.PRTNR_NO = OJT.PRTNR_NO
              LEFT OUTER JOIN
                 ( SELECT PRTNR_NO
                        , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD = 'SV01999901' THEN PERF_VAL ELSE 0 END ) AS INDV_ASN_CNT	/* 개인BS-배정건수 */
                        , SUM(CASE WHEN PRTNR_SV_PERF_ATC_CD IN ('SV01999902', 'SV01999903') THEN PERF_VAL ELSE 0 END ) AS INDV_FSH_CNT	/* 개인BS-완료건수 */
                     FROM TB_FEAM_WPTN_SV_PERF_AGRG T1	/* 웰스파트너서비스실적집계 */
                    WHERE DTA_DL_YN = 'N'
                      AND BASE_YM = #{perfYm}
                      AND CL_DV_CD = #{feeTcntDvCd}
                      AND OG_TP_CD = 'W02'
                      AND PRTNR_SV_PERF_ATC_CD IN ('SV01999901', 'SV01999902', 'SV01999903')	/* 배정건수, 당월완료건수, 전월완료건수 */
                    GROUP BY PRTNR_NO
                 ) INDVBS
                ON PRTNR.PRTNR_NO = INDVBS.PRTNR_NO
             LEFT OUTER JOIN
                ( SELECT PRTNR_NO
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00033' THEN PERF_VAL ELSE 0 END) AS RENTAL	/*인정실적 렌탈*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00034' THEN PERF_VAL ELSE 0 END) AS SPAY	/*인정실적 일시불*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W02P00027' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_EXCP	/*인정실적 환경가전외*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00036' THEN PERF_VAL ELSE 0 END) AS ELHM_NTOR	/*가전순주문건수*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL ELSE 0 END) AS ELHM_ACKMT	/*개인가전인정건수*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00011' THEN PERF_VAL ELSE 0 END) AS BS_ACKMT	/*개인BS인정건수*/
                       , SUM(CASE WHEN PERF_ATC_CD IN ('W00P00014', 'W00P00018') THEN PERF_VAL ELSE 0 END) AS ELHM_CHDVC_CNT	/*가전기변건수*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00008' THEN PERF_VAL ELSE 0 END) AS ELHM_CHDVC_AMT	/*가전기변금액*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_RENTAL	/*환경가전 렌탈*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_SPAY	/*환경가전 일시불*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00005' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_FXAM	/*환경가전 정액*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00006' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_EXCP_SPAY	/*환경가전외 일시불*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00007' THEN PERF_VAL ELSE 0 END) AS ENVR_ELHM_EXCP_FXAM	/*환경가전외 정액*/
                       , SUM(CASE WHEN PERF_ATC_CD IN ('W02P00105', 'W00P00009') THEN PERF_VAL ELSE 0 END) AS LIVE_PAKG_CNT	/*라이브팩건수*/
                       , SUM(CASE WHEN PERF_ATC_CD IN ('W00P00010', 'W02P00106') THEN PERF_VAL ELSE 0 END) AS INDV_NW_SELL_CNT	/*개인신규판매건수*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W00P00035' THEN PERF_VAL ELSE 0 END) AS HCR_SELL_CNT	/*홈케어판매가*/
                       , SUM(CASE WHEN PERF_ATC_CD = 'W02P00085' THEN PERF_VAL ELSE 0 END) AS BS_FSH_CT	/*BS완료계정*/
                    FROM TB_FEAM_NTORP_PERF_MM_CL	/* 순주문실적월마감 */
                   WHERE DTA_DL_YN = 'N'
                     AND BASE_YM = #{perfYm}
                     AND PERF_YM = #{perfYm}
                     AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                     AND PERF_AGRG_CRT_DV_CD = '201'
                     AND PERF_DV_CD = '0'	/* 실적구분코드 0-개인 */
                     AND OG_TP_CD = 'W02'
                     AND PERF_ATC_CD IN ( 'W00P00033', 'W00P00034', 'W02P00027', 'W02P00102', 'W02P00002',
                                          'W00P00011', 'W00P00014', 'W00P00008', 'W00P00003', 'W00P00004',
                                          'W00P00005', 'W00P00006', 'W00P00007', 'W02P00105', 'W00P00010',
                                          'W00P00035', 'W02P00085', 'W00P00009', 'W02P00106', 'W00P00036', 'W00P00018' )
                   GROUP BY PRTNR_NO
               ) INDVPERF
              ON PRTNR.PRTNR_NO = INDVPERF.PRTNR_NO
            LEFT OUTER JOIN
               ( SELECT PRTNR_NO
                      , SUM(CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL ELSE 0 END) AS OG_ELHM_ACKMT	 /*조직가전인정건수*/
                      , SUM(CASE WHEN PERF_ATC_CD = 'W00P00010' THEN PERF_VAL ELSE 0 END) AS OG_NW_SELL_CNT	 /*조직신규판매건수*/
                      , SUM(CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL ELSE 0 END) AS OG_ENVR_ELHM_RENTAL /*조직 환경가전 렌탈*/
                      , SUM(CASE WHEN PERF_ATC_CD = 'W00P00004' THEN PERF_VAL ELSE 0 END) AS OG_ENVR_ELHM_SPAY /*조직 환경가전 일시불*/
                      , SUM(CASE WHEN PERF_ATC_CD = 'W00P00006' THEN PERF_VAL ELSE 0 END) AS OG_ENVR_ELHM_EXCP_SPAY /*조직 환경가전외 일시불*/
                   FROM TB_FEAM_NTORP_PERF_MM_CL   /*순주문 파트너 실적 월마감*/
                  WHERE DTA_DL_YN = 'N'
                    AND BASE_YM = #{perfYm}
                    AND PERF_YM = #{perfYm}
                    AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                    AND PERF_AGRG_CRT_DV_CD = '202'
                    AND PERF_DV_CD = '2'   /*지점판매*/
                    AND OG_TP_CD = 'W02'  /*웰스 M조직*/
                    AND PERF_ATC_CD IN ( 'W02P00002', 'W00P00010', 'W00P00003', 'W00P00004', 'W00P00006')
                  GROUP BY PRTNR_NO
               ) OGPERF
              ON PRTNR.PRTNR_NO = OGPERF.PRTNR_NO
            LEFT OUTER JOIN
               ( SELECT PRTNR_NO
                     , NVL(SUM(TOT_PPL), 0) AS TOT_PPL
                     , NVL(SUM(SPCNT), 0) AS SPCNT
                     , NVL(SUM(WMCNT), 0) AS WMCNT
                     , NVL(SUM(WPCNT), 0) AS WPCNT
                  FROM
                     ( SELECT PRTNR_NO
                            , CASE WHEN PERF_ATC_CD = 'W02P00111' THEN PERF_VAL ELSE 0 END AS TOT_PPL
                            , 0 AS SPCNT
                            , 0 AS WMCNT
                            , 0 AS WPCNT
                         FROM TB_FEAM_PRTNR_PERF_MM_CL	/* 파트너실적월마감 */
                        WHERE DTA_DL_YN = 'N'
                          AND BASE_YM = #{perfYm}
                          AND PERF_YM = #{perfYm}
                          AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                          AND PERF_ATC_CD = 'W02P00111'	/* 지점실활동인원수 */
                          AND CO_CD = '2000'
                          AND OG_TP_CD = 'W02'  /*웰스 M조직*/
                        UNION ALL
                        SELECT A.PRTNR_NO
                             , 0 AS TOT_PPL
                             , CASE WHEN A.PSTN_DV_CD = '7' AND NVL(E.ACTI_YN, 'N') = 'Y' THEN 1 ELSE 0 END SPCNT
                             , CASE WHEN A.PSTN_DV_CD != '7' AND (F.QLF_DV_CD = '3') AND NVL(E.ACTI_YN, 'N') = 'Y' THEN 1 ELSE 0 END WMCNT
                             , CASE WHEN A.PSTN_DV_CD != '7' AND (F.QLF_DV_CD != '3') AND NVL(E.ACTI_YN, 'N') = 'Y' THEN 1 ELSE 0 END WPCNT
                          FROM TB_OGBS_MM_PRTNR_IZ A	/* 월파트너내역 */
                          LEFT OUTER JOIN TB_FEAM_WELS_PAST_ACTI_IZ  E 	/* 웰스과거활동내역 */
                            ON A.BASE_YM = E.PERF_YM
                           AND A.OG_TP_CD = E.OG_TP_CD
                           AND A.PRTNR_NO = E.PRTNR_NO
                           AND E.ACTI_YN = 'Y'	/* 활동여부 */
                          LEFT OUTER JOIN TB_OGPS_PLAR_QLF_CH_IZ F    /* 플래너자격변경내역 */
                            ON A.BASE_YM BETWEEN F.STRTDT AND F.ENDDT
                           AND A.OG_TP_CD = F.OG_TP_CD
                           AND A.PRTNR_NO = F.PRTNR_NO
                           AND NVL(F.QLF_APLC_DV_CD, '0') IN ('1', '2')     /* 승격,자격해제(과거)  3:보류 제외 */
                         WHERE A.DTA_DL_YN = 'N'
                           AND A.BASE_YM  = #{perfYm}
                           AND A.OG_TP_CD  = 'W02'
                     )
                 GROUP BY PRTNR_NO
              ) ACTI	/* 실활동 */
             ON PRTNR.PRTNR_NO = ACTI.PRTNR_NO
           LEFT OUTER JOIN TB_FEAM_WELS_PAST_ACTI_IZ PAST_ACTI 	/* 웰스과거활동내역 */
             ON PRTNR.BASE_YM = PAST_ACTI.PERF_YM
            AND PRTNR.OG_TP_CD = PAST_ACTI.OG_TP_CD
            AND PRTNR.PRTNR_NO = PAST_ACTI.PRTNR_NO
           LEFT OUTER JOIN
              ( SELECT PRTNR_NO
                     , CNDT_ACHV_YN	/* 조건달성여부 */
                     , NINC_CT	/* 순증건수 */
                  FROM TB_FEAM_WELS_PAST_NINC_IZ	/* 웰스과거순증내역 */
                  WHERE PERF_YM = #{perfYm}
                  AND OG_TP_CD = 'W02'
              ) PAST
             ON PRTNR.PRTNR_NO = PAST.PRTNR_NO
           LEFT OUTER JOIN
              ( SELECT PRTNR_NO
                     , SUM(CASE WHEN FEE_CD IN ('W020078', 'W020079') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_HCR  /*홈케어*/
                     , SUM(CASE WHEN FEE_CD IN ('W020007', 'W020034', 'W020035') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_LIVE_PAKG  /*라이브팩*/
                     , SUM(CASE WHEN FEE_CD IN ('W020001', 'W020002') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ELHM_PRPN  /*가전비례*/
                     , SUM(CASE WHEN FEE_CD IN ('W020003', 'W020004') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ELHM_EXCP_PRPN  /*가전외비례*/
                     , SUM(CASE WHEN FEE_CD IN ('W020012', 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_SELL_ENCRG  /*판매장려*/
                     , SUM(CASE WHEN FEE_CD IN ('W020074', 'W020075', 'W020076', 'W020077') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_EDU  /*교육*/
                     , SUM(CASE WHEN FEE_CD IN ('W020080', 'W020081', 'W020082') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_SETTLE  /*정착*/
                     , SUM(CASE WHEN FEE_CD IN ('W020005', 'W020031', 'W020032') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_MCHN_CH  /*기기변경*/
                     , SUM(CASE WHEN FEE_CD IN ('W020084', 'W020087') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_BS_MNGT  /*BS관리*/
                     , SUM(CASE WHEN FEE_CD IN ('W020085', 'W020088') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_RGLVL  /*급지*/
                     , SUM(CASE WHEN FEE_CD ='W020083' THEN FEE_ATC_VAL ELSE 0 END) AS FEE_SELL_ENCRG_RETT  /*판매장려소급*/
                     , SUM(CASE WHEN FEE_CD IN ('W020019', 'W020020', 'W020021') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ELHM_OG_PRPN  /*가전조직비례*/
                     , SUM(CASE WHEN FEE_CD IN ('W020022', 'W020023', 'W020024') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ELHM_OG_EXCP_PRPN  /*가전조직외비례*/
                     , SUM(CASE WHEN FEE_CD IN ('W020017', 'W020043', 'W020044', 'W020045', 'W020046') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_OG_SELL_ENCRG  /*조직판매장려*/
                     , SUM(CASE WHEN FEE_CD IN ('W020013', 'W020039', 'W020040') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_NW_SELL  /*신규판매*/
                     , SUM(CASE WHEN FEE_CD IN ('W020018', 'W020047', 'W020048') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_OG_MNGT  /*조직관리*/
                     , SUM(CASE WHEN FEE_CD = 'W020054' THEN FEE_ATC_VAL ELSE 0 END) AS FEE_SPMT_ENCRG  /*추가장려*/
                     , SUM(CASE WHEN FEE_CD IN ('W020015', 'W020042') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_OG_EJT1  /*조직배출1*/
                     , SUM(CASE WHEN FEE_CD = 'W020016' THEN FEE_ATC_VAL ELSE 0 END) AS FEE_OG_EJT2  /*조직배출2*/
                     , SUM(CASE WHEN FEE_CD = 'W020025' THEN FEE_ATC_VAL ELSE 0 END) AS FEE_NB_BRCH  /*신설지점*/
                     , SUM(CASE WHEN FEE_CD IN ('W020006', 'W020033') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_MSH  /*멤버십*/
                     , SUM(CASE WHEN FEE_CD IN ('W020090', 'W020091') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ADSB  /*재지급*/
                     , SUM(CASE WHEN FEE_CD IN ('W020094', 'W020095') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_ETC_SPPT  /*기타지원*/
                     , SUM(CASE WHEN FEE_CD IN ('W020027', 'W020089') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_WM_TELC  /*WM통신*/
                     , SUM(CASE WHEN FEE_CD IN ('W020096', 'W020097') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_WM_ETC  /*WM기타*/
                     , SUM(CASE WHEN FEE_CD = 'W020086' THEN FEE_ATC_VAL ELSE 0 END) AS FEE_PRR_VST  /*사전방문*/
                     , SUM(CASE WHEN FEE_CD IN ('W020098', 'W020099')  THEN FEE_ATC_VAL ELSE 0 END) AS FEE_UNIFORM  /*유니폼*/
                     , SUM(CASE WHEN FEE_CD IN ('W020014', 'W020041') THEN FEE_ATC_VAL ELSE 0 END) AS FEE_MAT_GRMG  /*자재실장*/
                  FROM TB_FEAM_FEE_DSB_DTL_IZ   /* 수수료지급상세내역 */
                 WHERE DSB_YM = #{perfYm}
                   AND OG_TP_CD = 'W02'
                   AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                   AND FEE_ATC_DV_CD = '01'
                   AND FEE_CD IN ( 'W020078', 'W020079', 'W020007', 'W020034', 'W020035', 'W020001', 'W020002', 'W020003', 'W020004', 'W020012'
                                   , 'W020036', 'W020038', 'W020008', 'W020009', 'W020010', 'W020011', 'W020037', 'W020074', 'W020075', 'W020076'
                                   , 'W020077', 'W020080', 'W020081', 'W020082', 'W020005', 'W020031', 'W020032', 'W020084', 'W020087', 'W020085'
                                   , 'W020088', 'W020083', 'W020019', 'W020020', 'W020021', 'W020022', 'W020023', 'W020024', 'W020017', 'W020043'
                                   , 'W020044', 'W020045', 'W020046', 'W020013', 'W020039', 'W020040', 'W020018', 'W020047', 'W020048', 'W020054'
                                   , 'W020015', 'W020042', 'W020016', 'W020025', 'W020006', 'W020033', 'W020090', 'W020091', 'W020095', 'W020094'
                                   , 'W020027', 'W020089', 'W020096', 'W020097', 'W020086', 'W020098', 'W020099', 'W020014', 'W020041', 'W020054')
                 GROUP BY PRTNR_NO
             ) FEE	/* 수수료 */
            ON PRTNR.PRTNR_NO = FEE.PRTNR_NO
          LEFT OUTER JOIN
             ( SELECT PRTNR_NO
                    , INTBS_AMT	/* 소득과표금액 */
                    , DDCTAM	/* 공제금액 */
                    , DSB_OJ_AMT	/* 지급대상금액 */
                 FROM TB_FEAM_FEE_DSB_IZ	/* 수수료지급내역 */
                WHERE DTA_DL_YN = 'N'
                  AND DSB_YM = #{perfYm}
                  AND CO_CD = '2000'
                  AND OG_TP_CD = 'W02'
                  AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                  AND SPMT_DSB_DV_CD = '01'	/*추가지급구분코드 - 정상지급*/
            ) DSB
           ON PRTNR.PRTNR_NO = DSB.PRTNR_NO
        WHERE PRTNR.DTA_DL_YN = 'N'
          AND PRTNR.BASE_YM = #{perfYm}
          AND PRTNR.OG_TP_CD = 'W02'
          <if test='@MybatisUtils@isEmpty(rsbDvCd)'>
          AND PRTNR.RSB_DV_CD IN ('W0204', 'W0205')
          </if>
          <if test='@MybatisUtils@isNotEmpty(rsbDvCd)'>
          AND PRTNR.RSB_DV_CD = #{rsbDvCd}
          </if>
          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
          AND PRTNR.PRTNR_NO = #{prtnrNo}
          </if>
          <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
          AND OG.DGR1_LEVL_OG_ID = #{ogLevl1Id}
          </if>
          <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
          AND OG.DGR2_LEVL_OG_ID = #{ogLevl2Id}
          </if>
          <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
          AND OG.DGR3_LEVL_OG_ID = #{ogLevl3Id}
          </if>
        ORDER BY OG_CD, TO_NUMBER(PRTNR_NO)
       )
    </select>

    <select id='selectPlannerFees' resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , NVL(PM.PERF_VAL,0) AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
                END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                         CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                              WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                              WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , G.IS11EDU /* 플래너스타트업 */
             , G.IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT /*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT /*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT /*업무해약월*/
             , SUBSTR(PAI.UPGR_YM,1,6) AS AKSTYM  /*수석승급월*/
             , H.CV_DT AS LCECAYMD       /*웰스매니저 개시일 */
             , NVL(MM.B_AKSD05,0) AS B_AKSD05             /* 정착수수료 = 이전 정착수수료*/
             , NVL(B.AKCDA0, 0) AS AKCDA0  /* 가전    */
             , NVL(B.AKCDA1, 0) AS AKCDA1  /* 가전외    */
             , NVL(B.AKCDA2, 0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(B.AKCDA3, 0) AS AKCDA3  /* 환경(정액)  */
             , NVL(B.AKCDA4, 0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(TRUNC(B.EC5AMT,-1),0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(D.AKSD23, 0) AS AKSD23  /* 정액 수당  */
             , NVL(D.AKSD24, 0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(D.AKSD25, 0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01, 0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02, 0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03, 0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD21, 0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD04, 0) AS AKSD04  /* 미팅    */
             , NVL(D.AKSD05, 0) AS AKSD05  /* 정착    */
             , NVL(D.AKSD20, 0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD30, 0) AS AKSD30  /* 기타지원  */
             , NVL(D.AKSD26, 0) AS AKSD26  /* BS관리수수료  */
             , NVL(C.INTBS_AMT, 0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN TB_FEAM_PRTNR_PERF_MM_CL PM
            ON A.PRTNR_NO = PM.PRTNR_NO
           AND A.OG_TP_CD = PM.OG_TP_CD
           AND A.BASE_YM = PM.BASE_YM
           AND PM.FEE_TCNT_DV_CD = #{feeTcntDvCd}
           AND PM.PERF_ATC_CD = 'W01P00012'    /* 미팅참석일수 */
           AND PM.PERF_AGRG_CRT_DV_CD = '101'  /* P추진단미팅실적생성 */
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD26),0) AS AKSD26  /* BS관리수수료  */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010121') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010031' OR FEE_CD = 'W010131') THEN FEE_ATC_VAL ELSE 0 END AS AKSD26  /* BS관리수수료  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND FEE_ATC_DV_CD = '01'
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010023'
                                                     , 'W010123', 'W010024', 'W010124', 'W010025', 'W010125', 'W010031', 'W010131')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT IS NULL
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = '0'
                                      GROUP BY PRTNR_NO
                                  UNION ALL
                                 SELECT PRTNR_NO
                                      , 0 AS P_CNT
                                      , COUNT(1) AS G_CNT
                                   FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                  WHERE BASE_YM = #{perfYm}
                                    AND CAN_DT IS NULL
                                    AND FLPYM_TN > 1
                                    AND LIF_CNTR_STAT_CD = '0'
                                  GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(IS11EDU) AS IS11EDU
                                 , MAX(IS17EDU) AS IS17EDU
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN EDUC_CRSE_NO = '14' THEN EDUC_CRSE_CRT_BASE_YM END AS IS11EDU
                                          , CASE WHEN EDUC_CRSE_NO = '19' THEN EDUC_CRSE_CRT_BASE_YM END AS IS17EDU
                                       FROM TB_PSCA_MCPTN_EDUC_IZ
                                      WHERE EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND EDUC_CRSE_NO IN ('14','19')
                                        AND EDUC_CPC_ACKMT_YN = 'Y'
                                   )
                             GROUP BY PRTNR_NO
                          )G
            ON A.PRTNR_NO = G.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MIN(STRTDT) AS CV_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                             WHERE QLF_DV_CD = '3'  /* 웰스매니저 */
                               AND DTA_DL_YN = 'N'
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )H
            ON A.PRTNR_NO = H.PRTNR_NO
          LEFT OUTER JOIN TB_OGPS_TOPMR_PLAR_APLC_IZ PAI
            ON PAI.MNGT_YM = #{perfYm}
           AND PAI.OG_TP_CD = 'W01'
           AND PAI.QLF_DV_CD = '1'  /* 수석플래너 */
           AND PAI.UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
           AND PAI.UPGR_DMTN_DV_CD = '1' /* 승급 */
           AND PAI.PRTNR_NO = A.PRTNR_NO
          LEFT OUTER JOIN ( SELECT T1.PRTNR_NO
                                 , NVL(SUM(T1.B_AKSD05),0) AS B_AKSD05
                              FROM ( SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND OG_TP_CD = 'W01' /*P조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분=2차확정*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W010005', 'W010105')
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND DSB_YM &gt;= '201904'
                                        AND OG_TP_CD = 'W02' /*M조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )T1
                              LEFT OUTER JOIN (
                                     SELECT PRTNR_NO
                                          , MIN(UPGR_YM) AS UPGR_YM
                                       FROM TB_OGPS_TOPMR_PLAR_APLC_IZ
                                      WHERE OG_TP_CD = 'W01'
                                        AND QLF_DV_CD = '1'  /* 수석플래너 */
                                        AND UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
                                        AND UPGR_DMTN_DV_CD = '1' /* 승급 */
                                        AND MNGT_YM IN (#{perfYm}, TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'),-1),'YYYYMM')) /* 실적월, 실적 전월 조회 */
                                      GROUP BY PRTNR_NO
                                   ) T2
                                ON T2.PRTNR_NO = T1.PRTNR_NO
                             WHERE T1.DSB_YM &lt; NVL(T2.UPGR_YM,'000001')     /*수석플래너등록 이전*/
                             GROUP BY T1.PRTNR_NO
                          )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND A.PRTNR_NO = #{prtnrNo}
       </if>
           AND A.PSTN_DV_CD = '15'
    </select>

    <select id='selectPlannerBranchManagerFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarBrmgrRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , '플래너지점장' AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '플래너지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                         END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT /* 최초계약일자 => 등록기준월 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT     /* 계약일자 => 최초업무등록월 */
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT /*최종 해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT     /*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN G.EDUC_CRSE_NO = '19' THEN G.EDUC_CRSE_CRT_BASE_YM END AS IS17EDU /* 수석(플래너)실전 */
             , CASE WHEN A.PRFMT_DT > 0 AND A.PRFMT_DMTN_DV_CD = 0 THEN SUBSTR(A.PRFMT_DT,1,6)
                    ELSE CASE WHEN AA.PRFMT_DT > 0 AND AA.PRFMT_DMTN_DV_CD = 0 THEN SUBSTR(AA.PRFMT_DT,1,6) ELSE '' END
               END AS AKDRIY                    /* 승진월     */
             , SUBSTR(PAI.UPGR_YM,1,6) AS AKSTYM  /*수석승급월*/
             , H.CV_DT AS LCECAYMD /*웰스매니저 개시일 LC1700P 정리되지 않아 임시처리 */
             , NVL(MM.B_AKSD05,0) AS B_AKSD05             /* 정착수수료 = 이전 정착수수료*/
             , NVL(B.AKCDA0, 0) AS AKCDA0  /* 가전    */
             , NVL(B.AKCDA1, 0) AS AKCDA1  /* 가전외    */
             , NVL(B.AKCDA2, 0) AS AKCDA2  /* 기변    */
             , NVL(EE.P_CNT, 0)  AS AKSQ01              /* 당월 상조  */
             , NVL(EE.G_CNT, 0)  AS N_AKSQ01             /* 상조 유지  */
             , NVL(B1.AKCDA0, 0) AS AKCDAG0  /* 지점 가전    */
             , NVL(B1.AKCDA1, 0) AS AKCDAG1  /* 지점 가전외    */
             , NVL(B1.AKSQ02, 0) AS AKSQG02  /* 지점 상조    */
             , NVL(B.AKCDA3, 0) AS AKCDA3  /* 환경(정액)  */
             , NVL(B.AKCDA4, 0) AS AKCDA4  /* 환경외(정액)  */
             , NVL(B.AKDEQ5,0) AS AKDEQ5  /* 라이브팩 건수 */
             , NVL(B.EC5AMT, 0) AS EC5AMT  /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT /* 관리상품 판매건수 */
             , NVL(D.AKSD23, 0) AS AKSD23  /* 정액 수당  */
             , NVL(D.AKSD24, 0) AS AKSD24  /* 라이브팩 수당 */
             , NVL(D.AKSD25, 0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01, 0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02, 0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03, 0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD11, 0) AS AKSD11  /* 가전조직비례 */
             , NVL(D.AKSD12, 0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(D.AKSD13, 0) AS AKSD13  /* 조직판매장려 */
             , NVL(D.AKSD05, 0) AS AKSD05  /* 정착수수료 */
             , NVL(D.AKSD16, 0) AS AKSD16  /* 조직배출1 */
             , NVL(D.AKSD17, 0) AS AKSD17  /* 조직배출2 */
             , NVL(D.AKSD18, 0) AS AKSD18  /* 승진수수료 */
             , NVL(D.AKSD15, 0) AS AKSD15  /* 신설 */
             , NVL(D.AKSD20, 0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD21, 0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD22, 0) AS AKSD22  /* 지점장상조   */
             , NVL(D.AKSD30, 0) AS AKSD30  /* 기타지원  */
             , NVL(D.AKSD26, 0) AS AKSD26  /* BS관리수수료  */
             , NVL(C.INTBS_AMT, 0) AS AKSD99 /* 과표합계 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
        <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
        </if>
        <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
        </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                          </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                        AND AK17.PERF_ATC_CD IN ( 'W01P00001' , 'W01P00004' , 'W00P00028' , 'W00P00029' , 'W00P00030'
                                                                , 'W00P00009' , 'W01P00016' , 'W01P00018'
                                                                )
                                    )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00034' THEN PERF_VAL END AS AKSQ02   /* 조직상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                     )M
                                GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
        LEFT OUTER JOIN TB_OGPS_TOPMR_PLAR_APLC_IZ PAI
                    ON PAI.MNGT_YM = #{perfYm}
                        AND PAI.OG_TP_CD = 'W01'
                        AND PAI.QLF_DV_CD = '1'  /* 수석플래너 */
                        AND PAI.UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
                        AND PAI.UPGR_DMTN_DV_CD = '1' /* 승급 */
                        AND PAI.PRTNR_NO = A.PRTNR_NO
        LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
          ON A.PRTNR_NO = C.PRTNR_NO
         AND A.BASE_YM = C.DSB_YM
         AND A.OG_TP_CD = C.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
        LEFT OUTER JOIN ( SELECT PRTNR_NO
                               , DSB_YM
                               , CO_CD
                               , OG_TP_CD
                               , FEE_TCNT_DV_CD
                               , SPMT_DSB_DV_CD
                               , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액 수당  */
                               , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                               , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                               , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                               , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                               , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                               , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                               , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                               , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                               , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                               , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                               , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                               , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착 */
                               , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료 */
                               , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                               , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                               , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                               , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                               , NVL(SUM(AKSD26),0) AS AKSD26  /* BS관리수수료  */
                            FROM ( SELECT PRTNR_NO
                                        , DSB_YM
                                        , CO_CD
                                        , OG_TP_CD
                                        , FEE_TCNT_DV_CD
                                        , SPMT_DSB_DV_CD
                                        , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END AS AKSD23  /* 정액 수당  */
                                        , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                        , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                        , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                        , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                        , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                        , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                        , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                        , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                        , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD05 /* 정착    */
                                        , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                        , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                        , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                        , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18                         /* 승진수수료 */
                                        , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                        , CASE WHEN (FEE_CD = 'W010121' OR FEE_CD = 'W010121') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                        , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                        , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                        , CASE WHEN (FEE_CD = 'W010031' OR FEE_CD = 'W010131') THEN FEE_ATC_VAL ELSE 0 END AS AKSD26  /* BS관리수수료  */
                                     FROM TB_FEAM_FEE_DSB_DTL_IZ
                                    WHERE DSB_YM = #{perfYm}
                                      AND OG_TP_CD = 'W01'
                                      AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                      AND FEE_ATC_DV_CD = '01'
                                 <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND PRTNR_NO = #{prtnrNo}
                                 </if>
                                      AND FEE_CD IN ('W010023', 'W010123', 'W010024', 'W010124', 'W010025', 'W010125', 'W010001', 'W010101', 'W010118'
                                                   , 'W010002', 'W010102', 'W010003', 'W010103', 'W010011', 'W010012', 'W010013', 'W010016', 'W010018'
                                                   , 'W010017', 'W010015', 'W010020', 'W010120', 'W010121', 'W010121', 'W010022', 'W010030', 'W010130'
                                                   , 'W010005', 'W010105', 'W010031', 'W010131' )
                                 )
                           GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                        )D
          ON C.PRTNR_NO = D.PRTNR_NO
         AND C.DSB_YM = D.DSB_YM
         AND C.OG_TP_CD = D.OG_TP_CD
         AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
         AND C.CO_CD = D.CO_CD
         AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
        LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                               , SUM(Z.P_CNT) AS P_CNT
                               , SUM(Z.G_CNT) AS G_CNT
                            FROM ( SELECT PRTNR_NO
                                        , COUNT(1) AS P_CNT
                                        , 0 AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT IS NULL
                                      AND FLPYM_TN = 1
                                      AND LIF_CNTR_STAT_CD = '0'
                                    GROUP BY PRTNR_NO
                                    UNION ALL
                                   SELECT PRTNR_NO
                                        , 0 AS P_CNT
                                        , COUNT(1) AS G_CNT
                                     FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                    WHERE BASE_YM = #{perfYm}
                                      AND CAN_DT IS NULL
                                      AND FLPYM_TN > 1
                                      AND LIF_CNTR_STAT_CD = '0'
                                    GROUP BY PRTNR_NO
                                 ) Z GROUP BY Z.PRTNR_NO
                        ) EE
          ON A.PRTNR_NO = EE.PRTNR_NO
        LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                               , SUM(RUNCNT) AS RUNCNT
                               , SUM(GADCNT) AS GADCNT
                            FROM ( SELECT A.PRTNR_NO
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                        , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                     FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                    WHERE A.BASE_YM = #{perfYm}
                                      AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                      AND A.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                      AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035')
                                      AND A.CO_CD = '2000'
                                      AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                 <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND A.PRTNR_NO = #{prtnrNo}
                                 </if>
                                      AND A.PERF_VAL > 0
                                 )M
                           GROUP BY M.PRTNR_NO
                        ) P_CNT
          ON A.PRTNR_NO = P_CNT.PRTNR_NO
        LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
          ON A.PRTNR_NO = F.PRTNR_NO
         AND A.OG_TP_CD = F.OG_TP_CD
         AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
        LEFT OUTER JOIN TB_PSCA_MCPTN_EDUC_IZ G
          ON A.BASE_YM = G.EDUC_CRSE_CRT_BASE_YM
         AND A.PRTNR_NO = G.PRTNR_NO
         AND A.OG_TP_CD = G.OG_TP_CD
         AND G.EDUC_CRSE_NO = '19'
         AND G.EDUC_CPC_ACKMT_YN = 'Y'
        LEFT OUTER JOIN ( SELECT PRTNR_NO
                               , MIN(STRTDT) AS CV_DT
                            FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                           WHERE QLF_DV_CD = '3'  /* 웰스매니저 */
                             AND DTA_DL_YN = 'N'
                        <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                             AND PRTNR_NO = #{prtnrNo}
                        </if>
                           GROUP BY PRTNR_NO
               ) H
            ON A.PRTNR_NO = H.PRTNR_NO
        LEFT OUTER JOIN ( SELECT T1.PRTNR_NO
                                , NVL(SUM(T1.B_AKSD05),0) AS B_AKSD05
                            FROM ( SELECT PRTNR_NO
                                        , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                        , DSB_YM
                                      FROM TB_FEAM_FEE_DSB_DTL_IZ
                                    WHERE DSB_YM <![CDATA[<]]> #{perfYm}
                                      AND OG_TP_CD = 'W01' /*P조직*/
                                      AND FEE_TCNT_DV_CD = #{feeTcntDvCd}  /*차수구분=2차확정*/
                                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                          AND PRTNR_NO = #{prtnrNo}
                                      </if>
                                      AND FEE_CD IN ('W010005', 'W010105')

                                    UNION ALL

                                    SELECT PRTNR_NO
                                        , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                        , DSB_YM
                                      FROM TB_FEAM_FEE_DSB_DTL_IZ
                                    WHERE DSB_YM <![CDATA[<]]> #{perfYm}
                                      AND DSB_YM <![CDATA[>=]]> '201904'
                                      AND OG_TP_CD = 'W02' /*M조직*/
                                      AND FEE_TCNT_DV_CD = #{feeTcntDvCd}  /*차수구분*/
                                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                          AND PRTNR_NO = #{prtnrNo}
                                      </if>
                                      AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                  )T1
                             LEFT OUTER JOIN (
                                    SELECT PRTNR_NO
                                         , MIN(UPGR_YM) AS UPGR_YM
                                      FROM TB_OGPS_TOPMR_PLAR_APLC_IZ
                                     WHERE OG_TP_CD = 'W01'
                                       AND QLF_DV_CD = '1'  /* 수석플래너 */
                                       AND UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
                                       AND UPGR_DMTN_DV_CD = '1' /* 승급 */
                                       AND MNGT_YM IN (#{perfYm}, TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'),-1),'YYYYMM')) /* 실적월, 실적 전월 조회 */
                                     GROUP BY PRTNR_NO
                                  ) T2
                               ON T2.PRTNR_NO = T1.PRTNR_NO
                            WHERE T1.DSB_YM <![CDATA[<]]> NVL(T2.UPGR_YM,'000001')     /*수석플래너등록 이전*/
                            GROUP BY T1.PRTNR_NO
                        )MM
          ON A.PRTNR_NO = MM.PRTNR_NO
       WHERE A.BASE_YM = #{perfYm}
         AND A.OG_TP_CD = 'W01' /*P조직*/
    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
         AND A.PRTNR_NO = #{prtnrNo}
    </if>
         AND A.PSTN_DV_CD = 7
    </select>

    <select id='selectPlannerTotalFees'
            resultType="com.kyowon.sms.wells.web.fee.calculation.dto.WfebOrganizationFeeDto$SearchPlarTotalRes">
        SELECT A.OG_CD AS OG_NM  /*소속*/
             , A.PRTNR_NO /*번호*/
             , A.PRTNR_KNM /*성명*/
             , A.RSB_DV_CD /*직책*/
             , NVL(P_CNT.AKCUIL,0) AS AKCUIL     /*미팅일수*/
             , CASE WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '2' THEN '플래너'
                    WHEN A.PSTN_DV_CD = 15 AND NVL(A.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                    WHEN A.PSTN_DV_CD = 7 THEN '지점장'
                    ELSE ''
               END AS JAGYUK       /*수수료월 자격*/
             , CASE WHEN F.PRTNR_NO IS NOT NULL THEN
                    CASE WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '2' THEN '플래너'
                         WHEN F.PSTN_DV_CD = 15 AND NVL(F.QLF_DV_CD , '2') = '1' THEN '수석플래너'
                         WHEN F.PSTN_DV_CD = 7 THEN '지점장'
                         WHEN F.PSTN_DV_CD = 4 THEN '단장'
                         WHEN F.PSTN_DV_CD = 2 THEN '총괄단장장'
                    END
                    ELSE '해약'
               END AS N_JAGYUK1               /* 자격(M+1)   */
             , G.IS11EDU /* 플래너스타트업 */
             , G.IS17EDU /* 수석(플래너)실전 */
             , SUBSTR(A.CNTR_DT,1,6) AS CNTR_DT/*등록기준월*/
             , SUBSTR(A.FST_CNTR_DT,1,6) AS FST_CNTR_DT/*최초업무등록월*/
             , SUBSTR(A.RCNTR_DT,1,6) AS RCNTR_DT/*재등록월*/
             , SUBSTR(A.FNL_CLTN_DT,1,6) AS FNL_CLTN_DT/*최종해약월*/
             , SUBSTR(A.CLTN_DT,1,6) AS CLTN_DT/*업무해약월*/
             , NVL(P_CNT.RUNCNT,0) AS RUNCNT        /* 실활동인원     */
             , NVL(P_CNT.GADCNT,0) AS GADCNT  	/* 가동인원 */
             , CASE WHEN A.PSTN_DV_CD = 7 THEN
                        CASE WHEN A.PRFMT_DT > 0 AND A.PRFMT_DMTN_DV_CD = 0 THEN SUBSTR(A.PRFMT_DT,1,6)
                             ELSE CASE WHEN AA.PRFMT_DT > 0 AND AA.PRFMT_DMTN_DV_CD = 0 THEN SUBSTR(AA.PRFMT_DT,1,6) ELSE '' END
                         END
                    ELSE SUBSTR(A.PRFMT_DT,1,6)
                END AS AKDRIY                    /* 승진월     */
             , SUBSTR(PAI.UPGR_YM,1,6) AS AKSTYM  /*수석승급월*/
             , H.CV_DT AS LCECAYMD       /*웰스매니저 개시일 */
             , NVL(MM.B_AKSD05,0) AS B_AKSD05             /* 정착수수료 = 이전 정착수수료*/
             , NVL(B.AKCDA0, 0) AS AKCDA0        /* 가전    */
             , NVL(B.AKCDA1, 0) AS AKCDA1        /* 가전외    */
             , NVL(B.AKCDA2, 0) AS AKCDA2        /* 기변    */
             , NVL(EE.P_CNT, 0) AS AKSQ01       /* 당월 상조  */
             , NVL(EE.G_CNT, 0) AS N_AKSQ01     /* 상조 유지  */
             , NVL(B1.AKCDA0, 0) AS AKCDAG0      /* 지점 가전    */
             , NVL(B1.AKCDA1, 0) AS AKCDAG1      /* 지점 가전외    */
             , NVL(B1.AKSQ02, 0) AS AKSQG02      /* 지점 상조    */
             , NVL(B.AKCDA3, 0) AS AKCDA3        /* 환경(정액)  */
             , NVL(B.AKCDA4, 0) AS AKCDA4        /* 환경외(정액)  */
             , NVL(B.AKDEQ5, 0) AS AKDEQ5        /* 라이브팩 건수 */
             , NVL(B.EC5AMT, 0) AS EC5AMT        /* 홈케어 판매가 */
             , NVL(B.MPRODUCT,0) AS MPRODUCT    /* 관리상품 판매건수 */
             , NVL(D.AKSD23, 0) AS AKSD23 /* 정액수수료 */
             , NVL(D.AKSD24, 0) AS AKSD24 /* 라이브팩 수당 */
             , NVL(D.AKSD25, 0) AS AKSD25  /* 홈케어 수장  */
             , NVL(D.AKSD01, 0) AS AKSD01  /* 개인비례 가전 */
             , NVL(D.AKSD02, 0) AS AKSD02  /* 개인비례 가전외 */
             , NVL(D.AKSD03, 0) AS AKSD03  /* 개인 판매장려 */
             , NVL(D.AKSD21, 0) AS AKSD21  /* 개인상조   */
             , NVL(D.AKSD04, 0) AS AKSD04  /* 미팅    */
             , NVL(D.AKSD05, 0) AS AKSD05  /* 정착    */
             , NVL(D.AKSD20, 0) AS AKSD20  /* 재지급    */
             , NVL(D.AKSD30, 0) AS AKSD30  /* 기타지원  */
             , NVL(D.AKSD26, 0) AS AKSD26  /* BS관리수수료  */
             , NVL(D.AKSD11, 0) AS AKSD11  /* 가전조직비례 */
             , NVL(D.AKSD12, 0) AS AKSD12  /* 가전조직외 비례 */
             , NVL(D.AKSD13, 0) AS AKSD13  /* 조직판매장려 */
             , NVL(D.AKSD16, 0) AS AKSD16  /* 조직배출1 */
             , NVL(D.AKSD17, 0) AS AKSD17  /* 조직배출2 */
             , NVL(D.AKSD15, 0) AS AKSD15  /* 신설 */
             , NVL(D.AKSD18, 0) AS AKSD18  /* 승진수수료 */
             , NVL(D.AKSD22, 0) AS AKSD22  /* 지점장상조   */
             , NVL(C.INTBS_AMT, 0) AS AKSD99 /* 과표합계 */
             , NVL(C.DDCTAM, 0) AS DDCTAM     /* 공제 */
             , NVL(C.DSB_OJ_AMT, 0) AS DSB_OJ_AMT /* 실지급 */
          FROM TB_OGBS_MM_PRTNR_IZ A
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AA
            ON AA.OG_TP_CD = 'W02'
           AND AA.PRTNR_NO = A.PRTNR_NO
           AND AA.BASE_YM = ( SELECT MAX(X.BASE_YM)
                                FROM TB_OGBS_MM_PRTNR_IZ X
                               WHERE X.OG_TP_CD = 'W02'
                                 AND X.PRTNR_NO = AA.PRTNR_NO
                             )
         INNER JOIN TB_OGBS_MM_OG_IZ O
            ON A.BASE_YM = O.BASE_YM
           AND A.OG_ID = O.OG_ID
       <if test='@MybatisUtils@isNotEmpty(ogLevl1Id)'>
           AND O.DGR1_LEVL_OG_ID = #{ogLevl1Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl2Id)'>
           AND O.DGR2_LEVL_OG_ID = #{ogLevl2Id}
       </if>
       <if test='@MybatisUtils@isNotEmpty(ogLevl3Id)'>
           AND O.DGR3_LEVL_OG_ID = #{ogLevl3Id}
       </if>
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKCDA2) AS AKCDA2
                                 , SUM(AKCDA3) AS AKCDA3
                                 , SUM(AKCDA4) AS AKCDA4
                                 , SUM(AKDEQ5) AS AKDEQ5
                                 , SUM(EC5AMT) AS EC5AMT
                                 , SUM(MPRODUCT) AS MPRODUCT
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00028' THEN PERF_VAL END AS AKCDA2   /* 기변    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00029' THEN PERF_VAL END AS AKCDA3   /* 환경(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00030' THEN PERF_VAL END AS AKCDA4   /* 환경외(정액)  */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W00P00009' THEN PERF_VAL END AS AKDEQ5   /* 라이브팩 건수 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00016' THEN PERF_VAL END AS EC5AMT   /* 홈케어 판매가 */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00018' THEN PERF_VAL END AS MPRODUCT   /* 관리상품 판매건수 */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 0   /*개인판매*/
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B
            ON A.PRTNR_NO = B.PRTNR_NO
           AND A.OG_TP_CD = B.OG_TP_CD
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , M.OG_TP_CD
                                 , SUM(AKCDA0) AS AKCDA0
                                 , SUM(AKCDA1) AS AKCDA1
                                 , SUM(AKSQ02) AS AKSQ02
                              FROM ( SELECT AK17.PRTNR_NO
                                          , AK17.OG_TP_CD
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00001' THEN PERF_VAL END AS AKCDA0   /* 가전    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00004' THEN PERF_VAL END AS AKCDA1   /* 가전외    */
                                          , CASE WHEN AK17.PERF_ATC_CD = 'W01P00034' THEN PERF_VAL END AS AKSQ02   /* 조직 상조실적    */
                                       FROM TB_FEAM_NTORP_PERF_MM_CL AK17   /*순주문 파트너 실적 월마감*/
                                      WHERE AK17.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND AK17.BASE_YM = #{perfYm}
                                        AND AK17.PERF_DV_CD = 2
                                        AND AK17.PERF_AGRG_CRT_DV_CD = '101' /* P추진단순주문실적생성 */
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND AK17.PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND AK17.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   )M
                             GROUP BY M.PRTNR_NO, M.OG_TP_CD
                           )B1
            ON A.PRTNR_NO = B1.PRTNR_NO
           AND A.OG_TP_CD = B1.OG_TP_CD
          LEFT OUTER JOIN TB_OGPS_TOPMR_PLAR_APLC_IZ PAI
            ON PAI.MNGT_YM = #{perfYm}
           AND PAI.OG_TP_CD = 'W01'
           AND PAI.QLF_DV_CD = '1'  /* 수석플래너 */
           AND PAI.UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
           AND PAI.UPGR_DMTN_DV_CD = '1' /* 승급 */
           AND PAI.PRTNR_NO = A.PRTNR_NO
          LEFT OUTER JOIN TB_FEAM_FEE_DSB_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.BASE_YM = C.DSB_YM
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = #{feeTcntDvCd}
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , DSB_YM
                                 , CO_CD
                                 , OG_TP_CD
                                 , FEE_TCNT_DV_CD
                                 , SPMT_DSB_DV_CD
                                 , NVL(SUM(AKSD01),0) AS AKSD01  /* 개인비례 가전 */
                                 , NVL(SUM(AKSD02),0) AS AKSD02 /* 개인비례 가전외 */
                                 , NVL(SUM(AKSD03),0) AS AKSD03  /* 개인 판매장려 */
                                 , NVL(SUM(AKSD21),0) AS AKSD21  /* 개인상조   */
                                 , NVL(SUM(AKSD04),0) AS AKSD04  /* 미팅    */
                                 , NVL(SUM(AKSD05),0) AS AKSD05  /* 정착    */
                                 , NVL(SUM(AKSD20),0) AS AKSD20  /* 재지급    */
                                 , NVL(SUM(AKSD30),0) AS AKSD30  /* 기타수수료  */
                                 , NVL(SUM(AKSD26),0) AS AKSD26  /* BS관리수수료  */
                                 , NVL(SUM(AKSD24),0) AS AKSD24  /* 라이브팩 수당 */
                                 , NVL(SUM(AKSD25),0) AS AKSD25  /* 홈케어 수장  */
                                 , NVL(SUM(AKSD11),0) AS AKSD11  /* 조직비례 가전 */
                                 , NVL(SUM(AKSD12),0) AS AKSD12  /* 조직비례 가전 외   */
                                 , NVL(SUM(AKSD13),0) AS AKSD13  /* 조직 판매장려 */
                                 , NVL(SUM(AKSD16),0) AS AKSD16  /* 조직배출1 */
                                 , NVL(SUM(AKSD17),0) AS AKSD17  /* 조직배출2 */
                                 , NVL(SUM(AKSD15),0) AS AKSD15  /* 신설 */
                                 , NVL(SUM(AKSD22),0) AS AKSD22  /* 지점장상조   */
                                 , NVL(SUM(AKSD23),0) AS AKSD23  /* 정액수수료   */
                                 , NVL(SUM(AKSD18),0) AS AKSD18  /* 승진수수료   */
                              FROM ( SELECT PRTNR_NO
                                          , DSB_YM
                                          , CO_CD
                                          , OG_TP_CD
                                          , FEE_TCNT_DV_CD
                                          , SPMT_DSB_DV_CD
                                          , CASE WHEN (FEE_CD = 'W010001' OR FEE_CD = 'W010101') THEN FEE_ATC_VAL ELSE 0 END AS AKSD01  /* 개인비례 가전 */
                                          , CASE WHEN (FEE_CD = 'W010002' OR FEE_CD = 'W010102') THEN FEE_ATC_VAL ELSE 0 END AS AKSD02  /* 개인비례 가전외 */
                                          , CASE WHEN (FEE_CD = 'W010003' OR FEE_CD = 'W010103') THEN FEE_ATC_VAL ELSE 0 END AS AKSD03  /* 개인 판매장려 */
                                          , CASE WHEN (FEE_CD = 'W010021' OR FEE_CD = 'W010121') THEN FEE_ATC_VAL ELSE 0 END AS AKSD21  /* 개인상조   */
                                          , CASE WHEN FEE_CD = 'W010004' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD04                         /* 미팅    */
                                          , CASE WHEN (FEE_CD = 'W010005' OR FEE_CD = 'W010105') THEN FEE_ATC_VAL ELSE 0 END AS AKSD05  /* 정착    */
                                          , CASE WHEN (FEE_CD = 'W010020' OR FEE_CD = 'W010120') THEN FEE_ATC_VAL ELSE 0 END AS AKSD20  /* 재지급    */
                                          , CASE WHEN (FEE_CD = 'W010030' OR FEE_CD = 'W010130') THEN FEE_ATC_VAL ELSE 0 END AS AKSD30  /* 기타수수료  */
                                          , CASE WHEN (FEE_CD = 'W010031' OR FEE_CD = 'W010131') THEN FEE_ATC_VAL ELSE 0 END AS AKSD26  /* BS관리수수료  */
                                          , CASE WHEN (FEE_CD = 'W010024' OR FEE_CD = 'W010124') THEN FEE_ATC_VAL ELSE 0 END AS AKSD24  /* 라이브팩 수당 */
                                          , CASE WHEN (FEE_CD = 'W010025' OR FEE_CD = 'W010125') THEN FEE_ATC_VAL ELSE 0 END AS AKSD25  /* 홈케어 수장  */
                                          , CASE WHEN FEE_CD = 'W010011' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD11                         /* 조직비례 가전    */
                                          , CASE WHEN FEE_CD = 'W010012' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD12                         /* 조직비례 가전 외    */
                                          , CASE WHEN FEE_CD = 'W010013' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD13                         /* 조직 판매장려    */
                                          , CASE WHEN FEE_CD = 'W010016' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD16                         /* 조직배출1    */
                                          , CASE WHEN FEE_CD = 'W010017' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD17                         /* 조직배출2    */
                                          , CASE WHEN FEE_CD = 'W010015' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD15                         /* 신설    */
                                          , CASE WHEN FEE_CD = 'W010022' THEN FEE_ATC_VAL ELSE 0 END  AS AKSD22                         /* 지점장상조  */
                                          , CASE WHEN (FEE_CD = 'W010023' OR FEE_CD = 'W010123') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD23 /* 정액수수료  */
                                          , CASE WHEN (FEE_CD = 'W010018' OR FEE_CD = 'W010118') THEN FEE_ATC_VAL ELSE 0 END  AS AKSD18 /* 승진수수료  */
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND FEE_ATC_DV_CD = '01'
                                    <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                    </if>
                                        AND FEE_CD IN ('W010001', 'W010101', 'W010002', 'W010102', 'W010003', 'W010103', 'W010021', 'W010121'
                                                     , 'W010004', 'W010005', 'W010105', 'W010020', 'W010120', 'W010030', 'W010130', 'W010024'
                                                     , 'W010124', 'W010025', 'W010125', 'W010011', 'W010012', 'W010013', 'W010016', 'W010017'
                                                     , 'W010015', 'W010022', 'W010023', 'W010123', 'W010018', 'W010118', 'W010031', 'W010131')
                                    )
                             GROUP BY PRTNR_NO, DSB_YM, CO_CD, OG_TP_CD, FEE_TCNT_DV_CD, SPMT_DSB_DV_CD
                           )D
            ON C.PRTNR_NO = D.PRTNR_NO
           AND C.DSB_YM = D.DSB_YM
           AND C.OG_TP_CD = D.OG_TP_CD
           AND C.FEE_TCNT_DV_CD = D.FEE_TCNT_DV_CD
           AND C.CO_CD = D.CO_CD
           AND C.SPMT_DSB_DV_CD = D.SPMT_DSB_DV_CD
          LEFT OUTER JOIN ( SELECT Z.PRTNR_NO
                                 , SUM(Z.P_CNT) AS P_CNT
                                 , SUM(Z.G_CNT) AS G_CNT
                              FROM ( SELECT PRTNR_NO
                                          , COUNT(1) AS P_CNT
                                          , 0 AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A /* 상조 건수*/
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT IS NULL
                                        AND FLPYM_TN = 1
                                        AND LIF_CNTR_STAT_CD = '0'
                                      GROUP BY PRTNR_NO
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , 0 AS P_CNT
                                          , COUNT(1) AS G_CNT
                                       FROM TB_IFIN_LIF_ALNC_FEE_CNTR_IZ A
                                      WHERE BASE_YM = #{perfYm}
                                        AND CAN_DT IS NULL
                                        AND FLPYM_TN > 1
                                        AND LIF_CNTR_STAT_CD = '0'
                                      GROUP BY PRTNR_NO
                                    ) Z GROUP BY Z.PRTNR_NO
                           ) EE
            ON ( A.PRTNR_NO = EE.PRTNR_NO )
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ F
            ON A.PRTNR_NO = F.PRTNR_NO
           AND A.OG_TP_CD = F.OG_TP_CD
           AND F.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}, 'YYYYMM'), 1),'YYYYMM' )
          LEFT OUTER JOIN ( SELECT M.PRTNR_NO
                                 , SUM(RUNCNT) AS RUNCNT
                                 , SUM(GADCNT) AS GADCNT
                                 , SUM(AKCUIL) AS AKCUIL
                              FROM ( SELECT A.PRTNR_NO
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00020' THEN PERF_VAL END AS RUNCNT   /* 실활동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00035' THEN PERF_VAL END AS GADCNT   /* 가동인원  */
                                          , CASE WHEN A.PERF_ATC_CD = 'W01P00012' THEN PERF_VAL END AS AKCUIL   /* 미팅참석일수 */
                                       FROM TB_FEAM_PRTNR_PERF_MM_CL A   /*순주문 파트너 실적 월마감*/
                                      WHERE A.BASE_YM = #{perfYm}
                                        AND A.FEE_TCNT_DV_CD = #{feeTcntDvCd}
                                        AND A.PERF_AGRG_CRT_DV_CD IN ('101','103') /* P추진단순주문실적생성, P조직미팅참석집계 */
                                        AND A.PERF_ATC_CD IN ('W01P00020', 'W01P00035', 'W01P00012')
                                        AND A.CO_CD = '2000'
                                        AND A.OG_TP_CD = 'W01'  /*웰스 P조직*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND A.PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND A.PERF_VAL > 0
                                   )M
                             GROUP BY M.PRTNR_NO
                          ) P_CNT
            ON A.PRTNR_NO = P_CNT.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MAX(IS11EDU) AS IS11EDU
                                 , MAX(IS17EDU) AS IS17EDU
                              FROM ( SELECT PRTNR_NO
                                          , CASE WHEN EDUC_CRSE_NO = '14' THEN EDUC_CRSE_CRT_BASE_YM END AS IS11EDU
                                          , CASE WHEN EDUC_CRSE_NO = '19' THEN EDUC_CRSE_CRT_BASE_YM END AS IS17EDU
                                       FROM TB_PSCA_MCPTN_EDUC_IZ
                                      WHERE EDUC_CRSE_CRT_BASE_YM = #{perfYm}
                                        AND OG_TP_CD = 'W01'
                                        AND EDUC_CRSE_NO IN ('14','19')
                                        AND EDUC_CPC_ACKMT_YN = 'Y'
                                   )
                             GROUP BY PRTNR_NO
                          )G
            ON A.PRTNR_NO = G.PRTNR_NO
          LEFT OUTER JOIN ( SELECT PRTNR_NO
                                 , MIN(STRTDT) AS CV_DT
                              FROM TB_OGPS_PLAR_QLF_CH_IZ /*플래너 자격 변경내역*/
                             WHERE QLF_DV_CD = '3'  /* 웰스매니저 */
                               AND DTA_DL_YN = 'N'
                          <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                               AND PRTNR_NO = #{prtnrNo}
                          </if>
                             GROUP BY PRTNR_NO
                          )H
            ON A.PRTNR_NO = H.PRTNR_NO
          LEFT OUTER JOIN ( SELECT T1.PRTNR_NO
                                 , NVL(SUM(T1.B_AKSD05),0) AS B_AKSD05
                              FROM ( SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND OG_TP_CD = 'W01' /*P조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분=2차확정*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W010005', 'W010105')
                                      UNION ALL
                                     SELECT PRTNR_NO
                                          , FEE_ATC_VAL AS B_AKSD05  /* P조직 기준일 이전수수료 */
                                          , DSB_YM
                                       FROM TB_FEAM_FEE_DSB_DTL_IZ
                                      WHERE DSB_YM &lt; #{perfYm}
                                        AND DSB_YM &gt;= '201904'
                                        AND OG_TP_CD = 'W02' /*M조직*/
                                        AND FEE_TCNT_DV_CD = '02'  /*차수구분*/
                                   <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                        AND PRTNR_NO = #{prtnrNo}
                                   </if>
                                        AND FEE_CD IN ('W020080', 'W020081', 'W020082')
                                   )T1
                              LEFT OUTER JOIN (
                                     SELECT PRTNR_NO
                                          , MIN(UPGR_YM) AS UPGR_YM
                                       FROM TB_OGPS_TOPMR_PLAR_APLC_IZ
                                      WHERE OG_TP_CD = 'W01'
                                        AND QLF_DV_CD = '1'  /* 수석플래너 */
                                        AND UPGR_MCN > 0 /* 승급개월수가 0 이상, 강등되지 않은 */
                                        AND UPGR_DMTN_DV_CD = '1' /* 승급 */
                                        AND MNGT_YM IN (#{perfYm}, TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm},'YYYYMM'),-1),'YYYYMM')) /* 실적월, 실적 전월 조회 */
                                       GROUP BY PRTNR_NO
                                   ) T2
                                ON T2.PRTNR_NO = T1.PRTNR_NO
                             WHERE T1.DSB_YM &lt; NVL(T2.UPGR_YM,'000001')     /*수석플래너등록 이전*/
                             GROUP BY T1.PRTNR_NO
                          )MM
            ON A.PRTNR_NO = MM.PRTNR_NO
         WHERE A.BASE_YM = #{perfYm}
           AND A.OG_TP_CD = 'W01' /*P조직*/
       <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
           AND A.PRTNR_NO = #{prtnrNo}
       </if>
           AND ( A.PSTN_DV_CD = 7 OR A.PSTN_DV_CD = 15 )
    </select>

</mapper>
