<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.closing.payment.mapper.WdcaEtcAnticipationAmtMapper">
    <select id="selectMaxEtcAnticipationNo" resultType="String">
        SELECT TO_CHAR(NVL(MAX(TO_NUMBER(ETC_ATAM_NO))
,0)+1) AS ETC_ATAM_NO
          FROM TB_CBCL_ETC_ATAM_BAS
         WHERE ITG_DP_NO = #{itgDpNo}
    </select>

    <select id="selectMaxEtcAnticipationSn" resultType="Integer">
        SELECT NVL(MAX(ETC_ATAM_NO),0)+1 AS ETC_ATAM_NO
          FROM TB_CBCL_ETC_ATAM_PROCS_IZ
         WHERE ETC_ATAM_NO = #{etcAtamNo}
    </select>

    <insert id="insertEtcBasic">
        INSERT INTO TB_CBCL_ETC_ATAM_BAS(
            ETC_ATAM_NO
            , ETC_ATAM_OC_DT
            , ITG_DP_NO
            , ETC_ATAM_AMT
            , ETC_ATAM_TP_CD
            , ETC_ATAM_BLAM
            , CNTR_NO
            , CNTR_SN
            , KW_GRP_CO_CD
            , RVE_CD
            , ICHR_PRTNR_NO
            , CST_NO
            , PD_CD
            , SAP_DP_TP_CD
            , SAP_PD_DV_CD
            , SAP_PD_ATC_CD
            , PD_HCLSF_ID
            , PD_MCLSF_ID
            , PD_LCLSF_ID
            , PD_DCLSF_ID
            <include refid="COMMON.insertSystemField" />
        ) VALUES (
            #{etcAtamNo}
            ,#{etcAtamOcDt}
            ,#{itgDpNo}
            ,#{etcAtamAmt}
            ,#{etcAtamTpCd}
            ,#{etcAtamProcsAmt}
            ,#{cntrNo}
            ,#{cntrSn}
            ,#{kwGrpCoCd}
            ,#{rveCd}
            ,#{ichrPrtnrNo}
            ,#{cstNo}
            ,#{pdCd}
            ,#{sapDpTpCd}
            ,#{sapPdDvCd}
            ,#{sapPdAtcCd}
            ,#{pdHclsfId}
            ,#{pdMclsfId}
            ,#{pdLclsfId}
            ,#{pdDclsfId}
            <include refid="COMMON.insertSystemFieldValue" />
        )
    </insert>

    <insert id="insertEtcProcess">
        INSERT INTO TB_CBCL_ETC_ATAM_PROCS_IZ(
            ETC_ATAM_NO
            , ETC_ATAM_SN
            , ETC_ATAM_PROCS_CD
            , ETC_ATAM_PRCSDT
            , ETC_ATAM_PROCS_AMT
            , RVE_NO
            , RVE_SN
            , RFND_RCP_NO
            , RVE_DT
            , BIL_TN
            , PROCS_DV_CD
            , DP_DV_CD
            , SELL_TP_CD
            , SELL_TP_DTL_CD
            , DP_MES_CD
            , DP_TP_CD
            , CDCO_CD
            , CARD_APRNO
            , CRCDNO_ENCR
            , BNK_CD
            , DPR_NM
            , VAC_NO
            , VNCO_DV_CD
            <include refid="COMMON.insertSystemField" />
        ) VALUES (
            #{etcAtamNo}
            ,#{etcAtamSn}
            ,#{etcAtamProcsCd}
            ,#{etcAtamPrcsdt}
            ,#{etcAtamProcsAmt}
            ,#{rveNo}
            ,#{rveSn}
            ,#{rfndRcpNo}
            ,#{rveDt}
            ,#{bilTn}
            ,#{procsDvCd}
            ,#{dpDvCd}
            ,#{sellTpCd}
            ,#{sellTpDtlCd}
            ,#{dpMesCd}
            ,#{dpTpCd}
            ,#{cdcoCd}
            ,#{cardAprno}
            ,#{crcdnoEncr}
            ,#{bnkCd}
            ,#{dprNm}
            ,#{vacNo}
            ,#{vncoDvCd}
            <include refid="COMMON.insertSystemFieldValue" />
        )
    </insert>

    <update id="updateEtcBasic">
        UPDATE TB_CBCL_ETC_ATAM_BAS
           SET ETC_ATAM_BLAM = ETC_ATAM_BLAM - #{etcAtamProcsAmt}
               <include refid="COMMON.updateSystemField" />
         WHERE ETC_ATAM_NO = #{etcAtamNo}
    </update>
</mapper>
