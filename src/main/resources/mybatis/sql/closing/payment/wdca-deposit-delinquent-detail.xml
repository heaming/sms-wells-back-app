<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.closing.payment.mapper.WdcaDepositDelinquentDetailMapper">
    <select id="selectDepositDelinquentDetails" resultType="com.kyowon.sms.wells.web.closing.payment.dto.WdcaDepositDelinquentDetailDto$SearchRes">
        /* dlqDv(연체구분) ALL:전체, 1:정상, 2:연체 */
        /* inqrDv 1:총괄단, 2:지역단, 3:지점 */
        <if test='@MybatisUtils@equals(dlqDv, "ALL")'>
            SELECT T.OG_CD/*조직코드*/
                 , T.OG_NM/*조직명*/
                 <if test='@MybatisUtils@equals(inqrDv, "1")'>
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , '' AS DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , '' AS DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '2')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '3')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , T.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , T.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 , T.PRTNR_NO/*파트너번호*/
                 , T.PRTNR_KNM/*파트너명*/
                 , T.SELL_TP_CD                                                       AS SELL_TP_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_CD', T.SELL_TP_CD)         AS SELL_TP_NM
                 , T.SELL_TP_DTL_CD                                                     AS SELL_TP_DTL_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_DTL_CD', T.SELL_TP_DTL_CD)         AS SELL_TP_DTL_NM
                 , SUM(T.THM_NW_ACC_N + T.NOM_ACC_N + T.DLQ_ACC_N) AS TOT_ACC_N/* 총 계정수 : 당월 신규, 정상, 연체 계정수 합 */
                 , SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT + T.DLQ_AMT) AS UCAM_TAM /* 미수금 총액 : 당월 신규/정상 미수금액+연체금액합 */
                 , SUM(T.THM_NW_UC_AMT) AS THM_NW_UC_AMT
                 , SUM(T.THM_NW_ACC_N) AS THM_NW_ACC_N
                 , SUM(T.THM_NW_DP_AMT) AS THM_NW_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT)) * 100) AS THM_NW_DP_RT /* 당월 신규 입금율 : (당월신규입금계/당원신규미수금계) * 100*/
                 , SUM(T.NOM_UC_AMT) AS NOM_UC_AMT
                 , SUM(T.NOM_ACC_N) AS NOM_ACC_N
                 , SUM(T.NOM_DP_AMT) AS NOM_DP_AMT
                 , DECODE(SUM(T.NOM_UC_AMT), 0, 0, (SUM(T.NOM_DP_AMT) / SUM(T.NOM_UC_AMT)) * 100) AS NOM_DP_RT
                 , SUM(T.DLQ_AMT) AS DLQ_AMT
                 , SUM(T.DLQ_ACC_N) AS DLQ_ACC_N
                 , SUM(T.DLQ_DP_AMT) AS DLQ_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT), 0, 0, (SUM(T.DLQ_AMT - T.DLQ_DP_AMT) / SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT)) * 100) AS UC_CPR_DLQ_RT
                 , SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT + T.DLQ_DP_AMT) AS TOT_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT), 0, 0, (SUM(T.NOM_DP_AMT + T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT)) * 100) AS DP_RT
                 , SUM(T.BIL_AMT) AS BIL_AGG
                 , SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT + T.DLQ_DP_AMT) AS DP_AGG
                 , DECODE(SUM(T.BIL_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT + T.DLQ_DP_AMT) / SUM(T.BIL_AMT)) * 100) AS DLQ_RT_SUM
              FROM (
                    /*당월 신규 : 계약기본T CNTR_CNFM_DTM 확정일시가 당월이고 CNTR_CAN_DTM 취소일시가 NULL인 것들이 대상*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD       /*판매유형코드*/
                         , A.SELL_TP_DTL_CD   /*판매유형상세코드*/
                         , A.FNL_AMT AS THM_NW_UC_AMT
                         , 1 AS THM_NW_ACC_N
                         , D.RVE_AMT AS THM_NW_DP_AMT
                         , 0 AS NOM_UC_AMT
                         , 0 AS NOM_ACC_N
                         , 0 AS NOM_DP_AMT
                         , 0 AS DLQ_AMT
                         , 0 AS DLQ_ACC_N
                         , 0 AS DLQ_DP_AMT
                         , 0 AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_RVDW_RVE_DTL D/*수납상세*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.CNTR_CNFM_DTM BETWEEN #{perfYm}||'00000000' AND #{perfYm}||'99999999'/*계약확정일시 - 당월*/
                       AND B.CNTR_CAN_DTM IS NULL  /*취소일시 - NULL*/
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = #{perfYm}
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND D.DP_DV_CD = '1'/*입금구분코드 - 1:입금*/
                       AND D.RVE_DV_CD = '01'/*수납구분코드 - 01:계약(청약)금*/
                       AND D.RVE_DT BETWEEN #{perfYm}||'01' AND #{perfYm}||'31'/*수납일자 - 당월*/
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                     UNION ALL
                    /*정상 전월마감*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD/*판매유형코드*/
                         , A.SELL_TP_DTL_CD /*판매유형상세코드*/
                         , 0 AS THM_NW_UC_AMT
                         , 0 AS THM_NW_ACC_N
                         , 0 AS THM_NW_DP_AMT
                         , D.EOT_UC_AMT AS NOM_UC_AMT
                         , 1 AS NOM_ACC_N
                         , D.THM_ISTM_TOT_DP_AMT AS NOM_DP_AMT
                         , 0 AS DLQ_AMT
                         , 0 AS DLQ_ACC_N
                         , 0 AS DLQ_DP_AMT
                         , D.SL_AGG_AMT AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_CBCL_WELLS_SL_MM_CL_IZ D/*WELLS월마감매출내역*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND D.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND (D.CNTR_NO, D.CNTR_SN) NOT IN (SELECT CNTR_NO, CNTR_SN
                                                            FROM TB_CBCL_DLQ_BAS_HIST/*연체기본이력*/
                                                           WHERE DLQ_SN = 1
                                                             AND PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM'))
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                     UNION ALL
                     /*연체 전월마감*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD       /*판매유형코드*/
                         , A.SELL_TP_DTL_CD   /*판매유형상세코드*/
                         , 0 AS THM_NW_UC_AMT
                         , 0 AS THM_NW_ACC_N
                         , 0 AS THM_NW_DP_AMT
                         , 0 AS NOM_UC_AMT
                         , 0 AS NOM_ACC_N
                         , 0 AS NOM_DP_AMT
                         , D.EOT_DLQ_AMT AS DLQ_AMT
                         , 1 AS DLQ_ACC_N
                         , D.THM_DLQ_DP_SUM_AMT AS 입금금액
                         , 0 AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_CBCL_DLQ_BAS_HIST D/*연체기본이력*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND D.DLQ_SN = 1
                       AND D.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                   ) T
             <if test='@MybatisUtils@equals(inqrDv, "1")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD
             </if>
             <if test="@MybatisUtils@equals(inqrDv, '2')">
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD
             </if>
             <if test="@MybatisUtils@equals(inqrDv, '3')">
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.DGR3_LEVL_OG_CD, T.DGR3_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD, T.DGR3_LEVL_OG_CD
             </if>
        </if>
        <if test='@MybatisUtils@equals(dlqDv, "1")'>
            --3) 총괄단 정상
            SELECT T.OG_CD/*조직코드*/
                 , T.OG_NM/*조직명*/
                 <if test='@MybatisUtils@equals(inqrDv, "1")'>
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , '' AS DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , '' AS DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '2')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '3')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , T.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , T.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 , T.PRTNR_NO/*파트너번호*/
                 , T.PRTNR_KNM/*파트너명*/
                 , T.SELL_TP_CD                                                       AS SELL_TP_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_CD', T.SELL_TP_CD)         AS SELL_TP_NM
                 , T.SELL_TP_DTL_CD                                                     AS SELL_TP_DTL_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_DTL_CD', T.SELL_TP_DTL_CD)         AS SELL_TP_DTL_NM
                 , SUM(T.THM_NW_ACC_N + T.NOM_ACC_N) AS TOT_ACC_N/* 총 계정수 : 당월 신규, 정상, 연체 계정수 합 */
                 , SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT) AS UCAM_TAM /* 미수금 총액 : 당월 신규/정상 미수금액+연체금액합 */
                 , SUM(T.THM_NW_UC_AMT) AS THM_NW_UC_AMT
                 , SUM(T.THM_NW_ACC_N) AS THM_NW_ACC_N
                 , SUM(T.THM_NW_DP_AMT) AS THM_NW_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT)) * 100) AS THM_NW_DP_RT /* 당월 신규 입금율 : (당월신규입금계/당원신규미수금계) * 100*/
                 , SUM(T.NOM_UC_AMT) AS NOM_UC_AMT
                 , SUM(T.NOM_ACC_N) AS NOM_ACC_N
                 , SUM(T.NOM_DP_AMT) AS NOM_DP_AMT
                 , DECODE(SUM(T.NOM_UC_AMT), 0, 0, (SUM(T.NOM_DP_AMT) / SUM(T.NOM_UC_AMT)) * 100) AS NOM_DP_RT
                 , 0 AS DLQ_AMT
                 , 0 AS DLQ_ACC_N
                 , 0 AS DLQ_DP_AMT
                 , 0 AS UC_CPR_DLQ_RT
                 , SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT) AS TOT_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT), 0, 0, (SUM(T.NOM_DP_AMT + T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT + T.NOM_UC_AMT)) * 100) AS DP_RT
                 , SUM(T.BIL_AMT) AS BIL_AGG
                 , SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT) AS DP_AGG
                 , DECODE(SUM(T.BIL_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT) / SUM(T.BIL_AMT)) * 100) AS DLQ_RT_SUM
              FROM (
                    /*당월 신규 : 계약기본T CNTR_CNFM_DTM 확정일시가 당월이고 CNTR_CAN_DTM 취소일시가 NULL인 것들이 대상*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD       /*판매유형코드*/
                         , A.SELL_TP_DTL_CD   /*판매유형상세코드*/
                         , A.FNL_AMT AS THM_NW_UC_AMT
                         , 1 AS THM_NW_ACC_N
                         , D.RVE_AMT AS THM_NW_DP_AMT
                         , 0 AS NOM_UC_AMT
                         , 0 AS NOM_ACC_N
                         , 0 AS NOM_DP_AMT
                         , 0 AS DLQ_AMT
                         , 0 AS DLQ_ACC_N
                         , 0 AS DLQ_DP_AMT
                         , 0 AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_RVDW_RVE_DTL D/*수납상세*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.CNTR_CNFM_DTM BETWEEN #{perfYm}||'00000000' AND #{perfYm}||'99999999'/*계약확정일시 - 당월*/
                       AND B.CNTR_CAN_DTM IS NULL/*취소일시 - NULL*/
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = #{perfYm}
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND D.DP_DV_CD = '1'/*입금구분코드 - 1:입금*/
                       AND D.RVE_DV_CD = '01'/*수납구분코드 - 01:계약(청약)금*/
                       AND D.RVE_DT BETWEEN #{perfYm}||'01' AND #{perfYm}||'31'/*수납일자 - 당월*/
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                     UNION ALL
                    /*정상 전월마감*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD/*판매유형코드*/
                         , A.SELL_TP_DTL_CD /*판매유형상세코드*/
                         , 0 AS THM_NW_UC_AMT
                         , 0 AS THM_NW_ACC_N
                         , 0 AS THM_NW_DP_AMT
                         , D.EOT_UC_AMT AS NOM_UC_AMT
                         , 1 AS NOM_ACC_N
                         , D.THM_ISTM_TOT_DP_AMT AS NOM_DP_AMT
                         , 0 AS DLQ_AMT
                         , 0 AS DLQ_ACC_N
                         , 0 AS DLQ_DP_AMT
                         , D.SL_AGG_AMT AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_CBCL_WELLS_SL_MM_CL_IZ D/*WELLS월마감매출내역*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND D.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND (D.CNTR_NO, D.CNTR_SN) NOT IN (SELECT CNTR_NO, CNTR_SN
                                                            FROM TB_CBCL_DLQ_BAS_HIST/*연체기본이력*/
                                                           WHERE DLQ_SN = 1 AND PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM'))
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                   ) T
             <if test='@MybatisUtils@equals(inqrDv, "1")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD
             </if>
             <if test='@MybatisUtils@equals(inqrDv, "2")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD
             </if>
             <if test='@MybatisUtils@equals(inqrDv, "3")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.DGR3_LEVL_OG_CD, T.DGR3_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD, T.DGR3_LEVL_OG_CD
             </if>
        </if>
        <if test='@MybatisUtils@equals(dlqDv, "2")'>
            --2) 총괄단 연체
            SELECT T.OG_CD/*조직코드*/
                 , T.OG_NM/*조직명*/
                 <if test='@MybatisUtils@equals(inqrDv, "1")'>
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , '' AS DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , '' AS DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '2')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , '' AS DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , '' AS DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 <if test="@MybatisUtils@equals(inqrDv, '3')">
                 , T.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                 , T.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                 , T.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                 , T.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                 , T.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                 , T.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                 </if>
                 , T.PRTNR_NO/*파트너번호*/
                 , T.PRTNR_KNM/*파트너명*/
                 , T.SELL_TP_CD                                                       AS SELL_TP_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_CD', T.SELL_TP_CD)       AS SELL_TP_NM
                 , T.SELL_TP_DTL_CD                                                   AS SELL_TP_DTL_CD
                 , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_DTL_CD', T.SELL_TP_DTL_CD)       AS SELL_TP_DTL_NM
                 , SUM(T.THM_NW_ACC_N + T.DLQ_ACC_N) AS TOT_ACC_N /* 총 계정수 : 당월 신규, 정상, 연체 계정수 합 */
                 , SUM(T.THM_NW_UC_AMT + T.DLQ_AMT) AS UCAM_TAM /* 미수금 총액 : 당월 신규/정상 미수금액+연체금액합 */
                 , SUM(T.THM_NW_UC_AMT) AS THM_NW_UC_AMT
                 , SUM(T.THM_NW_ACC_N) AS THM_NW_ACC_N
                 , SUM(T.THM_NW_DP_AMT) AS THM_NW_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT)) * 100) AS THM_NW_DP_RT /* 당월 신규 입금율 : (당월신규입금계/당원신규미수금계) * 100*/
                 , 0 AS NOM_UC_AMT
                 , 0 AS NOM_ACC_N
                 , 0 AS NOM_DP_AMT
                 , 0 AS NOM_DP_RT
                 , SUM(T.DLQ_AMT) AS DLQ_AMT
                 , SUM(T.DLQ_ACC_N) AS DLQ_ACC_N
                 , SUM(T.DLQ_DP_AMT) AS DLQ_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT), 0, 0, (SUM(T.DLQ_AMT - T.DLQ_DP_AMT) / SUM(T.THM_NW_UC_AMT)) * 100) AS UC_CPR_DLQ_RT
                 , SUM(T.THM_NW_DP_AMT + T.NOM_DP_AMT + T.DLQ_DP_AMT) AS TOT_DP_AMT
                 , DECODE(SUM(T.THM_NW_UC_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT) / SUM(T.THM_NW_UC_AMT)) * 100) AS DP_RT
                 , SUM(T.BIL_AMT) AS BIL_AGG
                 , SUM(T.THM_NW_DP_AMT + T.DLQ_DP_AMT) AS DP_AGG
                 , DECODE(SUM(T.BIL_AMT), 0, 0, (SUM(T.THM_NW_DP_AMT + T.DLQ_DP_AMT) / SUM(T.BIL_AMT)) * 100) AS DLQ_RT_SUM
              FROM (
                    /*당월 신규 : 계약기본T CNTR_CNFM_DTM 확정일시가 당월이고 CNTR_CAN_DTM 취소일시가 NULL인 것들이 대상*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD       /*판매유형코드*/
                         , A.SELL_TP_DTL_CD   /*판매유형상세코드*/
                         , A.FNL_AMT AS THM_NW_UC_AMT
                         , 1 AS THM_NW_ACC_N
                         , D.RVE_AMT AS THM_NW_DP_AMT
                         , 0 AS NOM_UC_AMT
                         , 0 AS NOM_ACC_N
                         , 0 AS NOM_DP_AMT
                         , 0 AS DLQ_AMT
                         , 0 AS DLQ_ACC_N
                         , 0 AS DLQ_DP_AMT
                         , 0 AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_RVDW_RVE_DTL D/*수납상세*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.CNTR_CNFM_DTM BETWEEN #{perfYm}||'00000000' AND #{perfYm}||'99999999'/*계약확정일시 - 당월*/
                       AND B.CNTR_CAN_DTM IS NULL   /*취소일시 - NULL*/
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = #{perfYm}
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND D.DP_DV_CD = '1'/*입금구분코드 - 1:입금*/
                       AND D.RVE_DV_CD = '01'/*수납구분코드 - 01:계약(청약)금*/
                       AND D.RVE_DT BETWEEN #{perfYm}||'01' AND #{perfYm}||'31'/*수납일자 - 당월*/
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                     UNION ALL
                    /*연체 전월마감*/
                    SELECT E.OG_CD/*조직코드*/
                         , E.OG_NM/*조직명*/
                         <if test='@MybatisUtils@equals(inqrDv, "1")'>
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '2')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         </if>
                         <if test="@MybatisUtils@equals(inqrDv, '3')">
                         , E.DGR1_LEVL_OG_CD/*1차레벨조직코드*/
                         , E.DGR1_LEVL_OG_NM/*1차레벨조직명*/
                         , E.DGR2_LEVL_OG_CD/*2차레벨조직코드*/
                         , E.DGR2_LEVL_OG_NM/*2차레벨조직명*/
                         , E.DGR3_LEVL_OG_CD/*3차레벨조직코드*/
                         , E.DGR3_LEVL_OG_NM/*3차레벨조직명*/
                         </if>
                         , C.PRTNR_NO/*파트너번호*/
                         , C.PRTNR_KNM/*파트너명*/
                         , A.SELL_TP_CD       /*판매유형코드*/
                         , A.SELL_TP_DTL_CD   /*판매유형상세코드*/
                         , 0 AS THM_NW_UC_AMT
                         , 0 AS THM_NW_ACC_N
                         , 0 AS THM_NW_DP_AMT
                         , 0 AS NOM_UC_AMT
                         , 0 AS NOM_ACC_N
                         , 0 AS NOM_DP_AMT
                         , D.EOT_DLQ_AMT AS DLQ_AMT
                         , 1 AS DLQ_ACC_N
                         , D.THM_DLQ_DP_SUM_AMT AS DLQ_DP_AMT
                         , 0 AS BIL_AMT
                      FROM TB_SSCT_CNTR_DTL A /*계약상세*/
                         , TB_SSCT_CNTR_BAS B/*계약기본*/
                         , TB_OGBS_MM_PRTNR_IZ C/*월파트너내역*/
                         , TB_CBCL_DLQ_BAS_HIST D/*연체기본이력*/
                         , TB_OGBS_MM_OG_IZ E/*월조직내역*/
                     WHERE A.CNTR_NO = B.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
                       AND A.CNTR_NO = #{cntrNo}
                       AND A.CNTR_SN = #{cntrSn}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
                       /*화면-판매유형 선택 시(전체 제외)-시작*/
                       AND A.SELL_TP_CD = #{sellTpCd}
                       /*화면-판매유형 선택 시(전체 제외)-종료*/
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
                       AND A.SELL_TP_DTL_CD = #{sellTpDtlCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
                       AND B.COPN_DV_CD = #{copnDvCd} /*개인법인구분*/
                       </if>
                       AND B.SELL_PRTNR_NO = C.PRTNR_NO
                       AND C.BASE_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       AND C.OG_TP_CD = E.OG_TP_CD
                       AND C.OG_ID = E.OG_ID
                       AND E.BASE_YM = C.BASE_YM
                       AND E.OG_LEVL_DV_CD = #{inqrDv}
                       AND A.CNTR_NO = D.CNTR_NO
                       AND A.CNTR_SN = D.CNTR_SN
                       AND D.DLQ_SN = 1
                       AND D.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                       <if test="@MybatisUtils@isNotEmpty(dlqMcnt) and dlqMcnt.size() > 0">
                       AND
                           <foreach collection="dlqMcnt" item="dlqMcnt" open="(" close=")" separator="OR">
                               <if test='!@MybatisUtils@equals(dlqMcnt, "7")'>
                               /*0~6까지는 아래 쿼리*/
                               NVL(D.DLQ_MCN, 0) = #{dlqMcnt}
                               </if>
                               <if test='@MybatisUtils@equals(dlqMcnt, "7")'>
                               /*7이면 아래 쿼리로 변경*/
                               NVL(D.DLQ_MCN, 0) > #{dlqMcnt}
                               </if>
                           </foreach>
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
                       AND E.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
                       AND E.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
                       </if>
                       <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
                       AND E.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
                       AND B.SELL_OG_TP_CD = #{ogTp}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
                       AND C.PRTNR_NO = #{prtnrNo}
                       </if>
                       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
                       AND B.CNTR_CST_NO = #{cntrCstNo}
                       </if>
                       AND A.DTA_DL_YN = 'N'
                       AND B.DTA_DL_YN = 'N'
                       AND C.DTA_DL_YN = 'N'
                       AND D.DTA_DL_YN = 'N'
                       AND E.DTA_DL_YN = 'N'
                   ) T
             <if test='@MybatisUtils@equals(inqrDv, "1")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD
             </if>
             <if test='@MybatisUtils@equals(inqrDv, "2")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD
             </if>
             <if test='@MybatisUtils@equals(inqrDv, "3")'>
             GROUP BY T.SELL_TP_CD, T.SELL_TP_DTL_CD, T.OG_CD, T.OG_NM, T.DGR1_LEVL_OG_CD, T.DGR1_LEVL_OG_NM, T.DGR2_LEVL_OG_CD, T.DGR2_LEVL_OG_NM, T.DGR3_LEVL_OG_CD, T.DGR3_LEVL_OG_NM, T.PRTNR_NO, T.PRTNR_KNM
             ORDER BY T.OG_CD, T.DGR1_LEVL_OG_CD, T.DGR2_LEVL_OG_CD, T.DGR3_LEVL_OG_CD
             </if>
        </if>
    </select>

    <select id="selectDepositDelinquentContractPages" resultType="com.kyowon.sms.wells.web.closing.payment.dto.WdcaDepositDelinquentDetailDto$SearchContractRes">
        SELECT A1.SELL_TP_CD                                                         AS SELL_TP_CD       /*판매유형코드*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_CD', A1.SELL_TP_CD)         AS SELL_TP_NM     /*판매유형코드명*/
             , A1.SELL_TP_DTL_CD                                                     AS SELL_TP_DTL_CD   /*판매유형상세코드*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'SELL_TP_DTL_CD', A1.SELL_TP_DTL_CD) AS SELL_TP_DTL_NM /*판매유형상세코드명*/
             , A1.CNTR_NO || '-' || A1.CNTR_SN                                       AS CNTR_DTL_NO       /*계약번호+계약일련번호*/
             , A2.CNTR_CST_NO                                                        AS CNTR_CST_NO       /*계약고객번호*/
             , A3.CST_KNM                                                            AS CST_KNM             /*고객한글명*/
             , A6.SL_CL_DT                                                           AS SL_CL_DT           /*매출마감일자*/
             , A1.BASE_PD_CD                                                         AS BASE_PD_CD           /*기준상품코드*/
             , A4.PD_NM                                                              AS PD_NM             /*상품명*/
             , NVL(A9.DLQ_MCN, 0)                                                    AS DLQ_MCN           /*연체개월수*/
             , NVL(A9.EOT_DLQ_AMT, 0)                                                AS EOT_DLQ_AMT           /*기말연체금액*/
             , A6.SL_AGG_AMT                                                         AS BILLING_AMOUNT         /*매출누계금액*/
             , 0                                                                     AS DEPOSIT_AMOUNT
             , 0                                                                     AS UNCOLLECTED_AMOUNT
             , F_CMZ_CD_NM(#{session.tenantId}, 'DP_TP_CD', A5.DP_TP_CD)             AS DP_TP_CD           /*입금유형코드*/
             , A5.MPY_BSDT                                                           AS MPY_BSDT         /*납부기준일자*/
             , ''                                                                    AS APPROVE_CODE           /*입/출금에 문의*/
             , ''                                                                    AS NON_PAYMENT_REASON         /*입/출금에 문의*/
             , A6.SL_AGG_AMT                                                         AS SL_AGG_AMT           /*매출누계금액*/
             , 0                                                                     AS DEPOSIT_AGGREGATE
             , A7.PRTNR_KNM                                                          AS PRTNR_KNM           /*파트너한글명*/
             , A7.PRTNR_NO                                                           AS PRTNR_NO         /*파트너번호*/
             , A7.FST_CNTR_DT                                                        AS FST_CNTR_DT   /*최초계약일자*/
             , A7.PSTN_DV_CD                                                         AS PSTN_DV_CD         /*직급구분코드*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'RSB_DV_CD', A7.RSB_DV_CD)           AS RSB_DV_CD         /*직책구분코드*/
             , A8.DGR3_LEVL_OG_CD                                                    AS DGR3_LEVL_OG_CD               /*3차레벨조직코드*/
             , A8.DGR3_LEVL_DG_PRTNR_NM                                              AS DGR3_LEVL_DG_PRTNR_NM           /*3차레벨대표파트너명*/
             , A8.BLD_NM                                                             AS BLD_NM             /*빌딩명*/
             , A8.DGR1_LEVL_OG_CD                                                    AS DGR1_LEVL_OG_CD             /*1차레벨조직코드*/
             , A8.DGR2_LEVL_OG_CD                                                    AS DGR2_LEVL_OG_CD             /*2차레벨조직코드*/
             , CASE /*구매자가 직원인지를 판단-당시 구매자의 재직여부를 출력*/
                    WHEN A8.DGR1_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NULL THEN '내부(총괄)-재직'
                    WHEN A8.DGR1_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NOT NULL THEN '내부(총괄)-퇴사'
                    WHEN A8.DGR2_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NULL THEN '내부(지역)-재직'
                    WHEN A8.DGR2_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NOT NULL THEN '내부(지역)-퇴사'
                    WHEN A8.DGR3_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NULL THEN '내부(지점)-재직'
                    WHEN A8.DGR3_LEVL_DG_PRTNR_NO = A3.PRTNR_NO AND A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NOT NULL THEN '내부(지점)-퇴사'
                    WHEN A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NULL THEN '내부-재직'
                    WHEN A7.PRTNR_NO = A3.PRTNR_NO AND A7.CLTN_DT IS NOT NULL THEN '내부-퇴사'
                    ELSE '' END                                                      AS INSIDE_PURCHASE
             , A10.CLCTAM_PRTNR_NO                                                   AS CLCTAM_PRTNR_NO         /*집금파트너번호*/
             , A11.PRTNR_KNM                                                         AS CLCTAM_PRTNR_KNM         /*파트너한글명*/
             , A11.CRP_MPNO                                                          AS CRP_MPNO /*법인휴대전화번호*/
             , A1.MM_ISTM_AMT                                                        AS MM_ISTM_AMT           /*월할부금액*/
          FROM TB_SSCT_CNTR_DTL A1 /*계약상세*/
         INNER JOIN TB_SSCT_CNTR_BAS A2 /*계약기본*/
            ON A2.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A2.CNTR_NO = A1.CNTR_NO
         INNER JOIN TB_CUBS_CST_BAS A3 /*고객기본*/
            ON A3.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A3.CST_NO    = A2.CNTR_CST_NO
         INNER JOIN TB_PDBS_PD_BAS A4 /*상품기본*/
            ON A4.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A4.PD_CD     = A1.BASE_PD_CD
         INNER JOIN TB_SSCT_CNTR_STLM_BAS A5 /*계약결제기본*/
            ON A5.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A5.CNTR_NO   = A1.CNTR_NO
         INNER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ A6 /*WELLS매출월마감내역*/
            ON A6.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A6.CNTR_NO = A1.CNTR_NO
           AND A6.CNTR_SN = A1.CNTR_SN
           AND A6.SL_CL_YM = #{perfYm}
         INNER JOIN TB_OGBS_MM_PRTNR_IZ A7 /*월파트너내역*/
            ON A7.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A7.BASE_YM   = #{perfYm}
           AND A7.OG_TP_CD = A2.SELL_OG_TP_CD
           AND A7.PRTNR_NO = A2.SELL_PRTNR_NO
         INNER JOIN TB_OGBS_MM_OG_IZ A8 /*월조직내역*/
            ON A8.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A8.OG_ID = A7.OG_ID
           AND A8.BASE_YM = #{perfYm}
          LEFT OUTER JOIN TB_CBCL_DLQ_BAS_HIST A9 /*연체기본이력*/
            ON A9.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A9.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{perfYm}||'01', 'YYYYMMDD'), -1), 'YYYYMM')
           AND A9.CNTR_NO = A1.CNTR_NO
           AND A9.CNTR_SN = A1.CNTR_SN
           AND A9.DLQ_SN = 1 /*해당월의 연체책정된 값 출력*/
          LEFT OUTER JOIN TB_CBBO_BND_CNTR_BAS A10 /*채권계약기본*/
            ON A10.DTA_DL_YN = 'N' /*데이터삭제여부*/
           AND A10.BASE_YM = #{perfYm}
           AND A10.CNTR_NO = A1.CNTR_NO
           AND A10.CNTR_SN = A1.CNTR_SN
          LEFT OUTER JOIN (SELECT PRTNR_NO
                                , PRTNR_KNM /*파트너한글명*/
                                , CRP_MPNO  /*법인휴대전화번호*/
                             FROM TB_CBBO_CLCTAM_PRTNR_DTL /*집금파트너상세*/
                            WHERE DTA_DL_YN = 'N' /*데이터삭제여부*/
                              AND (SYSDATE BETWEEN BIZ_STRTDT AND BIZ_ENDDT)
                              AND CLCTAM_MNGT_YN = 'Y'
                              AND ROWNUM = 1
                           ) A11
            ON A11.PRTNR_NO = A10.CLCTAM_PRTNR_NO
         WHERE 1=1
           AND A1.DTA_DL_YN  = 'N' /*데이터삭제여부*/
           <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
           /*화면-판매유형 선택 시(전체 제외)-시작*/
           AND A1.SELL_TP_CD = #{sellTpCd}
           /*화면-판매유형 선택 시(전체 제외)-종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(sellTpDtlCd) and !@MybatisUtils@equals(sellTpDtlCd, 'ALL')">
           AND A1.SELL_TP_DTL_CD = #{sellTpDtlCd}
           </if>
           <if test="@MybatisUtils@isNotEmpty(cntrNo) and @MybatisUtils@isNotEmpty(cntrSn)">
           /*화면-계약상세번호 입력 시-시작*/
           AND A1.CNTR_NO = #{cntrNo}
           AND A1.CNTR_SN = #{cntrSn}
           /*화면-계약상세번호 입력 시-종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(copnDvCd) and !@MybatisUtils@equals(copnDvCd, 'ALL')">
           /*화면-개인/법인구분 선택 시(전체 제외)-시작*/
           AND A2.COPN_DV_CD = #{copnDvCd}
           /*화면-개인/법인구분 선택 시(전체 제외)-종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
           /*화면-고객번호 입력 시 - 시작*/
           AND A2.CNTR_CST_NO = #{cntrCstNo}
           /*화면-고객번호 입력 시 - 종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(dlqDv) and !@MybatisUtils@equals(dlqDv, 'ALL')">
           /*화면-연체구분 선택 시 (전체 제외)-시작*/
               <if test='@MybatisUtils@equals(dlqDv, "1")'>
               /*화면-연체구분 정상 선택 시 - 시작*/
               AND NVL(A9.EOT_DLQ_AMT, 0) = 0
               /*화면-연체구분 정상 선택 시 - 종료*/
               </if>
               <if test='@MybatisUtils@equals(dlqDv, "2")'>
               /*화면-연체구분 연체 선택 시 연체 개월을 선택할 수 있음- 시작*/
               AND NVL(A9.EOT_DLQ_AMT, 0) > 0
               <if test="@MybatisUtils@isNotEmpty(dlqMcnt) and dlqMcnt.size() > 0">
               AND
               <foreach collection="dlqMcnt" item="dlqMcnt" open="(" close=")" separator="OR">
                   <if test='!@MybatisUtils@equals(dlqMcnt, "7")'>
                   /*0~6까지는 아래 쿼리*/
                   NVL(A9.DLQ_MCN, 0) = #{dlqMcnt}
                   </if>
                   <if test='@MybatisUtils@equals(dlqMcnt, "7")'>
                   /*7이면 아래 쿼리로 변경*/
                   NVL(A9.DLQ_MCN, 0)  >= #{dlqMcnt}
                   </if>
                </foreach>
               </if>
               /*화면-연체구분 연체 선택 시 연체 개월을 선택할 수 있음- 종료*/
               </if>
           /*화면-연체구분 선택 시 (전체 제외)-종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(prtnrNo)">
           /*화면-번호 입력 시-시작*/
           AND A7.PRTNR_NO = #{prtnrNo}
           /*화면-번호 입력 시-종료*/
           </if>
           <if test='@MybatisUtils@isNotEmpty(dgr1LevlOgCd)'>
           /*화면-조직레벨 선택 시-시작*/
           /*총괄단 선택 시*/
           AND A8.DGR1_LEVL_OG_ID = #{dgr1LevlOgCd}
           </if>
           <if test='@MybatisUtils@isNotEmpty(dgr2LevlOgCd)'>
           /*지역단 선택 시*/
           AND A8.DGR2_LEVL_OG_ID = #{dgr2LevlOgCd}
           </if>
           <if test='@MybatisUtils@isNotEmpty(dgr3LevlOgCd)'>
           /*지점 선택 시*/
           AND A8.DGR3_LEVL_OG_ID = #{dgr3LevlOgCd}
           /*화면-조직레벨 선택 시-종료*/
           </if>
           <if test="@MybatisUtils@isNotEmpty(ogTp) and !@MybatisUtils@equals(ogTp, 'ALL')">
           /*화면-조직유형 선택 시-시작*/
           AND A2.SELL_OG_TP_CD = #{ogTp}
           /*화면-조직유형 선택 시-종료*/
           </if>
    </select>
</mapper>
