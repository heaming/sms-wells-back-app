<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.closing.payment.mapper.WdcaBusinessAnticipationAmtMapper">
    <select id="selectBusinessBasicCheck" resultType="Integer">
        SELECT COUNT(1) AS CNT
          FROM TB_CBCL_BZNS_ATAM_BAS
         WHERE RVE_NO = #{rveNo}
           AND RVE_SN = #{rveSn}
    </select>

    <insert id="insertBusinessBasic">
        INSERT INTO TB_CBCL_BZNS_ATAM_BAS(
            RVE_NO
            , RVE_SN
            , DP_CL_DT
            , CNTR_NO
            , CNTR_SN
            , KW_GRP_CO_CD
            , RVE_CD
            , ICHR_PRTNR_NO
            , RVE_AMT
            , CST_NO
            , BZNS_ATAM_BLAM
            , SAP_DP_TP_CD
            , SAP_PD_DV_CD
            , SAP_PD_ATC_CD
            , BNK_CD
            , CDCO_CD
            , ETC_ATAM_NO
            , ETC_ATAM_SN
            <include refid="COMMON.insertSystemField" />
        ) VALUES (
            #{rveNo}
            , #{rveSn}
            , #{dpClDt}
            , #{cntrNo}
            , #{cntrSn}
            , #{kwGrpCoCd}
            , #{rveCd}
            , #{ichrPrtnrNo}
            , #{rveAmt}
            , #{cstNo}
            , #{bznsAtamBlam}
            , #{sapDpTpCd}
            , #{sapPdDvCd}
            , #{sapPdAtcCd}
            , #{bnkCd}
            , #{cdcoCd}
            , #{etcAtamNo}
            , #{etcAtamSn}
            <include refid="COMMON.insertSystemFieldValue" />
        )
    </insert>

    <insert id="insertBusinessProcess">
        INSERT INTO TB_CBCL_BZNS_ATAM_PROCS_IZ(
            RVE_NO
            , RVE_SN
            , BZNS_ATAM_SN
            , BZNS_ATAM_PROCS_CD
            , BZNS_ATAM_PROCS_AMT
            <include refid="COMMON.insertSystemField" />
        ) VALUES (
            #{rveNo}
            , #{rveSn}
            , (SELECT NVL(MAX(BZNS_ATAM_SN),0)+1
                 FROM TB_CBCL_BZNS_ATAM_PROCS_IZ
                WHERE RVE_NO = #{rveNo}
                  AND RVE_SN = #{rveSn})
            , #{bznsAtamProcsCd}
            , #{bznsAtamProcsAmt}
            <include refid="COMMON.insertSystemFieldValue" />
        )
    </insert>

    <update id="updateBusinessBasic">
        UPDATE TB_CBCL_BZNS_ATAM_BAS
           SET BZNS_ATAM_BLAM = BZNS_ATAM_BLAM - #{bznsAtamProcsAmt}    /*영업선수금잔액 = 기존 영업선수금잔액 - 입력받은 영업선수금처리금액*/
               <include refid="COMMON.updateSystemField" />
         WHERE RVE_NO = #{rveNo}
           AND RVE_SN = #{rveSn}
    </update>
</mapper>
