<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.closing.sales.mapper.WdcbProductSalesDetailMapper">
    <select id="selectProductSalesSinglePaymentDetails" resultType="com.kyowon.sms.wells.web.closing.sales.dto.WdcbProductSalesDetailDto$SearchSingleRes">
    SELECT #{taskDiv} AS TASK_DIV
         , T1.SELL_TP_CD
         , T1.PD_DTL_CD
         , #{sellDv} AS SELL_DV
         , T1.SL_DT
         , T1.CNTR_NO || T1.CNTR_SN AS CNTR_DTL_NO
         , T1.CST_NO
         , T2.CST_KNM
         , T1.SELL_QTY AS NORMAL_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS NORMAL_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS NORMAL_MM_ISTM_PCAM_AMT
         , 0 AS NORMAL_VAT
         , T1.NOM_SL_AMT - 0 AS NORMAL_PUR_SL_AMT
         , T1.SELL_QTY AS CHG_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CHG_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CHG_MM_ISTM_PCAM_AMT
         , 0 AS CHG_VAT
         , T1.SL_CTR_AMT - 0 AS CHG_PUR_SL_AMT
         , T1.SELL_QTY AS CAN_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CAN_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CAN_MM_ISTM_PCAM_AMT
         , 0 AS CAN_VAT
         , T1.SL_CAN_AMT - 0 AS CAN_PUR_SL_AMT
         , T1.SELL_QTY AS SUM_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS SUM_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS SUM_MM_ISTM_PCAM_AMT
         , T1.SL_SUM_VAT AS SUM_VAT
         , T1.THM_SL_SUM_AMT - SL_SUM_VAT AS SUM_PUR_SL_AMT
      FROM TB_CBCL_WELLS_SL_MM_CL_IZ T1
     INNER JOIN TB_CUBS_CST_BAS T2
        ON T1.CST_NO = T2.CST_NO
      LEFT OUTER JOIN TB_RVDW_PVDA_PLAN_BAS T3
        ON T1.CNTR_NO = T3.CNTR_NO
       AND T1.CNTR_SN = T3.CNTR_SN
     INNER JOIN TB_RVDW_PVDA_PLAN_DTL T4
        ON T3.PVDA_PLAN_NO = T4.PVDA_PLAN_NO
      LEFT OUTER JOIN TB_CBCL_SL_CNFM_BAS T5
        ON T1.CNTR_NO = T5.CNTR_NO
       AND T1.CNTR_SN = T5.CNTR_SN
     WHERE 1=1
       AND T1.SL_DT BETWEEN #{baseDtmnFrom} AND #{baseDtmnTo}
       <if test='@MybatisUtils@equals(taskDiv, "3") or @MybatisUtils@equals(taskDiv, "4") or @MybatisUtils@equals(taskDiv, "5")'>
       /* TODO : 업무구분 조건 추가할 것 */
           <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
           AND T1.SELL_TP_CD = #{sellTpCd}
           </if>
       </if>
       <if test='@MybatisUtils@isNotEmpty(cntrDtlNo)'>
       AND T1.CNTR_NO || T1.CNTR_SN = #{cntrDtlNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cstNo)'>
       AND T1.CST_NO = #{cstNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(sapSlpno)'>
       AND T5.SAP_SLPNO = #{sapSlpno}
       </if>
    </select>
    
    <select id="selectProductSalesLeaseDetails" resultType="com.kyowon.sms.wells.web.closing.sales.dto.WdcbProductSalesDetailDto$SearchSingleRes">
    SELECT #{taskDiv} AS TASK_DIV
         , T1.SELL_TP_CD
         , T1.PD_DTL_CD
         , #{sellDv} AS SELL_DV
         , T1.SL_DT
         , T1.CNTR_NO || T1.CNTR_SN AS CNTR_DTL_NO
         , T1.CST_NO
         , T2.CST_KNM
         , T1.SELL_QTY AS NORMAL_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS NORMAL_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS NORMAL_MM_ISTM_PCAM_AMT
         , 0 AS NORMAL_VAT
         , T1.NOM_SL_AMT - 0 AS NORMAL_PUR_SL_AMT
         , T1.SELL_QTY AS CHG_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CHG_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CHG_MM_ISTM_PCAM_AMT
         , 0 AS CHG_VAT
         , T1.SL_CTR_AMT - 0 AS CHG_PUR_SL_AMT
         , T1.SELL_QTY AS CAN_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CAN_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CAN_MM_ISTM_PCAM_AMT
         , 0 AS CAN_VAT
         , T1.SL_CAN_AMT - 0 AS CAN_PUR_SL_AMT
         , T1.SELL_QTY AS SUM_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS SUM_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS SUM_MM_ISTM_PCAM_AMT
         , T1.SL_SUM_VAT AS SUM_VAT
         , T1.THM_SL_SUM_AMT - SL_SUM_VAT AS SUM_PUR_SL_AMT
      FROM TB_CBCL_WELLS_SL_MM_CL_IZ T1
     INNER JOIN TB_CUBS_CST_BAS T2
        ON T1.CST_NO = T2.CST_NO
      LEFT OUTER JOIN TB_RVDW_PVDA_PLAN_BAS T3
        ON T1.CNTR_NO = T3.CNTR_NO
       AND T1.CNTR_SN = T3.CNTR_SN
     INNER JOIN TB_RVDW_PVDA_PLAN_DTL T4
        ON T3.PVDA_PLAN_NO = T4.PVDA_PLAN_NO
      LEFT OUTER JOIN TB_CBCL_SL_CNFM_BAS T5
        ON T1.CNTR_NO = T5.CNTR_NO
       AND T1.CNTR_SN = T5.CNTR_SN
     WHERE 1=1
       AND T1.SL_DT BETWEEN #{baseDtmnFrom} AND #{baseDtmnTo}
       <if test='@MybatisUtils@equals(taskDiv, "3") or @MybatisUtils@equals(taskDiv, "4") or @MybatisUtils@equals(taskDiv, "5")'>
       /* TODO : 업무구분 조건 추가할 것 */
           <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
           AND T1.SELL_TP_CD = #{sellTpCd}
           </if>
       </if>
       <if test='@MybatisUtils@isNotEmpty(cntrDtlNo)'>
       AND T1.CNTR_NO || T1.CNTR_SN = #{cntrDtlNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cstNo)'>
       AND T1.CST_NO = #{cstNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(sapSlpno)'>
       AND T5.SAP_SLPNO = #{sapSlpno}
       </if>
    </select>
    
    <select id="selectProductSalesFarmSaleDetails" resultType="com.kyowon.sms.wells.web.closing.sales.dto.WdcbProductSalesDetailDto$SearchSingleRes">
    SELECT #{taskDiv} AS TASK_DIV
         , T1.SELL_TP_CD
         , T1.PD_DTL_CD
         , #{sellDv} AS SELL_DV
         , T1.SL_DT
         , T1.CNTR_NO || T1.CNTR_SN AS CNTR_DTL_NO
         , T1.CST_NO
         , T2.CST_KNM
         , T1.SELL_QTY AS NORMAL_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS NORMAL_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS NORMAL_MM_ISTM_PCAM_AMT
         , 0 AS NORMAL_VAT
         , T1.NOM_SL_AMT - 0 AS NORMAL_PUR_SL_AMT
         , T1.SELL_QTY AS CHG_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CHG_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CHG_MM_ISTM_PCAM_AMT
         , 0 AS CHG_VAT
         , T1.SL_CTR_AMT - 0 AS CHG_PUR_SL_AMT
         , T1.SELL_QTY AS CAN_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS CAN_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS CAN_MM_ISTM_PCAM_AMT
         , 0 AS CAN_VAT
         , T1.SL_CAN_AMT - 0 AS CAN_PUR_SL_AMT
         , T1.SELL_QTY AS SUM_SELL_QTY
         , CASE #{taskDiv} WHEN '1' THEN T1.CNTRAM_DP_AMT + T1.THM_INTAM_DP_AMT 
             WHEN '3' THEN T1.THM_ATAM_DP_AMT
             WHEN '5' THEN T1.SL_BND_ALRPY_AMT END AS SUM_MPY_AMT
         , T4.MM_ISTM_PCAM_AMT AS SUM_MM_ISTM_PCAM_AMT
         , T1.SL_SUM_VAT AS SUM_VAT
         , T1.THM_SL_SUM_AMT - SL_SUM_VAT AS SUM_PUR_SL_AMT
      FROM TB_CBCL_WELLS_SL_MM_CL_IZ T1
     INNER JOIN TB_CUBS_CST_BAS T2
        ON T1.CST_NO = T2.CST_NO
      LEFT OUTER JOIN TB_RVDW_PVDA_PLAN_BAS T3
        ON T1.CNTR_NO = T3.CNTR_NO
       AND T1.CNTR_SN = T3.CNTR_SN
     INNER JOIN TB_RVDW_PVDA_PLAN_DTL T4
        ON T3.PVDA_PLAN_NO = T4.PVDA_PLAN_NO
      LEFT OUTER JOIN TB_CBCL_SL_CNFM_BAS T5
        ON T1.CNTR_NO = T5.CNTR_NO
       AND T1.CNTR_SN = T5.CNTR_SN
     WHERE 1=1
       AND T1.SL_DT BETWEEN #{baseDtmnFrom} AND #{baseDtmnTo}
       <if test='@MybatisUtils@equals(taskDiv, "3") or @MybatisUtils@equals(taskDiv, "4") or @MybatisUtils@equals(taskDiv, "5")'>
       /* TODO : 업무구분 조건 추가할 것 */
           <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
           AND T1.SELL_TP_CD = #{sellTpCd}
           </if>
       </if>
       <if test='@MybatisUtils@isNotEmpty(cntrDtlNo)'>
       AND T1.CNTR_NO || T1.CNTR_SN = #{cntrDtlNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cstNo)'>
       AND T1.CST_NO = #{cstNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(sapSlpno)'>
       AND T5.SAP_SLPNO = #{sapSlpno}
       </if>
    </select>
    
    <select id="selectProductSalesRentalDetails" resultType="com.kyowon.sms.wells.web.closing.sales.dto.WdcbProductSalesDetailDto$SearchRentalRes">
    SELECT #{taskDiv} AS TASK_DIV
         , T1.SELL_TP_CD
         , T1.PD_DTL_CD
         , #{sellDv} AS SELL_DV
         , T1.SL_DT
         , T1.CNTR_NO || T1.CNTR_SN AS CNTR_DTL_NO
         , T1.CST_NO
         , T2.CST_KNM
         , 0 AS RGST_QTY
         , T1.RENTAL_RGST_COST - T1.DSC_AMT AS RGST_MPY_AMT
         , T1.RENTAL_RGST_COST_VAT AS RGST_VAT
         , T1.RENTAL_RGST_COST - T1.DSC_AMT AS RGST_PUR_SL_AMT
         , 0 AS RENTAL_QTY
         , T1.SL_BND_ALRPY_AMT AS RENTAL_MPY_AMT
         , 100 AS RENTAL_VAT
         , T1.THM_SL_SUM_AMT AS RENTAL_PUR_SL_AMT
         , 0 AS SUM_QTY
         , T1.RENTAL_RGST_COST + T1.SL_BND_ALRPY_AMT AS SUM_MPY_AMT
         , 100 AS SUM_VAT
         , T1.RENTAL_RGST_COST - T1.DSC_AMT + T1.THM_SL_SUM_AMT AS SUM_PUR_SL_AMT
      FROM TB_CBCL_WELLS_SL_MM_CL_IZ T1
     INNER JOIN TB_CUBS_CST_BAS T2
        ON T1.CST_NO = T2.CST_NO
      LEFT OUTER JOIN TB_CBCL_SL_CNFM_BAS T3
        ON T1.CNTR_NO = T3.CNTR_NO
       AND T1.CNTR_SN = T3.CNTR_SN
     WHERE 1=1
       AND T1.SL_DT BETWEEN #{baseDtmnFrom} AND #{baseDtmnTo}
       <if test='@MybatisUtils@equals(taskDiv, "2")'>
       /* TODO : 업무구분 조건 추가할 것 */
       AND #{taskDiv} = #{taskDiv}
       </if>
       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
       AND T1.SELL_TP_CD = #{sellTpCd}
       </if>
       <if test="@MybatisUtils@isNotEmpty(sellDv) and !@MybatisUtils@equals(sellDv, 'ALL')">
       /* TODO : 판매구분 조건 추가할 것 */
       AND #{sellDv} = #{sellDv}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cntrDtlNo)'>
       AND T1.CNTR_NO || T1.CNTR_SN = #{cntrDtlNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cstNo)'>
       AND T1.CST_NO = #{cstNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(sapSlpno)'>
       AND T3.SAP_SLPNO = #{sapSlpno}
       </if>
    </select>
    
    <select id="selectProductSalesMembershipDetails" resultType="com.kyowon.sms.wells.web.closing.sales.dto.WdcbProductSalesDetailDto$SearchMembershipRes">
    SELECT #{taskDiv} AS TASK_DIV
         , T1.SELL_TP_CD
         , T1.PD_DTL_CD
         , #{sellDv} AS SELL_DV
         , T1.SL_DT
         , T1.CNTR_NO || T1.CNTR_SN AS CNTR_DTL_NO
         , T1.CST_NO
         , T2.CST_KNM
         , 0 AS SSPCS_QTY
         , T1.SL_BND_ALRPY_AMT AS SSPCS_MPY_AMT
         , T1.SL_SUM_VAT AS SSPCS_VAT
         , T1.THM_SL_SUM_AMT - T1.SL_SUM_VAT AS SSPCS_PUR_SL_AMT
         , 0 AS FILT_QTY
         , 0 AS FILT_MPY_AMT
         , 0 AS FILT_VAT
         , 0 AS FILT_PUR_SL_AMT
         , 0 AS SUM_QTY
         , T1.SL_BND_ALRPY_AMT AS SUM_MPY_AMT
         , T1.SL_SUM_VAT AS SUM_VAT
         , T1.THM_SL_SUM_AMT - T1.SL_SUM_VAT AS SUM_PUR_SL_AMT
      FROM TB_CBCL_WELLS_SL_MM_CL_IZ T1
     INNER JOIN TB_CUBS_CST_BAS T2
        ON T1.CST_NO = T2.CST_NO
      LEFT OUTER JOIN TB_CBCL_SL_CNFM_BAS T3
        ON T1.CNTR_NO = T3.CNTR_NO
       AND T1.CNTR_SN = T3.CNTR_SN
     WHERE 1=1
       AND T1.SL_DT BETWEEN #{baseDtmnFrom} AND #{baseDtmnTo}
       <if test='@MybatisUtils@equals(taskDiv, "4")'>
       /* TODO : 업무구분 조건 추가할 것 */
       AND #{taskDiv} = #{taskDiv}
       </if>
       <if test="@MybatisUtils@isNotEmpty(sellTpCd) and !@MybatisUtils@equals(sellTpCd, 'ALL')">
       AND T1.SELL_TP_CD = #{sellTpCd}
       </if>
       <if test="@MybatisUtils@isNotEmpty(sellDv) and !@MybatisUtils@equals(sellDv, 'ALL')">
       /* TODO : 판매구분 조건 추가할 것 */
       AND #{sellDv} = #{sellDv}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cntrDtlNo)'>
       AND T1.CNTR_NO || T1.CNTR_SN = #{cntrDtlNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(cstNo)'>
       AND T1.CST_NO = #{cstNo}
       </if>
       <if test='@MybatisUtils@isNotEmpty(sapSlpno)'>
       AND T3.SAP_SLPNO = #{sapSlpno}
       </if>
    </select>

</mapper>
