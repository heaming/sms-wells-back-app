<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.closing.expense.mapper.WdcdCalculateSecuritiesExceptionMgtMapper">

    <select id="selectBuilDingCd" resultType="com.kyowon.sms.wells.web.closing.expense.dto.WdcdCalculateSecuritiesExceptionMgtDto$CodeRes">
        SELECT DISTINCT B.BLD_CD
             , B.BLD_NM
          FROM TB_OGBS_OG_BAS A /*조직기본*/
         INNER JOIN TB_OGBS_BLD_BAS B /*빌딩기본*/
            ON A.BLD_CD = B.BLD_CD
         WHERE 1=1
           AND A.DGR2_LEVL_OG_CD IN (SELECT W1.OG_CD
                                       FROM TB_OGBS_PRTNR_BAS W1 /*파트너기본*/
                                      WHERE 1=1
                                        AND W1.OG_TP_CD = #{session.ogTpCd}
                                        /*AND W1.PRTNR_NO*/
                                     )
    </select>

    <select id="selectSubject" resultType="com.kyowon.sms.wells.web.closing.expense.dto.WdcdCalculateSecuritiesExceptionMgtDto$SubjectRes">
        SELECT T3.DGR1_LEVL_OG_NM
             , T3.OG_NM
             , T4.BLD_NM
             , DST_OJ_OG_TP_CD /*배분대상조직유형코드*/
             , DST_OJPS_NM    /*성명*/
             , SIGNR_PRTNR_NO /*번호*/
             , PSTN_DV_CD /*직책*/
             , USE_AMT    /*금액*/
          FROM WSMDBS.TB_CBCL_OPCS_ADJ_BAS T1
         INNER JOIN WSMDBS.TB_CBCL_OPCS_ADJ_DTL T2
            ON T1.OPCS_ADJ_NO = T2.OPCS_ADJ_NO
         INNER JOIN TB_OGBS_OG_BAS T3 /*조직기본*/
            ON T1.ADJ_DEPT_OG_ID = T3.OG_ID
           AND T1.PSTN_DV_CD = T3.OG_CD
         INNER JOIN TB_OGBS_BLD_BAS T4 /*빌딩기본*/
            ON T3.BLD_CD = T4.BLD_CD
         WHERE T1.DTA_DL_YN = 'N'
           AND T1.MSCR_YN = 'N'
        <if test="@MybatisUtils@isNotEmpty(pstnDvCd)">
            AND PSTN_DV_CD = #{pstnDvCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(ogLevlDvCd2)">
           AND T3.DGR2_LEVL_OG_NM = #{ogLevlDvCd2}
        </if>
        <if test="@MybatisUtils@isNotEmpty(dstOjpsNm)">
           AND DST_OJPS_NM LIKE '%'|| #{dstOjpsNm} ||'%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(bldCd)">
           AND BLD_CD LIKE '%'|| #{bldCd} ||'%'
        </if>
    </select>

    <select id="selectFinalWithholdingTaxSettlement" resultType="com.kyowon.sms.wells.web.closing.expense.dto.WdcdCalculateSecuritiesExceptionMgtDto$finalWithholdingTaxSettlementReq">
        SELECT T3.DGR2_LEVL_OG_NM
             , T3.OG_NM
             , T5.BLD_NM
             , DST_OJ_OG_TP_CD /*배분대상조직유형코드*/
             , DST_OJPS_NM     /*성명*/
             , SIGNR_PRTNR_NO /*번호*/
             , T1.PSTN_DV_CD     /*직책*/
             , T4.ADJ_CNFM_AMT   /*운영비 확정금액*/
             , DST_WHTX       /*원천세*/
          FROM TB_CBCL_OPCS_ADJ_BAS T1
         INNER JOIN TB_CBCL_OPCS_CNFM_BAS T4
            ON T1.BASE_YM    = T4.BASE_YM
           AND T1.OG_TP_CD   = T4.OG_TP_CD
           AND T1.MSCR_YN    = T4.MSCR_YN
           AND T1.PSTN_DV_CD = T4.PSTN_DV_CD
         INNER JOIN TB_CBCL_OPCS_ADJ_DTL T2
            ON T1.OPCS_ADJ_NO = T2.OPCS_ADJ_NO
         INNER JOIN TB_OGBS_OG_BAS T3 /*조직기본*/
            ON T1.ADJ_DEPT_OG_ID = T3.OG_ID
           AND T1.PSTN_DV_CD = T3.OG_CD
         INNER JOIN TB_OGBS_BLD_BAS T5 /*빌딩기본*/
            ON T3.BLD_CD = T5.BLD_CD
         WHERE T1.DTA_DL_YN = 'N'
           AND T1.MSCR_YN = 'N'
        <if test="@MybatisUtils@isNotEmpty(pstnDvCd)">
            AND PSTN_DV_CD = #{pstnDvCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(ogLevlDvCd2)">
           AND DGR2_LEVL_OG_NM = #{ogLevlDvCd2}
        </if>
        <if test="@MybatisUtils@isNotEmpty(dstOjpsNm)">
           AND DST_OJPS_NM LIKE '%'|| #{dstOjpsNm} ||'%'
        </if>
        <if test="@MybatisUtils@isNotEmpty(bldCd)">
           AND BLD_CD LIKE '%'|| #{bldCd} ||'%'
        </if>
    </select>
</mapper>
