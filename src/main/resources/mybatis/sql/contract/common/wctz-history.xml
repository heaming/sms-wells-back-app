<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.common.mapper.WctzHistoryMapper">

     <!-- TB_SSCT_CNTR_DCH_HIST 계약상세변경이력 -->
     <select id="selectCntrDetailForHist" resultType="com.kyowon.sms.wells.web.contract.common.dvo.WctzCntrDetailChangeHistDvo">
        SELECT  CNTR_NO            /* 계약번호 */
              , CNTR_SN            /* 계약일련번호 */
              , BASE_PD_CD         /* 기준상품코드 */
              , HGR_PD_CD          /* 상위상품코드 */
              , PD_QTY             /* 상품수량 */
              , STPL_PTRM_UNIT_CD  /* 약정기간단위코드 */
              , STPL_PTRM          /* 약정기간 */
              , ISTM_MCN           /* 할부개월수 */
              , CNTR_PD_STRTDT     /* 계약상품시작일자 */
              , CNTR_PD_ENDDT      /* 계약상품종료일자 */
              , CNTR_DTL_STAT_CD   /* 계약상세상태코드 */
              , SELL_TP_CD         /* 판매유형코드 */
              , SELL_TP_DTL_CD     /* 판매유형상세코드 */
              , SV_PTRM_UNIT_CD    /* 서비스기간단위코드 */
              , SV_PRD             /* 서비스주기 */
              , CNTRW_TP_CD        /* 계약서유형코드 */
              , BLG_CRP_CD         /* 소속법인코드 */
              , RVE_CRP_CD         /* 수납법인코드 */
              , CO_CD              /* 회사코드 */
              , BOO_SELL_TP_CD     /* 예약판매유형코드 */
              , PD_GD_CD           /* 상품등급코드 */
              , PD_HCLSF_ID        /* 상품대분류ID */
              , PD_MCLSF_ID        /* 상품중분류ID */
              , PD_LCLSF_ID        /* 상품소분류ID */
              , PD_DCLSF_ID        /* 상품세분류ID */
              , SELL_DSC_DV_CD     /* 판매할인구분코드 */
              , SELL_DSCR_CD       /* 판매할인율코드 */
              , SELL_DSC_CTR_AMT   /* 판매할인조정금액 */
              , SELL_DSC_TP_CD     /* 판매할인유형코드 */
              , STLM_TP_CD         /* 결제유형코드 */
              , CRNCY_DV_CD        /* 통화구분코드 */
              , APY_EXCR           /* 적용환율 */
              , PD_BASE_AMT        /* 상품기준금액 */
              , FNL_AMT            /* 최종금액 */
              , VAT                /* 부가가치세 */
              , SELL_AMT           /* 판매금액 */
              , CNTR_AMT           /* 계약금액 */
              , DSC_AMT            /* 할인금액 */
              , CNTRAM_DSC_AMT     /* 계약금할인금액 */
              , ISTM_PCAM_AMT      /* 할부원금금액 */
              , ISTM_INT_AMT       /* 할부이자금액 */
              , MM_ISTM_AMT        /* 월할부금액 */
              , CRP_UC_AMT         /* 법인미수금액 */
              , SELL_FEE           /* 판매수수료 */
              , ACKMT_PERF_RT      /* 인정실적율 */
              , ACKMT_PERF_AMT     /* 인정실적금액 */
              , CVT_PERF_AMT       /* 환산실적금액 */
              , FEE_ACKMT_CT       /* 수수료인정건수 */
              , FEE_ACKMT_BASE_AMT /* 수수료인정기준금액 */
              , FEE_FXAM_YN        /* 수수료정액여부 */
              , SPP_DUEDT          /* 배송예정일자 */
              , RESUB_YN           /* 재구독여부 */
              , RSTL_YN            /* 재약정여부 */
              , FRISU_YN           /* 무상여부 */
              , FRISU_DSB_TP_CD    /* 무상지급유형코드 */
              , TXINV_PBL_OJ_YN    /* 세금계산서발행대상여부 */
              , ALNCMP_CD
              , ALNCMP_CNTR_DRM_VAL
              , SMTPL_ID           /* 스마트플랜ID */
              , SMTPL_SN           /* 스마트플랜일련번호 */
              , BF_ORD_NO          /* 이전주문번호 */
              , CNTR_CH_RCP_ID     /* 계약변경접수ID */
              , CNTR_CH_SN         /* 계약변경일련번호 */
              , CNTR_CH_DTL_AK_CN  /* 계약변경상세요청내용 */
              , FST_RGST_DTM       /* 최초등록일시 */
              , FST_RGST_USR_ID    /* 최초등록사용자ID */
              , FST_RGST_PRG_ID    /* 최초등록프로그램ID */
              , FST_RGST_DEPT_ID   /* 최초등록부서ID */
              , FNL_MDFC_DTM       /* 최종수정일시 */
              , FNL_MDFC_USR_ID    /* 최종수정사용자ID */
              , FNL_MDFC_PRG_ID    /* 최종수정프로그램ID */
              , FNL_MDFC_DEPT_ID   /* 최종수정부서ID */
           FROM TB_SSCT_CNTR_DTL /* 계약상세 */
          WHERE 1 = 1
            AND CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
     </select>
     <select id="selectCntrDetailChangeHist" resultType="com.kyowon.sms.wells.web.contract.common.dvo.WctzCntrDetailChangeHistDvo">
        SELECT  CNTR_NO            /* 계약번호 */
              , HIST_STRT_DTM      /* 이력시작일시 */
              , CNTR_SN            /* 계약일련번호 */
              , HIST_END_DTM       /* 이력종료일시 */
              , BASE_PD_CD         /* 기준상품코드 */
              , HGR_PD_CD          /* 상위상품코드 */
              , PD_QTY             /* 상품수량 */
              , STPL_PTRM_UNIT_CD  /* 약정기간단위코드 */
              , STPL_PTRM          /* 약정기간 */
              , ISTM_MCN           /* 할부개월수 */
              , CNTR_PD_STRTDT     /* 계약상품시작일자 */
              , CNTR_PD_ENDDT      /* 계약상품종료일자 */
              , CNTR_DTL_STAT_CD   /* 계약상세상태코드 */
              , SELL_TP_CD
              , SELL_TP_DTL_CD     /* 판매유형상세코드 */
              , SV_PTRM_UNIT_CD    /* 서비스기간단위코드 */
              , SV_PRD             /* 서비스주기 */
              , CNTRW_TP_CD        /* 계약서유형코드 */
              , BLG_CRP_CD         /* 소속법인코드 */
              , RVE_CRP_CD         /* 수납법인코드 */
              , CO_CD              /* 회사코드 */
              , BOO_SELL_TP_CD
              , PD_GD_CD           /* 상품등급코드 */
              , PD_HCLSF_ID        /* 상품대분류ID */
              , PD_MCLSF_ID        /* 상품중분류ID */
              , PD_LCLSF_ID        /* 상품소분류ID */
              , PD_DCLSF_ID        /* 상품세분류ID */
              , SELL_DSC_DV_CD     /* 판매할인구분코드 */
              , SELL_DSCR_CD       /* 판매할인율코드 */
              , SELL_DSC_CTR_AMT   /* 판매할인조정금액 */
              , SELL_DSC_TP_CD     /* 판매할인유형코드 */
              , STLM_TP_CD         /* 결제유형코드 */
              , CRNCY_DV_CD        /* 통화구분코드 */
              , APY_EXCR           /* 적용환율 */
              , PD_BASE_AMT        /* 상품기준금액 */
              , FNL_AMT            /* 최종금액 */
              , VAT                /* 부가가치세 */
              , SELL_AMT           /* 판매금액 */
              , CNTR_AMT           /* 계약금액 */
              , DSC_AMT            /* 할인금액 */
              , CNTRAM_DSC_AMT     /* 계약금할인금액 */
              , ISTM_PCAM_AMT      /* 할부원금금액 */
              , ISTM_INT_AMT       /* 할부이자금액 */
              , MM_ISTM_AMT        /* 월할부금액 */
              , CRP_UC_AMT         /* 법인미수금액 */
              , SELL_FEE           /* 판매수수료 */
              , ACKMT_PERF_RT      /* 인정실적율 */
              , ACKMT_PERF_AMT     /* 인정실적금액 */
              , CVT_PERF_AMT       /* 환산실적금액 */
              , FEE_ACKMT_CT       /* 수수료인정건수 */
              , FEE_ACKMT_BASE_AMT /* 수수료인정기준금액 */
              , FEE_FXAM_YN        /* 수수료정액여부 */
              , SPP_DUEDT          /* 배송예정일자 */
              , RESUB_YN           /* 재구독여부 */
              , RSTL_YN            /* 재약정여부 */
              , FRISU_YN           /* 무상여부 */
              , FRISU_DSB_TP_CD    /* 무상지급유형코드 */
              , TXINV_PBL_OJ_YN    /* 세금계산서발행대상여부 */
              , ALNCMP_CD
              , ALNCMP_CNTR_DRM_VAL
              , SMTPL_ID           /* 스마트플랜ID */
              , SMTPL_SN           /* 스마트플랜일련번호 */
              , BF_ORD_NO          /* 이전주문번호 */
              , CNTR_CH_RCP_ID     /* 계약변경접수ID */
              , CNTR_CH_SN         /* 계약변경일련번호 */
              , CNTR_CH_DTL_AK_CN  /* 계약변경상세요청내용 */
              , FST_RGST_DTM       /* 최초등록일시 */
              , FST_RGST_USR_ID    /* 최초등록사용자ID */
              , FST_RGST_PRG_ID    /* 최초등록프로그램ID */
              , FST_RGST_DEPT_ID   /* 최초등록부서ID */
              , FNL_MDFC_DTM       /* 최종수정일시 */
              , FNL_MDFC_USR_ID    /* 최종수정사용자ID */
              , FNL_MDFC_PRG_ID    /* 최종수정프로그램ID */
              , FNL_MDFC_DEPT_ID   /* 최종수정부서ID */
              , DTA_DL_YN          /* 삭제여부 */
           FROM TB_SSCT_CNTR_DCH_HIST
          WHERE 1 = 1
            AND CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
            AND HIST_END_DTM = '99991231235959'
     </select>
     <insert id="insertCntrDetailChangeHist">
        INSERT INTO TB_SSCT_CNTR_DCH_HIST (  /* 계약상세변경이력 */
              CNTR_NO            /* 계약번호 */
            , HIST_STRT_DTM      /* 이력시작일시 */
            , CNTR_SN            /* 계약일련번호 */
            , HIST_END_DTM       /* 이력종료일시 */
            , BASE_PD_CD         /* 기준상품코드 */
            , HGR_PD_CD          /* 상위상품코드 */
            , PD_QTY             /* 상품수량 */
            , STPL_PTRM_UNIT_CD  /* 약정기간단위코드 */
            , STPL_PTRM          /* 약정기간 */
            , ISTM_MCN           /* 할부개월수 */
            , CNTR_PD_STRTDT     /* 계약상품시작일자 */
            , CNTR_PD_ENDDT      /* 계약상품종료일자 */
            , CNTR_DTL_STAT_CD   /* 계약상세상태코드 */
            , SELL_TP_CD
            , SELL_TP_DTL_CD     /* 판매유형상세코드 */
            , SV_PTRM_UNIT_CD    /* 서비스기간단위코드 */
            , SV_PRD             /* 서비스주기 */
            , CNTRW_TP_CD        /* 계약서유형코드 */
            , BLG_CRP_CD         /* 소속법인코드 */
            , RVE_CRP_CD         /* 수납법인코드 */
            , CO_CD              /* 회사코드 */
            , BOO_SELL_TP_CD
            , PD_GD_CD           /* 상품등급코드 */
            , PD_HCLSF_ID        /* 상품대분류ID */
            , PD_MCLSF_ID        /* 상품중분류ID */
            , PD_LCLSF_ID        /* 상품소분류ID */
            , PD_DCLSF_ID        /* 상품세분류ID */
            , SELL_DSC_DV_CD     /* 판매할인구분코드 */
            , SELL_DSCR_CD       /* 판매할인율코드 */
            , SELL_DSC_CTR_AMT   /* 판매할인조정금액 */
            , SELL_DSC_TP_CD     /* 판매할인유형코드 */
            , STLM_TP_CD         /* 결제유형코드 */
            , CRNCY_DV_CD        /* 통화구분코드 */
            , APY_EXCR           /* 적용환율 */
            , PD_BASE_AMT        /* 상품기준금액 */
            , FNL_AMT            /* 최종금액 */
            , VAT                /* 부가가치세 */
            , SELL_AMT           /* 판매금액 */
            , CNTR_AMT           /* 계약금액 */
            , DSC_AMT            /* 할인금액 */
            , CNTRAM_DSC_AMT     /* 계약금할인금액 */
            , ISTM_PCAM_AMT      /* 할부원금금액 */
            , ISTM_INT_AMT       /* 할부이자금액 */
            , MM_ISTM_AMT        /* 월할부금액 */
            , CRP_UC_AMT         /* 법인미수금액 */
            , SELL_FEE           /* 판매수수료 */
            , ACKMT_PERF_RT      /* 인정실적율 */
            , ACKMT_PERF_AMT     /* 인정실적금액 */
            , CVT_PERF_AMT       /* 환산실적금액 */
            , FEE_ACKMT_CT       /* 수수료인정건수 */
            , FEE_ACKMT_BASE_AMT /* 수수료인정기준금액 */
            , FEE_FXAM_YN        /* 수수료정액여부 */
            , SPP_DUEDT          /* 배송예정일자 */
            , RESUB_YN           /* 재구독여부 */
            , RSTL_YN            /* 재약정여부 */
            , FRISU_YN           /* 무상여부 */
            , FRISU_DSB_TP_CD    /* 무상지급유형코드 */
            , TXINV_PBL_OJ_YN    /* 세금계산서발행대상여부 */
            , ALNCMP_CD
            , ALNCMP_CNTR_DRM_VAL
            , SMTPL_ID           /* 스마트플랜ID */
            , SMTPL_SN           /* 스마트플랜일련번호 */
            , BF_ORD_NO          /* 이전주문번호 */
            , CNTR_CH_RCP_ID     /* 계약변경접수ID */
            , CNTR_CH_SN         /* 계약변경일련번호 */
            , CNTR_CH_DTL_AK_CN  /* 계약변경상세요청내용 */
            <include refid="COMMON.insertSystemField" />)
        VALUES (
              #{cntrNo}
            , #{histStrtDtm}
            , #{cntrSn}
            , #{histEndDtm}
            , #{basePdCd}
            , #{hgrPdCd}
            , #{pdQty}
            , #{stplPtrmUnitCd}
            , #{stplPtrm}
            , #{istmMcn}
            , #{cntrPdStrtdt}
            , #{cntrPdEnddt}
            , #{cntrDtlStatCd}
            , #{sellTpCd}
            , #{sellTpDtlCd}
            , #{svPtrmUnitCd}
            , #{svPrd}
            , #{cntrwTpCd}
            , #{blgCrpCd}
            , #{rveCrpCd}
            , #{coCd}
            , #{booSellTpCd}
            , #{pdGdCd}
            , #{pdHclsfId}
            , #{pdMclsfId}
            , #{pdLclsfId}
            , #{pdDclsfId}
            , #{sellDscDvCd}
            , #{sellDscrCd}
            , #{sellDscCtrAmt}
            , #{sellDscTpCd}
            , #{stlmTpCd}
            , #{crncyDvCd}
            , #{apyExcr}
            , #{pdBaseAmt}
            , #{fnlAmt}
            , #{vat}
            , #{sellAmt}
            , #{cntrAmt}
            , #{dscAmt}
            , #{cntramDscAmt}
            , #{istmPcamAmt}
            , #{istmIntAmt}
            , #{mmIstmAmt}
            , #{crpUcAmt}
            , #{sellFee}
            , #{ackmtPerfRt}
            , #{ackmtPerfAmt}
            , #{cvtPerfAmt}
            , #{feeAckmtCt}
            , #{feeAckmtBaseAmt}
            , #{feeFxamYn}
            , #{sppDuedt}
            , #{resubYn}
            , #{rstlYn}
            , #{frisuYn}
            , #{frisuDsbTpCd}
            , #{txinvPblOjYn}
            , #{alncmpCd}
            , #{alncmpCntrDrmVal}
            , #{smtplId}
            , #{smtplSn}
            , #{bfOrdNo}
            , #{cntrChRcpId}
            , #{cntrChSn}
            , #{cntrChDtlAkCn}
            <include refid="COMMON.insertSystemFieldValue" /> )
     </insert>
     <update id="updateCntrDetailChangeHist">
        UPDATE TB_SSCT_CNTR_DCH_HIST /* 계약상세변경이력 */
           SET HIST_END_DTM       = #{histEndDtm}         /* 이력종료일시 */
             , BASE_PD_CD         = #{basePdCd}           /* 기준상품코드 */
             , HGR_PD_CD          = #{hgrPdCd}            /* 상위상품코드 */
             , PD_QTY             = #{pdQty}              /* 상품수량 */
             , STPL_PTRM_UNIT_CD  = #{stplPtrmUnitCd}     /* 약정기간단위코드 */
             , STPL_PTRM          = #{stplPtrm}           /* 약정기간 */
             , ISTM_MCN           = #{istmMcn}            /* 할부개월수 */
             , CNTR_PD_STRTDT     = #{cntrPdStrtdt}       /* 계약상품시작일자 */
             , CNTR_PD_ENDDT      = #{cntrPdEnddt}        /* 계약상품종료일자 */
             , CNTR_DTL_STAT_CD   = #{cntrDtlStatCd}      /* 계약상세상태코드 */
             , SELL_TP_CD         = #{sellTpCd}
             , SELL_TP_DTL_CD     = #{sellTpDtlCd}        /* 판매유형상세코드 */
             , SV_PTRM_UNIT_CD    = #{svPtrmUnitCd}       /* 서비스기간단위코드 */
             , SV_PRD             = #{svPrd}              /* 서비스주기 */
             , CNTRW_TP_CD        = #{cntrwTpCd}          /* 계약서유형코드 */
             , BLG_CRP_CD         = #{blgCrpCd}           /* 소속법인코드 */
             , RVE_CRP_CD         = #{rveCrpCd}           /* 수납법인코드 */
             , CO_CD              = #{coCd}               /* 회사코드 */
             , BOO_SELL_TP_CD     = #{booSellTpCd}
             , PD_GD_CD           = #{pdGdCd}             /* 상품등급코드 */
             , PD_HCLSF_ID        = #{pdHclsfId}          /* 상품대분류ID */
             , PD_MCLSF_ID        = #{pdMclsfId}          /* 상품중분류ID */
             , PD_LCLSF_ID        = #{pdLclsfId}          /* 상품소분류ID */
             , PD_DCLSF_ID        = #{pdDclsfId}          /* 상품세분류ID */
             , SELL_DSC_DV_CD     = #{sellDscDvCd}        /* 판매할인구분코드 */
             , SELL_DSCR_CD       = #{sellDscrCd}         /* 판매할인율코드 */
             , SELL_DSC_CTR_AMT   = #{sellDscCtrAmt}      /* 판매할인조정금액 */
             , SELL_DSC_TP_CD     = #{sellDscTpCd}        /* 판매할인유형코드 */
             , STLM_TP_CD         = #{stlmTpCd}           /* 결제유형코드 */
             , CRNCY_DV_CD        = #{crncyDvCd}          /* 통화구분코드 */
             , APY_EXCR           = #{apyExcr}            /* 적용환율 */
             , PD_BASE_AMT        = #{pdBaseAmt}          /* 상품기준금액 */
             , FNL_AMT            = #{fnlAmt}             /* 최종금액 */
             , VAT                = #{vat}                /* 부가가치세 */
             , SELL_AMT           = #{sellAmt}            /* 판매금액 */
             , CNTR_AMT           = #{cntrAmt}            /* 계약금액 */
             , DSC_AMT            = #{dscAmt}             /* 할인금액 */
             , CNTRAM_DSC_AMT     = #{cntramDscAmt}       /* 계약금할인금액 */
             , ISTM_PCAM_AMT      = #{istmPcamAmt}        /* 할부원금금액 */
             , ISTM_INT_AMT       = #{istmIntAmt}         /* 할부이자금액 */
             , MM_ISTM_AMT        = #{mmIstmAmt}          /* 월할부금액 */
             , CRP_UC_AMT         = #{crpUcAmt}           /* 법인미수금액 */
             , SELL_FEE           = #{sellFee}            /* 판매수수료 */
             , ACKMT_PERF_RT      = #{ackmtPerfRt}        /* 인정실적율 */
             , ACKMT_PERF_AMT     = #{ackmtPerfAmt}       /* 인정실적금액 */
             , CVT_PERF_AMT       = #{cvtPerfAmt}         /* 환산실적금액 */
             , FEE_ACKMT_CT       = #{feeAckmtCt}         /* 수수료인정건수 */
             , FEE_ACKMT_BASE_AMT = #{feeAckmtBaseAmt}    /* 수수료인정기준금액 */
             , FEE_FXAM_YN        = #{feeFxamYn}          /* 수수료정액여부 */
             , SPP_DUEDT          = #{sppDuedt}           /* 배송예정일자 */
             , RESUB_YN           = #{resubYn}            /* 재구독여부 */
             , RSTL_YN            = #{rstlYn}             /* 재약정여부 */
             , FRISU_YN           = #{frisuYn}            /* 무상여부 */
             , FRISU_DSB_TP_CD    = #{frisuDsbTpCd}       /* 무상지급유형코드 */
             , TXINV_PBL_OJ_YN    = #{txinvPblOjYn}       /* 세금계산서발행대상여부 */
             , ALNCMP_CD              = #{alncmpCd}              /* 제휴사코드 */
             , ALNCMP_CNTR_DRM_VAL    = #{alncmpCntrDrmVal}      /* 제휴사계약식별값 */
             , SMTPL_ID           = #{smtplId}            /* 스마트플랜ID */
             , SMTPL_SN           = #{smtplSn}            /* 스마트플랜일련번호 */
             , BF_ORD_NO          = #{bfOrdNo}            /* 이전주문번호 */
             , CNTR_CH_RCP_ID     = #{cntrChRcpId}        /* 계약변경접수ID */
             , CNTR_CH_SN         = #{cntrChSn}           /* 계약변경일련번호 */
             , CNTR_CH_DTL_AK_CN  = #{cntrChDtlAkCn}      /* 계약변경상세요청내용 */
            <include refid="COMMON.updateSystemField"/>
         WHERE 1 = 1
           AND CNTR_NO            = #{cntrNo}             /* 계약번호 */
           AND HIST_STRT_DTM      = #{histStrtDtm}        /* 이력시작일시 */
           AND CNTR_SN            = #{cntrSn}             /* 계약일련번호 */
     </update>
     <update id="deleteCntrDetailChangeHist">
         UPDATE TB_SSCT_CNTR_DCH_HIST
            SET DTA_DL_YN           = 'Y'
             <include refid="COMMON.updateSystemField"/>
          WHERE 1 = 1
            AND CNTR_NO             = #{cntrNo}
            AND HIST_STRT_DTM       = #{histStrtDtm}
            AND CNTR_SN             = #{cntrSn}
     </update>

     <!-- TB_SSCT_CNTR_DTL_STAT_CH_HIST 계약상세상태변경이력 -->
     <select id="selectCntrDetailStatChangeHist" resultType="com.kyowon.sms.wells.web.contract.common.dvo.WctzCntrDtlStatChangeHistDvo">
         SELECT CNTR_NO
              , CNTR_SN
              , HIST_STRT_DTM
              , HIST_END_DTM
              , CNTR_DTL_STAT_CD
              , CNTR_DTL_STAT_CH_RSON_CD
              , CNTR_DTL_STAT_CH_MO_CN
              , DTA_DL_YN
              , FST_RGST_DTM
              , FST_RGST_USR_ID
              , FST_RGST_PRG_ID
              , FST_RGST_DEPT_ID
              , FNL_MDFC_DTM
              , FNL_MDFC_USR_ID
              , FNL_MDFC_PRG_ID
              , FNL_MDFC_DEPT_ID
           FROM TB_SSCT_CNTR_DTL_STAT_CH_HIST
          WHERE 1 = 1
            AND CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
            AND HIST_END_DTM = '99991231235959'
     </select>
     <insert id="insertCntrDetailStatChangeHist">
         INSERT INTO TB_SSCT_CNTR_DTL_STAT_CH_HIST (
                CNTR_NO
              , CNTR_SN
              , HIST_STRT_DTM
              , HIST_END_DTM
              , CNTR_DTL_STAT_CD
              , CNTR_DTL_STAT_CH_RSON_CD
              , CNTR_DTL_STAT_CH_MO_CN
              <include refid="COMMON.insertSystemField" />)
         VALUES (
                #{cntrNo}
              , #{cntrSn}
              , #{histStrtDtm}
              , #{histEndDtm}
              , #{cntrDtlStatCd}
              , #{cntrDtlStatChRsonCd}
              , #{cntrDtlStatChMoCn}
              <include refid="COMMON.insertSystemFieldValue" /> )
     </insert>
     <update id="updateCntrDetailStatChangeHist">
         UPDATE TB_SSCT_CNTR_DTL_STAT_CH_HIST
            SET HIST_END_DTM             = #{histEndDtm}
              , CNTR_DTL_STAT_CD         = #{cntrDtlStatCd}
              , CNTR_DTL_STAT_CH_RSON_CD = #{cntrDtlStatChRsonCd}
              , CNTR_DTL_STAT_CH_MO_CN   = #{cntrDtlStatChMoCn}
             <include refid="COMMON.updateSystemField"/>
          WHERE 1 = 1
            AND CNTR_NO                  = #{cntrNo}
            AND CNTR_SN                  = #{cntrSn}
            AND HIST_STRT_DTM            = #{histStrtDtm}
     </update>
     <update id="deleteCntrDetailStatChangeHist">
         UPDATE TB_SSCT_CNTR_DTL_STAT_CH_HIST
            SET DTA_DL_YN                = 'Y'
             <include refid="COMMON.updateSystemField"/>
          WHERE 1 = 1
            AND CNTR_NO                  = #{cntrNo}
            AND CNTR_SN                  = #{cntrSn}
            AND HIST_STRT_DTM            = #{histStrtDtm}
     </update>

    <!-- TB_SSCT_TXINV_RCP_BASE_CH_HIST 세금계산서접수기준변경이력 -->

    <select id="selectTaxInvoiceReceiptBase" resultType = "com.kyowon.sms.wells.web.contract.common.dvo.WctzTxinvRcpBaseChangeHistDvo">
        SELECT CNTR_NO                 /* 계약번호 */
             , CNTR_SN                 /* 계약일련번호 */
             , TXINV_PD_DV_CD          /* 세금계산서상품구분코드 */
             , TXINV_PBL_DV_CD         /* 세금계산서발행구분코드 */
             , APLC_PSIC_ID            /* 신청담당자ID */
             , RCPDT                   /* 접수일자 */
             , BZRNO                   /* 사업자등록번호 */
             , CNTR_CST_NO             /* 계약고객번호 */
             , TXINV_PBL_YN            /* 세금계산서발행여부 */
             , TXINV_PBL_D             /* 세금계산서발행일 */
             , TXINV_BNDL_SN           /* 세금계산서묶음일련번호 */
             , DLPNR_PSIC_NM           /* 거래처담당자명 */
             , EMADR                   /* 이메일주소 */
             , LOCARA_TNO              /* 지역전화번호 */
             , EXNO_ENCR               /* 전화국번호암호화 */
             , IDV_TNO                 /* 개별전화번호 */
             , CRAL_LOCARA_TNO         /* 휴대지역전화번호 */
             , MEXNO_ENCR              /* 휴대전화국번호암호화 */
             , CRAL_IDV_TNO            /* 휴대개별전화번호 */
             , RMK_CN                  /* 비고내용 */
             , MVS_DSTC_RCVRY_BASE_DTM /* 소산파기복구기준일시 */
             , MVS_DSTC_RCVRY_DV_CD    /* 소산파기복구구분코드 */
             , MVS_DSTC_RCVRY_DTM      /* 소산파기복구일시 */
             , DTA_DL_YN               /* 데이터삭제여부 */
             , FST_RGST_DTM            /* 최초등록일시 */
             , FST_RGST_USR_ID         /* 최초등록사용자ID */
             , FST_RGST_PRG_ID         /* 최초등록프로그램ID */
             , FST_RGST_DEPT_ID        /* 최초등록부서ID */
             , FNL_MDFC_DTM            /* 최종수정일시 */
             , FNL_MDFC_USR_ID         /* 최종수정사용자ID */
             , FNL_MDFC_PRG_ID         /* 최종수정프로그램ID */
             , FNL_MDFC_DEPT_ID        /* 최종수정부서ID */
          FROM TB_SSCT_TXINV_RCP_BASE_IZ /* 세금계산서접수기준내역 */
         WHERE 1 = 1
           AND CNTR_NO                 = #{cntrNo}                 /* 계약번호 */
           AND CNTR_SN                 = #{cntrSn}                 /* 계약일련번호 */
    </select>

    <insert id="insertTaxInvoiceReceiptBaseHist">
        INSERT INTO TB_SSCT_TXINV_RCP_BASE_CH_HIST (  /* 세금계산서접수기준변경이력 */
              CNTR_NO                 /* 계약번호 */
            , CNTR_SN                 /* 계약일련번호 */
            , CH_SN                   /* 변경일련번호 */
            , TXINV_PD_DV_CD          /* 세금계산서상품구분코드 */
            , TXINV_PBL_DV_CD         /* 세금계산서발행구분코드 */
            , APLC_PSIC_ID            /* 신청담당자ID */
            , RCPDT                   /* 접수일자 */
            , BZRNO                   /* 사업자등록번호 */
            , CNTR_CST_NO             /* 계약고객번호 */
            , TXINV_PBL_YN            /* 세금계산서발행여부 */
            , TXINV_PBL_D             /* 세금계산서발행일 */
            , TXINV_BNDL_SN           /* 세금계산서묶음일련번호 */
            , DLPNR_PSIC_NM           /* 거래처담당자명 */
            , EMADR                   /* 이메일주소 */
            , LOCARA_TNO              /* 지역전화번호 */
            , EXNO_ENCR               /* 전화국번호암호화 */
            , IDV_TNO                 /* 개별전화번호 */
            , CRAL_LOCARA_TNO         /* 휴대지역전화번호 */
            , MEXNO_ENCR              /* 휴대전화국번호암호화 */
            , CRAL_IDV_TNO            /* 휴대개별전화번호 */
            , RMK_CN                  /* 비고내용 */
            , MVS_DSTC_RCVRY_BASE_DTM /* 소산파기복구기준일시 */
            , MVS_DSTC_RCVRY_DV_CD    /* 소산파기복구구분코드 */
            , MVS_DSTC_RCVRY_DTM      /* 소산파기복구일시 */
            , DTA_DL_YN               /* 데이터삭제여부 */
            <include refid="COMMON.insertSystemField" />)
        VALUES (
              #{cntrNo}
            , #{cntrSn}
            , ( SELECT NVL(MAX(H.CH_SN), 0) + 1
                  FROM TB_SSCT_TXINV_RCP_BASE_CH_HIST H
                 WHERE H.CNTR_NO = #{cntrNo}
                   AND H.CNTR_SN = #{cntrSn}
               )
            , #{txinvPdDvCd}
            , #{txinvPblDvCd}
            , #{aplcPsicId}
            , #{rcpdt}
            , #{bzrno}
            , #{cntrCstNo}
            , #{txinvPblYn}
            , #{txinvPblD}
            , #{txinvBndlSn}
            , #{dlpnrPsicNm}
            , #{emadr}
            , #{locaraTno}
            , #{exnoEncr}
            , #{idvTno}
            , #{cralLocaraTno}
            , #{mexnoEncr}
            , #{cralIdvTno}
            , #{rmkCn}
            , #{mvsDstcRcvryBaseDtm}
            , #{mvsDstcRcvryDvCd}
            , #{mvsDstcRcvryDtm}
            , #{dtaDlYn}
            <include refid="COMMON.insertSystemFieldValue" /> )
    </insert>
</mapper>
