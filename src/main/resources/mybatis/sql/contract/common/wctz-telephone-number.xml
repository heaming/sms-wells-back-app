<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.common.mapper.WctzTelephoneNumberMapper">
    <select id="selectContractTnoByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzTelephoneNumberDto$SearchTnoRes">
        SELECT LOCARA_TNO
             , EXNO_ENCR
             , IDV_TNO
          FROM (
               SELECT LOCARA_TNO
                    , EXNO_ENCR
                    , IDV_TNO
                 FROM TB_CUBS_CST_CTPLC_BAS
                WHERE 1=1
                  AND CST_CTPLC_OJ_DV_CD = 1
                  AND CST_CTPLC_OJ_REFK_VAL = (
                                              SELECT CNTR_CST_NO
                                                FROM TB_SSCT_CNTR_BAS
                                               WHERE CNTR_NO = #{cntrNo}
                                              )
                ORDER BY HIST_END_DTM DESC
               )
          WHERE ROWNUM = 1
    </select>

    <select id="selectContractMpnoByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzTelephoneNumberDto$SearchMpnoRes">
        SELECT CRAL_LOCARA_TNO
             , MEXNO_ENCR
             , CRAL_IDV_TNO
          FROM TB_CUBS_CST_BAS
         WHERE CST_NO = (
                        SELECT CNTR_CST_NO
                          FROM TB_SSCT_CNTR_BAS
                         WHERE CNTR_NO = #{cntrNo}
                        )
    </select>

    <select id="selectInstallerTnoByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzTelephoneNumberDto$SearchTnoRes">
        SELECT LOCARA_TNO
             , EXNO_ENCR
             , IDV_TNO
          FROM TB_SSCT_CNTR_ADRPC_BAS
         WHERE CNTR_ADRPC_ID = (
                               SELECT CNTR_ADRPC_ID
                                 FROM TB_SSCT_CNTR_ADR_REL
                                WHERE DTL_CNTR_NO = #{dtlCntrNo}
                                  AND DTL_CNTR_SN=  #{dtlCntrSn}
                               )
    </select>

    <select id="selectInstallerMpnoByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzTelephoneNumberDto$SearchMpnoRes">
        SELECT CRAL_LOCARA_TNO
             , MEXNO_ENCR
             , CRAL_IDV_TNO
          FROM TB_SSCT_CNTR_ADRPC_BAS
         WHERE CNTR_ADRPC_ID = (
                               SELECT CNTR_ADRPC_ID
                                 FROM TB_SSCT_CNTR_ADR_REL
                                WHERE DTL_CNTR_NO = #{dtlCntrNo}
                                  AND DTL_CNTR_SN=  #{dtlCntrSn}
                               )
    </select>

    <select id="selectPartnerMpnoByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzTelephoneNumberDto$SearchMpnoRes">
        SELECT CRAL_LOCARA_TNO
             , MEXNO_ENCR
             , CRAL_IDV_TNO
          FROM TB_OGBS_MM_PRTNR_IZ T1
         INNER JOIN TB_SSCT_CNTR_BAS T2
            ON T2.SELL_PRTNR_NO = T1.PRTNR_NO
           AND SUBSTR(T2.CNTR_CNFM_DTM, 0, 6) = T1.BASE_YM
         WHERE T2.CNTR_NO = #{cntrNo}
    </select>
</mapper>
