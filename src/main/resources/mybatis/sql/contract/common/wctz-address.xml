<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.common.mapper.WctzTelephoneNumberMapper">
    <select id="selectContractorAddressByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzAddressDto$SearchAdrRes">
        SELECT ADR_ID
             , RNADR
             , RDADR
             , LTN_ADR
             , LTN_DTL_ADR
             , CLNG_ADR_ID
             , RNADR_MNGT_NO
             , NEW_ADR_ZIP
             , OLD_ADR_ZIP
             , STRU_MNGT_NO
          FROM TB_GBCO_ADR_BAS
         WHERE ADR_ID = (
                        SELECT ADR_ID
                          FROM TB_CUBS_CST_BAS
                         WHERE CST_NO = (
                                        SELECT CNTR_CST_NO
                                          FROM TB_SSCT_CNTR_BAS
                                         WHERE CNTR_NO = #{cntrNo}
                                        )
                        )
    </select>

    <select id="selectInstallerAddressByCntr" resultType="com.kyowon.sms.wells.web.contract.common.dto.WctzAddressDto$SearchAdrRes">
        WITH W1 AS (
                   SELECT ADR_ID, RCGVP_KNM
                     FROM TB_SSCT_CNTR_ADRPC_BAS
                    WHERE CNTR_ADRPC_ID = (
                                          SELECT CNTR_ADRPC_ID
                                            FROM TB_SSCT_CNTR_ADR_REL
                                           WHERE DTL_CNTR_NO = #{dtlCntrNo}
                                             AND DTL_CNTR_SN=  #{dtlCntrSn}
                                          )
        )
        SELECT T1.ADR_ID
             , T1.RNADR
             , T1.RDADR
             , T1.LTN_ADR
             , T1.LTN_DTL_ADR
             , T1.CLNG_ADR_ID
             , T1.RNADR_MNGT_NO
             , T1.NEW_ADR_ZIP
             , T1.OLD_ADR_ZIP
             , T1.STRU_MNGT_NO
             , W1.RCGVP_KNM
          FROM W1
         INNER JOIN TB_GBCO_ADR_BAS T1
            ON T1.ADR_ID = W1.ADR_ID
    </select>
</mapper>
