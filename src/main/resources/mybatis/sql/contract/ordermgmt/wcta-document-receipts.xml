<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.ordermgmt.mapper.WwctaDocumentReceiptPssMapper">
    <select id="selectDocumentReceipts" resultType="com.kyowon.sms.wells.web.contract.ordermgmt.dto.WwctaDocumentReceiptPssDto$SearchRes">
        SELECT
               A.CNTR_CH_RCP_ID                                     /* 접수일자 */
             , SUBSTR(A.CNTR_CH_RCP_DTM, 0,8) AS CNTR_CH_RCP_D      /* 접수일자 */
             , SUBSTR(A.CNTR_CH_RCP_DTM,9)    AS CNTR_CH_RCP_TM     /* 접수시간 */
             , CASE WHEN A.CNTR_CH_PRGS_STAT_CD = '60' THEN  '55'
                    WHEN A.CNTR_CH_PRGS_STAT_CD = '70' THEN  '55'
                    ELSE CNTR_CH_PRGS_STAT_CD END CNTR_CH_PRGS_STAT_CD /* 계약변경진행상태코드 : 접수대기~처리완료 - ASIS :  접수상태(기타종료 축약) */
             , A.CNTR_CH_PRGS_STAT_CD AS CNTR_CH_PRGS_STAT_CD_END   /* 계약변경진행상태코드 : 접수대기~처리완료 - ASIS :  접수상태(기타종료 상세) */
             , B.CST_KNM                        /* 고객명*/
             , B.CRAL_LOCARA_TNO                /* 휴대지역전화번호 */
             --, B.MEXNO_ENCR                     /* 휴대전화국번호암호화 - TODO:복호화 */
             , XX1.DEC_VARCHAR2_SEL(B.MEXNO_ENCR,10,'AES256') AS MEXNO_ENCR
             , B.CRAL_IDV_TNO                   /* 휴대개별전화번호 */
             , A.CNTR_CH_TP_CD                  /* 계약변경유형코드 */
             , A.FNL_MDFC_DTM                   /* 수정일자 */
          FROM TB_SSCT_CNTR_CH_RCP_BAS A        /* T.계약변경접수기본 */
          LEFT OUTER JOIN TB_CUBS_CST_BAS B     /* T.고객기본 */
            ON A.CST_NO = B.CST_NO
         WHERE 1=1
           AND A.CNTR_CH_RCP_DTM <![CDATA[ >= ]]> #{cntrChRcpStrtDtm}
           AND A.CNTR_CH_RCP_DTM <![CDATA[ <= ]]> #{cntrChRcpFinsDtm}
        <if test="@MybatisUtils@isNotEmpty(cntrChPrgsStatCd)">
           AND A.CNTR_CH_PRGS_STAT_CD = #{cntrChPrgsStatCd}
        </if>
           AND A.CNTR_CH_PRGS_STAT_CD IN ('55','60','70')
        <if test="@MybatisUtils@isNotEmpty(cntrChTpCd)">
           AND A.CNTR_CH_TP_CD = #{cntrChTpCd}
        </if>
           AND A.CNTR_CH_RCP_ID = #{cntrChRcpId}
           AND B.CST_KNM LIKE '%' || #{cstKnm} || '%'
           AND B.CRAL_LOCARA_TNO||XX1.DEC_VARCHAR2_SEL(B.MEXNO_ENCR,10,'AES256')||B.CRAL_IDV_TNO LIKE '%' || #{cralLocapaMexnoIdvTno} || '%'
    </select>
</mapper>
