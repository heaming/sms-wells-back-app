<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.risk.mapper.WctcDangerArbitMapper">
    <select id="selectDangerArbitManagerial" resultType="com.kyowon.sms.wells.web.contract.risk.dto.WctcDangerArbitDto$SearchRes">
        SELECT    G.DANG_OJ_PRTNR_NO /* 행위자사번 - 행위자사번 */
		, G.DANG_OC_STRTMM /* 행위자사번 - 발생년월 */
		, G.DANG_OJ_OG_ID /* 행위자사번 - 소속 */
		, G.DANG_OJ_PNTNR_NM /* 행위자사번 - 성명 */
		, G.DANG_OJ_PSTN_DV_CD /* 행위자사번 - 직급 */
		, G.DGR1_LEVL_DG_PRTNR_NO /* 소속 - 총괄단 */
        , G.DGR1_LEVL_DG_PRTNR_NM /* 소속 - 총괄단명 */
		, G.DGR2_LEVL_DG_PRTNR_NO /* 소속 - 지역단 */
        , G.DGR2_LEVL_DG_PRTNR_NM /* 소속 - 지역단 */
		, G.BZNS_SPPT_PRTNR_NO /* 소속 - BM */
        , G.BZNS_SPPT_PRTNR_NM /* 소속 - BM */
		, G.DGR3_LEVL_DG_PRTNR_NO  /* 소속 - 지점 */
        , G.DGR3_LEVL_DG_PRTNR_NM  /* 소속 - 지점 */
		, G.DANG_CHK_NM /* 벌점 - 부과내역 */
		, G.DANG_ARBIT_CD /* 벌점 - 조치항목 */
		, G.DANG_UNCVR_CT /* 벌점 - 부과대상건수 */
		, G.DANG_ARBIT_LVY_PC  /* 벌점 - 조치결과부과점수 */
		, G.DANG_ARBIT_OG_ID /* 벌점 - 조치부서 */
		, G.FST_RGST_USR_ID /* 등록자 */
		, G.FST_RGST_DT /* 등록일자 */
        FROM (
            WITH TB_OGBS_MM AS (
                SELECT D.PSTN_DV_CD /*월파트너내역.직급구분코드*/
                     , D.PRTNR_NO /* 월파트너내역.파트너번호 */
                     , D.PRTNR_KNM /* 월파트너내역.파트너한글명 */
                     , D.PSTN_DV_CD /* 월파트너내역.직급구분코드 */
                     , AFMDBS.F_CMZ_CD_NM('TNT_WELLS', 'PSTN_DV_CD', D.PSTN_DV_CD) AS PSTN_DV_NM /* 직급구분명 */
                     , C.DGR1_LEVL_OG_CD /* 월조직내역.1차레벨조직코드 - 총괄단 */
                     , C.DGR1_LEVL_OG_NM /* 월조직내역.1차레벨조직명 - 총괄단 */
                     , C.DGR1_LEVL_DG_PRTNR_NO /* 월조직내역.1차레벨대표파트너번호 - 총괄단 */
                     , (
                        SELECT MAX(F.OG_ID)
                          FROM WSMDBS.TB_OGBS_OG_BAS F /* 조직기본 */
                         WHERE F.DTA_DL_YN = 'N' /* 조직기본.데이터삭제여부가 'N'인 건*/
                           AND F.OG_CD = C.DGR1_LEVL_OG_CD /* 조직기본.조직ID = 월조직내역.1차레벨조직코드 */
                       ) AS DGR1_LEVL_OG_ID /* 1차레벨조직ID */
                     , C.DGR2_LEVL_OG_CD /* 월조직내역.2차레벨조직코드 - 지역단 */
                     , C.DGR2_LEVL_OG_NM /* 월조직내역.2차레벨조직명 - 지역단 */
                     , C.DGR2_LEVL_DG_PRTNR_NO /* 월조직내역.2차레벨대표파트너번호 - 지역단 */
                     , (
                        SELECT MAX(F.OG_ID)
                          FROM WSMDBS.TB_OGBS_OG_BAS F /* 조직기본 */
                         WHERE F.DTA_DL_YN = 'N' /* 조직기본.데이터삭제여부가 'N'인 건*/
                           AND F.OG_CD = C.DGR2_LEVL_OG_CD /* 조직기본.조직ID = 월조직내역.2차레벨조직코드 */
                       ) AS DGR2_LEVL_OG_ID /* 2차레벨조직ID */
                     , C.DGR3_LEVL_OG_CD /* 월조직내역.3차레벨조직코드 - 지점 */
                     , C.DGR3_LEVL_OG_NM /* 월조직내역.3차레벨조직명 - 지점 */
                     , C.DGR3_LEVL_DG_PRTNR_NO /* 월조직내역.3차레벨대표파트너번호 - 지점 */
                     , (
                        SELECT MAX(F.OG_ID)
                          FROM WSMDBS.TB_OGBS_OG_BAS F /* 조직기본 */
                         WHERE F.DTA_DL_YN = 'N' /* 조직기본.데이터삭제여부가 'N'인 건*/
                           AND F.OG_CD = C.DGR3_LEVL_OG_CD /* 조직기본.조직ID = 월조직내역.3차레벨조직코드 */
                       ) AS DGR3_LEVL_OG_ID /* 3차레벨조직ID */
                     , C.BIZ_SPPT_PRTNR_NO /* 월조직내역.업무지원파트너번호 */
                     , C.OG_UPBRNG_PRTNR_NO /* 월조직내역.조직육성파트너번호 */
                     , C.OG_CD /* 월조직내역.조직코드 */
                     , C.OG_ID /* 월조직내역.조직ID */
                     , C.OG_NM /* 월조직내역.조직명 */
                     , C.BASE_YM /* 월조직내역.기준년월 */
                 FROM WSMDBS.TB_OGBS_MM_OG_IZ C/* 월조직내역 - 월조직내역 TABLE의 1~5차 상위 조직ID가 없으므로 별도로 조회 */
                INNER JOIN WSMDBS.TB_OGBS_MM_PRTNR_IZ D /* 월파트너내역 */
                   ON D.BASE_YM = C.BASE_YM /* 월파트너내역.기준년월 = 월조직내역.기준년월 */
                  AND D.OG_ID = C.OG_ID /* 월조직내역.조직ID = 월파트너내역.조직ID */
                WHERE 1=1
                  AND C.DTA_DL_YN = 'N' /* 월조직내역.데이터삭제여부가 'N'인 건*/
                  AND D.DTA_DL_YN = 'N' /* 월파트너내역.데이터삭제여부가 'N'인 건 */
          <if test='@MybatisUtils@equals(srchGbn, "1")'>
          	<if test='@MybatisUtils@isNotEmpty(dangOcStrtdt)'>
          		AND  C.BASE_YM <![CDATA[ >= ]]> SUBSTR(#{dangOcStrtdt}, 1, 6)/* 입력한 FROM년월일 */
          	</if>
          	<if test='@MybatisUtils@isNotEmpty(dangOcEnddt)'>
          		AND C.BASE_YM <![CDATA[<= ]]> SUBSTR(#{dangOcEnddt}, 1, 6) /* 입력한 TO년월일 */
          	</if>
           </if>
           <if test='@MybatisUtils@equals(srchGbn, "2")'>
           	<if test='@MybatisUtils@isNotEmpty(dangOcStrtMonth)'>
           		AND  C.BASE_YM <![CDATA[ >= ]]> TRIM(#{dangOcStrtMonth}) /* 입력한 FROM년월 */
           	</if>
           	<if test='@MybatisUtils@isNotEmpty(dangOcEndMonth)'>
           		AND C.BASE_YM <![CDATA[<= ]]> TRIM(#{dangOcEndMonth}) /* 입력한 TO년월 */
           	</if>
           </if>
            )
           , W1 AS( SELECT T1.DANG_CHK_ID
     			, (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 2 THEN T1.DANG_MNGT_PRTNR_NO ELSE '' END) AS DGR1_LEVL_DG_PRTNR_NO /* 총괄단 */
                , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 2 THEN (
                        SELECT PRTNR_KNM /* 월 조직/파트너 내역(WITH).파트너한글명 */
                          FROM TB_OGBS_MM E /* 월 조직/파트너 내역(WITH) */
                         WHERE E.PRTNR_NO = T1.DANG_MNGT_PRTNR_NO /* 월 조직/파트너 내역(WITH).파트너번호 = 위험점검내역.위험관리파트너번호 */
                          AND E.BASE_YM = SUBSTR(T1.DANG_OC_STRTDT, 1, 6) /* 월 조직/파트너 내역(WITH).기준년월 = SUBSTR(위험점검내역.위험발생시작일자, 1, 6) */
                       )  ELSE '' END) AS DGR1_LEVL_DG_PRTNR_NM /* 총괄단 */
                 , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 4 THEN T1.DANG_MNGT_PRTNR_NO ELSE '' END) AS DGR2_LEVL_DG_PRTNR_NO /* 지역단 */
                , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 4 THEN (
                        SELECT PRTNR_KNM /* 월 조직/파트너 내역(WITH).파트너한글명 */
                          FROM TB_OGBS_MM E /* 월 조직/파트너 내역(WITH) */
                         WHERE E.PRTNR_NO = T1.DANG_MNGT_PRTNR_NO /* 월 조직/파트너 내역(WITH).파트너번호 = 위험점검내역.위험관리파트너번호 */
                          AND E.BASE_YM = SUBSTR(T1.DANG_OC_STRTDT, 1, 6) /* 월 조직/파트너 내역(WITH).기준년월 = SUBSTR(위험점검내역.위험발생시작일자, 1, 6) */
                       ) ELSE '' END) AS DGR2_LEVL_DG_PRTNR_NM /* 지역단 */
                 , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 5 THEN T1.DANG_MNGT_PRTNR_NO ELSE '' END) AS BZNS_SPPT_PRTNR_NO /* BM */
                , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 5 THEN (
                        SELECT PRTNR_KNM /* 월 조직/파트너 내역(WITH).파트너한글명 */
                          FROM TB_OGBS_MM_PRTNR_IZ P /* 월 파트너 내역 */
                         WHERE 1=1
                         AND P.PRTNR_NO = (SELECT PRTNR_NO FROM TB_OGBS_MM_PRTNR_IZ WHERE OG_ID = T1.DANG_OJ_OG_ID)
                       ) ELSE '' END) AS BZNS_SPPT_PRTNR_NM /* BM */
                 , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 7 THEN T1.DANG_MNGT_PRTNR_NO ELSE '' END) AS DGR3_LEVL_DG_PRTNR_NO /* 지점 */
                , (CASE WHEN T1.DANG_MNGT_PSTN_DV_CD = 7 THEN (
                        SELECT PRTNR_KNM /* 월 조직/파트너 내역(WITH).파트너한글명 */
                          FROM TB_OGBS_MM E /* 월 조직/파트너 내역(WITH) */
                         WHERE E.PRTNR_NO = T1.DANG_MNGT_PRTNR_NO /* 월 조직/파트너 내역(WITH).파트너번호 = 위험점검내역.위험관리파트너번호 */
                          AND E.BASE_YM = SUBSTR(T1.DANG_OC_STRTDT, 1, 6) /* 월 조직/파트너 내역(WITH).기준년월 = SUBSTR(위험점검내역.위험발생시작일자, 1, 6) */
                       ) ELSE '' END) AS DGR3_LEVL_DG_PRTNR_NM /* 지점 */
            FROM TB_SSCT_DANG_CHK_IZ T1 /* 위험점검내역 */
            WHERE 1=1
     )
            SELECT A.DANG_OJ_PRTNR_NO /* 위험점검내역.위험대상파트너번호 */
                 , SUBSTR(A.DANG_OC_STRTDT, 1, 6) AS DANG_OC_STRTMM /* SUBSTR(위험점검내역.위험발생시작일자,1,6) */
                 , A.DANG_OJ_OG_ID  /* 위험점검내역.위험관리조직유형코드 */
                 , (
                    SELECT PRTNR_KNM /* 월파트너내역.파트너한글명 */
                      FROM WSMDBS.TB_OGBS_MM_PRTNR_IZ T /* 월파트너내역 */
                     WHERE T.PRTNR_NO = A.DANG_OJ_PRTNR_NO /* 월파트너내역.파트너번호 = 위험점검내역.위험관리파트너번호 */
                      AND T.BASE_YM = SUBSTR(A.DANG_OC_STRTDT, 1, 6) /* 월파트너내역.기준년월 = SUBSTR(위험점검내역.위험발생시작일자, 1, 6) */
                   ) AS DANG_OJ_PNTNR_NM /* 월 조직/파트너 내역(WITH).파트너한글명 */
                 , A.DANG_OJ_PSTN_DV_CD /* 위험점검내역.위험대상직급구분코드 */
                   ,MAX(W1.DGR1_LEVL_DG_PRTNR_NO) AS DGR1_LEVL_DG_PRTNR_NO
                   ,MAX(W1.DGR1_LEVL_DG_PRTNR_NM) AS DGR1_LEVL_DG_PRTNR_NM
                   ,MAX(W1.DGR2_LEVL_DG_PRTNR_NO) AS DGR2_LEVL_DG_PRTNR_NO
                   ,MAX(W1.DGR2_LEVL_DG_PRTNR_NM) AS DGR2_LEVL_DG_PRTNR_NM
                   ,MAX(W1.BZNS_SPPT_PRTNR_NO) AS BZNS_SPPT_PRTNR_NO
                   ,MAX(W1.BZNS_SPPT_PRTNR_NM) AS BZNS_SPPT_PRTNR_NM
                   ,MAX(W1.DGR3_LEVL_DG_PRTNR_NO) AS DGR3_LEVL_DG_PRTNR_NO
                   ,MAX(W1.DGR3_LEVL_DG_PRTNR_NM) AS DGR3_LEVL_DG_PRTNR_NM
                 , A.DANG_CHK_NM /* 위험점검내역.위험점검명 */
                 , A.DANG_ARBIT_CD /* [벌점 - 조치항목]  */
                 , A.DANG_UNCVR_CT /* 위험점검내역.위험적발건수 */
                 , A.DANG_ARBIT_LVY_PC /* 위험점검내역.위험조치부과점수 */
                 , A.DANG_ARBIT_OG_ID AS DANG_ARBIT_OG_ID /* [벌점 - 조치부서] - 월조직내역.위험조치조직ID */
                 , A.FST_RGST_USR_ID /* 위험점검내역.최초등록사용자ID */
                 , SUBSTR(A.FST_RGST_DTM,0,8) AS FST_RGST_DT /* 위험점검내역.최초등록일시 */
            FROM TB_SSCT_DANG_CHK_IZ A /* 위험점검내역 */
            INNER JOIN W1
            ON W1.DANG_CHK_ID = A.DANG_CHK_ID
             WHERE 1=1
             AND A.DTA_DL_YN = 'N'
            /* 조회조건 - 적용기간(등록일자 또는 발생년월) FROM~TO */
                        <if test='@MybatisUtils@equals(srchGbn, "1")'>
                            <if test='@MybatisUtils@isNotEmpty(dangOcStrtdt)'>
                                AND  SUBSTR(A.FST_RGST_DTM,1,8) <![CDATA[ >= ]]> TRIM(#{dangOcStrtdt}) /* 위험점검내역.최초등록일시 입력한 FROM년월일 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(dangOcEnddt)'>
                                AND SUBSTR(A.FST_RGST_DTM,1,8) <![CDATA[<= ]]> TRIM(#{dangOcEnddt}) /* 위험점검내역.최초등록일시 입력한 TO년월일 */
                            </if>
                        </if>
                        <if test='@MybatisUtils@equals(srchGbn, "2")'>
                            <if test='@MybatisUtils@isNotEmpty(dangOcStrtMonth)'>
                                AND  A.DANG_OC_STRTDT <![CDATA[ >= ]]> TRIM(#{dangOcStrtMonth})||'01' /* 위험점검내역.위험발생시작일자 입력한 FROM년월 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(dangOcEndMonth)'>
                                AND A.DANG_OC_ENDDT <![CDATA[<= ]]> TRIM(#{dangOcEndMonth})||'01'),'YYYYMMDD') /* 위험점검내역.최초등록일시 입력한 TO년월 */
                            </if>
                        </if>
            GROUP BY A.DANG_OJ_PRTNR_NO, A.DANG_OC_STRTDT, A.DANG_OJ_OG_ID, A.DANG_CHK_NM, A.DANG_ARBIT_CD, A.DANG_UNCVR_CT, A.FST_RGST_USR_ID, A.FST_RGST_DTM, DANG_ARBIT_OG_ID, DANG_ARBIT_LVY_PC, A.DANG_OJ_PSTN_DV_CD
                ) G
            WHERE 1=1
                <if test='@MybatisUtils@isNotEmpty(gnrdv)'>
                    AND TRIM(G.DGR1_LEVL_DG_PRTNR_NO) LIKE #{gnrdv}||'%' /* 조회조건 - 총괄단 - 1차레벨조직 */
                </if>
                <if test='@MybatisUtils@isNotEmpty(rgrp)'>
                    AND TRIM(G.DGR2_LEVL_DG_PRTNR_NO) LIKE #{rgrp}||'%' /* 조회조건 - 지역단 - 2차레벨조직 */
                </if>
                <if test='@MybatisUtils@isNotEmpty(brch)'>
                    AND TRIM(G.DGR3_LEVL_DG_PRTNR_NO) LIKE #{brch}||'%' /* 조회조건 - 지점 - 3차레벨조직 */
                </if>
                <if test='@MybatisUtils@isNotEmpty(dangOjPrtnrNo)'>
                    AND TRIM(G.DANG_OJ_PRTNR_NO) LIKE #{dangOjPrtnrNo}||'%' /* 조회조건 - 사번 - 위험점검내역.위험관리파트너번호 */
                </if>
    </select>
    <select id="selectDangChkId" resultType="java.lang.String">
        SELECT DANG_CHK_ID
        FROM TB_SSCT_DANG_CHK_IZ
        WHERE 1=1
            AND DANG_MNGT_PRTNR_NO = #{dangOjPrtnrNo}
            AND DANG_OC_STRTDT = #{dangOcStrtdt}
            AND DANG_MNGT_PSTN_DV_CD = #{dangMngtPstnDvCd}
    </select>
    <select id="selectOrganizationInfInqr" resultType="com.kyowon.sms.wells.web.contract.risk.dto.WctcDangerArbitDto$SearchOrganizationRes">
        SELECT D.PRTNR_NO /* 월파트너내역.파트너번호 */
            , D.PRTNR_KNM /* 월파트너내역.파트너한글명 */
            , D.PSTN_DV_CD /* 월파트너내역.직급구분코드 */
            , AFMDBS.F_CMZ_CD_NM('TNT_WELLS', 'PSTN_DV_CD', D.PSTN_DV_CD) AS PSTN_DV_NM /* 직급구분명 */
            , C.DGR1_LEVL_OG_CD /* 월조직내역.1차레벨조직코드 - 총괄단 */
            , C.DGR1_LEVL_OG_NM /* 월조직내역.1차레벨조직명 - 총괄단 */
            , C.DGR1_LEVL_DG_PRTNR_NO /* 월조직내역.1차레벨대표파트너번호 - 총괄단 */
            , C.DGR1_LEVL_DG_PRTNR_NM /* 월조직내역.1차레벨대표파트너명 - 총괄단 */
            , C.DGR1_LEVL_OG_ID /* 1차레벨조직ID */
            , (SELECT MAX(D2.PSTN_DV_CD)
                FROM TB_OGBS_MM_PRTNR_IZ D2
                WHERE D2.BASE_YM = D.BASE_YM
                    AND D2.OG_TP_CD = D.OG_TP_CD
                    AND D2.DTA_DL_YN = 'N'
                    AND D2.PRTNR_NO = C.DGR1_LEVL_DG_PRTNR_NO
            ) AS DGR1_LEVL_DG_PSTN_DV_CD
            , C.DGR2_LEVL_OG_CD /* 월조직내역.2차레벨조직코드 - 지역단 */
            , C.DGR2_LEVL_OG_NM /* 월조직내역.2차레벨조직명 - 지역단 */
            , C.DGR2_LEVL_DG_PRTNR_NO /* 월조직내역.2차레벨대표파트너번호 - 지역단 */
            , C.DGR2_LEVL_DG_PRTNR_NM /* 월조직내역.2차레벨대표파트너명 - 지역단 */
            , C.DGR2_LEVL_OG_ID /* 2차레벨조직ID */
            , (SELECT MAX(D2.PSTN_DV_CD)
                FROM TB_OGBS_MM_PRTNR_IZ D2
                WHERE D2.BASE_YM = D.BASE_YM
                    AND D2.OG_TP_CD = D.OG_TP_CD
                    AND D2.DTA_DL_YN = 'N'
                    AND D2.PRTNR_NO = C.DGR2_LEVL_DG_PRTNR_NO
            ) AS DGR2_LEVL_DG_PSTN_DV_CD
            , C.DGR3_LEVL_OG_CD /* 월조직내역.3차레벨조직코드 - 지점 */
            , C.DGR3_LEVL_OG_NM /* 월조직내역.3차레벨조직명 - 지점 */
            , C.DGR3_LEVL_DG_PRTNR_NO /* 월조직내역.3차레벨대표파트너번호 - 지점 */
            , C.DGR3_LEVL_DG_PRTNR_NM /* 월조직내역.3차레벨대표파트너명 - 지점 */
            , C.DGR3_LEVL_OG_ID /* 3차레벨조직ID */
            , (SELECT MAX(D2.PSTN_DV_CD)
                FROM TB_OGBS_MM_PRTNR_IZ D2
                WHERE D2.BASE_YM = D.BASE_YM
                    AND D2.OG_TP_CD = D.OG_TP_CD
                    AND D2.DTA_DL_YN = 'N'
                    AND D2.PRTNR_NO = C.DGR3_LEVL_DG_PRTNR_NO
            ) AS DGR3_LEVL_DG_PSTN_DV_CD
            , C.DGR4_LEVL_OG_CD /* 월조직내역.4차레벨조직코드 */
            , C.DGR4_LEVL_OG_NM /* 월조직내역.4차레벨조직명 */
            , C.DGR4_LEVL_DG_PRTNR_NO /* 월조직내역.4차레벨대표파트너번호 */
            , C.DGR4_LEVL_DG_PRTNR_NM /* 월조직내역.4차레벨대표파트너명 */
            , C.DGR4_LEVL_OG_ID /* 4차레벨조직ID */
            , (SELECT MAX(D2.PSTN_DV_CD)
            FROM TB_OGBS_MM_PRTNR_IZ D2
            WHERE D2.BASE_YM = D.BASE_YM
            AND D2.OG_TP_CD = D.OG_TP_CD
            AND D2.DTA_DL_YN = 'N'
            AND D2.PRTNR_NO = C.DGR4_LEVL_DG_PRTNR_NO
            ) AS DGR4_LEVL_DG_PSTN_DV_CD
            , C.DGR5_LEVL_OG_CD /* 월조직내역.5차레벨조직코드 */
            , C.DGR5_LEVL_OG_NM /* 월조직내역.5차레벨조직명 */
            , C.DGR5_LEVL_DG_PRTNR_NO /* 월조직내역.5차레벨대표파트너번호 */
            , C.DGR5_LEVL_OG_ID /* 5차레벨조직ID */
            , C.BIZ_SPPT_PRTNR_NO /* 월조직내역.업무지원파트너번호 */
            , C.OG_UPBRNG_PRTNR_NO /* 월조직내역.조직육성파트너번호(영업지원파트너번호)-BM */
            , C.OG_CD /* 월조직내역.조직코드 */
            , C.OG_ID /* 월조직내역.조직ID */
            , C.OG_NM /* 월조직내역.조직명 */
            , C.BASE_YM /* 월조직내역.기준년월 */
            , C.OG_TP_CD /* 월조직내역.조직유형코드 */
        FROM WSMDBS.TB_OGBS_MM_OG_IZ C/* 월조직내역 - 월조직내역 TABLE의 1~5차 레벨 조직ID가 없으므로 별도로 조회 */
        INNER JOIN WSMDBS.TB_OGBS_MM_PRTNR_IZ D /* 월파트너내역 */
            ON D.BASE_YM = C.BASE_YM /* 월파트너내역.기준년월 = 월조직내역.기준년월 */
            AND D.OG_ID = C.OG_ID /* 월조직내역.조직ID = 월파트너내역.조직ID */
            AND D.OG_TP_CD = C.OG_TP_CD /* 월조직내역.조직유형코드 = 월파트너내역.조직유형코드 */
            AND D.DTA_DL_YN = 'N'/* 월파트너내역.데이터삭제여부가 'N'인 건 */
            AND C.DTA_DL_YN = 'N' /* 월조직내역.데이터삭제여부가 'N'인 건 */
        WHERE 1=1
            AND C.OG_TP_CD LIKE 'W%' /* 월조직내역의 조직유형코드 'W'로 시작 하는 건 - ▷임시처리 조직유형코드 적용 확정 이후 수정 필요 */
            <if test='@MybatisUtils@isNotEmpty(baseYm)'>
                AND C.BASE_YM = NVL(TRIM(#{baseYm}), TO_CHAR(SYSDATE, 'YYYYMM'))
            </if>
            <if test='@MybatisUtils@isNotEmpty(pntnrNo)'>
                AND D.PRTNR_NO = #{pntnrNo}
            </if>
    </select>
    <update id="updateDangerCheckIzDlYn">
        UPDATE WSMDBS.TB_SSCT_DANG_CHK_IZ
           SET DTA_DL_YN = 'Y'
           <include refid="COMMON.updateSystemField"/>
         WHERE DANG_CHK_ID = #{dangChkId}
    </update>
    <update id="updateDangerCheckChHist">
        UPDATE WSMDBS.TB_SSCT_DANG_CHK_CH_HIST
           SET DTA_DL_YN = 'Y'
           <include refid="COMMON.updateSystemField"/>
         WHERE HIST_END_DTM = '99991231235959'
            AND DANG_CHK_ID = #{dangChkId}
    </update>
    <insert id="insertDangerCheckChHistY">
        INSERT INTO WSMDBS.TB_SSCT_DANG_CHK_CH_HIST(
               DANG_CHK_ID
             , HIST_STRT_DTM
             , HIST_END_DTM
             , DANG_OJ_PRTNR_NO
             , DANG_MNGT_PRTNR_NO
             , DANG_OJ_OG_ID
             , DANG_OJ_PSTN_DV_CD
             , DANG_MNGT_PSTN_DV_CD
             , DANG_GD_CD
             , DANG_UNCVR_CT
             , DANG_CHK_NM
             , DANG_CHK_DT
             , DANG_UNCVR_CN
             , DANG_OC_STRTDT
             , DANG_OC_ENDDT
             , DANG_ARBIT_DT
             , DANG_ARBIT_CD
             , DANG_ARBIT_LVY_PC
             , DANG_ARBIT_OG_ID
             , DANG_ARBIT_CN
             , DCPLA_RS_CN
             , DCPLA_RIMB_AMT
             , DTA_DL_YN
             <include refid="COMMON.insertSystemField" />
        ) SELECT DANG_CHK_ID
             , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
             , '99991231235959'
             , DANG_OJ_PRTNR_NO
             , DANG_MNGT_PRTNR_NO
             , DANG_OJ_OG_ID
             , DANG_OJ_PSTN_DV_CD
             , DANG_MNGT_PSTN_DV_CD
             , DANG_GD_CD
             , DANG_UNCVR_CT
             , DANG_CHK_NM
             , DANG_CHK_DT
             , DANG_UNCVR_CN
             , DANG_OC_STRTDT
             , DANG_OC_ENDDT
             , DANG_ARBIT_DT
             , DANG_ARBIT_CD
             , DANG_ARBIT_LVY_PC
             , DANG_ARBIT_OG_ID
             , DANG_ARBIT_CN
             , DCPLA_RS_CN
             , DCPLA_RIMB_AMT
             , DTA_DL_YN
             <include refid="COMMON.insertSystemFieldValue" />
          FROM WSMDBS.TB_SSCT_DANG_CHK_IZ
          WHERE 1=1
             AND DANG_CHK_ID = #{dangChkId}
    </insert>

    <insert id="insertDangerCheckChHistN">
        INSERT INTO WSMDBS.TB_SSCT_DANG_CHK_CH_HIST(
              DANG_CHK_ID
            , HIST_STRT_DTM
            , HIST_END_DTM
            , DANG_OJ_PRTNR_NO
            , DANG_MNGT_PRTNR_NO
            , DANG_OJ_OG_ID
            , DANG_OJ_PSTN_DV_CD
            , DANG_MNGT_PSTN_DV_CD
            , DANG_GD_CD
            , DANG_UNCVR_CT
            , DANG_CHK_NM
            , DANG_CHK_DT
            , DANG_UNCVR_CN
            , DANG_OC_STRTDT
            , DANG_OC_ENDDT
            , DANG_ARBIT_DT
            , DANG_ARBIT_CD
            , DANG_ARBIT_LVY_PC
            , DANG_ARBIT_OG_ID
            , DANG_ARBIT_CN
            , DCPLA_RS_CN
            , DCPLA_RIMB_AMT
            , DTA_DL_YN
            <include refid="COMMON.insertSystemField" />
        ) SELECT DANG_CHK_ID
               , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
               , '99991231235959'
               , DANG_OJ_PRTNR_NO
               , DANG_MNGT_PRTNR_NO
               , DANG_OJ_OG_ID
               , DANG_OJ_PSTN_DV_CD
               , DANG_MNGT_PSTN_DV_CD
               , DANG_GD_CD
               , DANG_UNCVR_CT
               , DANG_CHK_NM
               , DANG_CHK_DT
               , DANG_UNCVR_CN
               , DANG_OC_STRTDT
               , DANG_OC_ENDDT
               , DANG_ARBIT_DT
               , DANG_ARBIT_CD
               , DANG_ARBIT_LVY_PC
               , DANG_ARBIT_OG_ID
               , DANG_ARBIT_CN
               , DCPLA_RS_CN
               , DCPLA_RIMB_AMT
               , DTA_DL_YN
            <include refid="COMMON.insertSystemFieldValue" />
          FROM WSMDBS.TB_SSCT_DANG_CHK_IZ
          WHERE 1=1
               AND DANG_CHK_ID = #{dangChkId}
    </insert>

    <insert id="insertDangerCheckIz" parameterType="com.kyowon.sms.wells.web.contract.risk.dvo.WctcDangerArbitDvo">
        <selectKey keyProperty="item.dangChkId" resultType="java.lang.String" order="BEFORE">
            SELECT LPAD(SQ_SSCT_DANG_CHK_IZ$DANG_CHK_ID.NEXTVAL,15,0)
              FROM DUAL
        </selectKey>
        INSERT INTO WSMDBS.TB_SSCT_DANG_CHK_IZ (  /* 위험점검내역 */
                  DANG_CHK_ID          /* 위험점검ID */
                , DANG_OJ_PRTNR_NO     /* 위험대상파트너번호 */
                , DANG_MNGT_PRTNR_NO   /* 위험관리파트너번호 */
                , DANG_OJ_OG_ID        /* 위험대상조직ID */
                , DANG_OJ_PSTN_DV_CD   /* 위험대상직급구분코드 */
                , DANG_MNGT_PSTN_DV_CD /* 위험관리직급구분코드 */
                , DANG_GD_CD           /* 위험등급값 */
                , DANG_UNCVR_CT        /* 위험적발건수 */
                , DANG_CHK_NM          /* 위험점검명 */
                , DANG_CHK_DT          /* 위험점검일자 */
                , DANG_UNCVR_CN        /* 위험적발내용 */
                , DANG_OC_STRTDT       /* 위험발생시작일자 */
                , DANG_OC_ENDDT        /* 위험발생종료일자 */
                , DANG_ARBIT_DT        /* 위험조치일자 */
                , DANG_ARBIT_CD        /* 위험조치코드 */
                , DANG_ARBIT_LVY_PC    /* 위험조치부과점수 */
                , DANG_ARBIT_OG_ID     /* 위험조치조직ID */
                , DANG_ARBIT_CN        /* 위험조치내용 */
                , DCPLA_RS_CN          /* 징계결과내용 */
                , DCPLA_RIMB_AMT       /* 징계변제금액 */
                , DTA_DL_YN            /* 데이터삭제여부 */
                <include refid="COMMON.insertSystemField" />)
            VALUES (
                  #{item.dangChkId}
                , #{item.dangOjPrtnrNo}
                , #{item.dangMngtPrtnrNo}
                , #{item.dangOjOgId}
                , #{item.dangArbitLvyPc}
                , #{item.dangMngtPstnDvCd}
                , #{item.dangGdCd}
                , #{item.dangUncvrCt}
                , #{item.dangChkNm}
                , #{item.dangChkDt}
                , #{item.dangUncvrCn}
                , #{item.dangOcStrtdt}
                , #{item.dangOcEnddt}
                , #{item.dangArbitDt}
                , #{item.dangArbitCd}
                , #{item.dangArbitLvyPc}
                , #{item.dangArbitOgId}
                , #{item.dangArbitCn}
                , #{item.dcplaRsCn}
                , #{item.dcplaRimbAmt}
                , 'N'
                <include refid="COMMON.insertSystemFieldValue" />
            )
    </insert>
    <update id="updateDangerCheckIz">
        UPDATE WSMDBS.TB_SSCT_DANG_CHK_IZ /* 위험점검내역 */
           SET DANG_CHK_NM          = #{dangChkNm}           /* 위험점검명 */
           , DANG_UNCVR_CT        = #{dangUncvrCt}         /* 위험적발건수 */
           , DANG_ARBIT_CD        = #{dangArbitCd}         /* 위험조치코드 */
           , DANG_ARBIT_LVY_PC    = #{dangArbitLvyPc}      /* 위험조치부과점수 */
           , DANG_ARBIT_OG_ID     = #{dangArbitOgId}       /* 위험조치조직ID */
            <include refid="COMMON.updateSystemField"/>
         WHERE 1 = 1
           AND DANG_CHK_ID          = #{dangChkId}           /* 위험점검ID */
    </update>
</mapper>
