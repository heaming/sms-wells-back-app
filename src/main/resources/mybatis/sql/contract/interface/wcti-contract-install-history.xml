<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.contract.interfaces.mapper.WctiContractInstallHistoryMapper">

	<!--
    EAI INTERFACE 통신 시 data key는 snake case를 사용함.
    resultMap을 사용하여 response dto에 매핑함.
    -->
    <resultMap id="historyInfo" type="com.kyowon.sms.wells.web.contract.interfaces.dto.WctiContractInstallHistoryDto$SearchRes">
        <constructor>
            <arg name="CNTR_NO" javaType="java.lang.String" column="CNTR_NO"/>
            <arg name="CNTR_SN" javaType="java.lang.String" column="CNTR_SN"/>
            <arg name="CRAL_LOCARA_TNO" javaType="java.lang.String" column="CRAL_LOCARA_TNO"/>
            <arg name="MEXNO" javaType="java.lang.String" column="MEXNO"/>
            <arg name="CRAL_IDV_TNO" javaType="java.lang.String" column="CRAL_IDV_TNO"/>
            <arg name="LOCARA_TNO" javaType="java.lang.String" column="LOCARA_TNO"/>
            <arg name="EXNO" javaType="java.lang.String" column="EXNO"/>
            <arg name="IDV_TNO" javaType="java.lang.String" column="IDV_TNO"/>
            <arg name="CH_DTM" javaType="java.lang.String" column="CH_DTM"/>
            <arg name="FNL_MDFC_USR_ID"	javaType="java.lang.String" column="FNL_MDFC_USR_ID"/>
            <arg name="FNL_MDFC_USR_NM" javaType="java.lang.String" column="FNL_MDFC_USR_NM"/>
        </constructor>
    </resultMap>

    <select id="selectIstlcChHist" resultMap="historyInfo">
		SELECT AR.DTL_CNTR_NO AS CNTR_NO
			 , AR.DTL_CNTR_SN AS CNTR_SN
			 , AH.CRAL_LOCARA_TNO
			 , AH.MEXNO_ENCR AS MEXNO
			 , AH.CRAL_IDV_TNO
			 , AH.LOCARA_TNO
			 , AH.EXNO_ENCR AS EXNO
			 , AH.IDV_TNO
			 , AH.HIST_STRT_DTM AS CH_DTM
			 , U0.EPNO AS FNL_MDFC_USR_ID
			 , U0.USR_NM AS FNL_MDFC_USR_NM
		  FROM TB_SSCT_CNTR_ADR_REL AR
		 INNER JOIN TB_SSCT_CNTR_ADR_CH_HIST AH
			ON AR.CNTR_ADRPC_ID = AH.CNTR_ADRPC_ID
           AND AH.DTA_DL_YN = 'N'
  		  LEFT OUTER JOIN T_CMY_USR_M U0
		    ON AH.FNL_MDFC_USR_ID = U0.USR_ID
           AND U0.TENANT_ID = 'TNT_WELLS'
           AND U0.DEL_YN = 'N'
		 WHERE AR.DTL_CNTR_NO = #{CNTR_NO}
		   AND AR.DTL_CNTR_SN = #{CNTR_SN}
		   AND AR.ADRPC_TP_CD = '2'
           AND AR.DTA_DL_YN = 'N'
         ORDER BY AH.HIST_STRT_DTM
    </select>

</mapper>
