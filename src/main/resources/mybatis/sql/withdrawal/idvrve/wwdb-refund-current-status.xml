<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.withdrawal.idvrve.mapper.WwdbRefundCurrentStatusMapper">
    <select id="selectRefundHistory" resultType="com.kyowon.sms.wells.web.withdrawal.idvrve.dto.WwdbRefundCurrentStatusDto$SearchRefundHistoryRes">
        SELECT T1.CNTR_NO
             , T1.CNTR_SN
             , T1.CNTR_NO || T1.CNTR_SN AS CNTR/*계약상세번호*/
             , (SELECT CST_KNM
                  FROM TB_CUBS_CST_BAS S1
                 WHERE 1 = 1
                   AND S1.CST_NO = T1.CST_NO
                   AND S1.DTA_DL_YN = 'N') AS CST_KNM  /*고객명*/
             , T3.SELL_TP_CD  /*판매유형*/
             , NVL(T4.DP_AMT , 0) AS DP_AMT /*입금총액*/
             , NVL(T2.RFND_DSB_AMT, 0) AS RVE_AMT  /*지급금액*/
             , NVL(T2.RFND_DSB_AMT, 0) AS RFND_DSB_AMT   /*환불금액*/
             , NVL(T2.RFND_DSB_PSP_INT , 0) AS RFND_DSB_PSP_INT  /*지연이자*/
             , NVL(T2.RFND_DDTN_AMT , 0) AS RFND_DDTN_AMT /*카드공제*/
             , T2.CSH_RFND_FNIT_CD
             , NVL((SELECT FNIT_NM
                  FROM TB_RVDW_FNIT_CD S1
                 WHERE 1 = 1
                   AND FNIT_CD = CSH_RFND_FNIT_CD
                   AND DTA_DL_YN = 'N'),'') AS CSH_FNIT_NM /*은행*/
             , T2.CARD_RFND_FNIT_CD
             , NVL((SELECT FNIT_NM
                  FROM TB_RVDW_FNIT_CD S1
                 WHERE 1 = 1
                   AND FNIT_CD = T2.CARD_RFND_FNIT_CD
                   AND DTA_DL_YN = 'N'),'') AS CARD_FNIT_NM /*카드사*/
             , T2.CSH_RFND_ACNO_ENCR                  /* 계좌번호 */
             , T2.CARD_RFND_CRCDNO_ENCR               /* 카드번호 */
             , NVL(NVL(T2.CSH_RFND_DLGPS_NM , T2.CARD_RFND_CRCDONR_NM),'')AS CSH_RFND_ACOWN_NM
             , T6.SELL_TP_CD AS SELL_TP_DTL_CD  /*판매유형*/
             , T7.DP_TP_CD AS RVE_DV_CD  /*입금유형*/
             , T5.CNTR_CST_NO AS CST_NO   /*전급고객번호*/
             , (SELECT CST_KNM
                  FROM TB_CUBS_CST_BAS S1
                 WHERE 1 = 1
                   AND S1.CST_NO = T5.CNTR_CST_NO
                   AND S1.DTA_DL_YN = 'N') AS TMP2 /*전금고객명*/
          FROM TB_RVDW_RFND_RCP_BAS T1                /* 환불접수기본 */
         INNER JOIN TB_RVDW_RFND_RCP_DTL T2                /* 환불접수상세 */
            ON (    T2.KW_GRP_CO_CD = T1.KW_GRP_CO_CD
                AND T2.RFND_RCP_NO = T1.RFND_RCP_NO
                AND T2.DTA_DL_YN = 'N')
         INNER JOIN TB_SSCT_CNTR_DTL T3 /*계약상세*/
            ON (    T3.CNTR_NO = T1.CNTR_NO
                AND T3.CNTR_SN = T1.CNTR_SN
                AND T3.DTA_DL_YN = 'N')
         INNER JOIN TB_RVDW_RVE_DTL T4 /*수납상세*/
            ON (    T4.RVE_NO  = T2.RVE_NO
                AND T4.RVE_SN  = T2.RVE_SN
                AND T4.DTA_DL_YN ='N'
                AND T4.KW_GRP_CO_CD = '2000')
          LEFT OUTER JOIN TB_SSCT_CNTR_BAS T5
            ON T5.CNTR_NO = T2.BLTF_OJ_CNTR_NO
           AND T5.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_DTL T6
            ON (    T6.CNTR_NO = T2.BLTF_OJ_CNTR_NO
                AND T6.CNTR_SN = T2.BLTF_OJ_CNTR_SN
                AND T6.DTA_DL_YN = 'N')
          LEFT OUTER JOIN LATERAL (SELECT DP_TP_CD AS DP_TP_CD
                                     FROM TB_RVDW_RVE_DTL S1
                                    WHERE 1 = 1
                                      AND S1.KW_GRP_CO_CD = T2.BLTF_OJ_CNTR_NO
                                      AND S1.CNTR_NO = T2.BLTF_OJ_CNTR_NO
                                      AND S1.CNTR_SN = T2.BLTF_OJ_CNTR_NO
                                      AND S1.DTA_DL_YN = 'N'
                                      AND S1.DP_DV_CD IN ('1','3')
                                    ORDER BY RVE_DT DESC
                                    FETCH FIRST 1 ROWS ONLY ) T7
            ON 1 = 1
         WHERE 1 = 1
           AND T1.DTA_DL_YN = 'N'
        <if test='@MybatisUtils@isNotEmpty(rveDtStart)'>
           AND T1.RFND_RVE_DT >= #{rveDtStart} /* 수납일자 */
        </if>
        <if test='@MybatisUtils@isNotEmpty(rveDtFinish)'>
           AND T1.RFND_RVE_DT <![CDATA[<=]]> #{rveDtFinish} /* 수납일자 */
        </if>
        <if test='@MybatisUtils@isNotEmpty(perfDtStart)'>
           AND T1.RFND_PERF_DT >= #{perfDtStart} /* 실적일자 */
        </if>
        <if test='@MybatisUtils@isNotEmpty(perfDtFinish)'>
           AND T1.RFND_PERF_DT <![CDATA[<=]]> #{perfDtFinish} /* 실적일자 */
        </if>

        <if test='@MybatisUtils@isNotEmpty(rfndDsbDvCd)'>
              <choose>
                <when test='@MybatisUtils@equals(rfndDsbDvCd,"04")'>
           AND T2.RFND_DSB_DV_CD = '04'               /* 환불접수상세.환불지급구분코드 = 04.귀속 */
                </when>
                <otherwise>
           AND T2.RFND_DSB_DV_CD != '04'               /* 환불접수상세.환불지급구분코드 != 04.귀속 */
                </otherwise>
              </choose>
        </if>
        <choose>
            <when test='@MybatisUtils@isNotEmpty(sellTpCd)'>
           AND T3.SELL_TP_CD = #{sellTpCd}
            </when>
            <otherwise>
           AND T3.SELL_TP_CD IN ('2','3','6')
            </otherwise>
        </choose>
        <choose>
           <when test='@MybatisUtils@isNotEmpty(sellTpDtlCd) and sellTpDtlCd != "ALL" and sellTpDtlCd != "all"'>
           AND T3.SELL_TP_DTL_CD = #{sellTpDtlCd} /* 판매유형상세 */
           </when>
           <otherwise>
           AND T3.SELL_TP_DTL_CD IN ('11', '12', '13', '21', '22', '24', '25', '26' , '31', '32', '33','61')
           </otherwise>
       </choose>
        <if test="@MybatisUtils@isNotEmpty(rveDvCd)">
            <choose>
              <when test='@MybatisUtils@equals(rveDvCd,"09")'>
           AND (T2.PROCS_DV_CD = 1 AND T4.RVE_DV_CD != '09')                  /* 수납상세.수납구분코드 != 09.대손이관 = 일반 테스트용 임시주석*/
              </when>
              <otherwise>
           AND (T2.PROCS_DV_CD = 2 AND T4.RVE_DV_CD = '09')                   /* 수납상세.수납구분코드 = 09.대손이관 = 대손구분 테스트용 임시주석 */
              </otherwise>
            </choose>
        </if>
        <if test='@MybatisUtils@isNotEmpty(dpMesCd)'> /* 수납상세.입금구분코드 조건 없음 = 전체 */
         <choose>
           <when test='@MybatisUtils@equals(dpMesCd,"07")'>
           AND T4.DP_MES_CD = '06'                     /* 수납상세.입금구분코드 = 06.포인트 */
           </when>
           <otherwise>
           AND T4.DP_MES_CD != '06'                    /* 수납상세.입금구분코드 != 06.포인트 제외 */
           </otherwise>
         </choose>
        </if>
<!--        -->
<!--      GROUP BY RRRB.CNTR_NO                          /* 계약번호 테스트용 RRD가 NULL이어서 RRRB로 바꿈*/-->
<!--             , RRRB.CNTR_SN                             /* 계약일련번호 테스트용 RRD가 NULL이어서 RRRB로 바꿈*/-->
<!--             , CCB.CST_KNM                              /* 고객명 */-->
<!--             , SCD.SELL_TP_CD                           /* 판매유형 */-->
<!--             , RRRD.CSH_RFND_FNIT_CD                    /* 은행사 */-->
<!--             , RRRD.CARD_RFND_FNIT_CD                   /* 카드사 */-->
<!--             , RRRD.CSH_RFND_ACNO_ENCR                  /* 계좌번호 */-->
<!--             , RRRD.CARD_RFND_CRCDNO_ENCR               /* 카드번호 */-->
<!--             , RRRD.CSH_RFND_ACOWN_NM                   /* 예금주 현금 */-->
<!--             , RRRD.CARD_RFND_CRDCD_APRNO               /* 예금주 카드 */-->
<!--             , SCD.SELL_TP_DTL_CD                       /* 판매유형상세 */-->
<!--             , RRD.RVE_DV_CD                            /* 입금유형 */-->
<!--             , RRRB.CST_NO                              /* 전금고객번호 */-->
<!--             /* , TMP2                                   전금고객명 */-->
    </select>

    <select id="selectCardRefundHistory" resultType="com.kyowon.sms.wells.web.withdrawal.idvrve.dto.WwdbRefundCurrentStatusDto$SearchCardRefundHistoryRes">
        SELECT M1.SELL_TP_CD AS REFUND_DIVISION
             , M1.SELL_TP_CD_NM
             , NVL(SUM(RFND_CSH_AMT),0) AS RFND_DSB_AMT
             , NVL(SUM(RFND_DDTN_AMT ),0) AS RFND_DDTN_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '361' THEN RFND_CSH_AMT END),0) AS BC_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '381' THEN RFND_CSH_AMT END),0) AS KB_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '374' THEN RFND_CSH_AMT END),0) AS HN_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '366' THEN RFND_CSH_AMT END),0) AS SH_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '365' THEN RFND_CSH_AMT END),0) AS SS_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '367' THEN RFND_CSH_AMT END),0) AS HD_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '368' THEN RFND_CSH_AMT END),0) AS LT_RFND_DSB_AMT
             , NVL(SUM( CASE WHEN CRDCD_FNIT_CD = '371' THEN RFND_CSH_AMT END),0) AS NH_RFND_DSB_AMT
             , NVL(SUM(RFND_CSH_AMT) - SUM(RFND_DDTN_AMT ) + SUM(RFND_DSB_PSP_INT), 0) AS SUM_RFND_DSB_DDTN_AMT
             , NVL(SUM(RFND_DSB_PSP_INT) , 0) AS SUM_RFND_DSB_PSP_INT
          FROM ( SELECT A1.CD_VLD_VAL SELL_TP_CD
        		      , B1.MLNG_CNTN  SELL_TP_CD_NM
        		   FROM T_CMZ_CD_D A1
        		   JOIN T_CMZ_MLNG_D B1
        		     ON B1.DEL_YN = 'N'
        		    AND B1.MLNG_ID = A1.CD_DTL_MLNG_ID
        		    AND B1.LNG_ID = 'ko'
        		    AND B1.TENANT_ID = 'TNT_WELLS'
        		  WHERE A1.TENANT_ID = 'TNT_WELLS'
        		    AND A1.CD_ID = 'SELL_TP_CD' ) M1
          LEFT OUTER JOIN ( SELECT T5.CRDCD_FNIT_CD
        					     , T3.SELL_TP_CD
        					     , SUM(T1.RFND_CSH_AMT) AS RFND_CSH_AMT
        					     , SUM(T1.RFND_DDTN_AMT) AS RFND_DDTN_AMT
        					     , SUM(T2.RFND_DSB_PSP_INT) AS RFND_DSB_PSP_INT
        					  FROM TB_RVDW_RFND_RCP_BAS T1
        					 INNER JOIN TB_RVDW_RFND_RCP_DTL T2 /*환불접수상세*/
        					    ON (    T2.KW_GRP_CO_CD = T1.KW_GRP_CO_CD
        					        AND T2.RFND_RCP_NO  = T1.RFND_RCP_NO
        					        AND T2.DTA_DL_YN = 'N')
        					 INNER JOIN TB_SSCT_CNTR_DTL T3  /*계약상세*/
        					    ON (    T3.CNTR_NO = T1.CNTR_NO
        					        AND T3.CNTR_SN = T1.CNTR_SN
        					        AND T3.DTA_DL_YN = 'N')
        					 INNER JOIN TB_RVDW_RVE_DTL T4 /*수납상세*/
        					    ON (    T4.KW_GRP_CO_CD = T2.KW_GRP_CO_CD
        					        AND T4.RVE_NO       = T2.RVE_NO
        					        AND T4.RVE_SN       = T2.RVE_SN
        					        AND T4.DTA_DL_YN    = 'N')
        					 INNER JOIN TB_RVDW_ITG_DP_BAS T5 /*통합입금번호*/
          					    ON T5.KW_GRP_CO_CD = T4.KW_GRP_CO_CD
          					   AND T5.ITG_DP_NO    = T4.ITG_DP_NO
          					   AND T5.DTA_DL_YN    = 'N'
        					 WHERE 1 = 1
        					   AND T1.RFND_CSH_AMT IS NOT NULL
        					   AND T2.RFND_DSB_DV_CD = '01'
        					  <if test='@MybatisUtils@isNotEmpty(rveDtStart)'>
        					   AND T1.RFND_RVE_DT >= #{rveDtStart} /* 수납일자 */
        					</if>
        					<if test='@MybatisUtils@isNotEmpty(rveDtFinish)'>
        					   AND T1.RFND_RVE_DT <![CDATA[<=]]> #{rveDtFinish} /* 수납일자 */
        					</if>
        					<if test='@MybatisUtils@isNotEmpty(perfDtStart)'>
        					   AND T1.RFND_PERF_DT >= #{perfDtStart} /* 실적일자 */
        					</if>
        					<if test='@MybatisUtils@isNotEmpty(perfDtFinish)'>
        					   AND T1.RFND_PERF_DT <![CDATA[<=]]> #{perfDtFinish} /* 실적일자 */
        					</if>
        					<if test='@MybatisUtils@isNotEmpty(rfndDsbDvCd)'>
        			              <choose>
        			                <when test='@MybatisUtils@equals(rfndDsbDvCd,"04")'>
        			           AND T2.RFND_DSB_DV_CD = '04'               /* 환불접수상세.환불지급구분코드 = 04.귀속 */
        			                </when>
        			                <otherwise>
        			           AND T2.RFND_DSB_DV_CD != '04'               /* 환불접수상세.환불지급구분코드 != 04.귀속 */
        			                </otherwise>
        			              </choose>
        			        </if>
        			        <if test='@MybatisUtils@isNotEmpty(sellTpCd)'>
        			           AND T3.SELL_TP_CD = #{sellTpCd}
        			        </if>
        			        <if test='@MybatisUtils@isNotEmpty(sellTpDtlCd) and sellTpDtlCd != "ALL" and sellTpDtlCd != "all"'>
        			           AND T3.SELL_TP_DTL_CD = #{sellTpDtlCd} /* 판매유형상세 */
        			        </if>
        			        <if test='@MybatisUtils@isNotEmpty(dpMesCd)'> /* 수납상세.입금구분코드 조건 없음 = 전체 */
        			         <choose>
        			           <when test='@MybatisUtils@equals(dpMesCd,"07")'>
        			           AND T4.DP_MES_CD = '06'                     /* 수납상세.입금구분코드 = 06.포인트 */
        			           </when>
        			           <otherwise>
        			           AND T4.DP_MES_CD != '06'                    /* 수납상세.입금구분코드 != 06.포인트 제외 */
        			           </otherwise>
        			         </choose>
        			        </if>
        					 GROUP BY T3.SELL_TP_CD , T5.CRDCD_FNIT_CD ) M2
              ON (    M2.SELL_TP_CD = M1.SELL_TP_CD)
           GROUP BY M1.SELL_TP_CD , M1.SELL_TP_CD_NM
           ORDER BY M1.SELL_TP_CD
    </select>

    <select id="selectBalanceTransferRefundHistory" resultType="com.kyowon.sms.wells.web.withdrawal.idvrve.dto.WwdbRefundCurrentStatusDto$SearchBalanceTransferRefundHistoryRes">
         SELECT M1.SELL_TP_DTL_CD AS REFUND_DIVISION
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '21' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS RT_RFND_DSB_AMT /*렌탈*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '22' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS LS_RFND_DSB_AMT /*리스*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '24' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS EL_RFND_DSB_AMT /*환경리스*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '31' OR M2.SELL_TP_DTL_CD = '32' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS MB_RFND_DSB_AMT /*맴버십*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '33' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS HC_RFND_DSB_AMT /*홈케어맴버십*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '25' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS LN_RFND_DSB_AMT /*장기할부*/
              , NVL(SUM(LM_RFND_DSB_AMT),0) AS LM_RFND_DSB_AMT /*할부금*/
              , NVL(SUM(KM_RFND_DSB_AMT),0) AS KM_RFND_DSB_AMT /*K머니*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '61' THEN M2.RFND_BLTF_AMT ELSE 0 END) AS RG_RFND_DSB_AMT /*정기배송*/
              , SUM(CASE WHEN M2.SELL_TP_DTL_CD = '21' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                SUM(CASE WHEN M2.SELL_TP_DTL_CD = '22' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                SUM(CASE WHEN M2.SELL_TP_DTL_CD = '24' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                SUM(CASE WHEN M2.SELL_TP_DTL_CD = '31' OR M2.SELL_TP_DTL_CD = '32' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                SUM(CASE WHEN M2.SELL_TP_DTL_CD = '33' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                SUM(CASE WHEN M2.SELL_TP_DTL_CD = '25' THEN M2.RFND_BLTF_AMT ELSE 0 END) +
                NVL(SUM(LM_RFND_DSB_AMT),0) +
                NVL(SUM(KM_RFND_DSB_AMT),0) AS SUM_RFND_DSB_AMT
           FROM (SELECT A1.CD_VLD_VAL SELL_TP_DTL_CD
                      , B1.MLNG_CNTN  SELL_TP_DTL_NM
                   FROM T_CMZ_CD_D A1
                   JOIN T_CMZ_MLNG_D B1
                     ON B1.DEL_YN = 'N'
                    AND B1.MLNG_ID = A1.CD_DTL_MLNG_ID
                    AND B1.LNG_ID = 'ko'
                    AND B1.TENANT_ID = 'TNT_WELLS'
                  WHERE A1.TENANT_ID = 'TNT_WELLS'
                    AND A1.CD_ID = 'SELL_TP_DTL_CD'
                    AND A1.CD_VLD_VAL IN ('21', '22', '24', '25', '26', '31', '32', '33','61') ) M1
           LEFT OUTER JOIN (SELECT SELL_TP_CD
                                 , SELL_TP_DTL_CD
                                 , SUM(RFND_BLTF_AMT) AS RFND_BLTF_AMT
                                 , SUM(CASE WHEN T4.RVE_DV_CD = '03' THEN T4.RVE_AMT ELSE 0 END) AS LM_RFND_DSB_AMT
                                 , SUM(CASE WHEN T4.DP_TP_CD = '0802' THEN T4.RVE_AMT ELSE 0 END) AS KM_RFND_DSB_AMT
                              FROM TB_RVDW_RFND_RCP_BAS T1
                             INNER JOIN TB_RVDW_RFND_RCP_DTL T2 /*환불접수상세*/
                                ON (    T2.KW_GRP_CO_CD = T1.KW_GRP_CO_CD
                                    AND T2.RFND_RCP_NO  = T1.RFND_RCP_NO
                                    AND T2.DTA_DL_YN = 'N')
                             INNER JOIN TB_SSCT_CNTR_DTL T3  /*계약상세*/
                                ON (    T3.CNTR_NO = T2.BLTF_OJ_CNTR_NO
                                    AND T3.CNTR_SN = T2.BLTF_OJ_CNTR_SN
                                    AND T3.DTA_DL_YN = 'N')
                             INNER JOIN TB_RVDW_RVE_DTL T4 /*수납상세*/
                                ON (    T4.KW_GRP_CO_CD = T2.KW_GRP_CO_CD
                                    AND T4.RVE_NO       = T2.RVE_NO
                                    AND T4.RVE_SN       = T2.RVE_SN
                                    AND T4.DTA_DL_YN    = 'N')
                             INNER JOIN TB_RVDW_ITG_DP_BAS T5 /*통합입금번호*/
                                ON T5.KW_GRP_CO_CD = T4.KW_GRP_CO_CD
                               AND T5.ITG_DP_NO    = T4.ITG_DP_NO
                               AND T5.DTA_DL_YN    = 'N'
                             WHERE 1 = 1
                            <if test='@MybatisUtils@isNotEmpty(rveDtStart)'>
                               AND T1.RFND_RVE_DT >= #{rveDtStart} /* 수납일자 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(rveDtFinish)'>
                               AND T1.RFND_RVE_DT <![CDATA[<=]]> #{rveDtFinish} /* 수납일자 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(perfDtStart)'>
                               AND T1.RFND_PERF_DT >= #{perfDtStart} /* 실적일자 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(perfDtFinish)'>
                               AND T1.RFND_PERF_DT <![CDATA[<=]]> #{perfDtFinish} /* 실적일자 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(rfndDsbDvCd)'>
                                  <choose>
                                    <when test='@MybatisUtils@equals(rfndDsbDvCd,"04")'>
                               AND T2.RFND_DSB_DV_CD = '04'               /* 환불접수상세.환불지급구분코드 = 04.귀속 */
                                    </when>
                                    <otherwise>
                               AND T2.RFND_DSB_DV_CD != '04'               /* 환불접수상세.환불지급구분코드 != 04.귀속 */
                                    </otherwise>
                                  </choose>
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(sellTpCd)'>
                               AND T3.SELL_TP_CD = #{sellTpCd}
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(sellTpDtlCd) and sellTpDtlCd != "ALL" and sellTpDtlCd != "all"'>
                               AND T3.SELL_TP_DTL_CD = #{sellTpDtlCd} /* 판매유형상세 */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(dpMesCd)'> /* 수납상세.입금구분코드 조건 없음 = 전체 */
                             <choose>
                               <when test='@MybatisUtils@equals(dpMesCd,"07")'>
                               AND T4.DP_MES_CD = '06'                     /* 수납상세.입금구분코드 = 06.포인트 */
                               </when>
                               <otherwise>
                               AND T4.DP_MES_CD != '06'                    /* 수납상세.입금구분코드 != 06.포인트 제외 */
                               </otherwise>
                             </choose>
                            </if>
                             GROUP BY T3.SELL_TP_CD  , T3.SELL_TP_DTL_CD ) M2
             ON (    M2.SELL_TP_DTL_CD = M1.SELL_TP_DTL_CD)
          GROUP BY M1.SELL_TP_DTL_CD , M1.SELL_TP_DTL_NM
          ORDER BY M1.SELL_TP_DTL_CD
    </select>
</mapper>
