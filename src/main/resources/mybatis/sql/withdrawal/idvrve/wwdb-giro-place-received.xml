<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.withdrawal.idvrve.mapper.WwdbGiroPlaceReceivedMgtMapper">
    <select id="selectGiroPlaceReceived" resultType="com.kyowon.sms.wells.web.withdrawal.idvrve.dto.WwdbGiroPlaceReceivedMgtDto$FindRes">
       SELECT
               T1.CNTR_NO
             , T1.CNTR_SN
             , T1.GIRO_BIZ_DV_CD --지로업무구분코드 
             , T1.GIRO_BIZ_TP_CD --지로업무유형코드 판매유형
             , T1.CST_FNM --고객명                          
             , T1.GIRO_PLRCV_ADR_ID --주소ID
             , T1.GIRO_PLRCV_RGST_DT --등록일자
             , T1.FST_RGST_USR_ID --업무담당  
             , T2.RNADR AS BAS_ADR /*주소*/          
             , T2.RDADR AS DTL_ADR /*상세주소*/
             , T2.NEW_ADR_ZIP AS ZIP /*우편번호*/
          FROM TB_RVDW_GIRO_PLRCV_BAS T1
         INNER JOIN TB_GBCO_ADR_BAS T2
            ON T2.ADR_ID = T1.GIRO_PLRCV_ADR_ID
         WHERE 1 = 1         
           AND CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
           AND T1.DTA_DL_YN = 'N'          
           AND T2.DTA_DL_YN = 'N' 
    </select>
    
    <insert id="insertGiroPlaceReceived">
        INSERT INTO TB_RVDW_GIRO_PLRCV_BAS(
            CNTR_NO
          , CNTR_SN
          , GIRO_BIZ_DV_CD --지로업무구분코드 
          , GIRO_BIZ_TP_CD --지로업무유형코드 판매유형
          , CST_FNM --고객명
          , GIRO_PLRCV_ADR_ID /* 주소 ID*/
          , GIRO_PLRCV_RGST_DT /* 등록일자*/
          <include refid="COMMON.insertSystemField"/>
        )VALUES(
            #{cntrNo}
          , #{cntrSn}
          , #{giroBizDvCd}
          , #{giroBizTpCd}
          , #{cstFnm}   
          , #{giroPlrcvAdrId}
          , #{giroPlrcvRgstDt}          
          <include refid="COMMON.insertSystemFieldValue" />
        )
        
    </insert>
    
    <update id="updateGiroPlaceReceived">
        UPDATE TB_RVDW_GIRO_PLRCV_BAS 
           SET GIRO_PLRCV_ADR_ID = #{giroPlrcvAdrId} /* 주소 ID*/
             , GIRO_PLRCV_RGST_DT = #{giroPlrcvRgstDt} /* 등록일자*/
             <include refid="COMMON.updateSystemField"/>
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = #{cntrSn}
    </update>
    <insert id="insertGiroPlaceReceivedHistory">
        INSERT INTO TB_RVDW_GIRO_PLRCV_BAS_HIST(
            CNTR_NO
          , CNTR_SN
          , GIRO_BIZ_DV_CD --지로업무구분코드 
          , GIRO_BIZ_TP_CD --지로업무유형코드 판매유형
          , CST_FNM --고객명
          , GIRO_PLRCV_ADR_ID /* 주소 ID*/
          , GIRO_PLRCV_RGST_DT /* 등록일자*/
          , HIST_CH_DTM
          <include refid="COMMON.insertSystemField"/>
        )VALUES(
            #{cntrNo}
          , #{cntrSn}
          , #{giroBizDvCd}
          , #{giroBizTpCd}
          , #{cstFnm}   
          , #{giroPlrcvAdrId}
          , #{giroPlrcvRgstDt}
          , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
          <include refid="COMMON.insertSystemFieldValue" />
        )
        
    </insert>
    
    <select id="selectGiroPlaceDupliCationReceived" resultType="int">
         SELECT 
                COUNT(1)  
           FROM TB_SSCT_CNTR_DTL 
          WHERE CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}
            AND DTA_DL_YN = 'N'     
    </select>
</mapper>