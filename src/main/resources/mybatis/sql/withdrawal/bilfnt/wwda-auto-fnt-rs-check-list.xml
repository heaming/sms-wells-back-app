<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.withdrawal.bilfnt.mapper.WwdaAftnCheckListMapper">

    <select id="selectAftnBilNrcvListPages" resultType="com.kyowon.sms.wells.web.withdrawal.bilfnt.dto.WwdaAftnCheckListDto$SearchAftnBilNrcvListRes">
                    SELECT '자동이체(은행) 청구되었으나 미수신건' AS AUTO_FNT_CLSF
                         , SCSB.BNK_CD AS BNK_CD
                         , SCSB.BNK_CD AS BNK_NM
                         , COUNT(*) AS CT
                      FROM TB_RVCL_BIL_FNT_AK_BAS RBFB
                      JOIN TB_SSCT_CNTR_STLM_BAS SCSB
                        ON RBFB.CNTR_STLM_ID = SCSB.CNTR_STLM_ID 
           LEFT OUTER JOIN TB_RVCL_AC_FNT_SEND_MTR_IZ RAFS
                        ON RBFB.BIL_NO = RAFS.BIL_NO 
           LEFT OUTER JOIN TB_RVCL_CARD_FNT_SEND_MTR_IZ RCFS
                        ON RBFB.BIL_NO = RCFS.BIL_NO 
                     WHERE RBFB.BIL_DT = #{bilDt}
                       AND RBFB.FNT_DV_CD = #{fntDvCd}
                       <if test='@MybatisUtils@equals(fntDvCd, "01")'>
                       AND RAFS.AC_FNT_RS_CD IS NULL
                       </if>
                       <if test='@MybatisUtils@equals(fntDvCd, "02")'>
                       AND RCFS.PCHS_RS_CD IS NULL 
                       </if>
                     GROUP BY SCSB.BNK_CD

    </select>
</mapper>