<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.withdrawal.interfaces.mapper.WwdbVirtualAccountDepositInterfaceMapper">

    <update id="updateVirtualAccountKiccDepositLedgerItemization">
        UPDATE TB_RVDW_VAC_KICC_DP_LEDG_IZ
           SET ITG_DP_NO = #{itgDpNo} /*통합입금번호*/
             , MTR_PROCS_YN = 'Y' /*자료처리여부*/
             , MTR_PROCS_DTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') /*자료처리일시*/
        <include refid="COMMON.updateSystemField" />
         WHERE KW_GRP_CO_CD = #{kwGrpCoCd}
           AND VAC_NO = #{vacNo}
           AND VAC_ORD_NO = #{vacOrdNo}
           AND PG_TRD_NO = #{pgTrdNo}
           AND APR_DTM = #{aprDtm}
    </update>

    <update id="updateVirtualAccountSettleBankDepositLedgerItemization">
        UPDATE TB_RVDW_VAC_STLBNK_DP_LEDG_IZ
           SET ITG_DP_NO = #{itgDpNo} /*통합입금번호*/
             , PROCS_YN = 'Y' /*자료처리여부*/
             , PROCS_DTM = TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') /*자료처리일시*/
        <include refid="COMMON.updateSystemField" />
         WHERE KW_GRP_CO_CD = #{kwGrpCoCd}
           AND VAC_BUR_CD =#{vacBurCd}
           AND VAC_TRD_NO = #{vacTrdNo}
           AND VAC_TRD_DTM = #{vacTrdDtm}
           AND VAC_TRD_KND_CD = #{vacTrdKndCd}
    </update>

    <update id="updateVirtualAccountSettleBankDepositFinish">
        UPDATE TB_RVDW_VAC_BAS
           SET VAC_ACOWN_NM = NULL /*가상계좌계좌주명*/
             , ENTRP_DV_CD = NULL /*사업자구분코드*/
             , ICHR_PRTNR_NO = NULL /*담당파트너번호*/
             , ICHR_PRTNR_NM = NULL /*담당파트너명*/
             , ICHR_PRTNR_OG_TP_CD = NULL /*담당파트너조직유형코드*/
             , ICHR_PRTNR_OG_ID = NULL /*담당파트너조직ID*/
             , RVE_CD = NULL /*수납코드*/
             , VAC_COPN_DV_CD = NULL /*가상계좌법인격구분코드*/
             , VAC_USE_PTRM_DV_CD = NULL /*가상계좌사용기간구분코드*/
             , VAC_USE_DV_CD = NULL /*가상계좌사용구분코드*/
             , VAC_IS_DV_CD = NULL /*가상계좌발급구분코드*/
             , VAC_IS_ID = NULL /*가상계좌발급ID*/
             , VAC_IS_CST_NO = NULL /*가상계좌발급고객번호*/
             , VAC_IS_CST_NM = NULL /*가상계좌발급고객명*/
             , VAC_DP_SE_AMT = NULL /*가상계좌입금설정금액*/
             , VAC_DP_OJ_CT = NULL /*가상계좌입금대상건수*/
             , VAC_DP_CNDT_CD = NULL /*가상계좌입금조건코드*/
             , VAC_DP_TMS_CD = NULL /*가상계좌입금횟수코드*/
             , VAC_DP_PSB_END_DTM = NULL /*가상계좌입금가능종료일시*/
             , CMS_CD = NULL /*CMS코드*/
             , PG_TRD_NO = NULL /*PG거래번호*/
             , VAC_RSG_DTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') /*가상계좌해지일시*/
             , FNL_TRD_DT = SUBSTR(#{dpDtm}, 0, 8) /*최종거래일자*/
             , ITRM_RVE_AMT = NULL /*기간내수납금액*/
             , ITRM_RVE_TMS = NULL /*기간내수납횟수*/
             , VAC_STAT_CD = '9' /*가상계좌상태코드*/
             , RVE_CO_CD = NULL /*수납회사코드*/
        <include refid="COMMON.updateSystemField" />
         WHERE KW_GRP_CO_CD = #{kwGrpCoCd}
           AND VAC_VNCO_DV_CD = '002'
           AND VAC_BNK_CD = #{vacBnkCd}
           AND VAC_NO = #{vacNo}
           AND VAC_IS_ID = #{vacIsId}
           AND VAC_USE_PTRM_DV_CD = '01' /*가상계좌사용기간구분코드 - 01(일회성)*/
    </update>
</mapper>
