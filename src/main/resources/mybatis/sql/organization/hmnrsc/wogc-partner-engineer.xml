<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.organization.hmnrsc.mapper.WogcPartnerEngineerMapper">
    <select id="selectEngineerAttends" resultType="com.kyowon.sms.wells.web.organization.hmnrsc.dto.WogcPartnerEngineerDto$SearchEngineerRes">
        SELECT B.OG_CD
             , B.OG_NM
             , A.PRTNR_NO
             , F_CMZ_CD_NM('TNT_WELLS', 'EGER_ROL_CD', A.ROL_DV_CD) AS ROL_DV_NM
             , A.PRTNR_KNM
             , CASE WHEN C.BIZ_AGNT_PRTNR_NO IS NOT NULL THEN 'Y'
                                                         ELSE 'N'
               END BIZ_AGNT_YN
             , #{baseDt} AS WRK_DT
             , TO_CHAR(TO_DATE(#{baseDt},'YYYYMMDD') ,'DY') AS WRK_DY
             , NVL(F_CMZ_CD_NM('TNT_WELLS','DNL_RSON_CD',C.DNL_RSON_CD),'정상') AS DNL_RSON_NM
             , C.RMK_CN
             , C.VCN_STRT_DT
             , C.VCN_END_DT
             , E.PRTNR_NO AS BIZ_AGNT_PRTNR_NO
             , E.PRTNR_KNM AS BIZ_AGNT_PRTNR_KNM
             , F_CMZ_CD_NM('TNT_WELLS','WK_GRP_CD',D.WK_GRP_CD) AS WK_GRP_NM
          FROM TB_OGBS_MM_PRTNR_IZ A
         INNER JOIN TB_OGBS_MM_OG_IZ B
            ON A.OG_ID = B.OG_ID
           AND A.OG_TP_CD = B.OG_TP_CD
           AND A.BASE_YM = B.BASE_YM
           AND A.BASE_YM = #{baseYm}
           AND A.OG_TP_CD='W06'
          LEFT OUTER JOIN TB_OGPS_EGER_ATDC_IZ C
            ON A.PRTNR_NO = C.PRTNR_NO
           AND A.OG_TP_CD = C.OG_TP_CD
           AND C.WRK_DT = #{baseDt}
          LEFT OUTER JOIN TB_OGBS_WK_GRP_BLG_DTL D
            ON A.PRTNR_NO = D.PRTNR_NO
           AND A.OG_TP_CD = D.OG_TP_CD
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ E
            ON C.BIZ_AGNT_PRTNR_NO = E.PRTNR_NO
           AND C.OG_TP_CD = E.OG_TP_CD
           AND A.BASE_YM = E.BASE_YM
         WHERE 1=1
           <if test="@MybatisUtils@isNotEmpty(ogLevlDvCd1)">
           AND OG_ID = #{ogLevlDvCd1}
           </if>
           <if test="@MybatisUtils@isNotEmpty(ogLevlDvCd2)">
           AND OG_ID = #{ogLevlDvCd2}
           </if>
    </select>
</mapper>
