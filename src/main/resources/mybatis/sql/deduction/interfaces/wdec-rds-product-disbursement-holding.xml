<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.deduction.interfaces.mapper.WdecRdsProductDisbursementHoldingInterfaceMapper">

    <!--
    EAI INTERFACE 통신 시 data key는 snake case를 사용함.
    resultMap을 사용하여 response dto에 매핑함.
    -->
    <resultMap id="rdsProductDisbursementHoldingInfo" type="com.kyowon.sms.wells.web.deduction.interfaces.dto.WdecRdsProductDisbursementHoldingInterfaceDto$FindRes">
        <constructor>
            <arg name="rdsPdDsbHdId" javaType="java.lang.String" column="RDS_PD_DSB_HD_ID"/> 
            <arg name="coCd" javaType="java.lang.String" column="CO_CD"/>
            <arg name="ogTpCd" javaType="java.lang.String" column="OG_TP_CD"/>
            <arg name="prtnrNo" javaType="java.lang.String" column="PRTNR_NO"/>
            <arg name="cntrNo" javaType="java.lang.String" column="CNTR_NO"/>
            <arg name="cntrSn" javaType="java.lang.Integer" column="CNTR_SN"/>
            <arg name="ojOgTpCd" javaType="java.lang.String" column="OJ_OG_TP_CD"/>
            <arg name="ojPrtnrNo" javaType="java.lang.String" column="OJ_PRTNR_NO"/>
            <arg name="pdgrpCd" javaType="java.lang.String" column="PDGRP_CD"/>
            <arg name="rdsHdOjDvCd" javaType="java.lang.String" column="RDS_HD_OJ_DV_CD"/>
            <arg name="rdsPdHdProcsDvCd" javaType="java.lang.String" column="RDS_PD_HD_PROCS_DV_CD"/>
            <arg name="apyStrtdt" javaType="java.lang.String" column="APY_STRTDT"/>
            <arg name="apyEnddt" javaType="java.lang.String" column="APY_ENDDT"/>
            <arg name="cltnDt" javaType="java.lang.String" column="CLTN_DT"/>
            <arg name="pstnDvCd" javaType="java.lang.String" column="PSTN_DV_CD"/>
            <arg name="hdPrcsdt" javaType="java.lang.String" column="HD_PRCSDT"/>
            <arg name="slDt" javaType="java.lang.String" column="SL_DT"/>
            <arg name="cntrTotAmt" javaType="java.lang.Integer" column="CNTR_TOT_AMT"/>
            <arg name="pyTotAmt" javaType="java.lang.Integer" column="PY_TOT_AMT"/>
            <arg name="ucTotAmt" javaType="java.lang.Integer" column="UC_TOT_AMT"/>
            <arg name="hdCalcTotAmt" javaType="java.lang.Integer" column="HD_CALC_TOT_AMT"/>
            <arg name="hdCalcTotIndvAmt" javaType="java.lang.Integer" column="HD_CALC_TOT_INDV_AMT"/>
            <arg name="hdCalcTotOgAmt" javaType="java.lang.Integer" column="HD_CALC_TOT_OG_AMT"/>
            <arg name="hdDecAmt" javaType="java.lang.Integer" column="HD_DEC_AMT"/>
            <arg name="suscMcn" javaType="java.lang.Integer" column="SUSC_MCN"/>
            <arg name="smryCn" javaType="java.lang.String" column="SMRY_CN"/>
            
            
        </constructor>
    </resultMap>

    <select id="selectRdsProductDisbursementHoldings" resultMap="rdsProductDisbursementHoldingInfo">
         SELECT 
           RDS_PD_DSB_HD_ID /*RDS상품지급보류ID*/
           ,CO_CD  /*회사코드*/
           ,OG_TP_CD  /*조직유형코드*/
           ,PRTNR_NO  /*파트너번호*/
           ,CNTR_NO  /*계약번호*/
           ,CNTR_SN /*계약일련번호*/
           ,OJ_OG_TP_CD /*대상조직유형코드*/
           ,OJ_PRTNR_NO   /*대상파트너번호*/
           ,PDGRP_CD   /*상품군코드*/
           ,RDS_HD_OJ_DV_CD   /*RDS보류대상구분코드*/
           ,RDS_PD_HD_PROCS_DV_CD   /*RDS상품보류처리구분코드*/
           ,APY_STRTDT   /*적용시작일자*/
           ,APY_ENDDT   /*적용종료일자*/
           ,CLTN_DT   /*해약일자*/
           ,PSTN_DV_CD   /*직급구분코드*/
           ,HD_PRCSDT   /*보류처리일자*/
           ,SL_DT   /*매출일자*/
           ,CNTR_TOT_AMT   /*계약총금액*/   
           ,PY_TOT_AMT   /*납입총금액*/
           ,UC_TOT_AMT   /*미수총금액*/
           ,HD_CALC_TOT_AMT   /*보류계산총금액*/
           ,HD_CALC_TOT_INDV_AMT   /*보류계산총개인금액*/
           ,HD_CALC_TOT_OG_AMT   /*보류계산총조직금액*/
           ,HD_DEC_AMT   /*보류결정금액*/
           ,SUSC_MCN   /*구독개월수*/
           ,SMRY_CN   /*적요내용*/
          FROM TB_FEDD_RDS_PD_DSB_HD_BAS /*테이블: RDS상품지급보류기본*/
         WHERE DTA_DL_YN = 'N'
           AND OG_TP_CD  = #{ogTpCd}
           AND PRTNR_NO = #{prtnrNo}
           AND HD_PRCSDT = #{hdPrcsdt}
    </select>
    
    <insert id="insertRdsProductDisbursementHoldings" parameterType="com.kyowon.sms.wells.web.deduction.interfaces.dvo.WdecRdsProductDisbursementHoldingInterfaceDvo" >
        INSERT INTO TB_FEDD_RDS_DSB_HD_OJ_IZ(  /*테이블: RDS지급보류대상내역*/
          RDS_DSB_DUEDT   /*RDS지급예정일자*/
          ,PRTNR_NO   /*파트너번호*/
          ,WK_PRTC_DTM   /*작업실행일시*/
          ,OG_TP_CD_ARY_VAL   /*조직유형코드값*/
          ,HD_WK_PRGS_STAT_CD /*조직유형코드값*/
          ,DTA_DL_YN   /*삭제여부*/ 
          <include refid="COMMON.insertSystemField" />            
          )
        VALUES (
          #{item.rdsDsbDuedt}  
          ,#{item.prtnrNO}  
          ,TO_CHAR(SYSDATE,'YYYYMMDDHHMM')
          ,#{item.ogTpCdVal} 
          ,'1' 
          ,'N' 
          <include refid="COMMON.insertSystemFieldValue" /> 
        )                
    </insert>

</mapper>
