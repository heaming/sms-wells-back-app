<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.deduction.redf.mapper.WdeaAllowanceRedfMgtMapper">

    <select id="selectAwRedfMgts" resultType="com.kyowon.sms.wells.web.deduction.redf.dto.WdeaAllowanceRedfMgtDto$SearchAwRedfRes">
        /*수당(실적) 되물림 관리_WELLS M, P, 홈마스터, 상조 */
 		SELECT T.REDF_ADSB_OC_YM /*발생년월*/
 			 , T.SL_YM /*실적년월*/
 			 , (CASE WHEN T.PD_GUB = '01' THEN '렌탈'
                     WHEN T.PD_GUB = '02' THEN '일시불/할부'
                     WHEN T.PD_GUB = '03' THEN '멤버십'
                     WHEN T.PD_GUB = '04' THEN '정기배송'
                     WHEN T.PD_GUB = '05' THEN '재약정'
                  END) AS PD_GUB/*상품구분*/
             , T.ENVR_YN
             , T.PD_CD
             , T.PD_CLSF_NM
             , T.CNTR_NO
             , T.CNTR_SN
             , T.CNTR_NO_SN /*계약상세번호*/
             , T.CST_KNM /*고객성명*/
             , T.PRTNR_KNM /*판매자*/
             , T.PRTNR_NO /*판매자번호*/
             , T.GNLR_LEDR_NO /*총괄단장*/
             , T.GNLR_LEDR /*총괄단장 성명*/
             , T.LOCAL_AREA_MANAGER_NO /*지역단장*/
             , T.LOCAL_AREA_MANAGER /*지역단장 성명*/
             , T.BRANCH_MANAGER_NO /*지점장*/
             , T.BRANCH_MANAGER /*지점장 성명*/
             , T.DSTRC_MANAGER_NO /*지구장*/
             , T.DSTRC_MANAGER /*지구장 성명*/
             , T.PERF_TP_CD /*처리유형*/
     	     , T.THM_OC_DLQ_AMT /*연체금액(기초연체금액+기초연체가산금액이 AS-IS데이터와 동일)*/
     	     , T.CNTR_DTL_STAT_CH_RSON_NM /*취소유형*/
     	     , T.DLQ_YM /*연체되물림년월*/
     	     , T.RDSB_YM
     	     , T.RENTAL_AMT
     	     , T.MCHN_CH_TP_CD /*기변유형*/
     	     , T.FEE_FXAM_YN /*정액여부*/
     	     , T.FEE_ACKMT_CT /*인정건수*/
     	     , T.PERF_VAL1
             , T.PERF_VAL2
 	     	 , T.SELL_DSC_DV_CD /*할인구분*/
 	     	 , T.SELL_DSCR_CD /*판매할인율코드(할인유형)*/
 	     	 , T.SELL_DSC_TP_CD /*프로모션코드(할인제도)*/
 	     	 , T.PAK_SN
 	     	 , T.FEE_ACKMT_BASE_AMT /*수수료기준금액, WELLS-M 일 때*/
 	     	 , T.ACKMT_PERF_AMT /*수수료인정실적 WELLS-P 일 때*/
 	     	 , T.BOO_YN /*예약여부*/
 	 		 , T.OG_CD /*지점*/
 	 		 , T.CNTR_PD_STRTDT /*설치일자*/
 	 		 , T.CAN_DT /*취소일자*/
	 		 , T.CPSN_REDF_YN /*강제되물림여부*/
             , T.RSTL_YN
 		  FROM (
		SELECT M.BASE_YM AS REDF_ADSB_OC_YM /*발생년월*/
			 , SUBSTR(A.CNTR_PD_STRTDT, 1, 6) AS SL_YM /*실적년월*/
			 , (CASE WHEN A.SELL_TP_CD = '1' AND A.STLM_TP_CD IN ('10', '20') THEN '02' /*일시불/할부*/
				 	 WHEN A.SELL_TP_CD = '2' THEN '01' /*렌탈*/
			 		 WHEN A.SELL_TP_CD =  '3' THEN '03' --'멤버십'
                     WHEN A.SELL_TP_CD =  '6' THEN '04' --'정기배송'
                   END) AS PD_GUB /*상품구분*/
             , (CASE WHEN C2.PD_CD IN (SELECT T230.PD_CD
	                                     FROM TB_PDBS_PD_ECOM_PRP_DTL T230 /* T.상품각사속성상세 */
	                                    WHERE 1=1
	                                      AND T230.PD_EXTS_PRP_GRP_CD = 'IND'
	                                      AND T230.PD_PRP_VAL11 ='Y'  /* 환경가전여부 */)
                     THEN 'Y'
                     ELSE 'N'
                   END) AS ENVR_YN /*환경여부*/
             , C2.PD_CD
             , C2.PD_NM AS PD_CLSF_NM /*상품명*/
             , M.CNTR_NO
             , M.CNTR_SN
             , M.CNTR_NO || M.CNTR_SN AS CNTR_NO_SN /*계약상세번호*/
             , C1.CST_KNM /*고객성명*/
             , D.PRTNR_KNM /*판매자*/
             , M.PRTNR_NO /*판매자번호*/
             , T1.PRTNR_NO AS GNLR_LEDR_NO /*총괄단장*/
             , T1.PRTNR_KNM AS GNLR_LEDR /*총괄단장 성명*/
             , T2.PRTNR_NO AS LOCAL_AREA_MANAGER_NO /*지역단장*/
             , T2.PRTNR_KNM AS LOCAL_AREA_MANAGER /*지역단장 성명*/
             , T3.PRTNR_NO AS BRANCH_MANAGER_NO /*지점장*/
             , T3.PRTNR_KNM AS BRANCH_MANAGER /*지점장 성명*/
             , T4.PRTNR_NO AS DSTRC_MANAGER_NO /*지구장*/
             , T4.PRTNR_KNM AS DSTRC_MANAGER /*지구장 성명*/
             , (CASE WHEN M.PERF_TP_CD = '3' THEN '매변'
             		 WHEN M.PERF_TP_CD IN ('0', '1') THEN '취소'
             		 WHEN M.PERF_TP_CD = '10' THEN '연체'
             	   END) AS PERF_TP_CD /*처리유형*/
     	     , NVL(E.BTD_DLQ_AMT + E.BTD_DLQ_ADD_AMT, 0) AS THM_OC_DLQ_AMT /*연체금액(기초연체금액+기초연체가산금액이 AS-IS데이터와 동일)*/
     	     , (CASE WHEN F.CNTR_DTL_STAT_CH_RSON_CD IS NOT NULL THEN
     	     			  F.CNTR_DTL_STAT_CH_RSON_CD || '. ' || F_CMZ_CD_NM('TNT_WELLS', 'CMN_STAT_CH_RSON_CD', F.CNTR_DTL_STAT_CH_RSON_CD, 'ko')
 	     			 ELSE ''
     			  END) AS CNTR_DTL_STAT_CH_RSON_NM /*취소유형*/
     	     , E.PERF_YM AS DLQ_YM /*연체되물림년월*/
     	     , (SELECT MIN(X.BASE_YM) AS BASE_YM
     	     	  FROM TB_FEAM_WELS_NRCTR_MM_CL X
     	     	 WHERE M.BASE_YM <![CDATA[ < ]]> X.BASE_YM
     	     	   AND X.CNTR_NO = M.CNTR_NO
     	     	   AND X.CNTR_SN = M.CNTR_SN
     	     	   AND X.CNTR_PERF_CRT_DV_CD <![CDATA[ > ]]> '07'
 	     	    ) AS RDSB_YM
     	     , (CASE WHEN A.SELL_TP_CD = '6' /*정기배송일 떄 ASIS 계산식, ((판매금액 - 할인금액)/서비스주기)*/
     	     		 THEN TRUNC((A.SELL_AMT - A.DSC_AMT) / A.SV_PRD)
     	     		 ELSE G.RENTAL_AMT
     	     	  END) AS RENTAL_AMT
     	     , M.MCHN_CH_TP_CD /*기변유형*/
     	     , A.FEE_FXAM_YN /*정액여부*/
     	     , M.ACKMT_PERF_CT AS FEE_ACKMT_CT /*인정건수*/
     	     <!--, '' AS PERF_VAL1 /*BS인정건수*/-->
     	     <!--, '' AS PERF_VAL2 /*BS신규건수*/-->
     	     , (SELECT SUM(NVL((CASE WHEN X.PERF_ATC_CD = 'W00P00011' THEN X.PERF_VAL END), 0)) AS PERF_VAL
     	          FROM TB_FEAM_NTORP_CNTR_MM_CL X
     	         WHERE M.CNTR_NO = X.CNTR_NO
     	           AND M.CNTR_SN = X.CNTR_SN
     	           AND M.BASE_YM = X.BASE_YM
     	           AND M.PERF_YM = X.PERF_YM
     	           AND X.PERF_ATC_CD = 'W00P00011' /*BS인정건수*/
     	         ) AS PERF_VAL1
             , (SELECT SUM(NVL((CASE WHEN X.PERF_ATC_CD = 'W00P00010' THEN X.PERF_VAL END), 0)) AS PERF_VAL
     	          FROM TB_FEAM_NTORP_CNTR_MM_CL X
     	         WHERE M.CNTR_NO = X.CNTR_NO
     	           AND M.CNTR_SN = X.CNTR_SN
     	           AND M.BASE_YM = X.BASE_YM
     	           AND M.PERF_YM = X.PERF_YM
     	           AND X.PERF_ATC_CD = 'W00P00010' /*BS신규판매건수*/
     	         ) AS PERF_VAL2
 	     	 , A.SELL_DSC_DV_CD /*할인구분*/
 	     	 , A.SELL_DSCR_CD /*판매할인율코드(할인유형)*/
 	     	 , A.SELL_DSC_TP_CD /*프로모션코드(할인제도)*/
 	     	 , '' AS PAK_SN
 	     	 /*TODO: 패키지 일련번호는 현재 TOBE에선 사용자에게 보여줄만한 데이터 값이 아니여서 잠시 보류중..추후 리뷰 후 협의해야할듯
             * 만약 정말로 보여줘야 한다면 계약상세의 상위상품코드를 패키지 코드인것을 보여줘야하는데 데이터 정합성이 맞는지도 의문*/
 	     	 , A.FEE_ACKMT_BASE_AMT /*수수료기준금액, WELLS-M 일 때*/
 	     	 , M.ACKMT_PERF_AMT /*수수료인정실적 WELLS-P 일 때*/
 	     	 , (CASE WHEN A.SELL_TP_CD != '6' AND A.BOO_SELL_TP_CD IS NOT NULL THEN 'Y'
 	     	 		 ELSE '' END) AS BOO_YN /*예약여부*/
 	 		 , D.OG_CD /*지점*/
 	 		 , A.CNTR_PD_STRTDT /*설치일자*/
 	 		 , (CASE WHEN SUBSTR(A.CNTR_DTL_STAT_CD, 1, 1) = '3' THEN A.CNTR_PD_ENDDT /*계약상태 취소인것들*/
 	 		 		 ELSE '' END) AS CAN_DT /*취소일자*/
	 		 , (CASE WHEN (SELECT COUNT(1)
                             FROM TB_FEDD_FEE_CPSN_REDF_OJ_IZ SUB /*수수료강제되물림대상내역*/
                            WHERE M.FEE_CPSN_REDF_ID = SUB.FEE_CPSN_REDF_ID
                              AND M.PERF_TP_CD = '1' /*강제되물림은 수당되물림(취소)만 해당*/
                           ) = '1' THEN 'Y'
                     ELSE '' END) AS CPSN_REDF_YN /*강제되물림여부*/
             , M.RSTL_YN
		  FROM TB_FEAM_WELS_NRCTR_MM_CL M /*웰스순주문계약월마감*/
		 INNER JOIN TB_SSCT_CNTR_DTL A /*계약상세*/
		    ON M.CNTR_NO = A.CNTR_NO
		   AND M.CNTR_SN = A.CNTR_SN
		   AND M.PERF_YM = SUBSTR(A.CNTR_PD_STRTDT, 1, 6)
		 INNER JOIN TB_SSCT_CNTR_BAS B /*계약기본*/
		    ON A.CNTR_NO = B.CNTR_NO
		 INNER JOIN TB_CUBS_CST_BAS C1 /*/*고객기본*/
		    ON B.CNTR_CST_NO = C1.CST_NO
		 INNER JOIN TB_PDBS_PD_BAS C2 /*상품기본*/
            ON A.BASE_PD_CD = C2.PD_CD
           AND C2.DTA_DL_YN = 'N'
	   	 INNER JOIN TB_OGBS_MM_PRTNR_IZ D /*월파트너내역*/
            ON D.BASE_YM = M.BASE_YM
           AND D.PRTNR_NO = M.PRTNR_NO
           AND D.OG_TP_CD = M.OG_TP_CD
          LEFT OUTER JOIN (
                           SELECT A.BASE_YM
                                , A.OG_TP_CD
                                , A.PRTNR_NO
                                , A.PRTNR_KNM
                                , A.OG_ID
                                , A.OG_CD
                                , A.OG_NM
                            FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                           WHERE A.PSTN_DV_CD = '2'  /*총괄단장*/
                             AND A.DTA_DL_YN = 'N'
                             ) T1  /* 총괄단장 */
             ON T1.BASE_YM = M.PERF_YM
            AND D.OG_ID = T1.OG_ID
            AND D.OG_CD = T1.OG_CD
           LEFT OUTER JOIN (
                           SELECT A.BASE_YM
                                , A.OG_TP_CD
                                , A.PRTNR_NO
                                , A.PRTNR_KNM
                                , A.OG_ID
                                , A.OG_CD
                                , A.OG_NM
                            FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                           WHERE A.PSTN_DV_CD = '4'  /*지역단장*/
                             AND A.DTA_DL_YN = 'N'
                             ) T2  /* 지역단장 */
             ON T2.BASE_YM = M.PERF_YM
            AND D.OG_ID = T2.OG_ID
            AND D.OG_CD = T2.OG_CD
           LEFT OUTER JOIN (
                           SELECT A.BASE_YM
                                , A.OG_TP_CD
                                , A.PRTNR_NO
                                , A.PRTNR_KNM
                                , A.OG_ID
                                , A.OG_CD
                                , A.OG_NM
                            FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                           WHERE A.PSTN_DV_CD = '7'  /*지점장 */
                             AND A.DTA_DL_YN = 'N'
                             ) T3  /* 지점장 */
             ON T3.BASE_YM = M.PERF_YM
            AND D.OG_ID = T3.OG_ID
            AND D.OG_CD = T3.OG_CD
           LEFT OUTER JOIN (
                           SELECT A.BASE_YM
                                , A.OG_TP_CD
                                , A.PRTNR_NO
                                , A.PRTNR_KNM
                                , A.OG_ID
                                , A.OG_CD
                                , A.OG_NM
                            FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                           WHERE A.PSTN_DV_CD = '10'  /*지구장*/
                             AND A.DTA_DL_YN = 'N'
                             ) T4  /* 지구장 */
            ON T4.BASE_YM = M.PERF_YM
           AND D.OG_ID = T4.OG_ID
           AND D.OG_CD = T4.OG_CD
          LEFT OUTER JOIN TB_CBCL_DLQ_BAS E /*연체기본*/
    	   ON M.CNTR_NO = E.CNTR_NO
    	  AND M.CNTR_SN = E.CNTR_SN
    	  AND M.BASE_YM = E.PERF_YM
    	  LEFT OUTER JOIN TB_SSCT_CNTR_DTL_STAT_CH_HIST F /*계약상세상태변경이력*/
            ON M.CNTR_NO = F.CNTR_NO
           AND M.CNTR_SN = F.CNTR_SN
           AND F.CNTR_DTL_STAT_CD != '101' /*정상이 아닌 계약만, 즉 취소유형이 존재할 데이터만 조회*/
          LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ G /*WELLS매출월마감내역(영업마감 채권)*/
            ON M.CNTR_NO = G.CNTR_NO
           AND M.CNTR_SN = G.CNTR_SN
           AND M.BASE_YM = G.SL_CL_YM
         WHERE M.DTA_DL_YN = 'N'
           AND M.FEE_TCNT_DV_CD = '02' /*수수료차수구분코드 02 고정*/
           AND M.CNTR_PERF_CRT_DV_CD != '01' /*순주문 제외*/
           <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
           AND M.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo} /*PARAM: 발생년월*/
           </if>
           <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
           AND SUBSTR(A.CNTR_PD_STRTDT, 1, 6) BETWEEN #{slYmFrom} AND #{slYmTo} /*PARAM: 매출년월*/
           </if>
           <if test='@MybatisUtils@isNotEmpty(prtnrNoFrom) and @MybatisUtils@isNotEmpty(prtnrNoTo)'>
           AND TO_NUMBER(M.PRTNR_NO) BETWEEN TO_NUMBER(#{prtnrNoFrom}) AND TO_NUMBER(#{prtnrNoTo}) /*파트너번호*/
           </if>
           <if test='@MybatisUtils@equals(redfAdsbTpCd, "0202") and redfAdsbTpCd != "ALL"'>
           AND M.PERF_TP_CD IN ('1', '3') /*화면값이 취소(0202)면 IN 조건 1:취소, 3:매변*/
           </if>
           <if test='@MybatisUtils@equals(redfAdsbTpCd, "0203") and redfAdsbTpCd != "ALL"'>
           AND M.PERF_TP_CD = '10' /*화면값이 연체(0203)면 10: 연체(전집)*/
           </if>
           <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
           AND M.OG_TP_CD = #{ogTpCd} /*조직유형*/
           AND (CASE WHEN 'W01' = #{ogTpCd} THEN '02'
                     WHEN 'W02' = #{ogTpCd} THEN '03'
                     WHEN 'W03' = #{ogTpCd} THEN '04'
                     WHEN 'W05' = #{ogTpCd} THEN '05'
                     WHEN 'W04' = #{ogTpCd} THEN '06'
                     WHEN 'Z02' = #{ogTpCd} THEN '07'
                  END) = M.CNTR_PERF_CRT_DV_CD
           <!--AND M.CNTR_PERF_CRT_DV_CD BETWEEN '01' AND '08' /* 계약실적생성구분코드가 02~07 ( 되물림 )*/-->
           </if>
           ) T
		 WHERE 1 = 1
		   <if test='@MybatisUtils@isNotEmpty(envrYn) and envrYn != "ALL"'>
		   AND T.ENVR_YN = #{envrYn} /*PARAM: 환경여부*/
		   </if>
		   <if test='@MybatisUtils@isNotEmpty(sellTpCd) and sellTpCd != "ALL"'>
		   AND T.PD_GUB = #{sellTpCd} /*PARAM: 상품구분*/
		   </if>
		   <if test='@MybatisUtils@equals(sellTpCd, "5") and sellTpCd != "ALL"'>
		   AND T.RSTL_YN = 'Y' /*PARAM: 상품구분이 재약정일 때*/
		   </if>

        <!--/*수당(실적) 되물림 관리_WELLS M, P, 홈마스터, 상조 */
        SELECT M.BASE_YM AS REDF_ADSB_OC_YM /*발생년월(기준년월)*/
             , M.PERF_YM AS SL_YM /*매출년월*/
             , (CASE WHEN A.PD_GUB = '01' THEN '렌탈'
                     WHEN A.PD_GUB = '02' THEN '일시불/할부'
                     WHEN A.PD_GUB = '03' THEN '멤버십'
                     WHEN A.PD_GUB = '04' THEN '정기배송'
                     WHEN A.PD_GUB = '05' THEN '재약정'
                      END) AS PD_GUB/*상품구분*/
             , A.ENVR_YN /*환경여부*/
             , M.PD_CD /*상품코드*/
             , B.PD_CLSF_NM /*상품명*/
             , M.CNTR_NO
             , M.CNTR_SN
             , M.CNTR_NO || M.CNTR_SN AS CNTR_NO_SN /*계약상세번호*/
             , B.CST_KNM /*고객성명*/
             , B.PRTNR_KNM /*판매자성명*/
             , M.PRTNR_NO /*파트너번호*/
             , B.GNLR_LEDR /*총괄단장*/
             , B.LOCAL_AREA_MANAGER /*지역단장*/
             , B.BRANCH_MANAGER /*지점장*/
             , B.DSTRC_MANAGER /*지구장*/
             , M.PERF_TP_CD /*실적유형코드 01: 신규(취소), 10: 연체 TODO: 확인필요, 매변 연체 취소가 실적유형코드로 통합됐는데 이 값이 맞는지*/
             , NVL(D.THM_OC_DLQ_AMT, 0) AS THM_OC_DLQ_AMT /*연체금액(연체기본.당월발생연체금액)*/
             , A.CNTR_DTL_STAT_CH_RSON_NM /*취소유형*/
             , (CASE
                 WHEN M.CNTR_PERF_CRT_DV_CD = '02' AND M.PERF_TP_CD = '10'
                 THEN M.BASE_YM
                END) AS DLQ_YM /*ASIS기준, 02: 되물림이고, 10: 연체인경우, 연체되물림년월*/
             , (CASE
                 WHEN M.CNTR_PERF_CRT_DV_CD = '03' AND M.PERF_TP_CD = '10'
                 THEN M.BASE_YM
                END) AS RDSB_YM /*ASIS기준, 03: 재지급이고, 10: 연체인경우, 재지급년월*/
             , A.RENTAL_AMT
             , M.MCHN_CH_TP_CD /*기변유형*/
             , A.FEE_FXAM_YN /*정액여부 ASIS: 일시불,할부의 경우 LC30.LCST13(수수료정액여부), 멤버십의 경우 LC35.LCET01(정액여부) 그 외 LCST13 / 정기배송의 경우 LD30.LCBGB1(수수료정액여부)*/
             , A.FEE_ACKMT_CT /*인정건수*/
             , NVL(C.PERF_VAL1, 0) AS PERF_VAL1 /*BS인정건수*/
             , NVL(C.PERF_VAL2, 0) AS PERF_VAL2 /*BS신규건수*/
             , A.SELL_DSC_DV_CD /*할인구분*/
             , A.SELL_DSCR_CD /*판매할인율코드(할인유형)*/
             , A.SELL_DSC_TP_CD /*프로모션코드(할인제도)*/
             , A.PAK_SN /*패키지일련번호, TODO 확인*/
             , A.FEE_ACKMT_BASE_AMT /*WELLS-M 수수료인정기준금액*/
             , A.ACKMT_PERF_AMT /*WELLS-P 인정실적금액*/
             , A.BOO_YN /*예약여부*/
             , E.OG_ID /*지점*/
             , A.CNTR_PD_STRTDT /*설치일자*/
             , A.CAN_DT /*취소일자*/
             , (CASE WHEN (SELECT COUNT(1)
                             FROM TB_FEAM_WELS_NRCTR_MM_CL MAIN
                            INNER JOIN TB_FEDD_FEE_CPSN_REDF_OJ_IZ SUB
                               ON MAIN.FEE_CPSN_REDF_ID = SUB.FEE_CPSN_REDF_ID
                              AND MAIN.PERF_TP_CD = '1' /*강제되물림은 수당되물림(취소)만 해당*/
                           ) = '1'
                     THEN 'Y'
                     ELSE '' END) AS CPSN_REDF_YN /*강제되물림여부*/
          FROM TB_FEAM_WELS_NRCTR_MM_CL M /*웰스순주문계약월마감*/
         INNER JOIN (
                    SELECT (CASE WHEN A2.STLM_TP_CD IN ('10', '20') THEN '02'&#45;&#45;'일시불/할부' /*결제유형코드 10:일시불, 20: 할부*/
                                 WHEN A2.SELL_TP_CD =  '2' THEN '01' &#45;&#45;'렌탈'
                                 WHEN A2.SELL_TP_CD =  '3' THEN '03' &#45;&#45;'멤버십'
                                 WHEN A2.SELL_TP_CD =  '6' THEN '04' &#45;&#45;'정기배송'
                               END) AS PD_GUB /*상품구분*/
                         , (CASE WHEN A1.SELL_TP_CD = '2' AND A2.SELL_TP_DTL_CD = '24' THEN 'Y'
                                 WHEN A1.SELL_TP_CD = '2' AND A2.SELL_TP_DTL_CD = '26' THEN 'Y'
                                 WHEN A2.STLM_TP_CD = '10' AND A2.SELL_TP_DTL_CD = '13' THEN 'Y'
                                 WHEN A2.STLM_TP_CD = '20' AND A2.SELL_TP_DTL_CD = '13' THEN 'Y'
                                 ELSE 'N' END) AS ENVR_YN /*환경여부*/
                         , A1.CNTR_NO
                         , A1.CNTR_SN
                         , (CASE WHEN A2.SELL_TP_CD =  '6'
                                 THEN TRUNC((A2.SELL_AMT - A2.DSC_AMT) / A2.SV_PRD) /*정기배송의 경우 렌탈료 계산식*/
                                 ELSE A3.RENTAL_AMT END) AS RENTAL_AMT /*렌탈료(ASIS 정기배송 (계약상세.판매금액 - 계약상세.할인금액)/서비스주기)*/
                         , A2.FEE_FXAM_YN /*정액여부*/
                         , (CASE WHEN A2.SELL_TP_CD =  '3' AND A2.SELL_TP_DTL_CD = '33' THEN 1
                                 WHEN A2.SELL_TP_CD =  '3' THEN 0
                                 ELSE A2.FEE_ACKMT_CT END) AS FEE_ACKMT_CT /*인정건수(AS-IS 인정건수)*/
                         , A2.SELL_DSC_DV_CD /*판매할인구분코드*/
                         , A2.SELL_DSCR_CD /*판매할인율코드(AS-IS 할인유형)*/
                         , A2.SELL_DSC_TP_CD /*프로모션코드(AS-IS 할인제도)*/
                         , '0' AS PAK_SN /*패키지일련번호*/
                         , A2.FEE_ACKMT_BASE_AMT /*수수료인정기준금액, TOBE 기준 WELLS-M*/
                         , A2.ACKMT_PERF_AMT /*인정실적금액, TOBE 기준 WELLS-P*/
                         , (CASE WHEN A2.SELL_TP_CD =  '6'
                                 THEN F_CMZ_CD_NM(#{session.tenantId}, 'RGLR_SPP_STAT_CH_RSON_CD', A4.CNTR_DTL_STAT_CH_RSON_CD, #{session.langId})
                                 ELSE F_CMZ_CD_NM(#{session.tenantId}, 'CMN_STAT_CH_RSON_CD', A4.CNTR_DTL_STAT_CH_RSON_CD, #{session.langId}) END) AS CNTR_DTL_STAT_CH_RSON_NM /*취소유형*/
                         , (CASE WHEN A2.SELL_TP_CD != '6' AND A2.BOO_SELL_TP_CD IS NOT NULL THEN 'Y'
                                 ELSE '' END) AS BOO_YN /*예약여부*/
                         , A2.CNTR_PD_STRTDT /*설치일자*/
                         , (CASE WHEN A2.CNTR_DTL_STAT_CD = '303' THEN A2.CNTR_PD_ENDDT
                                 ELSE '' END) AS CAN_DT /* TODO: ASIS 매핑대로일때 쿼리는 이렇고, 그냥 웰스순주문계약월마감 에서 취소일자 뽑으면 안되는건지 확인필요*/
&#45;&#45;                       , (CASE WHEN '04' = '04' AND A2.SELL_TP_CD =  '6' THEN 0
&#45;&#45;                               WHEN '03' = '03' AND A2.SELL_TP_CD =  '3' )
                            /*TODO: 패키지 일련번호는 현재 TOBE에선 사용자에게 보여줄만한 데이터 값이 아니여서 잠시 보류중..추후 리뷰 후 협의해야할듯
                             * 만약 정말로 보여줘야 한다면 계약상세의 상위삼푸코드를 패키지 코드인것을 보여줘야하는데 데이터 정합성이 맞는지도 의문*/
                      FROM TB_FEAM_WELS_NRCTR_MM_CL A1 /*웰스순주문계약월마감*/
                     INNER JOIN TB_SSCT_CNTR_DTL A2 /*계약상세*/
                        ON A1.CNTR_NO = A2.CNTR_NO
                       AND A1.CNTR_SN = A2.CNTR_SN
                     INNER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ A3 /*WELLS매출월마감내역(영업마감 채권)*/
                        ON A1.CNTR_NO = A3.CNTR_NO
                       AND A1.CNTR_SN = A3.CNTR_SN
                       AND A1.PERF_YM = A3.SL_CL_YM
                      LEFT OUTER JOIN TB_SSCT_CNTR_DTL_STAT_CH_HIST A4 /*계약상세상태변경이력*/
                        ON A1.CNTR_NO = A4.CNTR_NO
                       AND A1.CNTR_SN = A4.CNTR_SN
                       AND A4.DTA_DL_YN = 'N'
                     WHERE A1.DTA_DL_YN = 'N'
                        <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                        AND A1.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo}
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
                        AND A1.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo}
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
                        AND A1.OG_TP_CD = 'W01'
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(prtnrNoFrom) and @MybatisUtils@isNotEmpty(prtnrNoTo)'>
                        AND TO_NUMBER(A1.PRTNR_NO) BETWEEN #{prtnrNoFrom} AND #{prtnrNoTo} /*파트너번호*/
                        </if>
        &#45;&#45;              AND A1.FEE_TCNT_DV_CD = '01' /*수수료 차수 구분코드가 01 이 대상생성할때 만드는건데 화면에서 리스트 보여줄때 1차, 2차 같이보여줄지 확정됨에 따라 조건 바뀌어야함*/
                        <if test='@MybatisUtils@equals(redfAdsbTpCd, "0202") and redfAdsbTpCd != "ALL"'>
                        AND A1.PERF_TP_CD IN ('1', '3') /*화면값이 취소(0202)면 IN 조건 1:취소, 3:매변*/
                        </if>
                        <if test='@MybatisUtils@equals(redfAdsbTpCd, "0203") and redfAdsbTpCd != "ALL"'>
                        AND A1.PERF_TP_CD = '10' /*화면값이 연체(0203)면 10: 연체(전집)*/
                        </if>
                     UNION ALL
                    SELECT (CASE WHEN A2.RSTL_STAT_CD = '020' THEN '05' END) AS PD_GUB /*상품구분*/ &#45;&#45;'재약정' /*재약정상태코드 020: 확정*/
                          , 'Y' AS ENVR_YN /*ASIS 기준 재약정의 경우 환경여부 Y 고정*/
                          , A1.CNTR_NO
                          , A1.CNTR_SN
                          , A3.RENTAL_AMT
                          , '' AS FEE_FXAM_YN
                          , (CASE WHEN '05' = '05' AND A2.RSTL_STAT_CD =  '020'
                                   THEN A2.FEE_ACKMT_CT END) AS FEE_ACKMT_CT /*인정건수(AS-IS 인정건수)*/
                          , '' AS SELL_DSC_DV_CD /*판매할인구분코드*/
                          , '' AS SELL_DSCR_CD /*판매할인율코드(AS-IS 할인유형)*/
                          , '' AS SELL_DSC_TP_CD /*프로모션코드(AS-IS 할인제도)*/
                          , '0' AS PAK_SN /*패키지일련번호*/
                          , 0 AS FEE_ACKMT_BASE_AMT /*수수료인정기준금액, AS-IS는 재약정의 경우 0원 고정 처리돼있음*/
                          , A2.ACKMT_PERF_AMT /*인정실적금액*/
                          , F_CMZ_CD_NM(#{session.tenantId}, 'CMN_STAT_CH_RSON_CD', A4.CNTR_DTL_STAT_CH_RSON_CD, #{session.langId}) AS CNTR_DTL_STAT_CH_RSON_NM /*취소유형*/
                          , '' AS BOO_YN /*예약여부*/
                          , A2.STPL_STRTDT AS CNTR_PD_STRTDT /*설치일자*/
                          , (CASE WHEN A2.RSTL_STAT_CD = '030' THEN A2.STPL_ENDDT
                                  ELSE '' END) AS CAN_DT /* TODO: ASIS 매핑대로일때 쿼리는 이렇고, 그냥 웰스순주문계약월마감 에서 취소일자 뽑으면 안되는건지 확인필요*/
                       FROM TB_FEAM_WELS_NRCTR_MM_CL A1 /*웰스순주문계약월마감*/
                      INNER JOIN TB_SSCT_RENTAL_RSTL_IZ A2 /*렌탈재약정내역*/
                         ON A1.CNTR_NO = A2.CNTR_NO
                        AND A1.CNTR_SN = A2.CNTR_SN
                       LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ A3 /*WELLS매출월마감내역(영업마감 채권)*/
                         ON A1.CNTR_NO = A3.CNTR_NO
                        AND A1.CNTR_SN = A3.CNTR_SN
                        AND A1.PERF_YM = A3.SL_CL_YM
                       LEFT OUTER JOIN TB_SSCT_CNTR_DTL_STAT_CH_HIST A4 /*계약상세상태변경이력*/
                         ON A1.CNTR_NO = A4.CNTR_NO
                        AND A1.CNTR_SN = A4.CNTR_SN
                      WHERE A1.DTA_DL_YN = 'N'
                        <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                        AND A1.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo}
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
                        AND A1.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo}
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
                        AND A1.OG_TP_CD = 'W01'
                        </if>
                        <if test='@MybatisUtils@isNotEmpty(prtnrNoFrom) and @MybatisUtils@isNotEmpty(prtnrNoTo)'>
                        AND TO_NUMBER(A1.PRTNR_NO) BETWEEN #{prtnrNoFrom} AND #{prtnrNoTo} /*파트너번호*/
                        </if>
        &#45;&#45;              AND A1.FEE_TCNT_DV_CD = '01' /*수수료 차수 구분코드가 01 이 대상생성할때 만드는건데 화면에서 리스트 보여줄때 1차, 2차 같이보여줄지 확정됨에 따라 조건 바뀌어야함*/
                        <if test='@MybatisUtils@equals(redfAdsbTpCd, "0202") and redfAdsbTpCd != "ALL"'>
                        AND A1.PERF_TP_CD IN ('1', '3') /*화면값이 취소(0202)면 IN 조건 1:취소, 3:매변*/
                        </if>
                        <if test='@MybatisUtils@equals(redfAdsbTpCd, "0203") and redfAdsbTpCd != "ALL"'>
                        AND A1.PERF_TP_CD = '10' /*화면값이 연체(0203)면 10: 연체(전집)*/
                        </if>
                    )  A /*상품구분 및 환경여부 데이터 추출*/
             ON M.CNTR_NO = A.CNTR_NO
            AND M.CNTR_SN = A.CNTR_SN
           LEFT OUTER JOIN (
                            SELECT B1.CNTR_NO /*계약번호*/
                                 , B1.CNTR_SN /*계약일련번호*/
                                 , B1.BASE_YM /*기준년월 조인용*/
                                 , B1.PERF_YM /*실적년월 조인용*/
                                 , B2.SELL_PRTNR_NO /*파트너번호*/
                                 , B2.CNTR_CNFM_DTM /*계약확정일시(월파트너내역 조인용)*/
                                 , (SELECT SUB.PRTNR_KNM
                                      FROM TB_OGBS_PRTNR_BAS SUB
                                     WHERE SUB.PRTNR_NO = B2.SELL_PRTNR_NO
                                       AND SUB.OG_TP_CD = B2.SELL_OG_TP_CD) AS PRTNR_KNM
                                 , B3.CST_NO /*고객번호*/
                                 , B3.CST_KNM /*고객명*/
                                 , B5.PD_CLSF_NM /*상품분류명*/
                                 , T1.PRTNR_NO AS GNLR_LEDR_NO /*총괄단장*/
                                 , T1.PRTNR_KNM AS GNLR_LEDR /*총괄단장 성명*/
                                 , T2.PRTNR_NO AS LOCAL_AREA_MANAGER_NO /*지역단장*/
                                 , T2.PRTNR_KNM AS LOCAL_AREA_MANAGER /*지역단장 성명*/
                                 , T3.PRTNR_NO AS BRANCH_MANAGER_NO /*지점장*/
                                 , T3.PRTNR_KNM AS BRANCH_MANAGER /*지점장 성명*/
                                 , T4.PRTNR_NO AS DSTRC_MANAGER_NO /*지구장*/
                                 , T4.PRTNR_KNM AS DSTRC_MANAGER /*지구장 성명*/
                              FROM TB_FEAM_WELS_NRCTR_MM_CL B1 /*웰스순주문계약월마감*/
                             INNER JOIN TB_SSCT_CNTR_BAS B2 /*계약기본*/
                                ON B1.CNTR_NO = B2.CNTR_NO
                               AND B2.DTA_DL_YN = 'N'
                             INNER JOIN TB_CUBS_CST_BAS B3 /*고객기본*/
                                ON B2.CNTR_CST_NO = B3.CST_NO
                               AND B3.DTA_DL_YN = 'N'
                              LEFT OUTER JOIN TB_PDBS_PD_BAS B4 /*상품기본*/
                                ON B1.PD_CD = B4.PD_CD
                               AND B4.DTA_DL_YN = 'N'
                              LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS B5 /*상품분류기본*/
                                ON B4.PD_MCLSF_ID = B5.PD_CLSF_ID /*상품기본.중분류ID = 상품분류기본.상품분류ID*/
                               AND B5.PD_TP_CD = 'P'  /* 상품유형코드 = 'P'(기준상품) */
                              LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ B6 /*월파트너내역*/
                                ON B6.BASE_YM = SUBSTR(B2.CNTR_CNFM_DTM, 0, 6) /*계약확정일시*/
                               AND B6.PRTNR_NO = B2.SELL_PRTNR_NO
                               AND B6.OG_TP_CD = B2.SELL_OG_TP_CD
                              LEFT OUTER JOIN (
                                               SELECT A.BASE_YM
                                                    , A.OG_TP_CD
                                                    , A.PRTNR_NO
                                                    , A.PRTNR_KNM
                                                    , A.OG_ID
                                                    , A.OG_CD
                                                    , A.OG_NM
                                                    FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                                                   WHERE A.PSTN_DV_CD = '2'  /*총괄단장*/
                                                     AND A.DTA_DL_YN = 'N'
                                                 ) T1  /* 총괄단장 */
                                 ON T1.BASE_YM = SUBSTR(B2.CNTR_CNFM_DTM, 0, 6) /*계약확정일시*/
                                AND B6.OG_ID = T1.OG_ID
                                AND B6.OG_CD = T1.OG_CD
                               LEFT OUTER JOIN (
                                               SELECT A.BASE_YM
                                                    , A.OG_TP_CD
                                                    , A.PRTNR_NO
                                                    , A.PRTNR_KNM
                                                    , A.OG_ID
                                                    , A.OG_CD
                                                    , A.OG_NM
                                                    FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                                                   WHERE A.PSTN_DV_CD = '4'  /*지역단장*/
                                                     AND A.DTA_DL_YN = 'N'
                                                 ) T2  /* 지역단장 */
                                 ON T1.BASE_YM = SUBSTR(B2.CNTR_CNFM_DTM, 0, 6) /*계약확정일시*/
                                AND B6.OG_ID = T2.OG_ID
                                AND B6.OG_CD = T2.OG_CD
                               LEFT OUTER JOIN (
                                               SELECT A.BASE_YM
                                                    , A.OG_TP_CD
                                                    , A.PRTNR_NO
                                                    , A.PRTNR_KNM
                                                    , A.OG_ID
                                                    , A.OG_CD
                                                    , A.OG_NM
                                                    FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                                                   WHERE A.PSTN_DV_CD = '7'  /*지점장 */
                                                     AND A.DTA_DL_YN = 'N'
                                                 ) T3  /* 지점장 */
                                 ON T1.BASE_YM = SUBSTR(B2.CNTR_CNFM_DTM, 0, 6) /*계약확정일시*/
                                AND B6.OG_ID = T3.OG_ID
                                AND B6.OG_CD = T3.OG_CD
                               LEFT OUTER JOIN (
                                               SELECT A.BASE_YM
                                                    , A.OG_TP_CD
                                                    , A.PRTNR_NO
                                                    , A.PRTNR_KNM
                                                    , A.OG_ID
                                                    , A.OG_CD
                                                    , A.OG_NM
                                                    FROM TB_OGBS_MM_PRTNR_IZ A  /*월파트너내역*/
                                                   WHERE A.PSTN_DV_CD = '10'  /*지구장*/
                                                     AND A.DTA_DL_YN = 'N'
                                                 ) T4  /* 지구장 */
                                 ON T1.BASE_YM = SUBSTR(B2.CNTR_CNFM_DTM, 0, 6) /*계약확정일시*/
                                AND B6.OG_ID = T4.OG_ID
                                AND B6.OG_CD = T4.OG_CD
                           ) B /*고객 및 상품, 각 직책장 정보*/
             ON M.CNTR_NO = B.CNTR_NO
            AND M.CNTR_SN = B.CNTR_SN
            AND M.BASE_YM = B.BASE_YM
            AND M.PERF_YM = B.PERF_YM
           INNER JOIN (SELECT C.BASE_YM
                            , C.PERF_YM
                            , C.CNTR_NO
                            , C.CNTR_SN
                            , MAX(PERF_VAL1) AS PERF_VAL1
                            , MAX(PERF_VAL2) AS PERF_VAL2
                         FROM (
                               SELECT DISTINCT
                                      C1.BASE_YM /*조인용.기준년월*/
                                    , C1.PERF_YM /*조인용.실적년월*/
                                    , C1.CNTR_NO
                                    , C1.CNTR_SN
                                    , NVL((CASE WHEN C1.PERF_ATC_CD = 'W00P00010' THEN C1.PERF_VAL END), 0) AS PERF_VAL1 /*BS신규판매건수*/
                                    , NVL((CASE WHEN C1.PERF_ATC_CD = 'W00P00011' THEN C1.PERF_VAL END), 0) AS PERF_VAL2 /*BS판매인정건수*/
                                 FROM TB_FEAM_NTORP_CNTR_MM_CL C1 /*순주문파트너계약월마감*/
                                WHERE C1.DTA_DL_YN = 'N'
                                  <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                                  AND C1.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo} /*발생년월*/
                                  </if>
                                  <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
                                  AND C1.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo}
                                  </if>
                              ) C
                         GROUP BY C.BASE_YM, C.PERF_YM, C.CNTR_NO, C.CNTR_SN
                      ) C
             ON M.CNTR_NO = C.CNTR_NO
            AND M.CNTR_SN = C.CNTR_SN
            AND M.BASE_YM = C.BASE_YM
            AND M.PERF_YM = C.PERF_YM
           LEFT OUTER JOIN TB_CBCL_DLQ_BAS D /*연체기본*/
             ON M.CNTR_NO = D.CNTR_NO
            AND M.CNTR_SN = D.CNTR_SN
            AND M.PERF_YM = D.PERF_YM
           LEFT OUTER JOIN TB_SSCT_CNTR_PRTNR_REL E /*계약파트너기본.지점*/
             ON M.CNTR_NO = E.CNTR_NO
            AND M.PRTNR_NO = E.PRTNR_NO
            AND M.OG_TP_CD = E.OG_TP_CD
          WHERE M.DTA_DL_YN = 'N'
            <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
            AND M.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo} /*발생년월*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
            AND M.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo} /*매출년월*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
            AND M.OG_TP_CD = #{ogTpCd} /*조직유형*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(prtnrNoFrom) and @MybatisUtils@isNotEmpty(prtnrNoTo)'>
            AND TO_NUMBER(M.PRTNR_NO) BETWEEN #{prtnrNoFrom} AND #{prtnrNoTo} /*파트너번호*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(envrYn) and envrYn != "ALL"'>
            AND A.ENVR_YN = #{envrYn} /*환경여부*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(sellTpCd) and sellTpCd != "ALL"'>
            AND A.PD_GUB = #{sellTpCd} /*상품구분: 전체 ~ 재약정*/
            </if>
            <if test='@MybatisUtils@equals(redfAdsbTpCd, "0202") and redfAdsbTpCd != "ALL"'>
            AND M.PERF_TP_CD IN ('1', '3') /*화면값이 취소(0202)면 IN 조건 1:취소, 3:매변*/
            </if>
            <if test='@MybatisUtils@equals(redfAdsbTpCd, "0203") and redfAdsbTpCd != "ALL"'>
            AND M.PERF_TP_CD = '10' /*화면값이 연체(0203)면 10: 연체(전집)*/
            </if>-->
    </select>

    <select id="selectRedfMgts" resultType="com.kyowon.sms.wells.web.deduction.redf.dto.WdeaAllowanceRedfMgtDto$SearchRedfRes">
        /*수당(실적) 되물림 관리_WELLS 총판, B2B*/
        SELECT M.BASE_YM /*발생년월*/
             , M.PERF_YM AS SL_YM /*매출년월*/
             , A.OG_NM /*업체명*/
             , A.OG_CD /*소속코드*/
             , A.PRTNR_KNM /*판매자명*/
             , M.PRTNR_NO /*파트너번호*/
             , M.CNTR_NO /*계약번호*/
             , M.CNTR_SN /*계약일련번호*/
             , M.CNTR_NO || M.CNTR_SN AS CNTR_NO_SN /*계약상세번호*/
             , D.CST_KNM /*고객명*/
             , M.PD_CD /*제품코드(상품코드)*/
             , D.PD_CLSF_NM /*제품명(상품명)*/
             , D.MODEL_NO /*모델명*/
             , (CASE WHEN M.SELL_DSC_DV_CD IS NOT NULL AND M.SELL_DSC_TP_CD IS NOT NULL THEN
             			  M.SELL_DSC_DV_CD || '-' || M.SELL_DSC_TP_CD
         			 ELSE ''
         		  END)  AS SELL_DSC_DV_CD /*할인구분(ASIS: D-C)*/
             , (CASE WHEN M.SELL_DSC_DV_CD IS NOT NULL AND M.SELL_DSC_TP_CD IS NOT NULL THEN
             			  M.SELL_DSC_DV_CD || '-' || M.SELL_DSC_TP_CD
     			     ELSE ''
         		  END) AS SELL_DSC_TP_CD /*할인유형(ASIS: P)*/
             , M.PMOT_USWY_DV_CD /*업소*/
             , M.BFSVC_PRD_CD /*주기*/
             , B1.MCHN_CH_TP_CD AS MCHN_CH1 /*기변영*/
             , B2.MCHN_CH_TP_CD AS MCHN_CH2 /*기변센*/
             , M.RCPDT  /*계약일자*/
             , M.SL_DT /*매출일자*/
             , M.CAN_DT /*취소일자*/
             , NVL(C.REDF_AMT, 0) AS REDF_AMT /*되물림액(총판수수료)*/
          FROM TB_FEAM_WELS_NRCTR_MM_CL M /*웰스순주문계약월마감*/
         INNER JOIN TB_OGBS_PRTNR_BAS A /*파트너기본*/
            ON M.PRTNR_NO = A.PRTNR_NO
           AND M.OG_TP_CD = A.OG_TP_CD
          LEFT OUTER JOIN (SELECT BASE_CNTR_NO
                                , BASE_CNTR_SN
                                , MCHN_CH_TP_CD
                             FROM TB_SSCT_MCHN_CH_IZ) B1 /*기기변경내역.상품구분1(ASIS유형1), TODO: 유형1이 신규인지 유형2가 신규인지 확인필요*/
            ON M.CNTR_NO = B1.BASE_CNTR_NO
           AND M.CNTR_SN = B1.BASE_CNTR_SN
          LEFT OUTER JOIN (SELECT OJ_CNTR_NO
                                , OJ_CNTR_SN
                                , MCHN_CH_TP_CD
                             FROM TB_SSCT_MCHN_CH_IZ) B2 /*기기변경내역.상품구분1(ASIS유형1), TODO: 유형1이 신규인지 유형2가 신규인지 확인필요*/
            ON M.CNTR_NO = B2.OJ_CNTR_NO
           AND M.CNTR_SN = B2.OJ_CNTR_SN
          LEFT OUTER JOIN (
                             SELECT D1.CNTR_NO /*계약번호*/
                                  , D1.CNTR_SN /*계약일련번호*/
                                  , D3.CST_NO /*고객번호*/
                                  , D3.CST_KNM /*고객명*/
                                  , D4.MODEL_NO /*모델번호(모델명)*/
                                  , D5.PD_CLSF_NM /*상품분류명*/
                               FROM TB_FEAM_WELS_NRCTR_MM_CL D1 /*웰스순주문계약월마감*/
                              INNER JOIN TB_SSCT_CNTR_BAS D2 /*계약기본*/
                                 ON D1.CNTR_NO = D2.CNTR_NO
                              INNER JOIN TB_CUBS_CST_BAS D3 /*고객기본*/
                                 ON D2.CNTR_CST_NO = D3.CST_NO
                               LEFT OUTER JOIN TB_PDBS_PD_BAS D4 /*상품기본*/
                                 ON D1.PD_CD = D4.PD_CD
                               LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS D5 /*상품분류기본*/
                                 ON D4.PD_MCLSF_ID = D5.PD_CLSF_ID /*상품기본.중분류ID = 상품분류기본.상품분류ID*/
                                AND D5.PD_TP_CD = 'P'  /* 상품유형코드 = 'P'(기준상품) */
                              WHERE D1.DTA_DL_YN = 'N'
                                <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                                AND D1.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo} /*발생년월*/
                                </if>
                                <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
                                AND D1.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo} /*실적년월*/
                                </if>
                                <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
                                AND D1.OG_TP_CD = #{ogTpCd} /*조직유형*/
                                </if>
                           ) D /*고객 및 상품 정보*/
            ON M.CNTR_NO = D.CNTR_NO
           AND M.CNTR_SN = D.CNTR_SN
           LEFT OUTER JOIN ( /*TODO: 02: 계약실적생성구분코드 되물림생성이 아직 데이터가 만들어지지않아 아우터조인*/
                      SELECT DISTINCT
                             C1.PRTNR_NO /*조인용.파트너번호*/
                           , C1.OG_TP_CD /*조인용.조직유형*/
                           , C1.BASE_YM /*조인용.기준년월*/
                           , C1.PERF_YM /*조인용.실적년월*/
                           , C1.CO_CD /*조인용.회사코드*/
                           , C1.FEE_TCNT_DV_CD /*조인용.수수료차수구분코드*/
                           , C1.CNTR_NO
                           , C1.CNTR_SN
                           , C1.CNTR_PERF_CRT_DV_CD /*조인용.계약실적생성구분코드( 되물림 고정 )*/
                           <if test='@MybatisUtils@equals(ogTpCd, "W05")'>
                           , NVL((CASE WHEN C1.PERF_ATC_CD = 'W05P00001' THEN C1.PERF_VAL END), 0) AS REDF_AMT /*되물림액(총판수수료)*/
                           </if>
                           <if test='@MybatisUtils@equals(ogTpCd, "W04")'>
                           , NVL((CASE WHEN C1.PERF_ATC_CD = 'W04P00001' THEN C1.PERF_VAL END), 0) AS REDF_AMT /*되물림액(B2B수수료)*/
                           </if>
                        FROM TB_FEAM_NTORP_CNTR_MM_CL C1 /*순주문파트너계약월마감*/
                       WHERE C1.DTA_DL_YN = 'N'
                         <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                         AND C1.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo}
                         </if>
                         <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
                         AND C1.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo}
                         </if>
                         AND (CASE WHEN #{ogTpCd} = 'W01' THEN '02'
			                       WHEN #{ogTpCd} = 'W02' THEN '03'
			                       WHEN #{ogTpCd} = 'W03' THEN '04'
			                       WHEN #{ogTpCd} = 'W05' THEN '05'
			                       WHEN #{ogTpCd} = 'W04' THEN '06'
			                       WHEN #{ogTpCd} = 'Z02' THEN '07'
			                    END) = C1.CNTR_PERF_CRT_DV_CD /*계약실적생성구분코드: 되물림*/
                     ) C
             ON M.PRTNR_NO = C.PRTNR_NO
            AND M.OG_TP_CD = C.OG_TP_CD
            AND M.CNTR_NO = C.CNTR_NO
            AND M.CNTR_SN = C.CNTR_SN
            AND M.BASE_YM = C.BASE_YM
            AND M.PERF_YM = C.PERF_YM
            AND M.CO_CD = C.CO_CD
            AND M.FEE_TCNT_DV_CD = C.FEE_TCNT_DV_CD
            AND M.CNTR_PERF_CRT_DV_CD = C.CNTR_PERF_CRT_DV_CD
          WHERE M.DTA_DL_YN = 'N'
            <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
            AND M.OG_TP_CD = #{ogTpCd}
            AND (CASE WHEN #{ogTpCd} = 'W01' THEN '02'
                      WHEN #{ogTpCd} = 'W02' THEN '03'
                      WHEN #{ogTpCd} = 'W03' THEN '04'
                      WHEN #{ogTpCd} = 'W05' THEN '05'
                      WHEN #{ogTpCd} = 'W04' THEN '06'
                      WHEN #{ogTpCd} = 'Z02' THEN '07'
                   END) = M.CNTR_PERF_CRT_DV_CD /*계약실적생성구분코드: 되물림*/
            </if>
            <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
            AND M.BASE_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo}
            </if>
            <if test='@MybatisUtils@isNotEmpty(slYmFrom) and @MybatisUtils@isNotEmpty(slYmTo)'>
            AND M.PERF_YM BETWEEN #{slYmFrom} AND #{slYmTo}
            </if>
            <if test='@MybatisUtils@isNotEmpty(ogCdFrom) and @MybatisUtils@isNotEmpty(ogCdTo)'>
            AND A.OG_CD BETWEEN #{ogCdFrom} AND #{ogCdTo}
            </if>
            <if test='@MybatisUtils@equals(redfAdsbTpCd, "0202") and redfAdsbTpCd != "ALL"'>
            AND M.PERF_TP_CD IN ('1', '3') /*화면값이 취소(0202)면 IN 조건 1:취소, 3:매변*/
            </if>
            <if test='@MybatisUtils@equals(redfAdsbTpCd, "0203") and redfAdsbTpCd != "ALL"'>
            AND M.PERF_TP_CD = '10' /*화면값이 연체(0203)면 10: 연체(전집)*/
            </if>
    </select>

    <select id="selectRedfBizdMgts" resultType="com.kyowon.sms.wells.web.deduction.redf.dto.WdeaAllowanceRedfMgtDto$SearchRedfBizdRes">
        /*수당(실적) 되물림 관리 - 파트너 되물림 대상 집계 현황 조회 (통합) 목록 조회 - 영업부 되물림 생성 조회*/
        SELECT --/*+ NO_PUSH_PRED(M) */
               /*+ PUSH_PRED(M) use_nl(D M) */
               D.PERF_YM /*실적년월*/
             , D.REDF_ADSB_OC_YM AS BASE_YM /*발생년월*/
             , AK05.OG_CD /*소속코드*/
             , AK05.PRTNR_KNM /*성명*/
             , AK05.PRTNR_NO /*파트너번호*/
             , AK05.PSTN_DV_CD /*직급*/
             , AK05.OG_TP_CD /*조직유형*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'OG_TP_CD', AK05.OG_TP_CD, #{session.langId}) AS OG_TP_NM  /*조직유형*/
             , F_CMZ_CD_NM(#{session.tenantId}, 'QLF_DV_CD', AK05.QLF_DV_CD, #{session.langId}) AS QLF_DV_NM /*자격*/
             , (CASE WHEN AK55.PSTN_DV_CD = '7' THEN '지점장'
                     WHEN AK55.BZ_STAT_CD = '2' THEN '해약'
                     ELSE F_CMZ_CD_NM(#{session.tenantId}, 'QLF_DV_CD', AK55.QLF_DV_CD, #{session.langId})
                 END) AS QLF_DV_NM_1 /*자격(M+1)*/
             , (CASE WHEN AK05.PSTN_DV_CD = '10' AND M.PERF_YM <![CDATA[>=]]> '201801' /*2018 개편기준(ASIS기준)*/
                     THEN (SELECT X.QLF_DV_CD FROM TB_OGBS_MM_PRTNR_IZ X WHERE X.OG_TP_CD = 'W02' AND X.BASE_YM = M.PERF_YM AND X.PRTNR_NO = M.PRTNR_NO)
                     ELSE ''
                 END) AS DSTRC_GD /*지구등급*/
             , M.ATDC_DC AS ATDC_DC /*미팅(해당 실적년월의 출근일수)*/
<!--             , D.PERF_DV_CD AS PERF_DV_CD /*구분*/-->
             , F_CMZ_CD_NM(#{session.tenantId}, 'PERF_DV_CD', D.PERF_DV_CD, #{session.langId}) AS PERF_DV_CD /*실적구분*/
             , '' AS BRCH_DEC /*지점순감, TODO: AB7750P.지역단장 성과관리 매핑 테이블을 찾지못했음*/
             , (SELECT CASE WHEN X.PSTN_DV_CD = '10' THEN 'Y' ELSE 'N' END
                  FROM TB_OGBS_MM_PRTNR_IZ X /*월파트너내역*/
                 WHERE X.DTA_DL_YN = 'N'
                   AND X.BASE_YM = '201903'
                   AND X.OG_TP_CD = M.PRTNR_NO
                   AND X.PRTNR_NO = M.PRTNR_NO) AS MARCH_DSTRC_YN /*3월지구장*/
             , AK06.MNGT_YM AS CH_YM /*수석승급기준월(관리년월)*/
             , AK06.UPGR_YM AS WP_CH_YM /*승급년월(WELLS-P)*/
             , (SELECT CASE WHEN X.EDUC_CPC_ACKMT_YN = 'Y' THEN SUBSTR(X.EDUC_CPC_ACKMT_DT, 1, 6) ELSE '' END
                  FROM TB_PSCA_MCPTN_EDUC_IZ X /*월별파트너교육내역*/
                 WHERE X.PRTNR_NO = D.PRTNR_NO
                   AND X.OG_TP_CD = D.OG_TP_CD
                   AND X.EDUC_CRSE_NO IN ('100', '106') /*ASIS 기준, '100', '106' 고정*/
                   <!--AND X.EDUC_CRSE_CRT_BASE_YM = M.BASE_YM-->
                   <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
                   AND X.OG_TP_CD = #{ogTpCd}
                   </if>
                 ORDER BY X.EDUC_CPC_ACKMT_DT DESC
                 FETCH FIRST 1 ROW ONLY
               ) AS EDUC_CPC_MM /*수석정착 수료월*/
             , CASE WHEN NVL(D.SETTLE_REDF, 0) > 0 THEN 'Y' ELSE '' END AS AKSD48_YN /*정착 지급여부*/
             , CASE WHEN (SELECT X.EDUC_CPC_ACKMT_YN
                            FROM TB_PSCA_MCPTN_EDUC_IZ X /*월별파트너교육내역*/
                           WHERE X.PRTNR_NO = D.PRTNR_NO
                             AND X.OG_TP_CD = D.OG_TP_CD
                             <!--AND X.EDUC_CRSE_CRT_BASE_YM = M.BASE_YM-->
                             <if test='@MybatisUtils@isNotEmpty(ogTpCd)'>
                             AND X.OG_TP_CD = #{ogTpCd}
                             </if>
                           ORDER BY X.EDUC_CPC_ACKMT_DT DESC
                           FETCH FIRST 1 ROW ONLY /*TODO: 동일한 날짜(EDUC_CRSE_CRT_BASE_YM)에 EDUC_CRSE_NO가 다른 데이터가 있어서 여러 건 출력되어서 EDUC_CPC_ACKMT_DT기준으로 최신 데이터 뽑음. 맞는지 확인 필요*/
                ) = 'Y' THEN 'Y' ELSE '' END AS EDU17_YN /*플래너실전 수료여부*/
             , NVL(C.SELL_AMT, 0) AS SELL_AMT /*귀속월매출*/
             , NVL(C.ACKMT_PERF_RT, 0) || '%' AS ACKMT_PERF_RT /*지급율*/
             , (CASE WHEN AK05.PSTN_DV_CD = '10'
                     THEN (SELECT CASE WHEN COUNT(1) <![CDATA[>]]> 1 THEN '' ELSE 'Y' END
                             FROM TB_OGBS_OG_BAS A
                            WHERE A.OG_CD = AK05.OG_CD
                              AND A.OG_TP_CD = AK05.OG_TP_CD) END) AS ONETEAM_YN /*단독지구*/
             , NVL(M.HOME_CARE, 0) AS HOME_CARE /*홈케어실적*/
             , NVL(M.MC_PERF, 0) AS MC_PERF /*기변실적*/
--             /*환경가전*/
             , NVL(M.TB_ENVR_ELHM, 0) AS TB_ENVR_ELHM /*환경가전.귀속전월실적*/
             , NVL(M.T_ENVR_ELHM, 0) AS T_ENVR_ELHM /*환경가전.귀속월실적*/
             -- 되물림전실적 :  되물림 전실적이 0이거나 없으면, 최초실적 아니면 되물림전실적 그대로 보여줌
             , (CASE WHEN M.B_ENVR_ELHM = 0 OR M.B_ENVR_ELHM IS NULL THEN M.T_ENVR_ELHM ELSE M.B_ENVR_ELHM END) AS B_ENVR_ELHM/*환경가전.되물림전실적*/
             -- (되물림실적 = 되물림금액) = 되물림전실적 - 되물림후실적
             , (CASE WHEN M.B_ENVR_ELHM = 0 OR M.B_ENVR_ELHM IS NULL THEN M.T_ENVR_ELHM ELSE M.B_ENVR_ELHM END) -
                CASE WHEN M.A_ENVR_ELHM = 0 OR M.A_ENVR_ELHM IS NULL THEN (CASE WHEN M.B_ENVR_ELHM = 0 OR M.B_ENVR_ELHM IS NULL THEN M.T_ENVR_ELHM ELSE M.B_ENVR_ELHM END) ELSE M.A_ENVR_ELHM END AS ENVR_ELHM /*환경가전.되물림실적*/
             -- 되물림후실적 = 되물림후실적이 0이거나 없으면, 최초실적에서 되물림이 일어나지 않았다는것이므로, 되물림전실적을 보여준다. 아니면 되물림 후실적 보여줌
             , CASE WHEN M.A_ENVR_ELHM = 0 OR M.A_ENVR_ELHM IS NULL THEN (CASE WHEN M.B_ENVR_ELHM = 0 OR M.B_ENVR_ELHM IS NULL THEN M.T_ENVR_ELHM ELSE M.B_ENVR_ELHM END) ELSE M.A_ENVR_ELHM END AS A_ENVR_ELHM/*환경가전.되물림후실적*/
--             /*환경가전(건수)*/
             , NVL(M.TB_ENVR_ELHM_CNT, 0) AS TB_ENVR_ELHM_CNT/*환경가전(건수).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_CNT, 0) AS T_ENVR_ELHM_CNT/*환경가전(건수).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT = 0 OR M.B_ENVR_ELHM_CNT IS NULL THEN M.T_ENVR_ELHM_CNT ELSE M.B_ENVR_ELHM_CNT END) AS B_ENVR_ELHM_CNT/*환경가전(건수).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT = 0 OR M.B_ENVR_ELHM_CNT IS NULL THEN M.T_ENVR_ELHM_CNT ELSE M.B_ENVR_ELHM_CNT END) -
               (CASE WHEN M.A_ENVR_ELHM_CNT = 0 OR M.A_ENVR_ELHM_CNT IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT = 0 OR M.B_ENVR_ELHM_CNT IS NULL THEN M.T_ENVR_ELHM_CNT ELSE M.B_ENVR_ELHM_CNT END) ELSE M.A_ENVR_ELHM_CNT END ) AS ENVR_ELHM_CNT /*환경가전(건수).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_CNT = 0 OR M.A_ENVR_ELHM_CNT IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT = 0 OR M.B_ENVR_ELHM_CNT IS NULL THEN M.T_ENVR_ELHM_CNT ELSE M.B_ENVR_ELHM_CNT END) ELSE M.A_ENVR_ELHM_CNT END ) AS A_ENVR_ELHM_CNT/*환경가전(건수).되물림후실적*/
--             /*환경가전 건수(개인)*/
             , NVL(M.TB_ENVR_ELHM_CNT_PR, 0) AS TB_ENVR_ELHM_CNT_PR/*환경가전(개인).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_CNT_PR, 0) AS T_ENVR_ELHM_CNT_PR/*환경가전(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT_PR = 0 OR M.B_ENVR_ELHM_CNT_PR IS NULL THEN M.T_ENVR_ELHM_CNT_PR ELSE M.B_ENVR_ELHM_CNT_PR END) AS B_ENVR_ELHM_CNT_PR/*환경가전(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT_PR = 0 OR M.B_ENVR_ELHM_CNT_PR IS NULL THEN M.T_ENVR_ELHM_CNT_PR ELSE M.B_ENVR_ELHM_CNT_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_CNT_PR = 0 OR M.A_ENVR_ELHM_CNT_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT_PR = 0 OR M.B_ENVR_ELHM_CNT_PR IS NULL THEN M.T_ENVR_ELHM_CNT_PR ELSE M.B_ENVR_ELHM_CNT_PR END) ELSE M.A_ENVR_ELHM_CNT_PR END ) AS ENVR_ELHM_CNT_PR /*환경가전(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_CNT_PR = 0 OR M.A_ENVR_ELHM_CNT_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT_PR = 0 OR M.B_ENVR_ELHM_CNT_PR IS NULL THEN M.T_ENVR_ELHM_CNT_PR ELSE M.B_ENVR_ELHM_CNT_PR END) ELSE M.A_ENVR_ELHM_CNT_PR END ) AS A_ENVR_ELHM_CNT_PR/*환경가전(개인).되물림후실적*/
--             /*환경가전 건수(조직)*/
             , NVL(M.TB_ENVR_ELHM_CNT_JO, 0) AS TB_ENVR_ELHM_CNT_JO/*환경가전 건수(조직).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_CNT_JO, 0) AS T_ENVR_ELHM_CNT_JO/*환경가전 건수(조직).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT_JO = 0 OR M.B_ENVR_ELHM_CNT_JO IS NULL THEN M.T_ENVR_ELHM_CNT_JO ELSE M.B_ENVR_ELHM_CNT_JO END) AS B_ENVR_ELHM_CNT_JO/*환경가전 건수(조직).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_CNT_JO = 0 OR M.B_ENVR_ELHM_CNT_JO IS NULL THEN M.T_ENVR_ELHM_CNT_JO ELSE M.B_ENVR_ELHM_CNT_JO END) -
               (CASE WHEN M.A_ENVR_ELHM_CNT_JO = 0 OR M.A_ENVR_ELHM_CNT_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT_JO = 0 OR M.B_ENVR_ELHM_CNT_JO IS NULL THEN M.T_ENVR_ELHM_CNT_JO ELSE M.B_ENVR_ELHM_CNT_JO END) ELSE M.A_ENVR_ELHM_CNT_JO END ) AS ENVR_ELHM_CNT_JO /*환경가전 건수(조직).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_CNT_JO = 0 OR M.A_ENVR_ELHM_CNT_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_CNT_JO = 0 OR M.B_ENVR_ELHM_CNT_JO IS NULL THEN M.T_ENVR_ELHM_CNT_JO ELSE M.B_ENVR_ELHM_CNT_JO END) ELSE M.A_ENVR_ELHM_CNT_JO END ) AS A_ENVR_ELHM_CNT_JO/*환경가전 건수(조직).되물림후실적*/
--             /*환경가전(기준가격)*/
             , NVL(M.T_ENVR_ELHM_BASE_AMT, 0) AS T_ENVR_ELHM_BASE_AMT/*환경가전(기준가격).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_BASE_AMT = 0 OR M.B_ENVR_ELHM_BASE_AMT IS NULL THEN M.T_ENVR_ELHM_BASE_AMT ELSE M.B_ENVR_ELHM_BASE_AMT END) AS B_ENVR_ELHM_BASE_AMT/*환경가전(기준가격).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_BASE_AMT = 0 OR M.B_ENVR_ELHM_BASE_AMT IS NULL THEN M.T_ENVR_ELHM_BASE_AMT ELSE M.B_ENVR_ELHM_BASE_AMT END) -
               (CASE WHEN M.A_ENVR_ELHM_BASE_AMT = 0 OR M.A_ENVR_ELHM_BASE_AMT IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_BASE_AMT = 0 OR M.B_ENVR_ELHM_BASE_AMT IS NULL THEN M.T_ENVR_ELHM_BASE_AMT ELSE M.B_ENVR_ELHM_BASE_AMT END) ELSE M.A_ENVR_ELHM_BASE_AMT END ) AS ENVR_ELHM_BASE_AMT /*환경가전(기준가격).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_BASE_AMT = 0 OR M.A_ENVR_ELHM_BASE_AMT IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_BASE_AMT = 0 OR M.B_ENVR_ELHM_BASE_AMT IS NULL THEN M.T_ENVR_ELHM_BASE_AMT ELSE M.B_ENVR_ELHM_BASE_AMT END) ELSE M.A_ENVR_ELHM_BASE_AMT END ) AS A_ENVR_ELHM_BASE_AMT/*환경가전(기준가격).되물림후실적*/
--             /*환경가전 렌탈*/
             , NVL(M.TB_ENVR_ELHM_RENTAL, 0) AS TB_ENVR_ELHM_RENTAL/*환경가전 렌탈.귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_RENTAL, 0) AS T_ENVR_ELHM_RENTAL/*환경가전 렌탈.귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL = 0 OR M.B_ENVR_ELHM_RENTAL IS NULL THEN M.T_ENVR_ELHM_RENTAL ELSE M.B_ENVR_ELHM_RENTAL END) AS B_ENVR_ELHM_RENTAL/*환경가전 렌탈.되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL = 0 OR M.B_ENVR_ELHM_RENTAL IS NULL THEN M.T_ENVR_ELHM_RENTAL ELSE M.B_ENVR_ELHM_RENTAL END) -
               (CASE WHEN M.A_ENVR_ELHM_RENTAL = 0 OR M.A_ENVR_ELHM_RENTAL IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL = 0 OR M.B_ENVR_ELHM_RENTAL IS NULL THEN M.T_ENVR_ELHM_RENTAL ELSE M.B_ENVR_ELHM_RENTAL END) ELSE M.A_ENVR_ELHM_RENTAL END ) AS ENVR_ELHM_RENTAL /*환경가전 렌탈.되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_RENTAL = 0 OR M.A_ENVR_ELHM_RENTAL IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL = 0 OR M.B_ENVR_ELHM_RENTAL IS NULL THEN M.T_ENVR_ELHM_RENTAL ELSE M.B_ENVR_ELHM_RENTAL END) ELSE M.A_ENVR_ELHM_RENTAL END ) AS A_ENVR_ELHM_RENTAL/*환경가전 렌탈.되물림후실적*/
--             /*환경가전 렌탈(조직)*/
             , NVL(M.TB_ENVR_ELHM_RENTAL_JO, 0) AS TB_ENVR_ELHM_RENTAL_JO/*환경가전 렌탈(조직).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_RENTAL_JO, 0) AS T_ENVR_ELHM_RENTAL_JO/*환경가전 렌탈(조직).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL_JO = 0 OR M.B_ENVR_ELHM_RENTAL_JO IS NULL THEN M.T_ENVR_ELHM_RENTAL_JO ELSE M.B_ENVR_ELHM_RENTAL_JO END) AS B_ENVR_ELHM_RENTAL_JO/*환경가전 렌탈(조직).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL_JO = 0 OR M.B_ENVR_ELHM_RENTAL_JO IS NULL THEN M.T_ENVR_ELHM_RENTAL_JO ELSE M.B_ENVR_ELHM_RENTAL_JO END) -
               (CASE WHEN M.A_ENVR_ELHM_RENTAL_JO = 0 OR M.A_ENVR_ELHM_RENTAL_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL_JO = 0 OR M.B_ENVR_ELHM_RENTAL_JO IS NULL THEN M.T_ENVR_ELHM_RENTAL_JO ELSE M.B_ENVR_ELHM_RENTAL_JO END) ELSE M.A_ENVR_ELHM_RENTAL_JO END ) AS ENVR_ELHM_RENTAL_JO /*환경가전 렌탈(조직).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_RENTAL_JO = 0 OR M.A_ENVR_ELHM_RENTAL_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL_JO = 0 OR M.B_ENVR_ELHM_RENTAL_JO IS NULL THEN M.T_ENVR_ELHM_RENTAL_JO ELSE M.B_ENVR_ELHM_RENTAL_JO END) ELSE M.A_ENVR_ELHM_RENTAL_JO END ) AS A_ENVR_ELHM_RENTAL_JO/*환경가전 렌탈(조직).되물림후실적*/
--             /*환경가전 렌탈(개인)*/
             , NVL(M.TB_ENVR_ELHM_RENTAL_PR, 0) AS TB_ENVR_ELHM_RENTAL_PR/*환경가전 렌탈(개인).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_RENTAL_PR, 0) AS T_ENVR_ELHM_RENTAL_PR/*환경가전 렌탈(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL_PR = 0 OR M.B_ENVR_ELHM_RENTAL_PR IS NULL THEN M.T_ENVR_ELHM_RENTAL_PR ELSE M.B_ENVR_ELHM_RENTAL_PR END) AS B_ENVR_ELHM_RENTAL_PR/*환경가전 렌탈(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_RENTAL_PR = 0 OR M.B_ENVR_ELHM_RENTAL_PR IS NULL THEN M.T_ENVR_ELHM_RENTAL_PR ELSE M.B_ENVR_ELHM_RENTAL_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_RENTAL_PR = 0 OR M.A_ENVR_ELHM_RENTAL_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL_PR = 0 OR M.B_ENVR_ELHM_RENTAL_PR IS NULL THEN M.T_ENVR_ELHM_RENTAL_PR ELSE M.B_ENVR_ELHM_RENTAL_PR END) ELSE M.A_ENVR_ELHM_RENTAL_PR END ) AS ENVR_ELHM_RENTAL_PR /*환경가전 렌탈(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_RENTAL_PR = 0 OR M.A_ENVR_ELHM_RENTAL_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_RENTAL_PR = 0 OR M.B_ENVR_ELHM_RENTAL_PR IS NULL THEN M.T_ENVR_ELHM_RENTAL_PR ELSE M.B_ENVR_ELHM_RENTAL_PR END) ELSE M.A_ENVR_ELHM_RENTAL_PR END ) AS A_ENVR_ELHM_RENTAL_PR/*환경가전 렌탈(개인).되물림후실적*/
--             /*환경가전 일시불*/
             , NVL(M.T_ENVR_ELHM_SPAY, 0) AS T_ENVR_ELHM_SPAY/*환경가전 일시불.귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY = 0 OR M.B_ENVR_ELHM_SPAY IS NULL THEN M.T_ENVR_ELHM_SPAY ELSE M.B_ENVR_ELHM_SPAY END) AS B_ENVR_ELHM_SPAY/*환경가전 일시불.되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY = 0 OR M.B_ENVR_ELHM_SPAY IS NULL THEN M.T_ENVR_ELHM_SPAY ELSE M.B_ENVR_ELHM_SPAY END) -
               (CASE WHEN M.A_ENVR_ELHM_SPAY = 0 OR M.A_ENVR_ELHM_SPAY IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY = 0 OR M.B_ENVR_ELHM_SPAY IS NULL THEN M.T_ENVR_ELHM_SPAY ELSE M.B_ENVR_ELHM_SPAY END) ELSE M.A_ENVR_ELHM_SPAY END ) AS ENVR_ELHM_SPAY /*환경가전 일시불.되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_SPAY = 0 OR M.A_ENVR_ELHM_SPAY IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY = 0 OR M.B_ENVR_ELHM_SPAY IS NULL THEN M.T_ENVR_ELHM_SPAY ELSE M.B_ENVR_ELHM_SPAY END) ELSE M.A_ENVR_ELHM_SPAY END ) AS A_ENVR_ELHM_SPAY/*환경가전 일시불.되물림후실적*/
--             /*환경가전 일시불(조직)*/
             , NVL(M.TB_ENVR_ELHM_SPAY_JO, 0) AS TB_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_SPAY_JO, 0) AS T_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY_JO = 0 OR M.B_ENVR_ELHM_SPAY_JO IS NULL THEN M.T_ENVR_ELHM_SPAY_JO ELSE M.B_ENVR_ELHM_SPAY_JO END) AS B_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY_JO = 0 OR M.B_ENVR_ELHM_SPAY_JO IS NULL THEN M.T_ENVR_ELHM_SPAY_JO ELSE M.B_ENVR_ELHM_SPAY_JO END) -
               (CASE WHEN M.A_ENVR_ELHM_SPAY_JO = 0 OR M.A_ENVR_ELHM_SPAY_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY_JO = 0 OR M.B_ENVR_ELHM_SPAY_JO IS NULL THEN M.T_ENVR_ELHM_SPAY_JO ELSE M.B_ENVR_ELHM_SPAY_JO END) ELSE M.A_ENVR_ELHM_SPAY_JO END ) AS ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_SPAY_JO = 0 OR M.A_ENVR_ELHM_SPAY_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY_JO = 0 OR M.B_ENVR_ELHM_SPAY_JO IS NULL THEN M.T_ENVR_ELHM_SPAY_JO ELSE M.B_ENVR_ELHM_SPAY_JO END) ELSE M.A_ENVR_ELHM_SPAY_JO END ) AS A_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).되물림후실적*/
--             /*환경가전 일시불(개인)*/
             , NVL(M.TB_ENVR_ELHM_SPAY_PR, 0) AS TB_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_SPAY_PR, 0) AS T_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY_PR = 0 OR M.B_ENVR_ELHM_SPAY_PR IS NULL THEN M.T_ENVR_ELHM_SPAY_PR ELSE M.B_ENVR_ELHM_SPAY_PR END) AS B_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_SPAY_PR = 0 OR M.B_ENVR_ELHM_SPAY_PR IS NULL THEN M.T_ENVR_ELHM_SPAY_PR ELSE M.B_ENVR_ELHM_SPAY_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_SPAY_PR = 0 OR M.A_ENVR_ELHM_SPAY_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY_PR = 0 OR M.B_ENVR_ELHM_SPAY_PR IS NULL THEN M.T_ENVR_ELHM_SPAY_PR ELSE M.B_ENVR_ELHM_SPAY_PR END) ELSE M.A_ENVR_ELHM_SPAY_PR END ) AS ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_SPAY_PR = 0 OR M.A_ENVR_ELHM_SPAY_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_SPAY_PR = 0 OR M.B_ENVR_ELHM_SPAY_PR IS NULL THEN M.T_ENVR_ELHM_SPAY_PR ELSE M.B_ENVR_ELHM_SPAY_PR END) ELSE M.A_ENVR_ELHM_SPAY_PR END ) AS A_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).되물림후실적*/
--             /*환경가전외 일시불(개인)*/
             , NVL(M.TB_ENVR_ELHM_EXCP_PR, 0) AS TB_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_EXCP_PR, 0) AS T_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_PR = 0 OR M.B_ENVR_ELHM_EXCP_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_PR ELSE M.B_ENVR_ELHM_EXCP_PR END) AS B_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_PR = 0 OR M.B_ENVR_ELHM_EXCP_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_PR ELSE M.B_ENVR_ELHM_EXCP_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_EXCP_PR = 0 OR M.A_ENVR_ELHM_EXCP_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_PR = 0 OR M.B_ENVR_ELHM_EXCP_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_PR ELSE M.B_ENVR_ELHM_EXCP_PR END) ELSE M.A_ENVR_ELHM_EXCP_PR END ) AS ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_EXCP_PR = 0 OR M.A_ENVR_ELHM_EXCP_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_PR = 0 OR M.B_ENVR_ELHM_EXCP_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_PR ELSE M.B_ENVR_ELHM_EXCP_PR END) ELSE M.A_ENVR_ELHM_EXCP_PR END ) AS A_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).되물림후실적*/
--             /*환경가전외 일시불(조직)*/
             , NVL(M.TB_ENVR_ELHM_EXCP_JO, 0) AS TB_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_EXCP_JO, 0) AS T_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_JO = 0 OR M.B_ENVR_ELHM_EXCP_JO IS NULL THEN M.T_ENVR_ELHM_EXCP_JO ELSE M.B_ENVR_ELHM_EXCP_JO END) AS B_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_JO = 0 OR M.B_ENVR_ELHM_EXCP_JO IS NULL THEN M.T_ENVR_ELHM_EXCP_JO ELSE M.B_ENVR_ELHM_EXCP_JO END) -
               (CASE WHEN M.A_ENVR_ELHM_EXCP_JO = 0 OR M.A_ENVR_ELHM_EXCP_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_JO = 0 OR M.B_ENVR_ELHM_EXCP_JO IS NULL THEN M.T_ENVR_ELHM_EXCP_JO ELSE M.B_ENVR_ELHM_EXCP_JO END) ELSE M.A_ENVR_ELHM_EXCP_JO END ) AS ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_EXCP_JO = 0 OR M.A_ENVR_ELHM_EXCP_JO IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_JO = 0 OR M.B_ENVR_ELHM_EXCP_JO IS NULL THEN M.T_ENVR_ELHM_EXCP_JO ELSE M.B_ENVR_ELHM_EXCP_JO END) ELSE M.A_ENVR_ELHM_EXCP_JO END ) AS A_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).되물림후실적*/
--             /*환경가전외*/
             , NVL(M.TB_ENVR_ELHM_EXCP, 0) AS TB_ENVR_ELHM_EXCP/*환경가전외.귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_EXCP, 0) AS T_ENVR_ELHM_EXCP/*환경가전외.귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP = 0 OR M.B_ENVR_ELHM_EXCP IS NULL THEN M.T_ENVR_ELHM_EXCP ELSE M.B_ENVR_ELHM_EXCP END) AS B_ENVR_ELHM_EXCP/*환경가전외.되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP = 0 OR M.B_ENVR_ELHM_EXCP IS NULL THEN M.T_ENVR_ELHM_EXCP ELSE M.B_ENVR_ELHM_EXCP END) -
               (CASE WHEN M.A_ENVR_ELHM_EXCP = 0 OR M.A_ENVR_ELHM_EXCP IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP = 0 OR M.B_ENVR_ELHM_EXCP IS NULL THEN M.T_ENVR_ELHM_EXCP ELSE M.B_ENVR_ELHM_EXCP END) ELSE M.A_ENVR_ELHM_EXCP END ) AS ENVR_ELHM_EXCP /*환경가전외.되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_EXCP = 0 OR M.A_ENVR_ELHM_EXCP IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP = 0 OR M.B_ENVR_ELHM_EXCP IS NULL THEN M.T_ENVR_ELHM_EXCP ELSE M.B_ENVR_ELHM_EXCP END) ELSE M.A_ENVR_ELHM_EXCP END ) AS A_ENVR_ELHM_EXCP/*환경가전외.되물림후실적*/
--             /*환경가전외 정액*/
             , NVL(M.T_ENVR_ELHM_EXCP_FXAM, 0) AS T_ENVR_ELHM_EXCP_FXAM/*환경가전외 정액.귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM = 0 OR M.B_ENVR_ELHM_EXCP_FXAM IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM ELSE M.B_ENVR_ELHM_EXCP_FXAM END) AS B_ENVR_ELHM_EXCP_FXAM/*환경가전외 정액.되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM = 0 OR M.B_ENVR_ELHM_EXCP_FXAM IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM ELSE M.B_ENVR_ELHM_EXCP_FXAM END) -
               (CASE WHEN M.A_ENVR_ELHM_EXCP_FXAM = 0 OR M.A_ENVR_ELHM_EXCP_FXAM IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM = 0 OR M.B_ENVR_ELHM_EXCP_FXAM IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM ELSE M.B_ENVR_ELHM_EXCP_FXAM END) ELSE M.A_ENVR_ELHM_EXCP_FXAM END ) AS ENVR_ELHM_EXCP_FXAM /*환경가전외 정액.되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_EXCP_FXAM = 0 OR M.A_ENVR_ELHM_EXCP_FXAM IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM = 0 OR M.B_ENVR_ELHM_EXCP_FXAM IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM ELSE M.B_ENVR_ELHM_EXCP_FXAM END) ELSE M.A_ENVR_ELHM_EXCP_FXAM END ) AS A_ENVR_ELHM_EXCP_FXAM/*환경가전외 정액.되물림후실적*/
--             /*환경가전외 정액(개인)*/
             , NVL(M.TB_ENVR_ELHM_EXCP_FXAM_PR, 0) AS TB_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).귀속월실적*/
             , NVL(M.T_ENVR_ELHM_EXCP_FXAM_PR, 0) AS T_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.B_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM_PR ELSE M.B_ENVR_ELHM_EXCP_FXAM_PR END) AS B_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.B_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM_PR ELSE M.B_ENVR_ELHM_EXCP_FXAM_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.A_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.B_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM_PR ELSE M.B_ENVR_ELHM_EXCP_FXAM_PR END) ELSE M.A_ENVR_ELHM_EXCP_FXAM_PR END ) AS ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.A_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_EXCP_FXAM_PR = 0 OR M.B_ENVR_ELHM_EXCP_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_EXCP_FXAM_PR ELSE M.B_ENVR_ELHM_EXCP_FXAM_PR END) ELSE M.A_ENVR_ELHM_EXCP_FXAM_PR END ) AS A_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).되물림후실적*/
--             /*신규판매 건수(조직)*/
             , NVL(M.TB_NW_SELL_CNT_JO, 0) AS TB_NW_SELL_CNT_JO /*신규판매 건수(조직).귀속전월실적*/
             , NVL(M.T_NW_SELL_CNT_JO, 0) AS T_NW_SELL_CNT_JO /*신규판매 건수(조직).귀속월실적*/
             , (CASE WHEN M.B_NW_SELL_CNT_JO = 0 OR M.B_NW_SELL_CNT_JO IS NULL THEN M.T_NW_SELL_CNT_JO ELSE M.B_NW_SELL_CNT_JO END) AS B_NW_SELL_CNT_JO /*신규판매 건수(조직).되물림전실적*/
             , (CASE WHEN M.B_NW_SELL_CNT_JO = 0 OR M.B_NW_SELL_CNT_JO IS NULL THEN M.T_NW_SELL_CNT_JO ELSE M.B_NW_SELL_CNT_JO END) -
               (CASE WHEN M.A_NW_SELL_CNT_JO = 0 OR M.A_NW_SELL_CNT_JO IS NULL THEN (CASE WHEN M.B_NW_SELL_CNT_JO = 0 OR M.B_NW_SELL_CNT_JO IS NULL THEN M.T_NW_SELL_CNT_JO ELSE M.B_NW_SELL_CNT_JO END) ELSE M.A_NW_SELL_CNT_JO END ) AS NW_SELL_CNT_JO /*신규판매 건수(조직).되물림실적*/
             , (CASE WHEN M.A_NW_SELL_CNT_JO = 0 OR M.A_NW_SELL_CNT_JO IS NULL THEN (CASE WHEN M.B_NW_SELL_CNT_JO = 0 OR M.B_NW_SELL_CNT_JO IS NULL THEN M.T_NW_SELL_CNT_JO ELSE M.B_NW_SELL_CNT_JO END) ELSE M.A_NW_SELL_CNT_JO END ) AS A_NW_SELL_CNT_JO /*신규판매 건수(조직).되물림후실적*/
--             /*신규판매 건수(개인)*/
             , NVL(M.TB_NW_SELL_CNT_PR, 0) AS TB_NW_SELL_CNT_PR /*신규판매 건수(개인).귀속전월실적*/
             , NVL(M.T_NW_SELL_CNT_PR, 0) AS T_NW_SELL_CNT_PR /*신규판매 건수(개인).귀속월실적*/
             , (CASE WHEN M.B_NW_SELL_CNT_PR = 0 OR M.B_NW_SELL_CNT_PR IS NULL THEN M.T_NW_SELL_CNT_PR ELSE M.B_NW_SELL_CNT_PR END) AS B_NW_SELL_CNT_PR/*신규판매 건수(개인).되물림전실적*/
             , (CASE WHEN M.B_NW_SELL_CNT_PR = 0 OR M.B_NW_SELL_CNT_PR IS NULL THEN M.T_NW_SELL_CNT_PR ELSE M.B_NW_SELL_CNT_PR END) -
               (CASE WHEN M.A_NW_SELL_CNT_PR = 0 OR M.A_NW_SELL_CNT_PR IS NULL THEN (CASE WHEN M.B_NW_SELL_CNT_PR = 0 OR M.B_NW_SELL_CNT_PR IS NULL THEN M.T_NW_SELL_CNT_PR ELSE M.B_NW_SELL_CNT_PR END) ELSE M.A_NW_SELL_CNT_PR END ) AS NW_SELL_CNT_PR /*신규판매 건수(개인).되물림실적*/
             , (CASE WHEN M.A_NW_SELL_CNT_PR = 0 OR M.A_NW_SELL_CNT_PR IS NULL THEN (CASE WHEN M.B_NW_SELL_CNT_PR = 0 OR M.B_NW_SELL_CNT_PR IS NULL THEN M.T_NW_SELL_CNT_PR ELSE M.B_NW_SELL_CNT_PR END) ELSE M.A_NW_SELL_CNT_PR END ) AS A_NW_SELL_CNT_PR/*신규판매 건수(개인).되물림후실적*/
--             /*환경가전 정액(개인)*/
             , NVL(M.TB_ENVR_ELHM_FXAM_PR, 0) AS TB_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).귀속전월실적*/
             , NVL(M.T_ENVR_ELHM_FXAM_PR, 0) AS T_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).귀속월실적*/
             , (CASE WHEN M.B_ENVR_ELHM_FXAM_PR = 0 OR M.B_ENVR_ELHM_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_FXAM_PR ELSE M.B_ENVR_ELHM_FXAM_PR END) AS B_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).되물림전실적*/
             , (CASE WHEN M.B_ENVR_ELHM_FXAM_PR = 0 OR M.B_ENVR_ELHM_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_FXAM_PR ELSE M.B_ENVR_ELHM_FXAM_PR END) -
               (CASE WHEN M.A_ENVR_ELHM_FXAM_PR = 0 OR M.A_ENVR_ELHM_FXAM_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_FXAM_PR = 0 OR M.B_ENVR_ELHM_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_FXAM_PR ELSE M.B_ENVR_ELHM_FXAM_PR END) ELSE M.A_ENVR_ELHM_FXAM_PR END ) AS ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).되물림실적*/
             , (CASE WHEN M.A_ENVR_ELHM_FXAM_PR = 0 OR M.A_ENVR_ELHM_FXAM_PR IS NULL THEN (CASE WHEN M.B_ENVR_ELHM_FXAM_PR = 0 OR M.B_ENVR_ELHM_FXAM_PR IS NULL THEN M.T_ENVR_ELHM_FXAM_PR ELSE M.B_ENVR_ELHM_FXAM_PR END) ELSE M.A_ENVR_ELHM_FXAM_PR END ) AS A_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).되물림후실적*/
--             /*조직관리 실활동(명)*/
             , NVL(M.TB_OG_MGT_PPL, 0) AS TB_OG_MGT_PPL /*조직관리 실활동(명).전월대비*/
             , NVL(M.T_OG_MGT_PPL, 0) AS T_OG_MGT_PPL /*조직관리 실활동(명).귀속월실적*/
             , (CASE WHEN M.B_OG_MGT_PPL = 0 OR M.B_OG_MGT_PPL IS NULL THEN M.T_OG_MGT_PPL ELSE M.B_OG_MGT_PPL END) AS B_OG_MGT_PPL/*조직관리 실활동(명).되물림전실적*/
             , (CASE WHEN M.B_OG_MGT_PPL = 0 OR M.B_OG_MGT_PPL IS NULL THEN M.T_OG_MGT_PPL ELSE M.B_OG_MGT_PPL END) -
               (CASE WHEN M.A_OG_MGT_PPL = 0 OR M.A_OG_MGT_PPL IS NULL THEN (CASE WHEN M.B_OG_MGT_PPL = 0 OR M.B_OG_MGT_PPL IS NULL THEN M.T_OG_MGT_PPL ELSE M.B_OG_MGT_PPL END) ELSE M.A_OG_MGT_PPL END ) AS OG_MGT_PPL /*조직관리 실활동(명).되물림실적*/
             , (CASE WHEN M.A_OG_MGT_PPL = 0 OR M.A_OG_MGT_PPL IS NULL THEN (CASE WHEN M.B_OG_MGT_PPL = 0 OR M.B_OG_MGT_PPL IS NULL THEN M.T_OG_MGT_PPL ELSE M.B_OG_MGT_PPL END) ELSE M.A_OG_MGT_PPL END ) AS A_OG_MGT_PPL/*조직관리 실활동(명).되물림후실적*/
--             /*기변(WELLS-P)*/
             , NVL(M.TB_MC, 0) AS TB_MC /*기변.귀속전월실적*/
             , NVL(M.T_MC, 0) AS T_MC /*기변.귀속월실적*/
             , (CASE WHEN M.B_MC = 0 OR M.B_MC IS NULL THEN M.T_MC ELSE M.B_MC END) AS B_MC/*기변.되물림전실적*/
             , (CASE WHEN M.B_MC = 0 OR M.B_MC IS NULL THEN M.T_MC ELSE M.B_MC END) -
               (CASE WHEN M.A_MC = 0 OR M.A_MC IS NULL THEN (CASE WHEN M.B_MC = 0 OR M.B_MC IS NULL THEN M.T_MC ELSE M.B_MC END) ELSE M.A_MC END ) AS MC /*기변.되물림실적*/
             , (CASE WHEN M.A_MC = 0 OR M.A_MC IS NULL THEN (CASE WHEN M.B_MC = 0 OR M.B_MC IS NULL THEN M.T_MC ELSE M.B_MC END) ELSE M.A_MC END ) AS A_MC /*기변.되물림후실적*/
--             /*정액(WELLS-P)*/
             , NVL(M.TB_FXAM, 0) AS TB_FXAM /*정액.귀속전월실적*/
             , NVL(M.T_FXAM, 0) AS T_FXAM /*정액.귀속월실적*/
             , (CASE WHEN M.B_FXAM = 0 OR M.B_FXAM IS NULL THEN M.T_FXAM ELSE M.B_FXAM END) AS B_FXAM/*정액.되물림전실적*/
             , (CASE WHEN M.B_FXAM = 0 OR M.B_FXAM IS NULL THEN M.T_FXAM ELSE M.B_FXAM END) -
               (CASE WHEN M.A_FXAM = 0 OR M.A_FXAM IS NULL THEN (CASE WHEN M.B_FXAM = 0 OR M.B_FXAM IS NULL THEN M.T_FXAM ELSE M.B_FXAM END) ELSE M.A_FXAM END ) AS FXAM /*정액.되물림실적*/
             , (CASE WHEN M.A_FXAM = 0 OR M.A_FXAM IS NULL THEN (CASE WHEN M.B_FXAM = 0 OR M.B_FXAM IS NULL THEN M.T_FXAM ELSE M.B_FXAM END) ELSE M.A_FXAM END ) AS A_FXAM /*정액.되물림후실적*/
--             /*되물림 수수료*/
             , NVL(D.MCHN_CH_REDF201903, 0) AS MCHN_CH_REDF201903 /*기변수당*/
             , NVL(D.MCHN_CH_REDF201904, 0) AS MCHN_CH_REDF201904 /*기기변경*/
             , NVL(D.SP_REDF, 0) AS SP_REDF /*수석플래너*/
             , NVL(D.HOME_CARE_REDF, 0) AS HOME_CARE_REDF /*홈케어*/
             , NVL(D.SELL_ENCRG_REDF, 0) AS SELL_ENCRG_REDF /*판매장려*/
             , NVL(D.EDU_REDF, 0) AS EDU_REDF /*교육*/
             , NVL(D.SETTLE_REDF, 0) AS SETTLE_REDF /*정착*/
             , NVL(D.SELL_ENCRG_RETT_REDF, 0) AS SELL_ENCRG_RETT_REDF /*판매장려 소급*/
             , NVL(D.ENVR_TRG_REDF, 0) AS ENVR_TRG_REDF /*환경가전 목표달성*/
             , NVL(D.ENVR_BZNS_REDF201903, 0) AS ENVR_BZNS_REDF201903 /*환경가전 영업*/
             , NVL(D.ENVR_BZNS_REDF201904, 0) AS ENVR_BZNS_REDF201904 /*환경가전 비례*/
             , NVL(D.ENVR_EXCP_BZNS_REDF201903, 0) AS ENVR_EXCP_BZNS_REDF201903 /*환경가전외 영업*/
             , NVL(D.ENVR_EXCP_BZNS_REDF201904, 0) AS ENVR_EXCP_BZNS_REDF201904 /*환경가전외 비례*/
             , NVL(D.ENVR_METG_REDF, 0) AS ENVR_METG_REDF /*환경가전 미팅*/
             , NVL(D.ENVR_EXCP_METG_REDF, 0) AS ENVR_EXCP_METG_REDF /*환경가전외 미팅*/
             , NVL(D.ENVR_OG_REDF, 0) AS ENVR_OG_REDF /*환경가전 조직*/
             , NVL(D.ENVR_EXCP_OG_REDF201904, 0) AS ENVR_EXCP_OG_REDF201904 /*환경가전외 조직*/
             , NVL(D.ENVR_EXCP_OG_REDF201903, 0) AS ENVR_EXCP_OG_REDF201903 /*환경가전외 조직비례*/
             , NVL(D.ENVR_OG_METG, 0) AS ENVR_OG_METG /*환경가전 조직미팅*/
             , NVL(D.ENVR_EXCP_OG_METG_REDF, 0) AS ENVR_EXCP_OG_METG_REDF /*환경가전외 조직미팅*/
             , NVL(D.OG_SELL_ENCRG_REDF, 0) AS OG_SELL_ENCRG_REDF /*조직판매 장려*/
             , NVL(D.NW_SELL_REDF, 0) AS NW_SELL_REDF /*신규판매*/
             , NVL(D.OG_MGT_REDF, 0) AS OG_MGT_REDF /*조직관리*/
--             /*WELLS-P 되물림 수수료*/
             , NVL(D.WP_FXAM_REDF_DSTRC ,0) AS WP_FXAM_REDF_DSTRC /*정액(지구장이하)*/
             , NVL(D.WP_FXAM_REDF_BRCH ,0) AS WP_FXAM_REDF_BRCH /*정액(지점장이상)*/
             , NVL(D.WP_ENVR_EXCP_PR_REDF ,0) AS WP_ENVR_EXCP_PR_REDF /*가전외 개인비례*/
             , NVL(D.WP_ENVR_PR_REDF ,0) AS WP_ENVR_PR_REDF /*가전 개인비례*/
             , NVL(D.WP_PR_SELL_ENCRG_REDF ,0) AS WP_PR_SELL_ENCRG_REDF /*개인 판매장려*/
             , NVL(D.WP_METG_REDF ,0) AS WP_METG_REDF /*미팅*/
             , NVL(D.WP_SETTLE_REDF_DSTRC ,0) AS WP_SETTLE_REDF_DSTRC /*정착(지구장이하)*/
             , NVL(D.WP_SETTLE_REDF_BRCH ,0) AS WP_SETTLE_REDF_BRCH /*정착(지점장이상)*/
             , NVL(D.WP_ENVR_OG_REDF ,0) AS WP_ENVR_OG_REDF /*가전 조직비례*/
             , NVL(D.WP_ENVR_EXCP_OG_REDF ,0) AS WP_ENVR_EXCP_OG_REDF /*가전외 조직비례*/
             , NVL(D.WP_OG_SELL_ENCRG_REDF ,0) AS WP_OG_SELL_ENCRG_REDF /*조직 판매장려*/
             , NVL(D.WP_LIF_REDF_AMT, 0) AS WP_LIF_REDF_AMT /*상조되물림*/
             , NVL(D.DLQ_REDF_AMT, 0) AS DLQ_REDF_AMT /*연체되물림*/
             , NVL(D.REDF_PERF_RENTAL, 0) AS REDF_PERF_RENTAL  /*되물림실적.렌탈*/
             , NVL(D.REDF_PERF_EXCP, 0) AS REDF_PERF_EXCP  /*되물림실적.가전외일시불실적*/
             , NVL(D.DLQ_REDF_PERF_RENTAL, 0) AS DLQ_REDF_PERF_RENTAL /*연체되물림실적.렌탈*/
             , NVL(D.DLQ_REDF_PERF_EXCP, 0) AS DLQ_REDF_PERF_EXCP /*연체되물림실적.가전외일시불실적*/
             , NVL(D.DLQ_REDF_PERF_RENTAL, 0) + NVL(D.DLQ_REDF_PERF_EXCP, 0) AS DLQ_REDF_PERF_TOT /*연체되물림실적.계*/
             /*되물림 수수료.되물림 합계금액*/
             , NVL(D.MCHN_CH_REDF201903, 0)+NVL(D.SP_REDF, 0)+NVL(D.HOME_CARE_REDF, 0)+NVL(D.ENVR_TRG_REDF, 0)+NVL(D.ENVR_BZNS_REDF201903, 0)
              +NVL(D.ENVR_METG_REDF, 0)+NVL(D.ENVR_EXCP_BZNS_REDF201903, 0)+NVL(D.ENVR_EXCP_METG_REDF, 0)+NVL(D.ENVR_OG_REDF, 0)+NVL(D.ENVR_OG_METG, 0)
              +NVL(D.ENVR_EXCP_OG_REDF201903, 0)+NVL(D.ENVR_EXCP_OG_METG_REDF, 0) AS SUM_PERF_LAST_201903_REDF_DSTRC /*2019.03 이전 + 지구장이하 그리드 되물림 합계금액*/

             , NVL(D.HOME_CARE_REDF ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)+NVL(D.ENVR_EXCP_BZNS_REDF201904 ,0)
              +NVL(D.EDU_REDF ,0)+NVL(D.SETTLE_REDF ,0)+NVL(D.SELL_ENCRG_RETT_REDF ,0) AS SUM_PERF_201904_BETWEEN_202012_REDF_DSTRC /*2019.04 ~ 2020.12 + 지구장이하 그리드 되물림 합계금액*/

             , NVL(D.HOME_CARE_REDF ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)+NVL(D.ENVR_EXCP_BZNS_REDF201904 ,0)
              +NVL(D.SELL_ENCRG_REDF ,0)+NVL(D.EDU_REDF ,0)+NVL(D.SETTLE_REDF ,0)+NVL(D.SELL_ENCRG_RETT_REDF ,0) AS SUM_PERF_202101_REDF_DSTRC /*2021.01 이후 + 지구장이하 그리드 되물림 합계금액*/

             , NVL(D.MCHN_CH_REDF201903 ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.SP_REDF ,0)+NVL(D.HOME_CARE_REDF ,0)+NVL(D.ENVR_TRG_REDF ,0)+NVL(D.ENVR_BZNS_REDF201903 ,0)
              +NVL(D.ENVR_METG_REDF ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)+NVL(D.ENVR_EXCP_BZNS_REDF201903 ,0)+NVL(D.ENVR_EXCP_METG_REDF ,0)+NVL(D.ENVR_EXCP_BZNS_REDF201904 ,0)
              +NVL(D.SELL_ENCRG_REDF ,0)+NVL(D.EDU_REDF ,0)+NVL(D.SETTLE_REDF ,0)+NVL(D.SELL_ENCRG_RETT_REDF ,0)+NVL(D.ENVR_OG_REDF ,0)+NVL(D.ENVR_OG_METG ,0)
              +NVL(D.ENVR_EXCP_OG_REDF201903 ,0)+NVL(D.ENVR_EXCP_OG_METG_REDF ,0) AS SUM_PERF_ALL_REDF_DSTRC /*실적년월 전기간 + 지구장이하 그리드 되물림 합계금액*/

             , NVL(D.MCHN_CH_REDF201903 ,0)+NVL(D.SP_REDF ,0)+NVL(D.HOME_CARE_REDF ,0)+NVL(D.ENVR_TRG_REDF ,0)+NVL(D.ENVR_BZNS_REDF201903 ,0)+NVL(D.ENVR_METG_REDF ,0)
              +NVL(D.ENVR_EXCP_BZNS_REDF201903 ,0)+NVL(D.ENVR_EXCP_METG_REDF ,0)+NVL(D.ENVR_OG_REDF ,0)+NVL(D.ENVR_OG_METG ,0)
              +NVL(D.ENVR_EXCP_OG_REDF201903 ,0)+NVL(D.ENVR_EXCP_OG_METG_REDF ,0) AS SUM_PERF_LAST_201903_REDF_BRCH /* 2019.03 이전 + 지점장 이상 그리드 되물림 합계금액*/

             , NVL(D.HOME_CARE_REDF ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)+NVL(D.SELL_ENCRG_REDF ,0)+NVL(D.EDU_REDF ,0)+NVL(D.SETTLE_REDF ,0)
              +NVL(D.ENVR_OG_REDF ,0)+NVL(D.ENVR_EXCP_OG_REDF201904 ,0)+NVL(D.OG_SELL_ENCRG_REDF ,0)+NVL(D.NW_SELL_REDF ,0)
              +NVL(D.OG_MGT_REDF ,0) AS SUM_PERF_201904_BETWEEN_202012_REDF_BRCH /* 2019.04 ~ 2020.12 + 지점장 이상 그리드 되물림 합계금액*/
             , NVL(D.HOME_CARE_REDF ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)+NVL(D.SELL_ENCRG_REDF ,0)+NVL(D.EDU_REDF ,0)+NVL(D.SETTLE_REDF ,0)

              +NVL(D.ENVR_OG_REDF ,0)+NVL(D.ENVR_EXCP_OG_REDF201904 ,0)+NVL(D.OG_SELL_ENCRG_REDF ,0)+NVL(D.NW_SELL_REDF ,0)
              +NVL(D.OG_MGT_REDF ,0) AS SUM_PERF_202101_REDF_BRCH /* 2021.01 이후 + 지점장 이상 그리드 되물림 합계 금액*/

             , NVL(D.MCHN_CH_REDF201903 ,0)+NVL(D.SP_REDF ,0)+NVL(D.HOME_CARE_REDF ,0)+NVL(D.MCHN_CH_REDF201904 ,0)+NVL(D.SELL_ENCRG_REDF ,0)+NVL(D.EDU_REDF ,0)
              +NVL(D.SETTLE_REDF ,0)+NVL(D.ENVR_TRG_REDF ,0)+NVL(D.ENVR_BZNS_REDF201903 ,0)+NVL(D.ENVR_EXCP_BZNS_REDF201903 ,0)+NVL(D.ENVR_BZNS_REDF201904 ,0)
              +NVL(D.ENVR_EXCP_BZNS_REDF201904 ,0)+NVL(D.ENVR_METG_REDF ,0)+NVL(D.ENVR_EXCP_METG_REDF ,0)+NVL(D.ENVR_OG_REDF ,0)+NVL(D.ENVR_EXCP_OG_REDF201904 ,0)
              +NVL(D.ENVR_EXCP_OG_REDF201903 ,0)+NVL(D.ENVR_OG_METG ,0)+NVL(D.ENVR_EXCP_OG_METG_REDF ,0)+NVL(D.OG_SELL_ENCRG_REDF ,0)+NVL(D.NW_SELL_REDF ,0)
              +NVL(D.OG_MGT_REDF ,0) AS SUM_PERF_ALL_REDF_BRCH

             , NVL(D.WP_ENVR_PR_REDF ,0)+NVL(D.WP_ENVR_EXCP_PR_REDF ,0)+NVL(D.WP_PR_SELL_ENCRG_REDF ,0)+NVL(D.WP_METG_REDF ,0)+NVL(D.WP_SETTLE_REDF_DSTRC ,0)
              +NVL(D.WP_FXAM_REDF_DSTRC ,0) AS SUM_WP_REDF_DSTRC /*WELLS-P + 지구장 이하 되물림 합계금액*/

             , NVL(D.WP_ENVR_PR_REDF ,0)+NVL(D.WP_ENVR_EXCP_PR_REDF ,0)+NVL(D.WP_PR_SELL_ENCRG_REDF ,0)+NVL(D.WP_ENVR_OG_REDF ,0)+NVL(D.WP_ENVR_EXCP_OG_REDF ,0)
              +NVL(D.WP_OG_SELL_ENCRG_REDF ,0)+NVL(D.WP_SETTLE_REDF_BRCH ,0)+NVL(D.WP_FXAM_REDF_BRCH ,0) AS SUM_WP_REDF_BRCH /*WELLS-P + 지점장 이상 되물림 합계 금액*/
             , '' AS T_REDF_PPL /*적채용.귀속월인원*/
             , '' AS B_REDF_PPL /*적채용.되물림전 인원*/
             , '' AS REDF_PPL /*적채용.되물림 인원*/
             , '' AS A_REDF_PPL /*적채용.되물림후 인원*/
             , (CASE WHEN ( SELECT COUNT(1)
                              FROM TB_FEDD_FEE_CPSN_REDF_OJ_IZ C2 /*수수료강제되물림대상내역*/
                             WHERE C2.DTA_DL_YN = 'N'
                               AND C.BASE_YM = C2.OC_YM
                               AND C.PERF_YM = C2.PERF_YM
                               AND C.PRTNR_NO = C2.PRTNR_NO
                               AND C.OG_TP_CD = C2.OG_TP_CD
                               <!--AND C.CNTR_NO = C2.CNTR_NO
                               AND C.CNTR_SN = C2.CNTR_SN-->
                          ) <![CDATA[ >= ]]> 1 THEN 'Y' ELSE ''
                 END) AS CPSN_REDF_YN /*강제되물림포함여부*/
          FROM  (
                           SELECT M.REDF_ADSB_OC_YM
                                , M.PERF_YM
                                , M.OG_TP_CD
                                , M.PRTNR_NO
                                , M.REDF_ADSB_TP_CD
                                , M.PERF_DV_CD
                                /*분기처리(M조직, P조직)*/
                                /*M조직(지구장 이하): 기변수당, 기기변경,수석플래너,홈케어,환경가전 목표달성,환경가전영업,환경가전 미팅,환경가전 비례,환경가전외 영업,환경가전외 미팅,환경가전외 비례,판매장려,교육,정착,판매장려 소급,환경가전 조직,환경가전 조직미팅
                                 * 환경가전외 조직비례,환경가전 조직외미팅*/
                                /*M조직(지점장 이상): 기변수당,수석플래너,홈케어,기기변경,판매장려,교육,정착,환경가전 목표달성,환경가전영업,환경가전외 영업,환경가전 비례,환경가전외 비례,환경가전 미팅,환경가전외 미팅,환경가전 조직,환경가전외 조직,환경가전외 조직비례
                                 * 환경가전 조직미팅, 환경가전외 조직미팅,조직판매 장려, 신규판매, 조직관리*/
                                /*P조직(지점장 이상): 가전 개인비례, 가전 외 개인비례, 개인 판매장려, 가전 조직비례, 가전 외 조직비례, 조직 판매장려, 정착, 정액*/

                                /*M조직(지구장 이하)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020005' AND M.PERF_YM  <![CDATA[ <= ]]>  '201903'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS MCHN_CH_REDF201903 /*기변수당(TODO: ASIS기준 2019년 03월 이전엔 기변수당, 코드는 같음)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020005' AND M.PERF_YM >= '201904'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS MCHN_CH_REDF201904 /*기기변경(TODO: ASIS기준 2019년 04월 이후엔 기기변경, 코드는 같음)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = '@@@' /* TODO: 수석플래너 라는 수수료코드는 존재치 않는데 어떤 코드인지 찾아야함*/
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS SP_REDF /*수석플래너*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020078', 'W020079')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS HOME_CARE_REDF /*홈케어*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020051'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_TRG_REDF /*환경가전 목표달성*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020001', 'W020002') AND M.PERF_YM  <![CDATA[ <= ]]>  '201903'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_BZNS_REDF201903 /*환경가전영업 TODO: 201903까지 환경가전영업, 201904부터 환경가전 비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020001', 'W020002') AND M.PERF_YM >= '201904'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_BZNS_REDF201904 /*환경가전 비례 TODO: 201903까지 환경가전영업, 201904부터 환경가전 비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020062'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_METG_REDF /*환경가전 미팅*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020003', 'W020004') AND M.PERF_YM <![CDATA[ <= ]]>   '201903'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_BZNS_REDF201903 /*환경가전외 영업 TODO: 201903까지 환경가전외 영업, 201904부터 환경가전외 비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020003', 'W020004') AND M.PERF_YM >= '201904'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_BZNS_REDF201904 /*환경가전외 비례 TODO: 201903까지 환경가전외 영업, 201904부터 환경가전외 비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020063'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_METG_REDF /*환경가전외 미팅*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020012', 'W020008', 'W020009', 'W020010', 'W020011', 'W020115' )
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS SELL_ENCRG_REDF /*판매장려*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020077', 'W020076', 'W020075', 'W020074', 'W020116')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS EDU_REDF /*교육*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020082', 'W020081', 'W020080')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS SETTLE_REDF /*정착*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020083'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS SELL_ENCRG_RETT_REDF /*판매장려 소급*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020019', 'W020020', 'W020021' )
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_OG_REDF /*환경가전 조직*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020065'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_OG_METG /*환경가전 조직미팅*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020024' AND M.PERF_YM  <![CDATA[ <= ]]>  '201903'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_OG_REDF201903 /*환경가전외 조직비례(~2019.03)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020022', 'W020023') AND M.PERF_YM >= '201904'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_OG_REDF201904 /*환경가전외 조직(2019.04~)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W020066'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS ENVR_EXCP_OG_METG_REDF /*환경가전외 조직미팅*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020017', 'W020046', 'W020044', 'W020045', 'W020043')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS OG_SELL_ENCRG_REDF /*조직판매 장려*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020039', 'W020013', 'W020040')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS NW_SELL_REDF /*신규판매*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W020018', 'W020047', 'W020048')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS OG_MGT_REDF /*조직관리*/

                                /*P조직(지구장 이하)*/
                                /*P조직(지구장 이하): 가전,가전외비례,판매장려,미팅,정착,정액*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010001', 'W010101')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_ENVR_PR_REDF /*가전개인비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010002', 'W010102')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_ENVR_EXCP_PR_REDF /*가전 외 개인비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010003', 'W010103')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_PR_SELL_ENCRG_REDF /*개인판매장려*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W010004'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_METG_REDF /*미팅수수료*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010005', 'W010105')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_SETTLE_REDF_DSTRC /*정착수수료(지구장이하)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010023', 'W010123')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_FXAM_REDF_DSTRC /*정액(지구장이하)*/

                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010023', 'W010123')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_FXAM_REDF_BRCH /*정액(지점장이상)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W010011'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_ENVR_OG_REDF /*가전 조직비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W010012'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_ENVR_EXCP_OG_REDF /*가전외 조직비례*/
                                , SUM(NVL((CASE WHEN M.FEE_CD = 'W010013'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_OG_SELL_ENCRG_REDF /*조직 판매장려*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010005', 'W010105')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_SETTLE_REDF_BRCH /*정착수수료(지점장이상)*/
                                , SUM(NVL((CASE WHEN M.FEE_CD IN ('W010021', 'W010121', 'W010022')
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS WP_LIF_REDF_AMT /*상조되물림(개인,조직 모두 표현(화면상))*/
                                , SUM(NVL((CASE WHEN M.REDF_ADSB_TP_CD = '0203'
                                        THEN (CASE WHEN M.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN M.REDF_ADSB_OC_AMT
                                                   ELSE M.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS DLQ_REDF_AMT /*연체되물림*/
                                , SUM(NVL((CASE WHEN M.REDF_ADSB_TP_CD = '0203' AND S.SELL_TP_CD = '2'
                                        THEN S.FEE_ACKMT_BASE_AMT
                                    END), 0)) AS REDF_PERF_RENTAL /*되물림구분이 연체일 때, 되물림실적.렌탈*/
                                , SUM(NVL((CASE WHEN M.REDF_ADSB_TP_CD = '0203' AND S.SELL_TP_CD = '2'
                                        THEN (CASE WHEN S.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN S.REDF_ADSB_OC_AMT
                                                   ELSE S.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS DLQ_REDF_PERF_RENTAL /*되물림구분이 연체일 때, 연체되물림실적.렌탈*/
                                , SUM(NVL((CASE WHEN M.REDF_ADSB_TP_CD = '0203' AND S.SELL_TP_CD = '1'
                                        THEN S.FEE_ACKMT_BASE_AMT
                                    END), 0)) AS REDF_PERF_EXCP /*되물림구분이 연체일 때, 되물림실적.가전외일시불*/
                                , SUM(NVL((CASE WHEN M.REDF_ADSB_TP_CD = '0203' AND S.SELL_TP_CD = '1'
                                        THEN (CASE WHEN S.REDF_ADSB_CTR_CNFM_AMT IS NULL
                                                   THEN S.REDF_ADSB_OC_AMT
                                                   ELSE S.REDF_ADSB_CTR_CNFM_AMT END)
                                    END), 0)) AS DLQ_REDF_PERF_EXCP /*되물림구분이 연체일 때, 되물림실적.가전외일시불*/
                             FROM TB_FEDD_FEE_REDF_ADSB_BAS M /*수수료되물림재지급기본*/
                             LEFT OUTER JOIN (
                             				  SELECT S1.FEE_REDF_ADSB_ID
                             				  	   , S2.SELL_TP_CD /*1: 일시불, 2: 렌탈*/
                             				  	   , S2.FEE_ACKMT_BASE_AMT /*수수료인정기준금액, = 되물림실적*/
                             				  	   , S1.REDF_ADSB_OC_AMT
                             				  	   , S1.REDF_ADSB_CTR_CNFM_AMT
                             				    FROM TB_FEDD_FEE_REDF_ADSB_DTL S1 /*수수료되물림재지급상세*/
                             				    LEFT OUTER JOIN TB_SSCT_CNTR_DTL S2 /*계약상세*/
                             				      ON S1.CNTR_NO = S2.CNTR_NO
                             				     AND S1.CNTR_SN = S2.CNTR_SN
                             				   WHERE 1 = 1
                                                 <if test='@MybatisUtils@isNotEmpty(perfYmFrom) and @MybatisUtils@isNotEmpty(perfYmTo)'>
                             				     AND S1.PERF_YM BETWEEN #{perfYmFrom} AND #{perfYmTo} /*PARAM: 실적년월*/
                                                 </if>
                                                 <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                              					 AND S1.REDF_ADSB_OC_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo} /*PARAM: 발생년월*/
                                                 </if>
                         	   ) S
                         	   ON M.FEE_REDF_ADSB_ID = S.FEE_REDF_ADSB_ID
                            WHERE M.DTA_DL_YN = 'N'
                              AND M.OG_TP_CD = #{ogTpCd}
                              <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                              AND M.PRTNR_NO = #{prtnrNo}
                              </if>
                              AND M.REDF_ADSB_TP_CD = #{redfAdsbTpCd}
                              <if test='@MybatisUtils@equals(rsbDvCd, "01")'>
                              AND M.PERF_DV_CD = '0'
                              </if>
                              <if test='@MybatisUtils@equals(rsbDvCd, "02")'>
                              AND M.PERF_DV_CD = '2'
                              </if>
                              <if test='@MybatisUtils@isNotEmpty(perfYmFrom) and @MybatisUtils@isNotEmpty(perfYmTo)'>
                              AND M.PERF_YM BETWEEN #{perfYmFrom} AND #{perfYmTo}
                              </if>
                              <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                              AND M.REDF_ADSB_OC_YM BETWEEN #{redfAdsbOcYmFrom} AND #{redfAdsbOcYmTo}
                              </if>
                            GROUP BY M.REDF_ADSB_OC_YM
                                   , M.PERF_YM
                                   , M.OG_TP_CD
                                   , M.PRTNR_NO
                                   , M.REDF_ADSB_TP_CD
                                   , M.PERF_DV_CD
                          ) D /*되물림 수수료*/

          LEFT OUTER JOIN (
                SELECT MAX(B.BASE_YM) AS BASE_YM
                     , A.PERF_YM
                     , TO_CHAR(ADD_MONTHS(TO_DATE(A.PERF_YM || '01', 'YYYYMMDD'), 1), 'YYYYMM') AS PERF_YM_1
                     , A.OG_TP_CD
                     , A.PRTNR_NO
                     <!--, B.PERF_DV_CD-->
                     <!--, A.AKSD48_YN-->
                     , NVL(B.HOME_CARE, 0) AS HOME_CARE /*홈케어실적*/
                     , NVL(B.MC_PERF, 0) AS MC_PERF /*기변실적*/
                     , NVL(B.ATDC_DC, 0) AS ATDC_DC /*미팅(출근일수)*/
                     , NVL(A.T_ENVR_ELHM, 0) AS T_ENVR_ELHM /*환경가전.귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_CNT, 0) AS T_ENVR_ELHM_CNT /*환경가전(건수).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_CNT_PR, 0) AS T_ENVR_ELHM_CNT_PR /*환경가전 건수(개인).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_CNT_JO, 0) AS T_ENVR_ELHM_CNT_JO /*환경가전 건수(조직).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_BASE_AMT, 0) AS T_ENVR_ELHM_BASE_AMT /*환경가전(기준금액).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_RENTAL, 0) AS T_ENVR_ELHM_RENTAL /*환경가전 렌탈.귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_RENTAL_PR, 0) AS T_ENVR_ELHM_RENTAL_PR /*환경가전 렌탈(개인).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_RENTAL_JO, 0) AS T_ENVR_ELHM_RENTAL_JO /*환경가전 렌탈(조직).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_SPAY, 0) AS T_ENVR_ELHM_SPAY /*환경가전 일시불.귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_SPAY_PR, 0) AS T_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_SPAY_JO, 0) AS T_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_EXCP, 0) AS T_ENVR_ELHM_EXCP /*환경가전외.귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_EXCP_PR, 0) AS T_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_EXCP_JO, 0) AS T_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_EXCP_FXAM, 0) AS T_ENVR_ELHM_EXCP_FXAM /*환경가전외 정액.귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_FXAM_PR, 0) AS T_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).귀속월실적*/
                     , NVL(A.T_ENVR_ELHM_EXCP_FXAM_PR, 0) AS T_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).귀속월실적*/
                     , NVL(A.T_NW_SELL_CNT_PR, 0) AS T_NW_SELL_CNT_PR /*신규판매건수(개인).귀속월실적*/
                     , NVL(A.T_NW_SELL_CNT_JO, 0) AS T_NW_SELL_CNT_JO /*신규판매건수(개인).귀속월실적*/
                     , NVL(A.T_OG_MGT_PPL, 0) AS T_OG_MGT_PPL /*조직관리 실활동(명).귀속월실적*/
                     , NVL(A.T_MC, 0) AS T_MC /*기변(WELLS-P).귀속월실적*/
                     , NVL(A.T_FXAM, 0) AS T_FXAM /*정액(WELLS-P).귀속월실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM, 0) END) AS A_ENVR_ELHM /*환경가전.되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_CNT, 0) END) AS A_ENVR_ELHM_CNT /*환경가전(건수).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_CNT_PR, 0) END) AS A_ENVR_ELHM_CNT_PR /*환경가전 건수(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_CNT_JO, 0) END) AS A_ENVR_ELHM_CNT_JO /*환경가전 건수(조직).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_BASE_AMT, 0) END) AS A_ENVR_ELHM_BASE_AMT /*환경가전(기준금액).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_RENTAL, 0) END) AS A_ENVR_ELHM_RENTAL /*환경가전 렌탈.되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_RENTAL_PR, 0) END) AS A_ENVR_ELHM_RENTAL_PR /*환경가전 렌탈(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_RENTAL_JO, 0) END) AS A_ENVR_ELHM_RENTAL_JO /*환경가전 렌탈(조직).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_SPAY, 0) END) AS A_ENVR_ELHM_SPAY /*환경가전 일시불.되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_SPAY_PR, 0) END) AS A_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_SPAY_JO, 0) END) AS A_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_EXCP, 0) END) AS A_ENVR_ELHM_EXCP /*환경가전외.되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_EXCP_PR, 0) END) AS A_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_EXCP_JO, 0) END) AS A_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_FXAM_PR, 0) END) AS A_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_EXCP_FXAM_PR, 0) END) AS A_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_ENVR_ELHM_EXCP_FXAM, 0) END) AS A_ENVR_ELHM_EXCP_FXAM /*환경가전외 정액.되물림후실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_NW_SELL_CNT_PR, 0) END) AS A_NW_SELL_CNT_PR /*신규판매건수(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_NW_SELL_CNT_JO, 0) END) AS A_NW_SELL_CNT_JO /*신규판매건수(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_OG_MGT_PPL, 0) END) AS A_OG_MGT_PPL /*조직관리 실활동(명).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_MC, 0) END) AS A_MC /*기변(WELLS-P).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 1 THEN NVL(B.A_FXAM, 0) END) AS A_FXAM /*정액(WELLS-P).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM, 0) END) AS B_ENVR_ELHM /*환경가전.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_CNT_PR, 0) END) AS B_ENVR_ELHM_CNT_PR /*환경가전 건수(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_CNT_JO, 0) END) AS B_ENVR_ELHM_CNT_JO /*환경가전 건수(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_CNT, 0) END) AS B_ENVR_ELHM_CNT /*환경가전(건수).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_BASE_AMT, 0) END) AS B_ENVR_ELHM_BASE_AMT /*환경가전(기준금액).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_RENTAL, 0) END) AS B_ENVR_ELHM_RENTAL /*환경가전 렌탈.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_RENTAL_PR, 0) END) AS B_ENVR_ELHM_RENTAL_PR /*환경가전 렌탈(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_RENTAL_JO, 0) END) AS B_ENVR_ELHM_RENTAL_JO /*환경가전 렌탈(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_SPAY, 0) END) AS B_ENVR_ELHM_SPAY /*환경가전 일시불.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_SPAY_PR, 0) END) AS B_ENVR_ELHM_SPAY_PR /*환경가전 일시불(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_SPAY_JO, 0) END) AS B_ENVR_ELHM_SPAY_JO /*환경가전 일시불(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_EXCP, 0) END) AS B_ENVR_ELHM_EXCP /*환경가전외.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_EXCP_PR, 0) END) AS B_ENVR_ELHM_EXCP_PR /*환경가전외 일시불(개인).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_EXCP_JO, 0) END) AS B_ENVR_ELHM_EXCP_JO /*환경가전외 일시불(조직).되물림후실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_FXAM_PR, 0) END) AS B_ENVR_ELHM_FXAM_PR /*환경가전 정액(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_EXCP_FXAM_PR, 0) END) AS B_ENVR_ELHM_EXCP_FXAM_PR /*환경가전외 정액.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_ENVR_ELHM_EXCP_FXAM, 0) END) AS B_ENVR_ELHM_EXCP_FXAM /*환경가전외 정액.되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_NW_SELL_CNT_PR, 0) END) AS B_NW_SELL_CNT_PR /*신규판매건수(개인).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_NW_SELL_CNT_JO, 0) END) AS B_NW_SELL_CNT_JO /*신규판매건수(조직).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_OG_MGT_PPL, 0) END) AS B_OG_MGT_PPL /*조직관리 실활동(명).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_MC, 0) END) AS B_MC /*기변(WELLS-P).되물림전실적*/
                     , MAX(CASE WHEN B.RN = 2 THEN NVL(B.A_FXAM, 0) END) AS B_FXAM /*정액(WELLS-P).되물림전실적*/
                     , NVL(C.TB_ENVR_ELHM, 0) AS TB_ENVR_ELHM /*환경가전.귀속전월실적(T_BEFORE TB)*/
                     , NVL(C.TB_ENVR_ELHM_CNT, 0) AS TB_ENVR_ELHM_CNT /*환경가전(건수).귀속전월실적(T_BEFORE TB)*/
                     , NVL(C.TB_ENVR_ELHM_CNT_PR, 0) AS TB_ENVR_ELHM_CNT_PR /*귀속전월실적 환경가전 건수(개인)*/
                     , NVL(C.TB_ENVR_ELHM_CNT_JO, 0) AS TB_ENVR_ELHM_CNT_JO /*귀속전월실적 환경가전 건수(조직)*/
                     , NVL(C.TB_ENVR_ELHM_RENTAL, 0) AS TB_ENVR_ELHM_RENTAL /*환경가전 렌탈.귀속전월실적(T_BEFROE TB)*/
                     , NVL(C.TB_ENVR_ELHM_RENTAL_PR, 0) AS TB_ENVR_ELHM_RENTAL_PR /*귀속전월실적 환경가전 렌탈(개인)*/
                     , NVL(C.TB_ENVR_ELHM_RENTAL_JO, 0) AS TB_ENVR_ELHM_RENTAL_JO /*귀속전월실적 환경가전 렌탈(조직)*/
                     , NVL(C.TB_NW_SELL_CNT_PR, 0) AS TB_NW_SELL_CNT_PR /*귀속전월실적 신규판매 건수(개인)*/
                     , NVL(C.TB_NW_SELL_CNT_JO, 0) AS TB_NW_SELL_CNT_JO /*귀속전월실적 신규판매 건수(조직)*/
                     , NVL(C.TB_ENVR_ELHM_SPAY_PR, 0) AS TB_ENVR_ELHM_SPAY_PR /*귀속전월실적 환경가전 일시불(개인)*/
                     , NVL(C.TB_ENVR_ELHM_SPAY_JO, 0) AS TB_ENVR_ELHM_SPAY_JO /*귀속전월실적 환경가전 일시불(조직)*/
                     , NVL(C.TB_ENVR_ELHM_EXCP_PR, 0) AS TB_ENVR_ELHM_EXCP /*귀속전월실적 환경가전외 일시불(개인)*/
                     , NVL(C.TB_ENVR_ELHM_EXCP_PR, 0) AS TB_ENVR_ELHM_EXCP_PR /*귀속전월실적 환경가전외 일시불(개인)*/
                     , NVL(C.TB_ENVR_ELHM_EXCP_JO, 0) AS TB_ENVR_ELHM_EXCP_JO /*귀속전월실적 환경가전외 일시불(조직)*/
                     , NVL(C.TB_ENVR_ELHM_FXAM_PR, 0) AS TB_ENVR_ELHM_FXAM_PR /*귀속전월실적 환경가전 정액(개인)*/
                     , NVL(C.TB_ENVR_ELHM_EXCP_FXAM_PR, 0) AS TB_ENVR_ELHM_EXCP_FXAM_PR /*귀속전월실적 환경가전외 정액(개인)*/
                     , NVL(C.TB_OG_MGT_PPL, 0) AS TB_OG_MGT_PPL /*귀속전월실적 조직관리 실활동(명)*/
                     , NVL(C.TB_MC, 0) AS TB_MC /*귀속전월실적 기변(WELLS-P)*/
                     , NVL(C.TB_FXAM, 0) AS TB_FXAM /*귀속전월실적 기변(WELLS-P)*/
                  FROM (
                         SELECT BASE_YM
                              , PERF_YM
                              , OG_TP_CD
                              , PRTNR_NO
                              <!--, NVL(MAX((CASE WHEN (CASE WHEN PERF_ATC_CD IN ('W01P00018') THEN PERF_VAL END) IS NOT NULL THEN 'Y' ELSE '' END)), 0) AS AKSD48_YN /*정착지급여부*/-->
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00003', 'W00P00004', 'W00P00005') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM /*귀속월실적(TOTAL T) 환경가전*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_CNT /*귀속월실적 환경가전(건수) */
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_CNT_PR /*귀속월실적 환경가전 건수(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND PERF_DV_CD = '2' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_CNT_JO /*귀속월실적 환경가전 건수(조직)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00028') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_MC /*기변(WELLS-P).귀속월실적*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00029') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_FXAM /*정액(WELLS-P).귀속월실적*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00010') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_NW_SELL_CNT_PR /*귀속월실적 신규판매 건수(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00010') AND PERF_DV_CD = '2' THEN PERF_VAL END)), 0) AS T_NW_SELL_CNT_JO /*귀속월실적 신규판매 건수(조직)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00003', 'W00P00004', 'W00P00005') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_BASE_AMT /*귀속월실적 환경가전(기준금액)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_RENTAL /*귀속월실적 환경가전 렌탈*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_RENTAL_PR /*귀속월실적 환경가전 렌탈(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND PERF_DV_CD = '2' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_RENTAL_JO /*귀속월실적 환경가전 렌탈(조직)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_SPAY /*귀속월실적 환경가전 일시불*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_SPAY_PR /*귀속월실적 환경가전 일시불(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND PERF_DV_CD = '2' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_SPAY_JO /*귀속월실적 환경가전 일시불(조직)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00029', 'W00P00005') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_FXAM_PR /*귀속월실적 환경가전 정액(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00004', 'W00P00006', 'W00P00007') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_EXCP /*귀속월실적 환경가전외*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00004', 'W00P00006') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_EXCP_PR /*귀속월실적 환경가전외 일시불(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00004', 'W00P00006') AND PERF_DV_CD = '2' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_EXCP_JO /*귀속월실적 환경가전외 일시불(조직)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00030', 'W00P00007') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_EXCP_FXAM /*귀속월실적 환경가전외 정액*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W00P00030', 'W00P00007') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_ENVR_ELHM_EXCP_FXAM_PR /*귀속월실적 환경가전외 정액(개인)*/
                              , NVL(SUM((CASE WHEN PERF_ATC_CD IN ('W01P00020', 'W02P00111') AND PERF_DV_CD = '0' THEN PERF_VAL END)), 0) AS T_OG_MGT_PPL /*귀속월실적 조직관리 실활동(명)*/
                           FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감(ASIS: AK1700P) */
                          WHERE DTA_DL_YN = 'N'
                            AND FEE_TCNT_DV_CD = '02'
                            AND BASE_YM = PERF_YM
                            <if test='@MybatisUtils@equals(ogTpCd, "W01")'>
                            AND PERF_AGRG_CRT_DV_CD = '101' /*귀속월실적(순주문집계)_P */
                            </if>
                            <if test='@MybatisUtils@equals(ogTpCd, "W02")'>
                            AND PERF_AGRG_CRT_DV_CD = '201' /*귀속월실적(순주문집계)_M */
                            </if>
                            <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                            AND PRTNR_NO = #{prtnrNo}
                            </if>
                            AND OG_TP_CD = #{ogTpCd}
                            <if test='@MybatisUtils@isNotEmpty(perfYmFrom) and @MybatisUtils@isNotEmpty(perfYmTo)'>
                            AND PERF_YM BETWEEN #{perfYmFrom} AND #{perfYmTo}
                            </if>
                          GROUP BY BASE_YM , PERF_YM, OG_TP_CD, PRTNR_NO
                       ) A /*귀속월실적(기준년월 실적년월이 같은 최초 실적)*/
                   INNER JOIN (
                                  SELECT A.RN
                                       , A.BASE_YM
                                       , A.PERF_YM
                                       , A.OG_TP_CD
                                       , A.PRTNR_NO
                                       <!--, PERF_DV_CD-->
                                       <!--, ROW_NUMBER() OVER(PARTITION BY PRTNR_NO ORDER BY PERF_YM DESC) AS RN-->
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00016', 'W00P00035') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS HOME_CARE /* 홈케어실적 */
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00028', 'W00P00008') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS MC_PERF /*기변실적*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00012', 'W02P00093') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS ATDC_DC /*미팅(출근일수)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00003', 'W00P00004', 'W00P00005') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM /*되물림전후실적(AFTER A) 환경가전*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00028') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_MC /*되물림전후실적 기변*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00029') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_FXAM /*되물림전후실적 정액*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00010') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_NW_SELL_CNT_PR /*되물림전후실적 신규판매 건수(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00010') AND A.PERF_DV_CD = '2' THEN A.PERF_VAL END)), 0) AS A_NW_SELL_CNT_JO /*되물림전후실적 신규판매 건수(조직)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_CNT /*되물림전후실적 환경가전(건수)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_CNT_PR /*되물림전후실적 환경가전 건수(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00030', 'W02P00002') AND A.PERF_DV_CD = '2' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_CNT_JO /*되물림전후실적 환경가전 건수(조직)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00003', 'W00P00004', 'W00P00005') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_BASE_AMT /*되물림전후실적 환경가전(기준금액)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_RENTAL /*되물림전후실적 환경가전 렌탈*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_RENTAL_PR /*되물림전후실적 환경가전 렌탈(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00003') AND A.PERF_DV_CD = '2' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_RENTAL_JO /*되물림전후실적 환경가전 렌탈(조직)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_SPAY /*되물림전후실적 환경가전 일시불*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_SPAY_PR /*되물림전후실적 환경가전 일시불(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00001', 'W00P00004') AND A.PERF_DV_CD = '2' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_SPAY_JO /*되물림전후실적 환경가전 일시불(조직)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00029', 'W00P00005') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_FXAM_PR /*되물림전후실적 환경가전 정액(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00004', 'W00P00006', 'W00P00007') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_EXCP /*되물림전후실적 환경가전외*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00004', 'W00P00006') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_EXCP_PR /*되물림전후실적 환경가전외 일시불(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00004', 'W00P00006') AND A.PERF_DV_CD = '2' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_EXCP_JO /*되물림전후실적 환경가전외 일시불(조직)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00030', 'W00P00007') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_EXCP_FXAM /*되물림전후실적 환경가전외 정액*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W00P00030', 'W00P00007') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_ENVR_ELHM_EXCP_FXAM_PR /*되물림전후실적 환경가전외 정액(개인)*/
                                       , NVL(SUM((CASE WHEN A.PERF_ATC_CD IN ('W01P00020', 'W02P00111') AND A.PERF_DV_CD = '0' THEN A.PERF_VAL END)), 0) AS A_OG_MGT_PPL /*되물림전후실적 조직관리 실활동(명)*/
                                    FROM ( SELECT --/*+ INDEX(TB_FEAM_NTORP_PERF_MM_CL (PERF_AGRG_CRT_DV_CD, OG_TP_CD, PERF_YM, BASE_YM)) */ --힌트 제거
                                                  BASE_YM
                                                , PERF_YM
                                                , OG_TP_CD
                                                , PRTNR_NO
                                                , PERF_DV_CD
                                                , PERF_ATC_CD
                                                , PERF_VAL
                                                , PERF_AGRG_CRT_DV_CD
                                                , ROW_NUMBER() OVER(PARTITION BY PRTNR_NO, PERF_ATC_CD, PERF_DV_CD  ORDER BY BASE_YM DESC, PERF_YM DESC) AS RN
                                             FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감(ASIS: AK1700P) */
                                            WHERE DTA_DL_YN = 'N'
                                              AND FEE_TCNT_DV_CD = '02'
                                              <if test='@MybatisUtils@equals(ogTpCd, "W01")'>
                                              AND PERF_AGRG_CRT_DV_CD = '102' /*되물림후실적(순주문집계)_P */
                                              </if>
                                              <if test='@MybatisUtils@equals(ogTpCd, "W02")'>
                                              AND PERF_AGRG_CRT_DV_CD = '202' /*되물림후실적(순주문집계)_M */
                                              </if>
                                              AND OG_TP_CD = #{ogTpCd}
                                              <if test='@MybatisUtils@isNotEmpty(perfYmFrom) and @MybatisUtils@isNotEmpty(perfYmTo)'>
                                              AND PERF_YM BETWEEN #{perfYmFrom} AND #{perfYmTo}
                                              </if>
                                              <if test='@MybatisUtils@isNotEmpty(redfAdsbOcYmFrom) and @MybatisUtils@isNotEmpty(redfAdsbOcYmTo)'>
                                              AND BASE_YM <![CDATA[ <= ]]> #{redfAdsbOcYmTo}
                                              </if>
                                              <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                              AND PRTNR_NO = #{prtnrNo}
                                              </if>
                                         ) A
                                   WHERE A.RN IN ('1','2')
                                   GROUP BY A.BASE_YM
                                          , A.PERF_YM
                                          , A.OG_TP_CD
                                          , A.PRTNR_NO
                                          , A.RN
                                 ) B /* 되물림전월실적과 되물림후실적 */
                    <!--ON A.BASE_YM = B.BASE_YM-->
                    ON A.PERF_YM = B.PERF_YM
                   AND A.OG_TP_CD = B.OG_TP_CD
                   AND A.PRTNR_NO = B.PRTNR_NO
                  LEFT OUTER JOIN (
                                   SELECT BASE_YM
                                        , PERF_YM
                                        , OG_TP_CD
                                        , PRTNR_NO
                                        , ROW_NUMBER() OVER(PARTITION BY PRTNR_NO ORDER BY PERF_YM DESC) AS RN
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W020001' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM /*귀속전월실적(BEFORE B) 환경가전*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W01P00002' THEN PERF_VAL END), 0) AS TB_MC /*되물림전후실적 기변*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W01P00014' THEN PERF_VAL END), 0) AS TB_FXAM /*되물림전후실적 정액*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W02P00002' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_CNT /*귀속전월실적 환경가전(건수)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W02P00002' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_CNT_PR /*귀속전월실적 환경가전 건수(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W02P00002' AND PERF_DV_CD = '2' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_CNT_JO /*귀속전월실적 환경가전 건수(조직)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00003' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_RENTAL /*귀속전월실적 환경가전 렌탈*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00003' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_RENTAL_PR /*귀속전월실적 환경가전 렌탈(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00003' AND PERF_DV_CD = '2' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_RENTAL_JO /*귀속전월실적 환경가전 렌탈(조직)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00010' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_NW_SELL_CNT_PR /*귀속전월실적 신규판매 건수(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00010' AND PERF_DV_CD = '2' THEN PERF_VAL END), 0) AS TB_NW_SELL_CNT_JO /*귀속전월실적 신규판매 건수(조직)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00004' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_SPAY_PR /*귀속전월실적 환경가전 일시불(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00004' AND PERF_DV_CD = '2' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_SPAY_JO /*귀속전월실적 환경가전 일시불(조직)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00006' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_EXCP_PR /*귀속전월실적 환경가전외 일시불(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00006' AND PERF_DV_CD = '2' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_EXCP_JO /*귀속전월실적 환경가전외 일시불(조직)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00005' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_FXAM_PR /*귀속전월실적 환경가전 정액(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00007' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_EXCP_FXAM /*귀속전월실적 환경가전외 정액*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W00P00007' AND PERF_DV_CD = '0' THEN PERF_VAL END), 0) AS TB_ENVR_ELHM_EXCP_FXAM_PR /*귀속전월실적 환경가전외 정액(개인)*/
                                        , NVL((CASE WHEN PERF_ATC_CD = 'W02P00111' THEN PERF_VAL END), 0) AS TB_OG_MGT_PPL /*귀속전월실적 조직관리 실활동(명)*/
                                     FROM TB_FEAM_NTORP_PERF_MM_CL /* 순주문파트너실적월마감(ASIS: AK1700P) */
                                    WHERE DTA_DL_YN = 'N'
                                      AND FEE_TCNT_DV_CD = '02'
                                      <if test='@MybatisUtils@equals(ogTpCd, "W01")'>
                                      AND PERF_AGRG_CRT_DV_CD = '101' /*귀속전월실적(순주문집계)_P */
                                      </if>
                                      <if test='@MybatisUtils@equals(ogTpCd, "W02")'>
                                      AND PERF_AGRG_CRT_DV_CD = '201' /*귀속전월실적(순주문집계)_M */
                                      </if>
                                      AND OG_TP_CD = #{ogTpCd} /* M조직 집계 */
                                      <if test='@MybatisUtils@isNotEmpty(prtnrNo)'>
                                      AND PRTNR_NO = #{prtnrNo}
                                      </if>
                                      AND PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(PERF_YM||'01', 'YYYYMMDD'), -1), 'YYYYMM')
                                  ) C /*귀속전월실적*/
                    ON A.BASE_YM = C.BASE_YM
                   AND A.PERF_YM = C.PERF_YM
                   AND A.OG_TP_CD = C.OG_TP_CD
                   AND A.PRTNR_NO = C.PRTNR_NO
                 WHERE 1=1
                   AND B.RN IN ('1', '2')
                   <!--AND C.RN = '1' /*TODO: 현재 C쪽 데이터 없어서 임시주석처리*/-->
                 GROUP BY  A.PERF_YM, A.OG_TP_CD, A.PRTNR_NO, B.HOME_CARE, B.ATDC_DC, B.MC_PERF
                        , A.T_ENVR_ELHM, A.T_ENVR_ELHM_CNT, A.T_ENVR_ELHM_BASE_AMT, A.T_ENVR_ELHM_RENTAL, A.T_ENVR_ELHM_SPAY
                        , A.T_ENVR_ELHM_EXCP, A.T_ENVR_ELHM_EXCP_FXAM, C.TB_ENVR_ELHM, C.TB_ENVR_ELHM_CNT, C.TB_ENVR_ELHM_RENTAL
                        , A.T_ENVR_ELHM_CNT_PR, A.T_ENVR_ELHM_CNT_JO, A.T_ENVR_ELHM_RENTAL_PR, A.T_ENVR_ELHM_RENTAL_JO, A.T_ENVR_ELHM_SPAY_PR
                        , A.T_ENVR_ELHM_SPAY_JO, A.T_ENVR_ELHM_EXCP_PR, A.T_ENVR_ELHM_EXCP_JO, A.T_ENVR_ELHM_EXCP_FXAM_PR, C.TB_ENVR_ELHM_CNT_PR
                        , C.TB_ENVR_ELHM_CNT_JO, C.TB_ENVR_ELHM_RENTAL, C.TB_ENVR_ELHM_RENTAL_PR, C.TB_ENVR_ELHM_RENTAL_JO, C.TB_NW_SELL_CNT_PR
                        , C.TB_NW_SELL_CNT_JO, C.TB_ENVR_ELHM_SPAY_PR, C.TB_ENVR_ELHM_SPAY_JO, C.TB_ENVR_ELHM_EXCP_PR, C.TB_ENVR_ELHM_EXCP_JO
                        , C.TB_ENVR_ELHM_EXCP_FXAM, A.T_NW_SELL_CNT_PR, A.T_NW_SELL_CNT_JO, A.T_ENVR_ELHM_EXCP_FXAM_PR, A.T_ENVR_ELHM_FXAM_PR
                        , A.T_OG_MGT_PPL, C.TB_OG_MGT_PPL, A.T_MC, C.TB_MC, A.T_FXAM, C.TB_FXAM, C.TB_ENVR_ELHM_FXAM_PR
              ) M

            <!--ON M.BASE_YM = D.REDF_ADSB_OC_YM-->
            ON M.PERF_YM = D.PERF_YM
           AND M.OG_TP_CD = D.OG_TP_CD
           AND M.PRTNR_NO = D.PRTNR_NO
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AK05 /*월파트너내역*/
            ON D.PERF_YM = AK05.BASE_YM
           AND D.OG_TP_CD = AK05.OG_TP_CD
           AND D.PRTNR_NO = AK05.PRTNR_NO
          LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ AK55 /*월파트너내역(실적년월+1)*/
            ON M.PERF_YM_1 = AK55.BASE_YM
           AND M.OG_TP_CD = AK55.OG_TP_CD
           AND M.PRTNR_NO = AK55.PRTNR_NO
          LEFT OUTER JOIN TB_OGPS_TOPMR_PLAR_APLC_IZ AK06 /*수석플래너신청내역*/
            ON M.PERF_YM = AK06.MNGT_YM
           AND M.OG_TP_CD = AK06.OG_TP_CD
           AND M.PRTNR_NO = AK06.PRTNR_NO
           AND AK06.OG_TP_CD = 'W01' /* 수석플래너는 P조직만 있음 */
          LEFT OUTER JOIN (
                            SELECT C1.BASE_YM
                                 , C1.PERF_YM
                                 , C1.PRTNR_NO
                                 , C1.OG_TP_CD
                                 , NVL(SUM(SL_AMT), 0) AS SELL_AMT /*매출금액*/
                                 , AVG(NVL(C1.ACKMT_PERF_RT,0)) AS ACKMT_PERF_RT /*인정실적율*/
                              FROM TB_FEAM_WELS_NRCTR_MM_CL C1 /*웰스순주문계약월마감*/
                             WHERE C1.DTA_DL_YN = 'N'
                               AND C1.FEE_TCNT_DV_CD = '02'
                             GROUP BY C1.BASE_YM, C1.PERF_YM, C1.PRTNR_NO, C1.OG_TP_CD
                          ) C
            ON M.BASE_YM = C.BASE_YM
           AND M.PERF_YM = C.PERF_YM
           AND M.PRTNR_NO = C.PRTNR_NO
           AND M.OG_TP_CD = C.OG_TP_CD
         WHERE 1=1
           <if test='@MybatisUtils@equals(rsbDvCd, "01")'>
               <choose>
                   <when test='@MybatisUtils@equals(ogTpCd, "W01")'>
                       AND TO_NUMBER(AK05.PSTN_DV_CD) = '15' /* WELLS-P의 경우, 직급 15 고정중.. */
                   </when>
                   <otherwise>
                       AND TO_NUMBER(AK05.PSTN_DV_CD) <![CDATA[>=]]> 7 /*지구장 이하, 직급은 지국장도 포함*/
                   </otherwise>
               </choose>
           </if>
           <if test='@MybatisUtils@equals(rsbDvCd, "02")'>
           AND TO_NUMBER(AK05.PSTN_DV_CD) <![CDATA[<=]]> 7 /*지점장 이상*/
           </if>
         ORDER BY D.PERF_YM, AK05.OG_CD, AK05.PRTNR_NO
    </select>


</mapper>
