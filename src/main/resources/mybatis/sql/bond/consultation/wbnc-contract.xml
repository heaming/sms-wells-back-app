<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.bond.consultation.mapper.WbncContractMapper">
    <select id="selectContracts" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncContractDto$SearchRes">
        SELECT CTT /* 컨택 */
		     , BIZ_DV /* 업무구분 */
		     , BIZ_DV_NM /* 업무구분명 */
		     , PRDF /* 제품군 */
		     , PDCT_NM /* 제품명 */
		     , CNTR_NO /* 계약번호 */
		     , CNTR_SN /* 계약일련번호 */
		     , CST_NM /* 고객명 */
		     , DLQ_MCNT /* 연체개월 */
		     , OJ_AMT /* 대상금액 */
		     , OJ_DP /* 대상입금 */
		     , OJ_BLAM /* 대상잔액 */
		     , TOT_DLQ_AMT /* 총연체금 */
		     , TOT_DLQ_DP /* 총연체입금 */
		     , TOT_DLQ_BLAM /* 총연체잔액 */
		     , DLQ_AMT /* 연체금액 */
		     , DLQ_DP /* 연체입금 */
		     , DLQ_BLAM  /* 연체잔액 */
		     , MM_CHRAM_AMT /* 월요금액 */
		     , MM_CHRAM_DP /* 월요금입금 */
		     , MM_CHRAM_BLAM /* 월요금잔액 */
		     , DLQ_ADD_AMT /* 연체가산금액 */
		     , DLQ_ADD_DP /* 연체가산입금 */
		     , DLQ_ADAMT_BLAM /* 연체가산금잔액 */
		     , UC_AMT /* 미수금액 */
		     , RSG_BOR_DP_AMT /* 해지위약입금금액 */
		     , UC_DP /* 미수입금 */
		     , UC_BLAM /* 미수잔액 */
		     , TOT_DP_AMT /* 총입금액 */
		     , SPMT_SL /* 추가매출 */
		     , CCAM /* 위약금 */
		     , LSFE /* 분실료 */
		     , RTLFE1 /* 렌탈료1 */
		     , RTLFE_ISTM1 /* 렌탈료1할 */
		     , RTLFE2 /* 렌탈료2 */
		     , RTLFE_ISTM2 /* 렌탈료2할 */
		     , PROM_DT /* 약속일자 */
		     , DPR_NM /* 입금자명 */
		     , CLCTAM_PRTNR_NO /* 집금번호 */
		     , CLCTAM_ICHR  /* 집급담당 */
		     , CNTR_CRAL_LOCARA_TNO
		     , CNTR_MEXNO_ENCR
		     , CNTR_CRAL_IDV_TNO /* 계약휴대전화번호 */
		     , CNTR_LOCARA_TNO
		     , CNTR_EXNO_ENCR
		     , CNTR_IDV_TNO /* 계약전화번호 */
		     , IST_CRAL_LOCARA_TNO
		     , IST_MEXNO_ENCR
		     , IST_CRAL_IDV_TNO /* 설치휴대전화번호 */
		     , IST_LOCARA_TNO
		     , IST_EXNO_ENCR
		     , IST_IDV_TNO /* 설치전화번호 */
		     , CST_NO /* 고객번호 */
		     , TF_DT /* 이관일자 */
		     , BU_NOTI_DT /* 부담통보일자 */
		     , BU_NOTI_TP /* 부담통보유형 */
		     , CNTR_ZIP /* 계약우편번호 */
		     , CNTR_ADR /* 계약주소 */
		     , IST_ZIP /* 설치우편번호 */
		     , IST_ADR /* 설치주소 */
		     , VT_AC_BNK /* 가상계좌은행 */
		     , VT_AC_NO /* 가상계좌번호 */
		     , PESU_DT /* 독촉일자 */
		     , HI_DT /* 최고일자 */
		     , OVRD_DT /* 채불일자 */
		     , CPSN_EFCM  /* 강제집행*/
		     , DSB_CMD  /* 지급명령*/
		     , PRTY_CLRS  /* 재산명시*/
		     , SUBM_CMD  /* 제출명령*/
		     , CRC_CMD  /* 보정명령*/
		     , CUJ_OVRD  /* 법원채불*/
		     , VST_RS  /* 방문결과*/
		     , VST_DT  /* 방문일자*/
		     , SFK /* 세이프키*/
		     , UNUITM /* 특이사항*/
		     , CNTR_TP_CD /* 고객구분*/
		     , BIL_DT /* 이체일자 */
		     , BIL_TP_CD /* 입금유형코드*/
		  FROM (
		        SELECT
		        		CASE WHEN T2.FST_RGST_DTM > T1.BND_ASN_DT AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 1 THEN '○'
		                    WHEN T2.FST_RGST_DTM > T1.BND_ASN_DT AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 2 THEN '△'
		                    ELSE 'Ｘ'
		                END AS CTT /* 컨택 */
		             , T3.BND_BIZ_DV_CD AS BIZ_DV/* 업무구분 */
		             , F_CMZ_CD_NM('TNT_WELLS', 'BND_BIZ_DV_CD', T3.BND_BIZ_DV_CD) AS BIZ_DV_NM/* 업무구분 */
		             , T19.PD_CLSF_NM AS PRDF /* 제품군 */
		             , T19.PD_NM AS PDCT_NM /* 제품명 */
		             , T1.CNTR_NO AS CNTR_NO /* 계약번호 */
		             , T1.CNTR_SN AS CNTR_SN /* 계약일련번호 */
		             , T5.CST_KNM AS CST_NM /* 고객명 */
		             , T3.DLQ_MCN AS DLQ_MCNT /* 연체개월 */
		             , (NVL(T3.DLQ_AMT, 0) + NVL(T3.DLQ_ADD_AMT, 0)) + NVL(T3.THM_CHRAM_AMT, 0) AS OJ_AMT /* 대상금액 */
		             , (NVL(T3.DLQ_DP_AMT, 0) + NVL(T3.DLQ_ADD_DP_AMT, 0)) + NVL(T3.THM_CHRAM_DP_AMT, 0) AS OJ_DP /* 대상입금 */
		             , ((NVL(T3.DLQ_AMT, 0) + NVL(T3.DLQ_ADD_AMT, 0)) + NVL(T3.THM_CHRAM_AMT, 0)) - ((NVL(T3.DLQ_DP_AMT, 0) + NVL(T3.DLQ_ADD_DP_AMT, 0)) + NVL(T3.THM_CHRAM_DP_AMT, 0)) AS OJ_BLAM /* 대상금액 - 대상입금 = 대상잔액 */
		             , NVL(T3.DLQ_AMT, 0) + NVL(T3.DLQ_ADD_AMT, 0) AS TOT_DLQ_AMT /* 연체금액 + 연체가산금 = 총연체금 */
		             , NVL(T3.DLQ_DP_AMT, 0) + NVL(T3.DLQ_ADD_DP_AMT, 0) AS TOT_DLQ_DP /* 연체입금금액 + 연체가산금입금금액 = 총연체입금 */
		             , (NVL(T3.DLQ_AMT, 0) + NVL(T3.DLQ_ADD_AMT, 0)) - (NVL(T3.DLQ_DP_AMT, 0) + NVL(T3.DLQ_ADD_DP_AMT, 0)) AS TOT_DLQ_BLAM /* 총연체금 - 총연체입금 = 총연체잔액 */
		             , NVL(T3.DLQ_AMT, 0) AS DLQ_AMT /* 연체금액 */
		             , NVL(T3.DLQ_DP_AMT, 0) AS DLQ_DP /* 연체입금 */
		             , NVL(T3.DLQ_AMT, 0) - NVL(T3.DLQ_DP_AMT, 0) AS DLQ_BLAM /* 연체금액 - 연체입금 = 연체잔액 */
		             , NVL(T3.THM_CHRAM_AMT, 0) AS MM_CHRAM_AMT /* 월요금액 */
		             , NVL(T3.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_DP /* 월요금입금 */
		             , NVL(T3.THM_CHRAM_AMT, 0) - NVL(T3.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_BLAM /* 당월요금금액 - 당월요금입금금액 = 월요금잔액 */
		             , NVL(T3.DLQ_ADD_AMT, 0) AS DLQ_ADD_AMT /* 연체가산금액 */
		             , NVL(T3.DLQ_ADD_DP_AMT, 0) AS DLQ_ADD_DP /* 연체가산입금 */
		             , NVL(T3.DLQ_ADD_AMT, 0) - NVL(T3.DLQ_ADD_DP_AMT, 0) AS DLQ_ADAMT_BLAM /* 연체가산금액 - 연체가산금입금금액 = 연체가산금잔액 */
		             , NVL(T3.UC_AMT, 0) AS UC_AMT /* 미수금액 */
		             , NVL(T3.RSG_BOR_DP_AMT, 0) AS RSG_BOR_DP_AMT /* 해지위약입금금액 */
                     , (SELECT NVL(SUM(RVE_AMT),0) FROM ( SELECT CASE WHEN TT1.DP_DV_CD IN ('2','4') THEN NVL(TT1.RVE_AMT, 0) * -1 ELSE NVL(TT1.RVE_AMT, 0) END AS RVE_AMT FROM TB_RVDW_RVE_DTL TT1 WHERE 1=1 AND TT1.CNTR_NO = T1.CNTR_NO AND SUBSTR(PERF_DT,1,6) = T1.BASE_YM AND TT1.DTA_DL_YN = 'N' AND TT1.RVE_DV_CD IN ('02','03','04','05','07','08','19','13','18','97') )) AS UC_DP /* 미수입금 */
                     , NVL(T3.UC_AMT, 0) - (SELECT NVL(SUM(RVE_AMT),0) FROM ( SELECT CASE WHEN TT1.DP_DV_CD IN ('2','4') THEN NVL(TT1.RVE_AMT, 0) * -1 ELSE NVL(TT1.RVE_AMT, 0) END AS RVE_AMT FROM TB_RVDW_RVE_DTL TT1 WHERE 1=1 AND TT1.CNTR_NO = T1.CNTR_NO AND SUBSTR(PERF_DT,1,6) = T1.BASE_YM AND TT1.DTA_DL_YN = 'N' AND TT1.RVE_DV_CD IN ('02','03','04','05','07','08','19','13','18','97') )) AS UC_BLAM /* 미수금 - 미수입금 = 미수잔액 */
                     , (SELECT NVL(SUM(RVE_AMT),0) FROM ( SELECT CASE WHEN TT1.DP_DV_CD IN ('2','4') THEN NVL(TT1.RVE_AMT, 0) * -1 ELSE NVL(TT1.RVE_AMT, 0) END AS RVE_AMT FROM TB_RVDW_RVE_DTL TT1 WHERE 1=1 AND TT1.CNTR_NO = T1.CNTR_NO AND SUBSTR(PERF_DT,1,6) = T1.BASE_YM AND TT1.DTA_DL_YN = 'N' AND TT1.RVE_DV_CD IN ('02','03','04','05','07','08','19','13','14','18','97') )) AS TOT_DP_AMT /* 총입금액 */
		             , NVL(T6.SPMT_SL_AMT, 0) AS SPMT_SL /* 추가매출 */
		             , NVL(T7.BOR_AMT, 0) AS CCAM /* 위약금 */
		             , (SELECT NVL(TT1.LS_RNTF, 0) FROM TB_CBCL_WELLS_BOR_AMT_BAS TT1 WHERE TT1.PERF_YM = SUBSTR(T7.CCAM_CMPT_RQDT,0,6) AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N') AS LSFE/* 분실료 */
		             , NVL(T8.RENTAL_AMT, 0) AS RTLFE1 /* 렌탈료1 */
		             , NVL(T8.RENTAL_DSC_AMT, 0) AS RTLFE_ISTM1 /* 렌탈료1할 */
		             , NVL(T8.RENTAL_AMT2, 0) AS RTLFE2 /* 렌탈료2 */
		             , NVL(T8.RENTAL_DSC_AMT2, 0) AS RTLFE_ISTM2 /* 렌탈료2할 */
		             , (SELECT PROM_DT
		                  FROM TB_CBBO_BND_CNSL_PROM_BOO_IZ /* 채권상담약속예약내역 */
		                 WHERE 1=1
		                   AND DTA_DL_YN = 'N'
		                   AND T1.CST_NO = CST_NO
		                   ORDER BY PROM_DT DESC FETCH FIRST 1 ROW ONLY
		                ) AS PROM_DT /* 약속일자 */
		             , (SELECT DPR_NM
		                  FROM (SELECT DPR_NM
		                        FROM TB_CBBO_BND_TEL_CNSL_IZ /* 채권전화상담내역 */
		                       WHERE CST_NO = CST_NO
		                       ORDER BY FST_RGST_DTM DESC FETCH FIRST 1 ROW ONLY) T2
		               ) AS DPR_NM /* 입금자명 */
		             , T1.CLCTAM_PRTNR_NO /* 집금번호 */
		             , (SELECT DISTINCT PRTNR_KNM FROM TB_CBBO_CLCTAM_PRTNR_DTL WHERE PRTNR_NO = T1.CLCTAM_PRTNR_NO) AS CLCTAM_ICHR   /* 집급담당 */
		             , T5.CRAL_LOCARA_TNO AS CNTR_CRAL_LOCARA_TNO
		             , T5.MEXNO_ENCR AS CNTR_MEXNO_ENCR
		             , T5.CRAL_IDV_TNO AS CNTR_CRAL_IDV_TNO /* 계약휴대전화번호 */
		             , (SELECT TT1.LOCARA_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T10.CNTR_ADRPC_ID)  AS CNTR_LOCARA_TNO
		             , (SELECT TT1.EXNO_ENCR FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T10.CNTR_ADRPC_ID)  AS CNTR_EXNO_ENCR
		             , (SELECT TT1.IDV_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T10.CNTR_ADRPC_ID)  AS CNTR_IDV_TNO /* 계약전화번호 */
		             , (SELECT TT1.CRAL_LOCARA_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_CRAL_LOCARA_TNO
		             , (SELECT TT1.MEXNO_ENCR FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_MEXNO_ENCR
		             , (SELECT TT1.CRAL_IDV_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_CRAL_IDV_TNO /* 설치휴대전화번호 */
		             , (SELECT TT1.LOCARA_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_LOCARA_TNO
		             , (SELECT TT1.EXNO_ENCR FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_EXNO_ENCR
		             , (SELECT TT1.IDV_TNO FROM TB_SSCT_CNTR_ADRPC_BAS TT1 WHERE TT1.CNTR_ADRPC_ID = T11.CNTR_ADRPC_ID)  AS IST_IDV_TNO /* 설치전화번호 */
		             , T1.CST_NO AS CST_NO /* 고객번호 */
		             , T1.BND_TF_DT AS TF_DT /* 이관일자 */
		             , T12.BU_NOTI_DT AS BU_NOTI_DT /* 부담통보일자 */
		             , T12.BU_NOTI_TP_CD AS BU_NOTI_TP /* 부담통보유형 */
		             , (SELECT NVL(TT1.NEW_ADR_ZIP, TT1.OLD_ADR_ZIP) FROM TB_GBCO_ADR_BAS TT1 WHERE TT1.ADR_ID = T10.ADR_ID)  AS CNTR_ZIP /* 계약우편번호 */
		             , (SELECT NVL(TT1.RNADR, TT1.LTN_ADR) || NVL(TT1.RDADR, TT1.LTN_DTL_ADR) FROM TB_GBCO_ADR_BAS TT1 WHERE TT1.ADR_ID = T10.ADR_ID)  AS CNTR_ADR /* 계약주소 */
		             , (SELECT NVL(TT1.NEW_ADR_ZIP, TT1.OLD_ADR_ZIP) FROM TB_GBCO_ADR_BAS TT1 WHERE TT1.ADR_ID = T11.ADR_ID)  AS IST_ZIP /* 설치우편번호 */
		             , (SELECT NVL(TT1.RNADR, TT1.LTN_ADR) || NVL(TT1.RDADR, TT1.LTN_DTL_ADR) FROM TB_GBCO_ADR_BAS TT1 WHERE TT1.ADR_ID = T11.ADR_ID)  AS IST_ADR /* 설치주소 */
		             , F_CMZ_CD_NM('TNT_WELLS', 'BNK_CD', T13.VAC_BNK_CD) AS VT_AC_BNK /* 가상계좌은행 */
		             , T13.VAC_NO AS VT_AC_NO /* 가상계좌번호 */
		             , (SELECT TT1.PESU_DT FROM TB_CBBO_BND_LWM_IZ TT1 WHERE TT1.PESU_DT IS NOT NULL AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN ORDER BY TT1.FNL_MDFC_DTM DESC FETCH FIRST 1 ROW ONLY) AS PESU_DT /* 독촉일자 */
                     , (SELECT TT1.RMDR_DT FROM TB_CBBO_BND_LWM_IZ TT1 WHERE TT1.RMDR_DT IS NOT NULL AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN ORDER BY TT1.FNL_MDFC_DTM DESC FETCH FIRST 1 ROW ONLY) AS HI_DT /* 최고일자 */
                     , (SELECT TT1.DFLT_DT FROM TB_CBBO_BND_LWM_IZ TT1 WHERE TT1.DFLT_DT IS NOT NULL AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN ORDER BY TT1.FNL_MDFC_DTM DESC FETCH FIRST 1 ROW ONLY) AS OVRD_DT /* 채불일자 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '01' ) AS CPSN_EFCM  /* 강제집행 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '02' ) AS DSB_CMD  /* 지급명령 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '03' ) AS PRTY_CLRS  /* 재산명시 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '04' ) AS SUBM_CMD  /* 제출명령 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '06' ) AS CRC_CMD  /* 보정명령 */
                     , (SELECT MAX(LWM_DT) FROM TB_CBBO_BND_LWM_IZ WHERE CST_NO = T1.CST_NO AND LWM_TP_CD = '07' ) AS CUJ_OVRD  /* 법원채불 */
		             , T15.BND_VST_RS_CD AS VST_RS  /* 방문결과*/
		             , T15.VST_DT AS VST_DT  /* 방문일자*/
		             , T5.SFK_VAL AS SFK /* 세이프키*/
		             , (SELECT TT1.CNSL_UNUITM_CN FROM TB_CBBO_BND_UNUITM_CVCP_DTL TT1 WHERE TT1.BND_CNTR_TP_CD = '01' AND TT1.CST_NO = T1.CST_NO AND TT1.DTA_DL_YN = 'N' ORDER BY FST_RGST_DTM DESC FETCH FIRST 1 ROW ONLY) AS UNUITM /* 특이사항*/
		             , T17.COPN_DV_CD AS CNTR_TP_CD /* 고객구분*/
		             , T16.MPY_BSDT AS BIL_DT /* 이체일자 */
		             , T16.DP_TP_CD AS BIL_TP_CD/* 입금유형코드*/
		          FROM TB_CBBO_BND_CNSL_BAS_IZ T1 /* 채권상담기본내역 */
		          LEFT OUTER JOIN LATERAL(
		                           SELECT CST_NO
                                        , BND_CLN_PSBL_DV_CD
                                        , BND_CLN_PRCS_DV_CD
                                        , BND_CNSL_CST_STAT_CD
                                        , TEL_CNSL_RS_CD
                                        , FST_RGST_DTM
                                     FROM TB_CBBO_BND_TEL_CNSL_IZ TT1 /* 채권전화상담내역 */
                                    WHERE TT1.CST_NO = T1.CST_NO
                                    ORDER BY FST_RGST_DTM DESC FETCH FIRST 1 ROW ONLY
		             ) T2
		            ON 1=1
		          LEFT OUTER JOIN TB_CBBO_BND_CNTR_BAS T3 /* 채권계약기본 */
		            ON T1.CNTR_NO = T3.CNTR_NO
		           AND T1.CNTR_SN = T3.CNTR_SN
		           AND T1.BASE_YM = T3.BASE_YM
		          LEFT OUTER JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
		            ON T1.CST_NO = T5.CST_NO
		          LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T6 /* WELLS매출월마감내역 */
		            ON T6.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		           AND T6.CNTR_NO = T1.CNTR_NO
		           AND T6.CNTR_SN = T1.CNTR_SN
		          LEFT OUTER JOIN TB_CBCL_WELLS_BOR_AMT_BAS T7 /* WELLS위약금액기본 */
		            ON T7.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		           AND T7.CNTR_NO = T1.CNTR_NO
		           AND T7.CNTR_SN = T1.CNTR_SN
		           AND T7.DTA_DL_YN = 'N'
		          LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T8 /* WELLS매출월마감내역 */
		            ON T8.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		           AND T8.CNTR_NO = T1.CNTR_NO
		           AND T8.CNTR_SN = T1.CNTR_SN
		          LEFT OUTER JOIN LATERAL(
		                          SELECT
                                           CR.CNTR_ADRPC_ID
                                         , CB.ADR_ID
                                      FROM TB_SSCT_CNTR_ADR_REL CR /* 계약주소관계 */
		                              LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS CB /* 계약주소지기본 */
		                                ON CB.CNTR_ADRPC_ID = CR.CNTR_ADRPC_ID
		                             WHERE 1=1
		                               AND CR.DTL_CNTR_NO = T1.CNTR_NO
		                               AND CR.DTL_CNTR_SN = T1.CNTR_SN
		                               AND CR.CNTR_UNIT_TP_CD = '020'
		                               AND CR.ADRPC_TP_CD = '1'  /* 계약주소 */
		                               AND CR.DTA_DL_YN = 'N'
		             ) T10
		            ON 1=1
		          LEFT OUTER JOIN LATERAL(
		                            SELECT
	                                       CR.CNTR_ADRPC_ID
                                         , CB.ADR_ID
                                      FROM TB_SSCT_CNTR_ADR_REL CR /* 계약주소관계 */
		                              LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS CB /* 계약주소지기본 */
		                                ON CB.CNTR_ADRPC_ID = CR.CNTR_ADRPC_ID
		                             WHERE 1=1
		                               AND CR.DTL_CNTR_NO = T1.CNTR_NO
		                               AND CR.DTL_CNTR_SN = T1.CNTR_SN
		                               AND CR.CNTR_UNIT_TP_CD = '020'
		                               AND CR.ADRPC_TP_CD IN ('2','3')  /* 배송,설치주소 */
		                               AND CR.DTA_DL_YN = 'N'
		                          ) T11
		            ON 1=1
		          LEFT OUTER JOIN TB_FEDD_BU_NOTI_RGST_BAS T12 /* 부담통보등록기본 */
		            ON T1.CNTR_NO = T12.CNTR_NO
		           AND T1.CNTR_SN = T12.CNTR_SN
		          LEFT JOIN LATERAL (
		                                      SELECT
		                                             CST_NO
		                                           , CNTR_NO
		                                           , CNTR_SN
		                                           , TT2.VAC_BNK_CD
		                                           , (SELECT TT3.FNIT_NM FROM TB_RVDW_FNIT_CD TT3 WHERE FNIT_DV_CD = '1' AND TT3.FNIT_CD = TT2.VAC_BNK_CD) AS VT_AC_BNK
		                                           , TT2.VAC_NO
		                                        FROM TB_RVDW_VAC_IS_DTL TT1
		                                       INNER JOIN TB_RVDW_VAC_BAS TT2
		                                          ON TT1.CST_NO = T1.CST_NO
		                                         AND TT1.CNTR_NO = T1.CNTR_NO
		                                         AND TT1.CNTR_SN = T1.CNTR_SN
		                                         AND TT2.VAC_IS_ID = TT1.VAC_IS_ID
		                                         AND TT2.VAC_IS_DV_CD = '5'/*가상계좌발급구분코드 = 연체집금용*/
		                                         AND TT2.VAC_STAT_CD = '1'/*가상계좌상태코드 = 할당*/
		                                         ORDER BY VAC_IS_DTL_SN DESC FETCH FIRST 1 ROW ONLY
                    ) T13 ON 1=1
		          LEFT OUTER JOIN LATERAL(
		                                  SELECT CST_NO
		                                       , BND_VST_RS_CD
		                                       , VST_DT
		                                    FROM TB_CBBO_BND_CNSL_VST_IZ T15 /* 채권상담방문내역 */
		                                   WHERE 1=1
		                                     AND DTA_DL_YN = 'N'
		                                     AND T1.CST_NO = T15.CST_NO
		                                     ORDER BY VST_DT DESC FETCH FIRST 1 ROW ONLY
		            ) T15
		           ON 1=1
		         LEFT JOIN LATERAL(
											SELECT
                                                 CASE WHEN TT2.DP_TP_CD = '0102' THEN MPY_BSDT
                                                      WHEN TT2.DP_TP_CD = '0203' THEN MPY_BSDT||'카'
                                                      WHEN TT2.DP_TP_CD = '0401' THEN '지로'
                                                      ELSE '기타'
                                                  END FNT_MTHD
                                               , TT1.DTL_CNTR_NO AS CNTR_NO
                                               , TT1.DTL_CNTR_SN AS CNTR_SN
                                               , TT2.CST_NO
                                               , TT2.MPY_BSDT
                                               , TT2.DP_TP_CD
                                            FROM TB_SSCT_CNTR_STLM_REL TT1
                                            INNER JOIN TB_SSCT_CNTR_STLM_BAS TT2 ON TT2.CNTR_STLM_ID = TT1.CNTR_STLM_ID AND TT2.CNTR_NO = TT1.DTL_CNTR_NO AND TT2.DTA_DL_YN = 'N'
                                            WHERE 1=1
                                            AND TT1.DTL_CNTR_NO = T1.CNTR_NO
                                            AND TT1.DTL_CNTR_SN = T1.CNTR_SN
                                            AND TT1.DTA_DL_YN = 'N'
                                            ORDER BY VL_END_DTM DESC, CNTR_STLM_REL_ID DESC FETCH FIRST 1 ROW ONLY
				    ) T16 ON 1=1
		         INNER JOIN TB_SSCT_CNTR_BAS T17 /* 계약기본 */
		            ON T1.CNTR_NO = T17.CNTR_NO
		          LEFT OUTER JOIN TB_SSCT_CNTR_DTL T18 /* 계약상세 */
		            ON T1.CNTR_NO = T18.CNTR_NO
		           AND T1.CNTR_SN = T18.CNTR_SN
		          LEFT OUTER JOIN (
			                       SELECT NVL2(C2.PD_CLSF_NM, C2.PD_CLSF_NM, '')
			                              || NVL2(C3.PD_CLSF_NM, '>' || C3.PD_CLSF_NM, '')
			                              || NVL2(C4.PD_CLSF_NM, '>' || C4.PD_CLSF_NM, '') AS PD_CLSF_NM  /* 상품분류 */
			                            , PB.PD_CD                                  /* 상품코드 */
			                            , PB.PD_NM                                   /* 상품명 */
			                         FROM TB_PDBS_PD_BAS PB
			                         LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS C1          /* 분류 대 */
			                           ON PB.PD_HCLSF_ID  = C1.PD_CLSF_ID
			                         LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C2         /* 분류 중 */
			                           ON PB.PD_MCLSF_ID  = C2.PD_CLSF_ID
			                         LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C3         /* 분류 소 */
			                           ON PB.PD_LCLSF_ID  = C3.PD_CLSF_ID
			                         LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C4         /* 분류 세 */
			                           ON PB.PD_DCLSF_ID  = C4.PD_CLSF_ID
			                        WHERE PB.DTA_DL_YN = 'N'
			                      ) T19
		            ON T19.PD_CD = T18.BASE_PD_CD
		     ) T1
		 WHERE 1=1
           AND CLCTAM_PRTNR_NO = #{schClctamNo}
         <if test='@MybatisUtils@isNotEmpty(schCstNo)'>
           AND CST_NO = #{schCstNo}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schDlqMcntStrt) and @MybatisUtils@isNotEmpty(schDlqMcntEnd)'>
           AND DLQ_MCNT BETWEEN #{schDlqMcntStrt} AND #{schDlqMcntEnd}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schIstLocaraTno) and @MybatisUtils@isNotEmpty(schIstExnoEncr) and @MybatisUtils@isNotEmpty(schIstIdvTno)'>
           AND IST_LOCARA_TNO = #{schIstLocaraTno}
           AND IST_EXNO_ENCR = #{schIstExnoEncr}
           AND IST_IDV_TNO = #{schIstIdvTno}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schCntrDtlNo)'>
           AND CNTR_NO||'-'||CNTR_SN = #{schCntrDtlNo}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schBizDv)'>
           AND BIZ_DV = #{schBizDv}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schIstCralLocaraTno) and @MybatisUtils@isNotEmpty(schIstMexnoEncr) and @MybatisUtils@isNotEmpty(schIstCralIdvTno)'>
           AND IST_CRAL_LOCARA_TNO = #{schIstCralLocaraTno}
           AND IST_MEXNO_ENCR = #{schIstMexnoEncr}
           AND IST_CRAL_IDV_TNO = #{schIstCralIdvTno}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schCntrLocaraTno) and @MybatisUtils@isNotEmpty(schCntrExnoEncr) and @MybatisUtils@isNotEmpty(schCntrIdvTno)'>
           AND CNTR_LOCARA_TNO = #{schCntrLocaraTno}
           AND CNTR_EXNO_ENCR = #{schCntrExnoEncr}
           AND CNTR_IDV_TNO = #{schCntrIdvTno}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schSfK)'>
           AND SFK = #{schSfK}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schCstDv)'>
           <if test="schCstDv == '01'">
            AND CNTR_TP_CD = 1
           </if>
           <if test="schCstDv == '02'">
            AND CNTR_TP_CD = 2
           </if>
         </if>
         <if test='@MybatisUtils@isNotEmpty(schOjBlamStrt) and @MybatisUtils@isNotEmpty(schOjBlamEnd)'>
           AND OJ_BLAM BETWEEN #{schOjBlamStrt} AND #{schOjBlamEnd}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schCntrCralLocaraTno) and @MybatisUtils@isNotEmpty(schCntrMexnoEncr) and @MybatisUtils@isNotEmpty(schCntrCralIdvTno)'>
           AND CNTR_CRAL_LOCARA_TNO = #{schCntrCralLocaraTno}
           AND CNTR_MEXNO_ENCR = #{schCntrMexnoEncr}
           AND CNTR_CRAL_IDV_TNO = #{schCntrCralIdvTno}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schTfDtStrt) and @MybatisUtils@isNotEmpty(schTfDtEnd)'>
           AND TF_DT BETWEEN #{schTfDtStrt} AND #{schTfDtEnd}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schFntDv)'>
            <if test="schFntDv == '9999'">
             AND BIL_TP_CD IS NULL
           </if>
           <if test="schFntDv != '9999'">
             AND BIL_TP_CD = #{schFntDv}
           </if>
         </if>
         <if test='@MybatisUtils@isNotEmpty(schFntDtStrt) and @MybatisUtils@isNotEmpty(schFntDtEnd)'>
           AND BIL_DT BETWEEN #{schFntDtStrt} AND #{schFntDtEnd}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schBilDv)'>
           AND BIL_TP_CD = #{schBilDv}
         </if>
         <if test='@MybatisUtils@isNotEmpty(schCstThmDp)'>
           <if test="schCstThmDp == '02'">
             AND MM_CHRAM_DP <![CDATA[<>]]> 0
           </if>
         </if>
         <if test='@MybatisUtils@isNotEmpty(schDv1)'>
           AND DLQ_BLAM <![CDATA[<>]]> 0 /*연체잔액0원제외*/
         </if>
         <if test='@MybatisUtils@isNotEmpty(schDv2)'>
           AND TOT_DP_AMT <![CDATA[<>]]> 0 /*입금액0원제외*/
         </if>
         <if test='@MybatisUtils@isNotEmpty(schDv3)'>
           AND OJ_BLAM <![CDATA[<>]]> 0 /*대상잔액0원제외*/
         </if>
         <if test='@MybatisUtils@isNotEmpty(schDv4)'>
           AND DLQ_MCNT <![CDATA[<>]]> 0 /*연체개월0개월제외*/
         </if>
    </select>
</mapper>
