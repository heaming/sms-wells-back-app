<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.bond.consultation.mapper.WbncServiceMapper">
    <select id="selectServices" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncServiceDto$FindRes">
        SELECT T1.CST_SV_ASN_NO
             , T1.CST_SV_EXCN_SN
             , T1.CNTR_NO
             , T1.CNTR_SN
             , T1.CNTR_NO || '-' || T1.CNTR_SN AS CNTR_NO_SN
             , T2.SEP_IST_CS_DTL_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SEP_IST_CS_DTL_CD', T2.SEP_IST_CS_DTL_CD) AS SEP_IST_CS_DTL_NM
             , T1.SV_BIZ_DCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_DCLSF_CD', T1.SV_BIZ_DCLSF_CD) AS SV_BIZ_DCLSF_NM
             , T1.SV_BIZ_HCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_HCLSF_CD', T1.SV_BIZ_HCLSF_CD) AS SV_BIZ_HCLSF_NM
             , T1.VST_FSH_DT
             , T1.AS_CAUS_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'AS_CAUS_CD', T1.AS_CAUS_CD) AS AS_CAUS_NM
             , T1.SV_PROCS_CN
             , NVL(T2.BIL_OJ_AMT, 0) AS BIL_OJ_AMT
             , NVL(T3.DP_SUM_AMT, 0) AS DP_SUM_AMT
             , NVL(T2.BIL_OJ_AMT, 0) - NVL(T3.DP_SUM_AMT, 0) AS BLAM
          FROM TB_SVPD_CST_SV_WK_RS_IZ T1
          LEFT OUTER JOIN TB_SVPD_SV_CS_BIL_DTL T2
            ON T2.CNTR_NO = T1.CNTR_NO
           AND T2.CNTR_SN = T1.CNTR_SN
           AND T2.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T2.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SVPD_SV_CS_DP_IZ T3
            ON T3.CNTR_NO = T1.CNTR_NO
           AND T3.CNTR_SN = T1.CNTR_SN
           AND T3.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T3.DTA_DL_YN = 'N'
         WHERE 1=1
           AND T1.CNTR_NO = #{cntrNo}
           AND T1.CNTR_SN = #{cntrSn}
           AND T1.DTA_DL_YN = 'N'
    </select>
</mapper>
