<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.bond.consultation.mapper.WbncCustomerMapper">
    <select id="selectBaseYm" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindBaseYmRes">
        SELECT BASE_YM /*기준년월*/
          FROM ( SELECT BASE_YM
                   FROM TB_CBBO_BND_CNSL_BAS_IZ
                  WHERE 1=1
                  ORDER BY BASE_YM DESC
               )
         WHERE ROWNUM = 1
    </select>

    <select id="selectCustomers" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$SearchRes">
        SELECT *
          FROM (
		        SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO ORDER BY CST_NO,CNTR_NO,CNTR_SN) AS RN --고객당 계약 한건 조회하기 위한 ROW_NUMBER 함수
		             , CTT /* 컨택 */
		             , BIL_DT /* 이체일자 */
		             , DP_TP_CD /* 입금유형코드*/
		             , FNT /* 이체 */
		             , CST_NO /* 고객번호 */
		             , CST_NM /* 고객명 */
		             , DLQ_MCNT   /* 연체개월 */
		             , MAX(FNL_CNSL_D) OVER(PARTITION BY CST_NO) AS FNL_CNSL_D /* 최종상담일 */
		             , SUM(OJ_AMT) OVER(PARTITION BY CST_NO) AS OJ_AMT /* 대상금액 */
		             , SUM(OJ_DP) OVER(PARTITION BY CST_NO) AS OJ_DP /* 대상입금 */
		             , SUM(OJ_BLAM) OVER(PARTITION BY CST_NO) AS OJ_BLAM /* 대상금액 - 대상입금 = 대상잔액 */
		             , SUM(TOT_DLQ_AMT) OVER(PARTITION BY CST_NO) AS TOT_DLQ_AMT /* 연체금액 + 연체가산금 = 총연체금 */
		             , SUM(TOT_DLQ_DP) OVER(PARTITION BY CST_NO) AS TOT_DLQ_DP /* 연체입금금액 + 연체가산금입금금액 = 총연체입금 */
		             , SUM(TOT_DLQ_BLAM) OVER(PARTITION BY CST_NO) AS TOT_DLQ_BLAM /* 총연체금 - 총연체입금 = 총연체잔액 */
		             , SUM(DLQ_AMT) OVER(PARTITION BY CST_NO) AS DLQ_AMT /* 연체금액 */
		             , SUM(DLQ_DP) OVER(PARTITION BY CST_NO) AS DLQ_DP /* 연체입금 */
		             , SUM(DLQ_BLAM) OVER(PARTITION BY CST_NO) AS DLQ_BLAM /* 연체금액 - 연체입금 = 연체잔액 */
		             , SUM(MM_CHRAM_AMT) OVER(PARTITION BY CST_NO) AS MM_CHRAM_AMT /* 월요금액 */
		             , SUM(MM_CHRAM_DP) OVER(PARTITION BY CST_NO) AS MM_CHRAM_DP /* 월요금입금 */
		             , SUM(MM_CHRAM_BLAM) OVER(PARTITION BY CST_NO) AS MM_CHRAM_BLAM /* 당월요금금액 - 당월요금입금금액 = 월요금잔액 */
		             , SUM(DLQ_ADD_AMT) OVER(PARTITION BY CST_NO) AS DLQ_ADD_AMT /* 연체가산금액 */
		             , SUM(DLQ_ADD_DP) OVER(PARTITION BY CST_NO) AS DLQ_ADD_DP /* 연체가산입금 */
		             , SUM(DLQ_ADAMT_BLAM) OVER(PARTITION BY CST_NO) AS DLQ_ADAMT_BLAM /* 연체가산금액 - 연체가산금입금금액 = 연체가산금잔액 */
		             , SUM(UC_AMT) OVER(PARTITION BY CST_NO) AS UC_AMT /* 미수금액 */
		             , SUM(RSG_BOR_DP_AMT) OVER(PARTITION BY CST_NO) AS RSG_BOR_DP_AMT /* 해지위약입금금액 */
		             , SUM(UC_DP) OVER(PARTITION BY CST_NO) AS UC_DP /* 미수입금 */
		             , SUM(UC_BLAM) OVER(PARTITION BY CST_NO) AS UC_BLAM /* 미수금 - 총입금액 = 미수잔액 */
		             , SUM(TOT_DP_AMT) OVER(PARTITION BY CST_NO) AS TOT_DP_AMT /* 연체입금금액 + 연체가산입금금액 + 해지위약금입금금액 + 당월요금입금금액 = 총입금액 */
		             , SUM(SPMT_SL) OVER(PARTITION BY CST_NO) AS SPMT_SL /* 추가매출 */
		             , SUM(CCAM) OVER(PARTITION BY CST_NO) AS CCAM/* 위약금 */
		             , SUM(LSFE) OVER(PARTITION BY CST_NO) AS LSFE /* 분실료 */
		             , SUM(RTLFE1) OVER(PARTITION BY CST_NO) AS RTLFE1 /* 렌탈료1 */
		             , SUM(RTLFE_ISTM1) OVER(PARTITION BY CST_NO) AS RTLFE_ISTM1 /* 렌탈료1할 */
		             , SUM(RTLFE2) OVER(PARTITION BY CST_NO) AS RTLFE2 /* 렌탈료2 */
		             , SUM(RTLFE_ISTM2) OVER(PARTITION BY CST_NO) AS RTLFE_ISTM2 /* 렌탈료2할 */
		             , CLCTAM_PRTNR_NO /* 집금번호 */
		             , CLCTAM_ICHR   /* 집급담당 */
		             , CRAL_LOCARA_TNO /* 계약휴대전화번호1 */
		             , MEXNO_ENCR /* 계약휴대전화번호2 */
		             , CRAL_IDV_TNO  /* 계약휴대전화번호3 */
		             , IST_CRAL_LOCARA_TNO /* 설치휴대전화번호1 */
		             , IST_MEXNO_ENCR /* 설치휴대전화번호2 */
		             , IST_CRAL_IDV_TNO /* 설치휴대전화번호3 */
		             , VT_AC_BNK /* 가상계좌은행 */
		             , VT_AC_NO /* 가상계좌번호 */
		             , SFK /* 세이프키*/
		             , CLN_PSBL /* 회수가능성*/
		             , CLN_PRCS /* 회수절차*/
		             , CST_STAT /* 고객상태*/
		             , CVCP_INF /* 민원정보*/
		             , UNUSL_ARTC /* 특이사항*/
		             , CNTR_TP_CD /* 고객구분*/
		             , CNTR_NO /* 계약번호 */
		             , CNTR_SN /* 계약일련번호 */
		          FROM (
		                SELECT
		                       CASE WHEN T1.BND_ASN_DT > T2.FST_RGST_DTM AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 1 THEN '○'
		                            WHEN T1.BND_ASN_DT > T2.FST_RGST_DTM AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 2 THEN '△'
		                            ELSE 'Ｘ'
		                        END AS CTT /* 컨택 */
		                     , T3.MPY_BSDT AS BIL_DT /* 이체일자 */
		                     , T3.DP_TP_CD /* 입금유형코드*/
		                     , T3.FNT_MTHD AS FNT /* 이체 */
		                     , T1.CST_NO AS CST_NO /* 고객번호 */
		                     , T4.CST_KNM AS CST_NM /* 고객명 */
		                     , T5.DLQ_MCN AS DLQ_MCNT   /* 연체개월 */
		                     , SUBSTR(T1.FST_RGST_DTM,0,8) AS FNL_CNSL_D /* 최종상담일 */
		                     , (NVL(T5.DLQ_AMT, 0) + NVL(T5.DLQ_ADD_AMT, 0)) + NVL(T5.THM_CHRAM_AMT, 0) AS OJ_AMT /* 대상금액 */
		                     , (NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0)) + NVL(T5.THM_CHRAM_DP_AMT, 0) AS OJ_DP /* 대상입금 */
		                     , ((NVL(T5.DLQ_AMT, 0) + NVL(T5.DLQ_ADD_AMT, 0)) + NVL(T5.THM_CHRAM_AMT, 0)) - ((NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0)) + NVL(T5.THM_CHRAM_DP_AMT, 0)) AS OJ_BLAM /* 대상금액 - 대상입금 = 대상잔액 */
		                     , NVL(T5.DLQ_AMT, 0) + NVL(T5.DLQ_ADD_AMT, 0) AS TOT_DLQ_AMT /* 연체금액 + 연체가산금 = 총연체금 */
		                     , NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0) AS TOT_DLQ_DP /* 연체입금금액 + 연체가산금입금금액 = 총연체입금 */
		                     , (NVL(T5.DLQ_AMT, 0) + NVL(T5.DLQ_ADD_AMT, 0)) - (NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0)) AS TOT_DLQ_BLAM /* 총연체금 - 총연체입금 = 총연체잔액 */
		                     , NVL(T5.DLQ_AMT, 0) AS DLQ_AMT /* 연체금액 */
		                     , NVL(T5.DLQ_DP_AMT, 0) AS DLQ_DP /* 연체입금 */
		                     , NVL(T5.DLQ_AMT, 0) - NVL(T5.DLQ_DP_AMT, 0) AS DLQ_BLAM /* 연체금액 - 연체입금 = 연체잔액 */
		                     , NVL(T5.THM_CHRAM_AMT, 0) AS MM_CHRAM_AMT /* 월요금액 */
		                     , NVL(T5.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_DP /* 월요금입금 */
		                     , NVL(T5.THM_CHRAM_AMT, 0) - NVL(T5.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_BLAM /* 당월요금금액 - 당월요금입금금액 = 월요금잔액 */
		                     , NVL(T5.DLQ_ADD_AMT, 0) AS DLQ_ADD_AMT /* 연체가산금액 */
		                     , NVL(T5.DLQ_ADD_DP_AMT, 0) AS DLQ_ADD_DP /* 연체가산입금 */
		                     , NVL(T5.DLQ_ADD_AMT, 0) - NVL(T5.DLQ_ADD_DP_AMT, 0) AS DLQ_ADAMT_BLAM /* 연체가산금액 - 연체가산금입금금액 = 연체가산금잔액 */
		                     , NVL(T5.UC_AMT, 0) AS UC_AMT /* 미수금액 */
		                     , NVL(T5.RSG_BOR_DP_AMT, 0) AS RSG_BOR_DP_AMT /* 해지위약입금금액 */
		                     , NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0) + NVL(T5.RSG_BOR_DP_AMT, 0) + NVL(T5.THM_CHRAM_DP_AMT, 0) AS UC_DP /* 미수입금 */
		                     , NVL(T5.UC_AMT, 0) - (NVL(T5.DLQ_DP_AMT, 0) + NVL(T5.DLQ_ADD_DP_AMT, 0) + NVL(T5.RSG_BOR_DP_AMT, 0) + NVL(T5.THM_CHRAM_DP_AMT, 0)) AS UC_BLAM /* 미수금 - 총입금액 = 미수잔액 */
		                     , ( SELECT NVL(SUM(TT1.RVE_AMT), 0)
		                           FROM TB_RVDW_RVE_DTL TT1
		                          WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND SUBSTR(TT1.RVE_DT,0,6) = T1.BASE_YM AND TT1.DP_DV_CD IN ('1', '3')
		                       ) AS TOT_DP_AMT /* 총입금액 */
		                     , NVL(T6.SPMT_SL_AMT, 0) AS SPMT_SL /* 추가매출 */
		                     , NVL(T7.BOR_AMT, 0) AS CCAM /* 위약금 */
		                     , (SELECT NVL(TT1.LS_RNTF, 0) FROM TB_CBCL_WELLS_BOR_AMT_BAS TT1 WHERE TT1.PERF_YM = SUBSTR(T7.CCAM_CMPT_RQDT,0,6) AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N') AS LSFE/* 분실료 */
		                     , NVL(T8.RENTAL_AMT, 0) AS RTLFE1 /* 렌탈료1 */
		                     , NVL(T8.RENTAL_DSC_AMT, 0) AS RTLFE_ISTM1 /* 렌탈료1할 */
		                     , NVL(T8.RENTAL_AMT2, 0) AS RTLFE2 /* 렌탈료2 */
		                     , NVL(T8.RENTAL_DSC_AMT2, 0) AS RTLFE_ISTM2 /* 렌탈료2할 */
		                     , T1.CLCTAM_PRTNR_NO /* 집금번호 */
		                     , (SELECT DISTINCT PRTNR_KNM FROM TB_CBBO_CLCTAM_PRTNR_DTL WHERE PRTNR_NO = T1.CLCTAM_PRTNR_NO) AS CLCTAM_ICHR   /* 집급담당 */
		                     , T4.CRAL_LOCARA_TNO /* 계약휴대전화번호1 */
		                     , T4.MEXNO_ENCR /* 계약휴대전화번호2 */
		                     , T4.CRAL_IDV_TNO  /* 계약휴대전화번호3 */
		                     , T9.CRAL_LOCARA_TNO AS IST_CRAL_LOCARA_TNO /* 설치휴대전화번호1 */
		                     , T9.MEXNO_ENCR AS IST_MEXNO_ENCR /* 설치휴대전화번호2 */
		                     , T9.CRAL_IDV_TNO AS IST_CRAL_IDV_TNO /* 설치휴대전화번호3 */
		                     , T10.VT_AC_BNK  /* 가상계좌은행 */
		                     , T10.VT_AC_NO /* 가상계좌번호 */
		                     , T4.SFK_VAL AS SFK /* 세이프키*/
		                     , T11.BND_CLN_PSBL_DV_CD AS CLN_PSBL /* 회수가능성*/
		                     , T11.BND_CLN_PRCS_DV_CD AS CLN_PRCS /* 회수절차*/
		                     , T11.BND_CNSL_CST_STAT_CD AS CST_STAT /* 고객상태*/
		                     , T12.CVCP_CN AS CVCP_INF /* 민원정보*/
		                     , T12.CNSL_UNUITM_CN AS UNUSL_ARTC /* 특이사항*/
		                     , T13.COPN_DV_CD AS CNTR_TP_CD /* 고객구분*/
		                     , T1.CNTR_NO /* 계약번호 */
		                     , T1.CNTR_SN /* 계약일련번호 */
		                  FROM TB_CBBO_BND_CNSL_BAS_IZ T1 /* 채권상담기본내역 */
		                  LEFT OUTER JOIN (
		                                   SELECT CST_NO
		                                        , BND_CLN_PSBL_DV_CD
		                                        , BND_CLN_PRCS_DV_CD
		                                        , BND_CNSL_CST_STAT_CD
		                                        , TEL_CNSL_RS_CD
		                                        , FST_RGST_DTM
		                                     FROM TB_CBBO_BND_TEL_CNSL_IZ /* 채권전화상담내역 */
		                                    WHERE ROWNUM = 1 ORDER BY FST_RGST_DTM DESC
		                     ) T2
		                    ON T1.CST_NO = T2.CST_NO
		                  LEFT OUTER JOIN (
                                           SELECT
                                                  CASE WHEN DP_TP_CD = '0102' THEN MPY_BSDT
                                                       WHEN DP_TP_CD = '0203' THEN MPY_BSDT||'카'
                                                      WHEN MPY_BSDT = '0401' THEN '지로'
                                                      ELSE '기타'
                                                  END FNT_MTHD
                                                , CNTR_NO
                                                , CST_NO
                                                , DP_TP_CD
                                                , MPY_BSDT
                                             FROM TB_SSCT_CNTR_STLM_BAS TT1
                                             WHERE 1=1
                                               AND TT1.FNL_MDFC_DTM = (SELECT MAX(FNL_MDFC_DTM) FROM TB_SSCT_CNTR_STLM_BAS TT2 WHERE TT2.CNTR_NO = TT1.CNTR_NO)
                             ) T3
                            ON T1.CNTR_NO = T3.CNTR_NO
                           AND T1.CST_NO = T3.CST_NO
		                  LEFT OUTER JOIN TB_CUBS_CST_BAS T4 /* 고객기본 */
		                    ON T1.CST_NO = T4.CST_NO
		                  LEFT OUTER JOIN TB_CBBO_BND_CNTR_BAS T5 /* 채권계약기본 */
		                    ON T1.CNTR_NO = T5.CNTR_NO
		                   AND T1.CNTR_SN = T5.CNTR_SN
		                   AND T1.BASE_YM = T5.BASE_YM
		                  LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T6 /* WELLS매출월마감내역 */
		                    ON T6.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		                   AND T6.CNTR_NO = T1.CNTR_NO
		                   AND T6.CNTR_SN = T1.CNTR_SN
		                  LEFT OUTER JOIN TB_CBCL_WELLS_BOR_AMT_BAS T7 /* WELLS위약금액기본 */
		                    ON T7.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		                   AND T7.CNTR_NO = T1.CNTR_NO
		                   AND T7.CNTR_SN = T1.CNTR_SN
		                   AND T7.DTA_DL_YN = 'N'
		                  LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T8 /* WELLS매출월마감내역 */
		                    ON T8.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		                   AND T8.CNTR_NO = T1.CNTR_NO
		                   AND T8.CNTR_SN = T1.CNTR_SN
		                  LEFT OUTER JOIN (
		                                    SELECT CR.CNTR_ADRPC_ID
		                                         , CR.DTL_CNTR_NO
		                                         , CR.DTL_CNTR_SN
		                                         , CB.LOCARA_TNO
		                                         , CB.EXNO_ENCR
		                                         , CB.IDV_TNO
		                                         , CB.CRAL_LOCARA_TNO
		                                         , CB.MEXNO_ENCR
		                                         , CB.CRAL_IDV_TNO
		                                         , NVL(AB.NEW_ADR_ZIP, AB.OLD_ADR_ZIP) AS SPP_ZIP
		                                         , NVL(AB.RNADR, AB.LTN_ADR) AS SPP_ADR
		                                         , NVL(AB.RDADR, AB.LTN_DTL_ADR) AS SPP_DTL_ADR
		                                      FROM TB_SSCT_CNTR_ADR_REL CR /* 계약주소관계 */
		                                      LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS CB /* 계약주소지기본 */
		                                        ON CB.CNTR_ADRPC_ID = CR.CNTR_ADRPC_ID
		                                      LEFT OUTER JOIN TB_GBCO_ADR_BAS AB /* 주소기본 */
		                                        ON AB.ADR_ID = CB.ADR_ID
		                                     WHERE CR.CNTR_UNIT_TP_CD = '020'
		                                       AND CR.ADRPC_TP_CD = '3'  /* 설치주소 */
		                                       AND CR.DTA_DL_YN = 'N'
		                                  ) T9
		                    ON T1.CNTR_NO = T9.DTL_CNTR_NO
		                   AND T1.CNTR_SN = T9.DTL_CNTR_SN
		                  LEFT JOIN (
					                 SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO, CNTR_NO, CNTR_SN ORDER BY VAC_IS_DTL_SN DESC) AS RN
					                      , CST_NO
					                      , CNTR_NO
                                          , CNTR_SN
					                      , TT2.VAC_VNCO_DV_CD
					                      , (SELECT TT3.FNIT_NM FROM TB_RVDW_FNIT_CD TT3 WHERE FNIT_DV_CD = '1' AND TT3.FNIT_CD = TT2.VAC_BNK_CD) AS VT_AC_BNK
					                      , TT2.VAC_NO AS VT_AC_NO
					                   FROM TB_RVDW_VAC_IS_DTL TT1
					                  INNER JOIN TB_RVDW_VAC_BAS TT2
                                         ON TT2.VAC_IS_ID = TT1.VAC_IS_ID
                                        AND TT2.VAC_IS_DV_CD = '5'/*가상계좌발급구분코드 = 연체집금용*/
                                        AND TT2.VAC_STAT_CD = '1'/*가상계좌상태코드 = 할당*/
					                ) T10
					        ON T10.RN = 1
                           AND T10.CST_NO = T1.CST_NO
                           AND T10.CNTR_NO = T1.CNTR_NO
                           AND T10.CNTR_SN = T1.CNTR_SN
		                  LEFT OUTER JOIN
		                                 (
		                                   SELECT CST_NO
		                                        , BND_CLN_PSBL_DV_CD
		                                        , BND_CLN_PRCS_DV_CD
		                                        , BND_CNSL_CST_STAT_CD
		                                        , TEL_CNSL_RS_CD
		                                        , FST_RGST_DTM
		                                     FROM TB_CBBO_BND_TEL_CNSL_IZ /* 채권전화상담내역 */
		                                    WHERE ROWNUM = 1 ORDER BY FST_RGST_DTM DESC
		                     ) T11
		                    ON T1.CST_NO = T11.CST_NO
		                  LEFT OUTER JOIN (
		                                     SELECT MAX(FNL_MDFC_DTM) AS FNL_MDFC_DTM
		                                          , CLCTN_OJ_OG_TP_CD
		                                          , CLCTN_OJ_PRTNR_NO
		                                          , MAX(CNSL_UNUITM_CN) AS CNSL_UNUITM_CN
		                                          , MAX(CVCP_CN) AS CVCP_CN
		                                       FROM TB_CBBO_BND_UNUITM_CVCP_DTL
		                                      WHERE BND_CNTR_TP_CD = '02'
		                                        AND DTA_DL_YN = 'N'
		                                      GROUP BY CLCTN_OJ_OG_TP_CD, CLCTN_OJ_PRTNR_NO
		                                    ) T12
		                    ON T12.CLCTN_OJ_OG_TP_CD = T1.CLCTN_OJ_OG_TP_CD
		                   AND T12.CLCTN_OJ_PRTNR_NO = T1.CLCTN_OJ_PRTNR_NO
		                 INNER JOIN TB_SSCT_CNTR_BAS T13 /* 계약기본 */
		                    ON T1.CNTR_NO = T13.CNTR_NO
		                 WHERE 1=1
		                   AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM TB_CBBO_BND_CNSL_BAS_IZ)
		             )
		         WHERE 1=1
		           AND CLCTAM_PRTNR_NO = #{schClctamNo}
		         <if test='@MybatisUtils@isNotEmpty(schCstNo)'>
		           AND CST_NO = #{schCstNo}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schCstNm)'>
		           AND CST_NM = #{schCstNm}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schCralLocaraTno) and @MybatisUtils@isNotEmpty(schMexnoEncr) and @MybatisUtils@isNotEmpty(schCralIdvTno)'>
		           AND CRAL_LOCARA_TNO = #{schCralLocaraTno}
		           AND MEXNO_ENCR = #{schMexnoEncr}
		           AND CRAL_IDV_TNO = #{schCralIdvTno}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schSfK)'>
		           AND SFK = #{schSfK}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schIstCralLocaraTno) and @MybatisUtils@isNotEmpty(schIstMexnoEncr) and @MybatisUtils@isNotEmpty(schIstCralIdvTno)'>
		           AND IST_CRAL_LOCARA_TNO = #{schIstCralLocaraTno}
		           AND IST_MEXNO_ENCR = #{schIstMexnoEncr}
		           AND IST_CRAL_IDV_TNO = #{schIstCralIdvTno}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schDlqMcntStrt) and @MybatisUtils@isNotEmpty(schDlqMcntEnd)'>
		           AND DLQ_MCNT BETWEEN #{schDlqMcntStrt} AND #{schDlqMcntEnd}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schFntDv)'>
		            <if test="schFntDv == '9999'">
		             AND DP_TP_CD IS NULL
		           </if>
		           <if test="schFntDv != '9999'">
		             AND DP_TP_CD = #{schFntDv}
		           </if>
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schFntDtStrt) and @MybatisUtils@isNotEmpty(schFntDtEnd)'>
		           AND BIL_DT BETWEEN #{schFntDtStrt} AND #{schFntDtEnd}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schOjBlamStrt) and @MybatisUtils@isNotEmpty(schOjBlamEnd)'>
		           AND OJ_BLAM BETWEEN #{schOjBlamStrt} AND #{schOjBlamEnd}
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schCstDv)'>
		           <if test="schCstDv == '01'">
		            AND CNTR_TP_CD = 1
		           </if>
		           <if test="schCstDv == '02'">
		            AND CNTR_TP_CD = 2
		           </if>
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schDv1)'>
		           AND (DLQ_AMT - DLQ_DP) <![CDATA[<>]]> 0 /*연체잔액0원제외*/
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schDv2)'>
		           AND (DLQ_DP + DLQ_ADD_DP + RSG_BOR_DP_AMT + MM_CHRAM_DP) > 0 /*총입금액0원제외*/
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schDv3)'>
		           AND ((DLQ_AMT + DLQ_ADD_AMT + MM_CHRAM_AMT) - (DLQ_DP + DLQ_ADD_DP + MM_CHRAM_DP)) <![CDATA[<>]]> 0 /*대상잔액0원제외*/
		         </if>
		         <if test='@MybatisUtils@isNotEmpty(schDv4)'>
		           AND DLQ_MCNT <![CDATA[<>]]> 0 /*연체개월0개월제외*/
		         </if>
             ) WHERE RN = 1
    </select>

    <select id="selectCustomerDetail" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindRes">
        SELECT T1.CNTR_NO AS CNTR_NO /* 계약번호 */
		     , T1.CNTR_SN AS CNTR_SN /* 계약일련번호 */
		     , T1.CNTR_NO ||'-'||T1.CNTR_SN AS CNTR_DTL_NO /* 상세계약번호 */
		     , T2.CST_KNM AS CST_NM /* 고객명 */
		     , T2.SEX_DV_CD /* 성별코드 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'SEX_DV_CD', T2.SEX_DV_CD) AS SEX_DV_NM /* 성별 */
		     , T2.BRYY_MMDD /* 생년월일 */
		     , T2.COPN_DV_CD  /* 회사코드 */
		     , T2.CRAL_LOCARA_TNO AS CNTR_CRAL_LOCARA_TNO  /* 계약처휴대지역전화번호 */
		     , T2.MEXNO_ENCR  AS CNTR_MEXNO_ENCR           /* 계약처휴대전화국번호암호화 */
		     , T2.CRAL_IDV_TNO  AS CNTR_CRAL_IDV_TNO       /* 계약처휴대전화번호3 */
		     , T1.CST_NO AS CST_NO /* 고객번호 */
		     , T2.SFK_VAL AS SFK /* 세이프키 */
		     , T3.BU_NOTI_TP_CD AS BU_NOTI_TP_CD /* 부담유형 */
		     , T4.RCGVP_KNM AS RCGVP_KNM /* 설치자명 */
		     , T4.LOCARA_TNO AS IST_LOCARA_TNO /* 설치처지역전화번호 */
		     , T4.EXNO_ENCR AS IST_EXNO_ENCR /* 설치처전화국번호암호화 */
		     , T4.IDV_TNO AS IST_IDV_TNO /* 설치처개별전화번호 */
		     , T4.CRAL_LOCARA_TNO AS IST_CRAL_LOCARA_TNO /* 설치처휴대지역전화번호 */
		     , T4.MEXNO_ENCR AS IST_MEXNO_ENCR /* 설치처휴대전화국번호암호화 */
		     , T4.CRAL_IDV_TNO AS IST_CRAL_IDV_TNO /* 설치처휴대개별전화번호 */
		     , T5.SPP_ZIP AS CNTR_SPP_ZIP/* 계약처우편번호 */
		     , T5.SPP_ADR AS CNTR_SPP_ADR/* 계약처기본주소 */
		     , T5.SPP_DTL_ADR AS CNTR_SPP_DTL_ADR /* 계약처상세주소 */
		     , T4.SPP_ZIP AS IST_SPP_ZIP /* 설치처우편번호 */
		     , T4.SPP_ADR AS IST_SPP_ADR /* 설치처기본주소 */
		     , T4.SPP_DTL_ADR AS IST_SPP_DTL_ADR /* 설치처상세주소 */
		     , T6.PD_NM AS PD_NM /* 상품명 */
		     , T7.CNTR_DTL_STAT_CD /* 현재회원상태 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'CNTR_DTL_STAT_CD', T7.CNTR_DTL_STAT_CD) AS CNTR_DTL_STAT_NM /* 현재회원상태명 */
		     , (SELECT TO_CHAR(TO_DATE(CNTR_RCP_FSH_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD') FROM TB_SSCT_CNTR_BAS WHERE CNTR_NO = T1.CNTR_NO) AS RCP_DT /* 접수일 */
		     , TO_CHAR(TO_DATE(T9.IST_DT,'YYYYMMDD'),'YYYY-MM-DD') AS IST_DT /* 설치일 */
		     , TO_CHAR(TO_DATE(T7.CNTR_PD_ENDDT,'YYYYMMDD'),'YYYY-MM-DD') AS CAN_DT /* 취소일 */
		     , TO_CHAR(TO_DATE(T9.REQD_DT,'YYYYMMDD'),'YYYY-MM-DD') AS REQD_DT /* 철거일 */
		     , CASE WHEN T11.DP_TP_CD = '0102' THEN (SELECT FNIT_NM FROM TB_RVDW_FNIT_CD TT1 WHERE TT1.FNIT_DV_CD = '1' AND TT1.FNIT_CD = T11.BNK_CD) WHEN T11.DP_TP_CD = '0203' THEN (SELECT FNIT_NM FROM TB_RVDW_FNIT_CD TT1 WHERE TT1.FNIT_DV_CD = '2' AND TT1.FNIT_CD = T11.CDCO_CD) END BNK /* 은행명 */
		     , CASE WHEN T11.DP_TP_CD = '0102' THEN T11.ACNO_ENCR WHEN T11.DP_TP_CD = '0203' THEN T11.CRCDNO_ENCR END VT_AC /* 계좌번호 */
		     , T11.MPY_BSDT AS FNT_DT /* 이체일자 */
		     , T11.DP_TP_CD AS MPY_MTHD_TP_CD/* 입금유형코드 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'DP_TP_CD', T11.DP_TP_CD) AS MPY_MTHD_TP_NM /* 입금유형코드명 */
		     , T12.PRTNR_KNM AS PLAR /* 판매자 */
		     , T12.CRAL_LOCARA_TNO AS PLAR_CRAL_LOCARA_TNO
		     , T12.MEXNO_ENCR AS PLAR_MEXNO_ENCR
		     , T12.CRAL_IDV_TNO AS PLAR_CRAL_IDV_TNO /* 판매자 휴대전화번호 */
		     , TO_CHAR(TO_DATE(T8.CLTN_DT,'YYYYMMDD'),'YYYY-MM-DD') AS CLTN_DT /* 판매자 해약일 */
		     , T13.PRTNR_KNM AS DSMN /* 지국장 */
		     , T13.CRAL_LOCARA_TNO AS DSMN_CRAL_LOCARA_TNO
		     , T13.MEXNO_ENCR AS DSMN_MEXNO_ENCR
		     , T13.CRAL_IDV_TNO AS DSMN_CRAL_IDV_TNO /* 지국장 휴대전화번호 */
		     , T13.CLTN_DT AS DSMN_CLTN_DT /* 지국장 해약일 */
		     , T14.BLD_CD AS BLD_CD /* 소속빌딩코드 */
		     , T14.BLD_NM AS BLD_NM /* 소속빌딩명 */
		     , T14.LOCARA_TNO AS BLD_LOCARA_TNO
		     , T14.EXNO_ENCR AS BLD_MEXNO_ENCR
		     , T14.IDV_TNO AS BLD_IDV_TNO /* 판매처 전화번호 */
		     , '' AS ALNC_CD /* 제휴코드 */
		     , '' AS ALNC_NM /* 제휴명 */
		     , '' AS ALNC_STAT /* 제휴상태 */
		     , T15.VAC_NO AS VAC_NO /* 가상계좌번호 */
             , TO_CHAR(TO_DATE(T1.BND_ASN_DT,'YYYYMMDD'),'YYYY-MM-DD') AS TF_DT /* 이관일자 */
		     , T1.CLCTAM_PRTNR_NO AS PRTNR_NO /* 집금담당번호 */
		     , (SELECT PRTNR_KNM FROM TB_CBBO_CLCTAM_PRTNR_DTL WHERE PRTNR_NO = T1.CLCTAM_PRTNR_NO) AS PRTNR_NM /*집금담당명*/
		     , (SELECT TO_CHAR(TO_DATE(SUBSTR(TT1.DFLT_RGST_DTM, 0,8),'YYYYMMDD'),'YYYY-MM-DD') FROM TB_CBBO_DFLT_RGST_BAS TT1 WHERE TT1.DFLT_RLS_DTM IS NULL AND DTA_DL_YN = 'N' AND TT1.CST_NO = T1.CST_NO AND TT1.OC_DT = (SELECT MAX(TT2.OC_DT) FROM TB_CBBO_DFLT_RGST_BAS TT2 WHERE TT2.DFLT_RLS_DTM IS NULL AND TT2.DTA_DL_YN = 'N' AND TT2.CST_NO = TT1.CST_NO)) AS DFLT_DT /*채무불이행일자*/
             , CASE
		     	WHEN (SELECT COUNT(1) FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_CNFM_YN = 'Y') > 0 THEN (SELECT '최종확정('||SUBSTR(AUTH_RSG_CNFMDT,0,4)||'-'||SUBSTR(AUTH_RSG_CNFMDT,5,2)||')' FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_CNFM_YN = 'Y')
		     	WHEN (SELECT COUNT(1) FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_EXP_YN = 'Y') > 0 THEN (SELECT '예정확정('||SUBSTR(AUTH_RSG_DUEDT,0,4)||'-'||SUBSTR(AUTH_RSG_DUEDT,5,2)||')' FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_EXP_YN = 'Y')
		       END AS AUTH_RSG /* 직권해지 */
		     , T16.LWM_MO_CN /* 법조치 */
		     , ( CASE WHEN T7.CNTR_DTL_STAT_CD > '201' THEN 'Y' ELSE '' END) AS SL_STP /* 매출중지 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'BND_CLN_PSBL_DV_CD', T17.BND_CLN_PSBL_DV_CD) AS BND_CLN_PSBL_DV_CD /* 회수가능성 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'BND_CLN_PRCS_DV_CD', T17.BND_CLN_PRCS_DV_CD) AS BND_CLN_PRCS_DV_CD /* 회수절차 */
		     , NVL(T18.LWM_RCGN_AMT,0) + NVL(T18.LWM_DLVYFE,0) + NVL(T18.LWM_ENFORC_CS_AMT,0) + NVL(T18.LWM_PESU_PRCS_CS_AMT,0) AS LWSC_BIL_AMT /* 소송비 청구금액 */
		     , NVL(T18.LWM_DP_AMT,0) AS LWM_DP_AMT /* 소송비 입금액 */
		     , NVL(T18.LWM_RCGN_AMT,0) + NVL(T18.LWM_DLVYFE,0) + NVL(T18.LWM_ENFORC_CS_AMT,0) + NVL(T18.LWM_PESU_PRCS_CS_AMT,0) - NVL(T18.LWM_DP_AMT, 0) AS LWSC_BLAM /* 소송비 잔액 */
		     , (SELECT SUM(NVL(TT1.UC_AMT, 0)) FROM TB_CBBO_BND_CNTR_BAS TT1 WHERE TT1.CST_NO = T1.CST_NO AND TT1.BASE_YM = T1.BASE_YM) + NVL(T18.LWM_RCGN_AMT,0) + NVL(T18.LWM_DLVYFE,0) + NVL(T18.LWM_ENFORC_CS_AMT,0) + NVL(T18.LWM_PESU_PRCS_CS_AMT,0) - NVL(T18.LWM_DP_AMT, 0) AS UC_AMT /* 미수금합산 */
		     , (SELECT COUNT(1)
		          FROM TB_CBBO_BND_CNTC_EXCD_OJ_IZ TT1
		         WHERE TT1.CTNT_EXCD_BND_BIZ_CD = '01'
		           AND CTNT_EXCD_OJ_TP_CD = '02'
		           AND (CTNT_EXCD_MEDI_TP_CD = '01' OR CTNT_EXCD_MEDI_TP_CD = '02')
		           AND (TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APY_STRTDT AND APY_ENDDT)
		           AND LOCARA_TNO = T2.CRAL_LOCARA_TNO
		           AND EXNO_ENCR = T2.MEXNO_ENCR
		           AND IDV_TNO = T2.CRAL_IDV_TNO
		           AND DTA_DL_YN = 'N') AS TNO_CNT1 /* 제외번호구분 */
		     , (SELECT COUNT(1)
		          FROM TB_CBBO_BND_CNTC_EXCD_OJ_IZ TT1
		         WHERE TT1.CTNT_EXCD_BND_BIZ_CD = '01'
		           AND CTNT_EXCD_OJ_TP_CD = '02'
		           AND (CTNT_EXCD_MEDI_TP_CD = '01' OR CTNT_EXCD_MEDI_TP_CD = '02')
		           AND (TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APY_STRTDT AND APY_ENDDT)
		           AND LOCARA_TNO = T4.LOCARA_TNO
		           AND EXNO_ENCR = T4.EXNO_ENCR
		           AND IDV_TNO = T4.IDV_TNO
		           AND DTA_DL_YN = 'N') AS TNO_CNT2 /* 제외번호구분 */
		     , (SELECT COUNT(1)
		          FROM TB_CBBO_BND_CNTC_EXCD_OJ_IZ TT1
		         WHERE TT1.CTNT_EXCD_BND_BIZ_CD = '01'
		           AND CTNT_EXCD_OJ_TP_CD = '02'
		           AND (CTNT_EXCD_MEDI_TP_CD = '01' OR CTNT_EXCD_MEDI_TP_CD = '02')
		           AND (TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APY_STRTDT AND APY_ENDDT)
		           AND LOCARA_TNO = T4.CRAL_LOCARA_TNO
		           AND EXNO_ENCR = T4.MEXNO_ENCR
		           AND IDV_TNO = T4.CRAL_IDV_TNO
		           AND DTA_DL_YN = 'N') AS TNO_CNT3 /* 제외번호구분 */
		     , T2.BZRNO /* 사업자번호 */
		     , T1.BND_BIZ_DV_CD /* 채권업무구분코드 */
		     , T1.BASE_YM /* 기준년월 */
		     , ( SELECT TT1.RS_NM
		           FROM ( SELECT ROW_NUMBER() OVER(PARTITION BY B.CNTR_NO, B.CNTR_SN ORDER BY A.BIL_DT DESC) AS RN
		                       , B.CNTR_NO
		                       , B.CNTR_SN
		                       , CASE WHEN A.FNT_DV_CD = '01'/*계좌이체*/ THEN TO_CHAR(TO_DATE(A.BIL_DT,'YYYYMMDD'), 'YYYY-MM-DD')||'('||(SELECT AFTN_RS_ABBR_NM FROM TB_RVDW_AFTN_RS_CD WHERE AFTN_RS_DV_CD = '1' AND AFTN_RS_CD = C.AC_FNT_RS_CD)||')'
		                              WHEN A.FNT_DV_CD = '02'/*카드이체*/ THEN TO_CHAR(TO_DATE(A.BIL_DT,'YYYYMMDD'), 'YYYY-MM-DD')||'('||(SELECT AFTN_RS_ABBR_NM FROM TB_RVDW_AFTN_RS_CD WHERE AFTN_RS_DV_CD = '9' AND AFTN_RS_CD = D.CARD_FNT_RS_CD)||')'
		                          END RS_NM
		                    FROM TB_RVCL_BIL_FNT_AK_BAS A
		                    LEFT JOIN TB_RVCL_BIL_FNT_AK_DTL B ON A.BIL_NO = B.BIL_NO
		                    LEFT JOIN TB_RVCL_AC_FNT_SEND_MTR_IZ C ON A.BIL_NO = C.BIL_NO
		                    LEFT JOIN TB_RVCL_CARD_FNT_SEND_MTR_IZ D ON A.BIL_NO = D.BIL_NO
		                   WHERE 1=1
		                     AND (C.AC_FNT_RS_CD IS NOT NULL OR D.CARD_FNT_RS_CD IS NOT NULL)
		              ) TT1
		          WHERE TT1.RN = 1 AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN) AS RS_NM /* 이체구분 */
		  FROM TB_CBBO_BND_CNTR_BAS T1 /*채권계약기본*/
		  LEFT OUTER JOIN TB_CUBS_CST_BAS T2 /* 고객기본 */
		    ON T1.CST_NO = T2.CST_NO
		  LEFT OUTER JOIN TB_FEDD_BU_NOTI_RGST_BAS T3 /* 부담통보등록기본 */
		    ON T1.CNTR_NO = T3.CNTR_NO
		   AND T1.CNTR_SN = T3.CNTR_SN
		  LEFT OUTER JOIN (
		                    SELECT CR.CNTR_ADRPC_ID
		                         , CR.DTL_CNTR_NO
		                         , CR.DTL_CNTR_SN
		                         , CB.LOCARA_TNO
		                         , CB.EXNO_ENCR
		                         , CB.IDV_TNO
		                         , CB.CRAL_LOCARA_TNO
		                         , CB.MEXNO_ENCR
		                         , CB.CRAL_IDV_TNO
		                         , CB.RCGVP_KNM
		                         , NVL(AB.NEW_ADR_ZIP, AB.OLD_ADR_ZIP) AS SPP_ZIP
		                         , NVL(AB.RNADR, AB.LTN_ADR) AS SPP_ADR
		                         , NVL(AB.RDADR, AB.LTN_DTL_ADR) AS SPP_DTL_ADR
		                      FROM TB_SSCT_CNTR_ADR_REL CR /* 계약주소관계 */
		                      LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS CB /* 계약주소지기본 */
		                        ON CB.CNTR_ADRPC_ID = CR.CNTR_ADRPC_ID
		                      LEFT OUTER JOIN TB_GBCO_ADR_BAS AB /* 주소기본 */
		                        ON AB.ADR_ID = CB.ADR_ID
		                     WHERE CR.ADRPC_TP_CD IN ('2','3')  /* 배달주소,설치주소 */
		                       AND CR.DTA_DL_YN = 'N'
		                  ) T4
		    ON T1.CNTR_NO = T4.DTL_CNTR_NO
		   AND T1.CNTR_SN = T4.DTL_CNTR_SN
		  LEFT OUTER JOIN (
		                    SELECT CR.CNTR_ADRPC_ID /* 계약주소지ID */
		                         , CB.ADR_ID /* 주소ID */
		                         , CR.DTL_CNTR_NO /* 상세계약번호 */
		                         , CR.DTL_CNTR_SN /* 상세계약일련번호 */
		                         , CB.LOCARA_TNO /* 전화번호1 */
		                         , CB.EXNO_ENCR /* 전화번호2 */
		                         , CB.IDV_TNO /* 전화번호3 */
		                         , CB.CRAL_LOCARA_TNO /* 휴대전화번호1 */
		                         , CB.MEXNO_ENCR /* 휴대전화번호2 */
		                         , CB.CRAL_IDV_TNO /* 휴대전화번호3 */
		                         , NVL(AB.NEW_ADR_ZIP, AB.OLD_ADR_ZIP) AS SPP_ZIP /* 우편번호 */
		                         , NVL(AB.RNADR, AB.LTN_ADR) AS SPP_ADR /* 주소 */
		                         , NVL(AB.RDADR, AB.LTN_DTL_ADR) AS SPP_DTL_ADR /* 상세주소 */
		                      FROM TB_SSCT_CNTR_ADR_REL CR /* 계약주소관계 */
		                      LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS CB /* 계약주소지기본 */
		                        ON CB.CNTR_ADRPC_ID = CR.CNTR_ADRPC_ID
		                      LEFT OUTER JOIN TB_GBCO_ADR_BAS AB /* 주소기본 */
		                        ON AB.ADR_ID = CB.ADR_ID
		                     WHERE CR.ADRPC_TP_CD = '1'   /* 계약주소 */
		                       AND CR.DTA_DL_YN = 'N'
		                  ) T5
		    ON T1.CNTR_NO = T5.DTL_CNTR_NO
		   AND T1.CNTR_SN = T5.DTL_CNTR_SN
		  LEFT OUTER JOIN TB_SSCT_CNTR_DTL T7 /* 계약상세 */
		    ON T1.CNTR_NO = T7.CNTR_NO
		   AND T1.CNTR_SN = T7.CNTR_SN
		  LEFT OUTER JOIN TB_PDBS_PD_BAS T6 /* 상품기본 */
		    ON T7.BASE_PD_CD = T6.PD_CD
		  LEFT OUTER JOIN (
		                    SELECT TB1.CNTR_NO
		                         , TB1.CNTR_RCP_FSH_DTM
		                         , TB1.CNTR_CAN_DTM
		                         , TB2.CLTN_DT
		                      FROM TB_SSCT_CNTR_BAS TB1 /* 계약기본 */
		                      LEFT OUTER JOIN TB_OGBS_PRTNR_DTL TB2 /* 파트너기본 */
		                        ON TB1.SELL_PRTNR_NO = TB2.PRTNR_NO
		                        WHERE ROWNUM = 1
		                  ) T8
		    ON T1.CNTR_NO = T8.CNTR_NO
		  LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL T9 /* 계약WELLS상세 */
		    ON T1.CNTR_NO = T9.CNTR_NO
		   AND T1.CNTR_SN = T9.CNTR_SN
		  LEFT OUTER JOIN
		                 ( SELECT (TT1.MPY_BSDT||CASE WHEN TT1.DP_TP_CD = '0203' THEN '카' END) AS MPY_BSDT
		                        , TT1.CNTR_NO
		                        , TT1.CST_NO
		                        , TT1.DP_TP_CD
		                        , TT1.FNL_MDFC_DTM
		                        , TT1.BNK_CD
		                        , TT1.CDCO_CD
		                        , TT1.ACNO_ENCR
		                        , TT1.CRCDNO_ENCR
		                     FROM TB_SSCT_CNTR_STLM_BAS TT1
		                 ) T11
		    ON T1.CNTR_NO = T11.CNTR_NO
		   AND T1.CST_NO = T11.CST_NO
		   AND T11.FNL_MDFC_DTM = (SELECT MAX(FNL_MDFC_DTM) FROM TB_SSCT_CNTR_STLM_BAS TT2 WHERE TT2.CNTR_NO = T1.CNTR_NO)
		  LEFT OUTER JOIN (
		                    SELECT TB1.CNTR_NO
		                         , TB2.CRAL_LOCARA_TNO
		                         , TB2.MEXNO_ENCR
		                         , TB2.CRAL_IDV_TNO
		                         , TB2.PRTNR_KNM||'('||TB2.PRTNR_NO||')' AS PRTNR_KNM
		                      FROM TB_SSCT_CNTR_BAS TB1 /* 계약기본 */
		                      INNER JOIN TB_OGBS_PRTNR_BAS TB2 /* 파트너기본 */
		                        ON TB1.SELL_PRTNR_NO = TB2.PRTNR_NO
		                  ) T12
		    ON T1.CNTR_NO = T12.CNTR_NO
		   LEFT OUTER JOIN (
		                    SELECT B1.CNTR_NO /*계약번호*/
		                         , B4.PRTNR_KNM||'('||B4.PRTNR_NO||')' AS PRTNR_KNM /*지국장명*/
                                 , B4.CRAL_LOCARA_TNO /*지국장휴대전화번호 앞*/
		                         , B4.MEXNO_ENCR /*지국장휴대전화번호 중간*/
		                         , B4.CRAL_IDV_TNO /*지국장휴대전화번호 뒤*/
		                         , B5.CLTN_DT /*지국장 해약일자*/
		                        FROM TB_SSCT_CNTR_BAS B1/*계약기본*/
		                         INNER JOIN TB_OGBS_MM_PRTNR_IZ B2/*월파트너내역*/ ON B2.BASE_YM = SUBSTR(B1.CNTR_CNFM_DTM,1,6) AND B1.SELL_OG_TP_CD = B2.OG_TP_CD AND B1.SELL_PRTNR_NO = B2.PRTNR_NO
                                 INNER JOIN TB_OGBS_MM_OG_IZ B3/*월조직내역*/ ON B3.BASE_YM = SUBSTR(B1.CNTR_CNFM_DTM,1,6) AND B3.OG_ID = B2.OG_ID
                                 INNER JOIN TB_OGBS_PRTNR_BAS B4/*파트너기본*/ ON B4.PRTNR_NO = B3.HOO_PRTNR_NO AND B4.OG_TP_CD = B3.OG_TP_CD
                                 INNER JOIN TB_OGBS_PRTNR_DTL B5/*파트너상세*/ ON B5.OG_TP_CD = B4.OG_TP_CD AND B5.PRTNR_NO = B4.PRTNR_NO
		                  ) T13
		    ON T1.CNTR_NO = T13.CNTR_NO
		  LEFT OUTER JOIN (
		                    SELECT TB1.CNTR_NO
	                             , TB6.BLD_CD
	                             , TB6.BLD_NM
	                             , TB6.LOCARA_TNO
	                             , TB6.EXNO_ENCR
	                             , TB6.IDV_TNO
	                        FROM TB_SSCT_CNTR_BAS TB1 /* 계약기본 */
	                                 INNER JOIN TB_OGBS_MM_PRTNR_IZ TB2/*월파트너내역*/ ON TB2.BASE_YM = SUBSTR(TB1.CNTR_CNFM_DTM,1,6) AND TB1.SELL_OG_TP_CD = TB2.OG_TP_CD AND TB1.SELL_PRTNR_NO = TB2.PRTNR_NO
	                                 INNER JOIN TB_OGBS_MM_OG_IZ TB3/*월조직내역*/ ON TB3.BASE_YM = SUBSTR(TB1.CNTR_CNFM_DTM,1,6) AND TB3.OG_ID = TB2.OG_ID
	                                 INNER JOIN TB_OGBS_PRTNR_BAS TB4/*파트너기본*/ ON TB4.PRTNR_NO = TB3.HOO_PRTNR_NO AND TB4.OG_TP_CD = TB3.OG_TP_CD
	                                 INNER JOIN TB_OGBS_OG_BAS TB5 /* 조직기본 */ ON TB5.OG_TP_CD = TB4.OG_TP_CD AND TB5.OG_ID = TB4.OG_ID
	                                 INNER JOIN TB_OGBS_BLD_BAS TB6 /* 빌딩기본 */ ON TB6.OG_TP_CD = TB5.OG_TP_CD AND TB6.BLD_CD = TB5.BLD_CD
		                  ) T14
		    ON T1.CNTR_NO = T14.CNTR_NO
		  LEFT JOIN (
		              SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO, CNTR_NO, CNTR_SN ORDER BY VAC_IS_DTL_SN DESC) AS RN
		                   , CST_NO
		                   , CNTR_NO
		                   , CNTR_SN
		                   , (SELECT TT3.FNIT_NM FROM TB_RVDW_FNIT_CD TT3 WHERE FNIT_DV_CD = '1' AND TT3.FNIT_CD = TT2.VAC_BNK_CD) || ' : ' || TT2.VAC_NO AS VAC_NO
		                FROM TB_RVDW_VAC_IS_DTL TT1
		               INNER JOIN TB_RVDW_VAC_BAS TT2
		                  ON TT2.VAC_IS_ID = TT1.VAC_IS_ID
		                 AND TT2.VAC_IS_DV_CD = '5'/*가상계좌발급구분코드 = 연체집금용*/
		                 AND TT2.VAC_STAT_CD = '1'/*가상계좌상태코드 = 할당*/
		     ) T15
		    ON T15.RN = 1 AND T15.CST_NO = T1.CST_NO AND T15.CNTR_NO = T1.CNTR_NO AND T15.CNTR_SN = T1.CNTR_SN
		  LEFT OUTER JOIN (
		                    SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO ORDER BY FST_RGST_DTM DESC) AS RN
		                         , TB1.CST_NO
		                         , TB1.CNTR_NO
		                         , TB1.CNTR_SN
		                         , TB1.DFLT_DT
		                         , TB1.LWM_MO_CN
		                      FROM TB_CBBO_BND_LWM_IZ TB1 /* 채권법조치내역 */
		                  ) T16
		    ON T16.RN = 1
		   AND T1.CST_NO = T16.CST_NO
		  LEFT OUTER JOIN (
		                   SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO ORDER BY FST_RGST_DTM DESC) AS RN
		                        , BND_CLN_PSBL_DV_CD
		                        , CST_NO
		                        , BND_CLN_PRCS_DV_CD
		                        , FST_RGST_DTM
		                     FROM TB_CBBO_BND_TEL_CNSL_IZ  /* 채권전화상담내역 */
		                ) T17
		    ON T17.RN = 1
		   AND T1.CST_NO = T17.CST_NO
		  LEFT OUTER JOIN (
		                    SELECT * FROM (
		                                   SELECT ROW_NUMBER() OVER(PARTITION BY TB2.CST_NO ORDER BY TB2.CST_NO) AS RN
		                                        , TB2.CST_NO
		                                        , SUM(LWM_RCGN_AMT) OVER(PARTITION BY TB2.CST_NO) AS LWM_RCGN_AMT
		                                        , SUM(LWM_DLVYFE) OVER(PARTITION BY TB2.CST_NO) AS LWM_DLVYFE
		                                        , SUM(LWM_ENFORC_CS_AMT) OVER(PARTITION BY TB2.CST_NO) AS LWM_ENFORC_CS_AMT
		                                        , SUM(LWM_PESU_PRCS_CS_AMT) OVER(PARTITION BY TB2.CST_NO) AS LWM_PESU_PRCS_CS_AMT
		                                        , SUM(LWM_DP_AMT) OVER(PARTITION BY TB2.CST_NO) AS LWM_DP_AMT
		                                     FROM (
		                                           SELECT TB1.CST_NO
		                                                , TB1.CNTR_NO
		                                                , TB1.CNTR_SN
		                                                , CASE WHEN TB1.LWM_PESU_PRCS_CS_AMT > 1 THEN 0 ELSE TB1.LWM_RCGN_AMT END LWM_RCGN_AMT         /*인지금액*/
		                                                , CASE WHEN TB1.LWM_PESU_PRCS_CS_AMT > 1 THEN 0 ELSE TB1.LWM_DLVYFE END LWM_DLVYFE             /*송달료*/
		                                                , TB1.LWM_ENFORC_CS_AMT         /*개문집행비용금액*/
		                                                , TB1.LWM_PESU_PRCS_CS_AMT     /*독촉절차비용금액*/
		                                                , TB1.LWM_DP_AMT            /*입금금액*/
		                                             FROM TB_CBBO_BND_LWM_IZ TB1 /* 채권법조치내역 */
		                                        ) TB2
		                                )
		                            WHERE RN = 1 /*고객번호,계약번호,계약일련번호 당 한건만*/
		                ) T18
		    ON T1.CST_NO = T18.CST_NO
		 WHERE 1=1
		   AND T1.BASE_YM = (SELECT BASE_YM FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC) WHERE ROWNUM = 1)
           AND T1.CST_NO = #{schCstNo}
           AND T1.CNTR_NO = #{schCntrNo}
           AND T1.CNTR_SN = #{schCntrSn}
           AND ROWNUM = 1
    </select>

    <select id="selectCustomerDetails" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindCustomerDetailRes">
        SELECT CASE WHEN T1.BND_ASN_DT > T2.FST_RGST_DTM AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 1 THEN '○'
		            WHEN T1.BND_ASN_DT > T2.FST_RGST_DTM AND SUBSTR( T2.TEL_CNSL_RS_CD , 1 ,1 ) = 2 THEN '△'
		            ELSE 'Ｘ'
		        END AS CTT /* 이체 */
		     , T1.BND_BIZ_DV_CD /* 업무구분코드 */
		     , F_CMZ_CD_NM('TNT_WELLS', 'BND_BIZ_DV_CD', T1.BND_BIZ_DV_CD) AS BND_BIZ_DV_NM /* 업무구분명 */
		     , T4.PD_CLSF_NM /* 제품군 */
		     , T4.PD_NM /* 제품명 */
		     , T1.CNTR_NO /* 계약번호 */
		     , T1.CNTR_SN /* 계약일련번호 */
		     , T5.CST_KNM /* 고객명 */
		     , T1.CNTR_NO ||'-'||T1.CNTR_SN AS CNTR_DTL_NO /* 상세계약번호 */
		     , T1.DLQ_MCN /* 연체개월 */
             , CASE
		     	WHEN (SELECT COUNT(1) FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_CNFM_YN = 'Y') > 0 THEN (SELECT '최종확정('||SUBSTR(AUTH_RSG_CNFMDT,0,4)||'-'||SUBSTR(AUTH_RSG_CNFMDT,5,2)||')' FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_CNFM_YN = 'Y')
		     	WHEN (SELECT COUNT(1) FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_EXP_YN = 'Y') > 0 THEN (SELECT '예정확정('||SUBSTR(AUTH_RSG_DUEDT,0,4)||'-'||SUBSTR(AUTH_RSG_DUEDT,5,2)||')' FROM TB_CBBO_WELLS_AUTH_RSG_IZ TT1 WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N' AND TT1.AUTH_RSG_EXP_YN = 'Y')
		     END AS AUTH_RSG /* 직권해지일자 */
		     , (NVL(T1.DLQ_AMT, 0) + NVL(T1.DLQ_ADD_AMT, 0)) + NVL(T1.THM_CHRAM_AMT, 0) AS OJ_AMT /* 대상금액 */
		     , (NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0)) + NVL(T1.THM_CHRAM_DP_AMT, 0) AS OJ_DP /* 대상입금 */
		     , ((NVL(T1.DLQ_AMT, 0) + NVL(T1.DLQ_ADD_AMT, 0)) + NVL(T1.THM_CHRAM_AMT, 0)) - ((NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0)) + NVL(T1.THM_CHRAM_DP_AMT, 0)) AS OJ_BLAM /* 대상금액 - 대상입금 = 대상잔액 */
		     , NVL(T1.DLQ_AMT, 0) + NVL(T1.DLQ_ADD_AMT, 0) AS TOT_DLQ_AMT /* 연체금액 + 연체가산금 = 총연체금 */
		     , NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0) AS TOT_DLQ_DP /* 연체입금금액 + 연체가산금입금금액 = 총연체입금 */
		     , (NVL(T1.DLQ_AMT, 0) + NVL(T1.DLQ_ADD_AMT, 0)) - (NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0)) AS TOT_DLQ_BLAM /* 총연체금 - 총연체입금 = 총연체잔액 */
		     , NVL(T1.DLQ_AMT, 0) AS DLQ_AMT /* 연체금액 */
		     , NVL(T1.DLQ_DP_AMT, 0) AS DLQ_DP /* 연체입금 */
		     , NVL(T1.DLQ_AMT, 0) - NVL(T1.DLQ_DP_AMT, 0) AS DLQ_BLAM /* 연체금액 - 연체입금 = 연체잔액 */
		     , NVL(T1.THM_CHRAM_AMT, 0) AS MM_CHRAM_AMT /* 월요금액 */
		     , NVL(T1.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_DP /* 월요금입금 */
		     , NVL(T1.THM_CHRAM_AMT, 0) - NVL(T1.THM_CHRAM_DP_AMT, 0) AS MM_CHRAM_BLAM /* 당월요금금액 - 당월요금입금금액 = 월요금잔액 */
		     , NVL(T1.DLQ_ADD_AMT, 0) AS DLQ_ADD_AMT /* 연체가산금액 */
		     , NVL(T1.DLQ_ADD_DP_AMT, 0) AS DLQ_ADD_DP /* 연체가산입금 */
		     , NVL(T1.DLQ_ADD_AMT, 0) - NVL(T1.DLQ_ADD_DP_AMT, 0) AS DLQ_ADAMT_BLAM /* 연체가산금액 - 연체가산금입금금액 = 연체가산금잔액 */
             , NVL(T12.THM_OC_DLQ_ADD_AMT, 0) AS THM_OC_DLQ_ADD_AMT /*당월발생연체가산금액*/
		     , NVL(T8.SV_CS, 0) AS SV_CS /*서비스비용*/
		     , NVL(T8.SV_DP, 0) AS SV_DP /*서비스입금*/
		     , (NVL(T8.SV_CS, 0) - NVL(T8.SV_DP, 0)) AS SV_BLAM /*서비스잔액*/
		     , NVL(T1.UC_AMT, 0) AS UC_AMT /* 미수금액 */
		     , NVL(T1.RSG_BOR_DP_AMT, 0) AS RSG_BOR_DP_AMT /* 해지위약입금금액 */
		     , NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0) + NVL(T1.RSG_BOR_DP_AMT, 0) + NVL(T1.THM_CHRAM_DP_AMT, 0) AS UC_DP /* 미수입금 */
		     , NVL(T1.UC_AMT, 0) - (NVL(T1.DLQ_DP_AMT, 0) + NVL(T1.DLQ_ADD_DP_AMT, 0) + NVL(T1.RSG_BOR_DP_AMT, 0) + NVL(T1.THM_CHRAM_DP_AMT, 0)) AS UC_BLAM /* 미수금 - 총입금액 = 미수잔액 */
		     , ( SELECT NVL(SUM(TT1.RVE_AMT), 0)
                   FROM TB_RVDW_RVE_DTL TT1
                  WHERE TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND SUBSTR(TT1.RVE_DT,0,6) = T1.BASE_YM AND TT1.DP_DV_CD IN ('1', '3')
               ) AS TOT_DP_AMT /* 총입금액 */
		     , NVL(T9.SPMT_SL_AMT, 0) AS SPMT_SL /* 추가매출 */
		     , (SELECT NVL(TT1.LS_RNTF, 0) FROM TB_CBCL_WELLS_BOR_AMT_BAS TT1 WHERE TT1.PERF_YM = SUBSTR(T10.CCAM_CMPT_RQDT,0,6) AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N') AS LS_RNTF /* 분실손료 */
		     , F_CMZ_CD_NM('TNT_BASE', 'VNCO_DV_CD', T11.VAC_VNCO_DV_CD) AS VAC_VNCO_DV_CD /*가상계좌구분*/
		     , T11.BNK_NM /* 가상계좌은행 */
		     , T11.VAC_NO /* 가상계좌번호 */
		     , NVL(T10.BOR_AMT, 0) AS CCAM /* 위약금 */
		     , (SELECT NVL(TT1.LS_RNTF, 0) FROM TB_CBCL_WELLS_BOR_AMT_BAS TT1 WHERE TT1.PERF_YM = SUBSTR(T10.CCAM_CMPT_RQDT,0,6) AND TT1.CNTR_NO = T1.CNTR_NO AND TT1.CNTR_SN = T1.CNTR_SN AND TT1.DTA_DL_YN = 'N') AS LSFE/* 분실료 */
		     , NVL(T9.RENTAL_AMT, 0) AS RTLFE1 /* 렌탈료1 */
		     , NVL(T9.RENTAL_DSC_AMT, 0) AS RTLFE_ISTM1 /* 렌탈료1할 */
		     , NVL(T9.RENTAL_AMT2, 0) AS RTLFE2 /* 렌탈료2 */
		     , NVL(T9.RENTAL_DSC_AMT2, 0) AS RTLFE_ISTM2 /* 렌탈료2할 */
		     , T2.DPR_NM /* 입금자 */
		     , T1.CLCTAM_PRTNR_NO AS PRTNR_NO /* 집금담당번호 */
		     , (SELECT PRTNR_KNM FROM TB_CBBO_CLCTAM_PRTNR_DTL WHERE PRTNR_NO = T1.CLCTAM_PRTNR_NO) AS PRTNR_NM /*집금담당명*/
		     , T1.BND_TF_DT /* 이관일자 */
		     , T5.SFK_VAL /* 세이프키*/
		     , T1.CST_NO /* 고객번호*/
		     , T1.BASE_YM /* 기준년월*/
		  FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
		  LEFT OUTER JOIN (
		                   SELECT CST_NO
		                        , BND_CLN_PSBL_DV_CD
		                        , BND_CLN_PRCS_DV_CD
		                        , BND_CNSL_CST_STAT_CD
		                        , TEL_CNSL_RS_CD
		                        , FST_RGST_DTM
		                        , DPR_NM
		                     FROM TB_CBBO_BND_TEL_CNSL_IZ /* 채권전화상담내역 */
		                    WHERE ROWNUM = 1 ORDER BY FST_RGST_DTM DESC
		     ) T2
		    ON T1.CST_NO = T2.CST_NO
		  LEFT OUTER JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
            ON T1.CNTR_NO = T3.CNTR_NO
           AND T1.CNTR_SN = T3.CNTR_SN
          LEFT OUTER JOIN (
                           SELECT NVL2(C2.PD_CLSF_NM, C2.PD_CLSF_NM, '')
                                  || NVL2(C3.PD_CLSF_NM, '>' || C3.PD_CLSF_NM, '')
                                  || NVL2(C4.PD_CLSF_NM, '>' || C4.PD_CLSF_NM, '') AS PD_CLSF_NM  /* 상품분류 */
                                , PB.PD_CD                                  /* 상품코드 */
                                , PB.PD_NM
                             FROM TB_PDBS_PD_BAS PB
                             LEFT OUTER JOIN TB_PDBS_PD_CLSF_BAS C1          /* 분류 대 */
                               ON PB.PD_HCLSF_ID  = C1.PD_CLSF_ID
                             LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C2         /* 분류 중 */
                               ON PB.PD_MCLSF_ID  = C2.PD_CLSF_ID
                             LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C3         /* 분류 소 */
                               ON PB.PD_LCLSF_ID  = C3.PD_CLSF_ID
                             LEFT OUTER  JOIN TB_PDBS_PD_CLSF_BAS C4         /* 분류 세 */
                               ON PB.PD_DCLSF_ID  = C4.PD_CLSF_ID
                            WHERE PB.DTA_DL_YN = 'N'
                         ) T4
            ON T4.PD_CD = T3.BASE_PD_CD
		  LEFT OUTER JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
		    ON T1.CST_NO = T5.CST_NO
		  LEFT OUTER JOIN (
		                   SELECT CNTR_NO, CNTR_SN
		                         , NVL(SV_CS, 0) AS SV_CS /*서비스비용*/
		                         , NVL(SV_DP, 0) AS SV_DP /*서비스 입금*/
		                         , NVL((SV_CS - SV_DP), 0) AS SV_BLAM
		                        FROM (
		                         SELECT
		                          T1.CNTR_NO , T1.CNTR_SN
		                          , (SELECT SUM(BIL_OJ_AMT) FROM TB_SVPD_SV_CS_BIL_DTL TT1 WHERE TT1.CST_SV_ASN_NO IN (SELECT CST_SV_ASN_NO FROM TB_SVPD_CST_SV_WK_RS_IZ TT2 WHERE SUbSTR(TT2.VST_FSH_DT,0,6) = T1.BASE_YM AND TT2.CNTR_NO = T1.CNTR_NO AND TT2.CNTR_SN = T1.CNTR_SN) ) AS SV_CS
		                          , (SELECT SUM(DP_SUM_AMT) FROM TB_SVPD_SV_CS_DP_IZ TT1 WHERE TT1.CST_SV_ASN_NO IN (SELECT CST_SV_ASN_NO FROM TB_SVPD_CST_SV_WK_RS_IZ TT2 WHERE SUbSTR(TT2.VST_FSH_DT,0,6) = T1.BASE_YM AND TT2.CNTR_NO = T1.CNTR_NO AND TT2.CNTR_SN = T1.CNTR_SN) ) AS SV_DP
		                         FROM TB_CBBO_BND_CNSL_BAS_IZ T1
		                        )
		     ) T8
		    ON T1.CNTR_NO = T8.CNTR_NO
		   AND T1.CNTR_SN = T8.CNTR_SN
		  LEFT OUTER JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
		    ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		   AND T9.CNTR_NO = T1.CNTR_NO
		   AND T9.CNTR_SN = T1.CNTR_SN
		  LEFT OUTER JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
		    ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
		   AND T10.CNTR_NO = T1.CNTR_NO
		   AND T10.CNTR_SN = T1.CNTR_SN
		   AND T10.DTA_DL_YN = 'N'
		  LEFT JOIN (
		               SELECT ROW_NUMBER() OVER(PARTITION BY CST_NO, CNTR_NO, CNTR_SN ORDER BY VAC_IS_DTL_SN DESC) AS RN
		                    , CST_NO
		                    , CNTR_NO , CNTR_SN
		                    , TT2.VAC_VNCO_DV_CD
		                    , (SELECT TT3.FNIT_NM FROM TB_RVDW_FNIT_CD TT3 WHERE FNIT_DV_CD = '1' AND TT3.FNIT_CD = TT2.VAC_BNK_CD) AS BNK_NM
		                    , TT2.VAC_NO AS VAC_NO
		                 FROM TB_RVDW_VAC_IS_DTL TT1
		                INNER JOIN TB_RVDW_VAC_BAS TT2 ON TT2.VAC_IS_ID = TT1.VAC_IS_ID AND TT2.VAC_IS_DV_CD = '5'/*가상계좌발급구분코드 = 연체집금용*/ AND TT2.VAC_STAT_CD = '1'/*가상계좌상태코드 = 할당*/
		     ) T11
		    ON T11.RN = 1 AND T11.CST_NO = T1.CST_NO AND T11.CNTR_NO = T1.CNTR_NO AND T11.CNTR_SN = T1.CNTR_SN
          LEFT JOIN TB_CBCL_DLQ_BAS T12 /*연체기본*/
                    ON T12.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
                        AND T12.CNTR_NO = T1.CNTR_NO
                        AND T12.CNTR_SN = T1.CNTR_SN
		 WHERE 1=1
		   AND T1.BASE_YM = (SELECT BASE_YM FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC) WHERE ROWNUM = 1)
		   AND T1.CST_NO = #{schCstNo}
    </select>

    <select id="selectUnusualArticles" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindUnusualArticlesRes">
        SELECT CNSL_UNUITM_CN /* 특이사항 */
		     , ROWNUM
		  FROM (
		        SELECT CNSL_UNUITM_CN
		             , ROWNUM
		          FROM TB_CBBO_BND_UNUITM_CVCP_DTL
		         WHERE 1=1
		           AND CST_NO = #{schCstNo}
		         ORDER BY FST_RGST_DTM DESC
		     )
		 WHERE 1=1
		   AND ROWNUM = 1
    </select>

    <insert id="mergeUnuitmCn">
        MERGE INTO TB_CBBO_BND_UNUITM_CVCP_DTL T1    /* 채권특이사항민원상세 */
        USING ( SELECT #{cstNo} AS CST_NO            /* 고객번호 */
                     , #{cntrNo} AS CNTR_NO          /* 계약번호 */
                     , #{cntrSn} AS CNTR_SN          /* 계약일련번호 */
                  FROM DUAL ) T2
           ON (
                       T1.CST_NO = T2.CST_NO         /* 고객번호 */
                   AND T1.CNTR_NO = T2.CNTR_NO       /* 계약번호 */
                   AND T1.CNTR_SN = T2.CNTR_SN       /* 계약일련번호 */
              )
         WHEN MATCHED THEN
       UPDATE SET CNSL_UNUITM_CN = #{cnslUnuitmCn}
         <include refid="COMMON.updateSystemField"/>
         WHEN NOT MATCHED THEN
           INSERT (
                  BND_UNUITM_ID /* 채권특이사항ID */
                , BND_CNTR_TP_CD /* 채권계약유형코드 */
                , BND_BIZ_DV_CD /* 채권업무구분코드 */
                , CST_NO /* 고객번호 */
                , CNTR_NO /* 계약번호 */
                , CNTR_SN /* 계약일련번호 */
                , CLCTN_OJ_OG_TP_CD /* 추심대상조직유형코드 */
                , CLCTN_OJ_PRTNR_NO /* 추심대상파트너번호 */
                , CNSL_UNUITM_CN /* 상담특이사항내용 */
                , CVCP_CN /* 민원내용 */
                , DTA_DL_YN /* 데이터삭제여부 */
                <include refid="COMMON.insertSystemField"/>
           ) VALUES (
                  ( SELECT TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDhh24miss') || LPAD((SELECT COUNT(1) FROM TB_CBBO_BND_UNUITM_CVCP_DTL WHERE SUBSTR(FST_RGST_DTM, 0,8) = TO_CHAR(SYSTIMESTAMP, 'YYYYMMDD'))+1, 6, '0')
                      FROM DUAL)
                , #{bndCntrTpCd}
                , #{bndBizDvCd}
                , #{cstNo}
                , #{cntrNo}
                , #{cntrSn}
                , #{clctnOjOgTpCd}
                , #{clctnOjPrtnrNo}
                , #{cnslUnuitmCn}
                , #{cvcpCn}
                , 'N'
                <include refid="COMMON.insertSystemFieldValue" />  )
    </insert>

    <insert id="insertCounsel">
        INSERT INTO TB_CBBO_BND_TEL_CNSL_IZ ( /* 채권전화상담내역 */
               TEL_CNSL_ID /* 전화상담ID */
             , BND_CNTR_TP_CD /* 채권계약유형코드 */
             , BND_BIZ_DV_CD /* 채권업무구분코드 */
             , CST_NO /* 고객번호 */
             , CNTR_NO /* 계약번호 */
             , CNTR_SN /* 계약일련번호 */
             , CLCTN_OJ_OG_TP_CD /* 추심대상조직유형코드 */
             , CLCTN_OJ_PRTNR_NO /* 추심대상파트너번호 */
             , CLCTN_OJ_PRTNR_BZRNO /* 추심대상파트너사업자등록번호 */
             , CLCTAM_PRTNR_NO /* 집금파트너번호 */
             , TEL_CNSL_PH_CD /* 전화상담경로코드 */
             , BND_CNSL_MTR_DV_CD /* 채권상담자료구분코드 */
             , TEL_CNSL_RS_CD /* 전화상담결과코드 */
             , CNSL_CST_PRP_CD /* 상담고객속성코드 */
             , TEL_CNSL_CN /* 전화상담내용 */
             , BND_CLN_PSBL_DV_CD /* 채권회수가능성구분코드 */
             , BND_CNSL_CST_STAT_CD /* 채권상담고객상태코드 */
             , BND_CLN_PRCS_DV_CD /* 채권회수절차구분코드 */
             , DPR_NM /* 입금자명 */
             , RDG_ID /* 녹취ID */
             , DTA_DL_YN /* 데이터삭제여부 */
             <include refid="COMMON.insertSystemField" /> )
        VALUES (
               ( SELECT TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDhh24miss') || LPAD((SELECT COUNT(1) FROM TB_CBBO_BND_TEL_CNSL_IZ WHERE SUBSTR(FST_RGST_DTM, 0,8) = TO_CHAR(SYSTIMESTAMP, 'YYYYMMDD'))+1, 6, '0')
                   FROM DUAL )
             , #{bndCntrTpCd}
             , #{bndBizDvCd}
             , #{cstNo}
             , #{cntrNo}
             , #{cntrSn}
             , #{clctnOjOgTpCd}
             , #{clctnOjPrtnrNo}
             , #{clctnOjPrtnrBzrno}
             , #{clctamPrtnrNo}
             , #{telCnslPhCd}
             , #{bndCnslMtrDvCd}
             , #{telCnslRsCd}
             , #{cnslCstPrpCd}
             , #{telCnslCn}
             , #{bndClnPsblDvCd}
             , #{bndCnslCstStatCd}
             , #{bndClnPrcsDvCd}
             , #{dprNm}
             , #{rdgId}
             , 'N'
             <include refid="COMMON.insertSystemFieldValue" />
             )
    </insert>

    <insert id="insertPromise">
        INSERT INTO TB_CBBO_BND_CNSL_PROM_BOO_IZ ( /* 채권상담약속예약내역 */
               PROM_BOO_ID /* 약속예약ID */
             , BND_CNTR_TP_CD /* 채권계약유형코드 */
             , BND_BIZ_DV_CD /* 채권업무구분코드 */
             , CST_NO /* 고객번호 */
             , CNTR_NO /* 계약번호 */
             , CNTR_SN /* 계약일련번호 */
             , CLCTN_OJ_OG_TP_CD /* 추심대상조직유형코드 */
             , CLCTN_OJ_PRTNR_NO /* 추심대상파트너번호 */
             , CLCTN_OJ_PRTNR_BZRNO /* 추심대상파트너사업자등록번호 */
             , PROM_DT /* 약속일자 */
             , PROM_HH /* 약속시간 */
             , CLCTAM_PROM_TP_CD /* 집금약속유형코드 */
             , CLN_PROM_AMT /* 회수약속금액 */
             , PROM_CN /* 약속내용 */
             , PROM_FSH_YN /* 약속완료여부 */
             , DTA_DL_YN  /* 데이터삭제여부 */
             <include refid="COMMON.insertSystemField" /> )
        VALUES (
               ( SELECT TO_CHAR(SYSTIMESTAMP, 'YYYYMMDDhh24miss') || LPAD((SELECT COUNT(1) FROM TB_CBBO_BND_CNSL_PROM_BOO_IZ  WHERE SUBSTR(FST_RGST_DTM, 0,8) = TO_CHAR(SYSTIMESTAMP, 'YYYYMMDD'))+1, 6, '0')
                   FROM DUAL )
             , #{bndCntrTpCd}
             , #{bndBizDvCd}
             , #{cstNo}
             , #{cntrNo}
             , #{cntrSn}
             , #{clctnOjOgTpCd}
             , #{clctnOjPrtnrNo}
             , #{clctnOjPrtnrBzrno}
             , NVL(#{promDt},' ')
             , NVL(RPAD(#{promHh},6,'0'),'')
             , #{promTp}
             , NVL(#{promAmt}, '0')
             , #{promCn}
             , #{promFshYn}
             , 'N'
             <include refid="COMMON.insertSystemFieldValue" />
             )
    </insert>

    <select id="selectCounselHistorys" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindCounselHistoryRes">
        SELECT T1.TEL_CNSL_ID /* 전화상담ID */
             , T1.FST_RGST_DTM AS IN_DT /* 입력일시 */
             , (SELECT EPNO FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FST_RGST_USR_ID AND DEL_YN = 'N' ) AS IN_ICHR /* 등록담당사번 */
             , (SELECT USR_NM FROM T_CMP_USR_ACO_M WHERE USR_ID = T1.FST_RGST_USR_ID AND DEL_YN = 'N') AS IN_ICHR_NM /* 등록담당자 */
             , F_CMZ_CD_NM(#{session.tenantId}, 'TEL_CNSL_PH_CD', T1.TEL_CNSL_PH_CD) AS CNSL_PH   /* 상담경로 */
             , F_CMZ_CD_NM(#{session.tenantId}, 'TEL_CNSL_RS_CD', T1.TEL_CNSL_RS_CD) AS CRNCY_RS /* 통화결과 */
             , DPR_NM AS DPR_NM /* 입금자명 */
             , TEL_CNSL_CN AS CNSL_CN /* 전화상담내용 */
          FROM TB_CBBO_BND_TEL_CNSL_IZ T1 /* 채권전화상담내역 */
         WHERE T1.CST_NO = #{schCstNo}
         ORDER BY T1.FST_RGST_DTM DESC
    </select>

    <select id="selectUserInfo" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$SearchUserInfoRes">
        SELECT TNO1 /* 전화번호1 */
             , TNO2 /* 전화번호2 */
             , TNO3 /* 전화번호3 */
          FROM (
                SELECT T2.CPHON_LOCARA_TNO AS TNO1 /* 전화번호1 */
                     , T2.CPHON_EXNO_ENCR AS TNO2 /* 전화번호2 */
                     , T2.CPHON_IDV_TNO AS TNO3 /* 전화번호3 */
                  FROM TB_CBBO_CLCTAM_PRTNR_DTL T1 /* 집금파트너상세 */
                  LEFT OUTER JOIN TB_CBBO_CLCTAM_PRTNR_USTEL_DTL T2 /* 집금파트너사용전화상세 */
                    ON T1.PRTNR_NO = T2.PRTNR_NO
                   AND T1.OG_TP_CD = T2.OG_TP_CD
                   AND T2.TNO_SN = '1'
                   AND T2.MPHON_YN = 'Y'
                   AND T2.DTA_DL_YN = 'N'
                 WHERE 1 = 1
                   AND T1.PRTNR_NO = #{prtnrNo}
                   AND T1.OG_TP_CD = #{ogTpCd}
                 UNION
                SELECT T2.CPHON_LOCARA_TNO AS TNO1 /* 전화번호1 */
                     , T2.CPHON_EXNO_ENCR AS TNO2 /* 전화번호2 */
                     , T2.CPHON_IDV_TNO AS TNO3 /* 전화번호3 */
                  FROM TB_CBBO_CLCTAM_PRTNR_DTL T1 /* CPHON_EXNO_ENCR */
                  LEFT OUTER JOIN TB_CBBO_CLCTAM_PRTNR_USTEL_DTL T2 /* 집금파트너사용전화상세 */
                    ON T1.PRTNR_NO = T2.PRTNR_NO
                   AND T1.OG_TP_CD = T2.OG_TP_CD
                   AND T2.TNO_SN = '2'
                   AND T2.MPHON_YN = 'N'
                   AND T2.DTA_DL_YN = 'N'
                 WHERE 1 = 1
                   AND T1.PRTNR_NO = #{prtnrNo}
                   AND T1.OG_TP_CD = #{ogTpCd}
                 UNION
                SELECT T2.CPHON_LOCARA_TNO AS TNO1 /* 전화번호1 */
                     , T2.CPHON_EXNO_ENCR AS TNO2 /* 전화번호2 */
                     , T2.CPHON_IDV_TNO AS TNO3 /* 전화번호3 */
                  FROM TB_CBBO_CLCTAM_PRTNR_DTL T1 /* CPHON_EXNO_ENCR */
                  LEFT OUTER JOIN TB_CBBO_CLCTAM_PRTNR_USTEL_DTL T2 /* 집금파트너사용전화상세 */
                    ON T1.PRTNR_NO = T2.PRTNR_NO
                   AND T1.OG_TP_CD = T2.OG_TP_CD
                   AND T2.TNO_SN = '3'
                   AND T2.MPHON_YN = 'N'
                   AND T2.DTA_DL_YN = 'N'
                 WHERE 1 = 1
                   AND T1.PRTNR_NO = #{prtnrNo}
                   AND T1.OG_TP_CD = #{ogTpCd}
             )
         WHERE 1=1
    </select>

    <select id="selectCounselRegistration" resultType="com.kyowon.sms.wells.web.bond.consultation.dto.WbncCustomerDto$FindCounselRegistrationRes">
        SELECT TEL_CNSL_ID AS CNSL_ID/* 전화상담ID */
             , TEL_CNSL_PH_CD AS CNSL_PH /*상담경로*/
             , TEL_CNSL_RS_CD AS CRNCY_RS /*통화결과*/
             , CNSL_CST_PRP_CD AS CST_PRP /*고객속성*/
             , DPR_NM AS DPR_NM /*입금자*/
             , BND_CNSL_MTR_DV_CD AS CNSL_TP /*상담유형*/
             , BND_CNSL_CST_STAT_CD AS CST_STAT /*고객상태*/
             , BND_CLN_PSBL_DV_CD AS CLN_PSBL /*회수가능성*/
             , BND_CLN_PRCS_DV_CD AS CLN_PRCS /*회수절차*/
          FROM (
                SELECT TEL_CNSL_ID /* 전화상담ID */
                     , TEL_CNSL_PH_CD /*상담경로*/
                     , TEL_CNSL_RS_CD /*통화결과*/
                     , CNSL_CST_PRP_CD /*고객속성*/
                     , DPR_NM /*입금자*/
                     , BND_CNSL_MTR_DV_CD /*상담유형*/
                     , BND_CNSL_CST_STAT_CD /*고객상태*/
                     , BND_CLN_PSBL_DV_CD /*회수가능성*/
                     , BND_CLN_PRCS_DV_CD /*회수절차*/
                  FROM TB_CBBO_BND_TEL_CNSL_IZ
                 WHERE CST_NO = #{schCstNo}
                  ORDER BY FST_RGST_DTM DESC
             )
         WHERE 1=1
           AND ROWNUM = 1
    </select>

    <select id="selectPetitionType" resultType="com.kyowon.sms.wells.web.bond.consultation.dvo.WbncPetitionCreateDvo">
        SELECT B.BND_BIZ_DV_CD              /*채권업무구분코드*/
             , '02' AS BND_LWS_BIL_DV_CD    /*채권소송청구구분코드*/
             , '@'  AS BND_BIL_PPS_DV_CD    /*채권청구취지구분코드*/
             , (CASE WHEN NVL(A.MM_ISTM_AMT,0) > 0 THEN 'Y' ELSE 'N' END) AS ISTM_YN   /*할부여부*/
             , (CASE WHEN (NVL(A.DSC_AMT,0) > 0 OR NVL(A.CNTRAM_DSC_AMT,0) > 0) THEN 'Y' ELSE 'N' END) AS DSC_YN /*할인여부*/
             , A.CNTR_DTL_STAT_CD           /*계약상세상태코드*/
          FROM TB_SSCT_CNTR_DTL A /*T:계약상세*/
         INNER JOIN TB_CBBO_BND_CNTR_BAS B /*T:채권계약기본*/
            ON B.CNTR_NO = A.CNTR_NO
           AND B.CNTR_SN = A.CNTR_SN
           AND B.BASE_YM = #{baseYm}
         WHERE 1=1
           AND B.DTA_DL_YN = 'N'
           AND B.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
           AND B.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType1" resultType="Integer">
        /* B-2-1 [데이터] */
        SELECT COUNT(1)
          FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
          LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
            ON T1.CNTR_NO = T2.CNTR_NO
          LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
            ON T1.CNTR_NO = T3.CNTR_NO
           AND T1.CNTR_SN = T3.CNTR_SN
          LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
            ON T4.PD_CD = T3.BASE_PD_CD
          LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
            ON T1.CST_NO = T5.CST_NO
          LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
            ON T1.CNTR_NO = T7.CNTR_NO
           AND T1.CNTR_SN = T7.CNTR_SN
           AND T7.AUTH_RSG_CNFM_YN = 'Y'
          LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
            ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T9.CNTR_NO = T1.CNTR_NO
           AND T9.CNTR_SN = T1.CNTR_SN
          LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
            ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T10.CNTR_NO = T1.CNTR_NO
           AND T10.CNTR_SN = T1.CNTR_SN
         WHERE 1=1
           AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
           AND T1.BND_BIZ_DV_CD = 'L20'
           AND T3.CNTR_DTL_STAT_CD NOT IN ('302','303')
           AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /* 미수잔액*/
           AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
           AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType2" resultType="Integer">
        /* B-2-2 [데이터] */
        SELECT COUNT(1)
          FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
          LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
            ON T1.CNTR_NO = T2.CNTR_NO
          LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
            ON T1.CNTR_NO = T3.CNTR_NO
           AND T1.CNTR_SN = T3.CNTR_SN
          LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
            ON T4.PD_CD = T3.BASE_PD_CD
          LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
            ON T1.CST_NO = T5.CST_NO
          LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
            ON T1.CNTR_NO = T7.CNTR_NO
           AND T1.CNTR_SN = T7.CNTR_SN
           AND T7.AUTH_RSG_CNFM_YN = 'Y'
          LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
            ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T9.CNTR_NO = T1.CNTR_NO
           AND T9.CNTR_SN = T1.CNTR_SN
          LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
            ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T10.CNTR_NO = T1.CNTR_NO
           AND T10.CNTR_SN = T1.CNTR_SN
         WHERE 1=1
           AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
           AND T1.BND_BIZ_DV_CD = 'L21'
           AND T3.CNTR_DTL_STAT_CD NOT IN ('302','303')
           AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /*미수잔액*/
           AND NVL(T3.MM_ISTM_AMT,0) = 0 /*할부금액*/
           AND NVL(T3.DSC_AMT,0) = 0 /*할인금액*/
           AND NVL(T3.CNTRAM_DSC_AMT,0) = 0 /*할인금액*/
           AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
           AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType3" resultType="Integer">
       /* B-2-3 [데이터] */
       SELECT COUNT(1)
         FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
         LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
           ON T1.CNTR_NO = T2.CNTR_NO
         LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
           ON T1.CNTR_NO = T3.CNTR_NO
          AND T1.CNTR_SN = T3.CNTR_SN
         LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
           ON T4.PD_CD = T3.BASE_PD_CD
         LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
           ON T1.CST_NO = T5.CST_NO
         LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
           ON T1.CNTR_NO = T7.CNTR_NO
          AND T1.CNTR_SN = T7.CNTR_SN
          AND T7.AUTH_RSG_CNFM_YN = 'Y'
         LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
           ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T9.CNTR_NO = T1.CNTR_NO
          AND T9.CNTR_SN = T1.CNTR_SN
         LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
           ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T10.CNTR_NO = T1.CNTR_NO
          AND T10.CNTR_SN = T1.CNTR_SN
        WHERE 1=1
          AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
          AND T1.BND_BIZ_DV_CD = 'L21'
          AND T3.CNTR_DTL_STAT_CD NOT IN ('302','303')
          AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /*미수잔액*/
          AND NVL(T3.MM_ISTM_AMT,0) > 0 /*할부금액*/
          AND (NVL(T3.DSC_AMT,0) > 0 OR NVL(T3.CNTRAM_DSC_AMT,0) > 0) /*할인금액*/
          AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
          AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType4" resultType="Integer">
       /* B-2-4 [데이터] */
       SELECT COUNT(1)
         FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
         LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
           ON T1.CNTR_NO = T2.CNTR_NO
         LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
           ON T1.CNTR_NO = T3.CNTR_NO
          AND T1.CNTR_SN = T3.CNTR_SN
         LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
           ON T4.PD_CD = T3.BASE_PD_CD
         LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
           ON T1.CST_NO = T5.CST_NO
         LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
           ON T1.CNTR_NO = T7.CNTR_NO
          AND T1.CNTR_SN = T7.CNTR_SN
          AND T7.AUTH_RSG_CNFM_YN = 'Y'
         LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
           ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T9.CNTR_NO = T1.CNTR_NO
          AND T9.CNTR_SN = T1.CNTR_SN
         LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
           ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T10.CNTR_NO = T1.CNTR_NO
          AND T10.CNTR_SN = T1.CNTR_SN
        WHERE 1=1
          AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
          AND T1.BND_BIZ_DV_CD = 'L10'
          AND T3.CNTR_DTL_STAT_CD NOT IN ('302','303')
          AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /*미수잔액*/
          AND NVL(T3.MM_ISTM_AMT,0) > 0 /*할부금액*/
          AND NVL(T3.DSC_AMT,0) = 0 /*할인금액*/
          AND NVL(T3.CNTRAM_DSC_AMT,0) = 0 /*할인금액*/
          AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
          AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType5" resultType="Integer">
       /* B-2-5 [데이터] */
       SELECT COUNT(1)
         FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
         LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
           ON T1.CNTR_NO = T2.CNTR_NO
         LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
           ON T1.CNTR_NO = T3.CNTR_NO
          AND T1.CNTR_SN = T3.CNTR_SN
         LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
           ON T4.PD_CD = T3.BASE_PD_CD
         LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
           ON T1.CST_NO = T5.CST_NO
         LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
           ON T1.CNTR_NO = T7.CNTR_NO
          AND T1.CNTR_SN = T7.CNTR_SN
          AND T7.AUTH_RSG_CNFM_YN = 'Y'
         LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
           ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T9.CNTR_NO = T1.CNTR_NO
          AND T9.CNTR_SN = T1.CNTR_SN
         LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
           ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T10.CNTR_NO = T1.CNTR_NO
          AND T10.CNTR_SN = T1.CNTR_SN
        WHERE 1=1
          AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
          AND T1.BND_BIZ_DV_CD IN ('L30','L60')
          AND T3.CNTR_DTL_STAT_CD NOT IN ('302','303')
          AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /*미수잔액*/
          AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
          AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType6" resultType="Integer">
       /* B-2-6 [데이터] */
       SELECT COUNT(1)
         FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
         LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
           ON T1.CNTR_NO = T2.CNTR_NO
         LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
           ON T1.CNTR_NO = T3.CNTR_NO
          AND T1.CNTR_SN = T3.CNTR_SN
         LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
           ON T4.PD_CD = T3.BASE_PD_CD
         LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
           ON T1.CST_NO = T5.CST_NO
         LEFT JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
           ON T1.CNTR_NO = T7.CNTR_NO
          AND T1.CNTR_SN = T7.CNTR_SN
          AND T7.AUTH_RSG_CNFM_YN = 'Y'
         LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
           ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T9.CNTR_NO = T1.CNTR_NO
          AND T9.CNTR_SN = T1.CNTR_SN
         LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
           ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
          AND T10.CNTR_NO = T1.CNTR_NO
          AND T10.CNTR_SN = T1.CNTR_SN
        WHERE 1=1
          AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
          AND T1.BND_BIZ_DV_CD IN ('L20','L21','L60')
          AND T3.CNTR_DTL_STAT_CD IN ('303')
          AND NVL(T1.UC_AMT,0)-(NVL(T1.DLQ_DP_AMT,0)+NVL(T1.RSG_BOR_DP_AMT,0)+NVL(T1.THM_CHRAM_DP_AMT,0))-NVL(T1.DLQ_ADD_DP_AMT,0) > 0 /*미수잔액*/
          AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
          AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>

    <select id="selectPetitionType7" resultType="Integer">
       /* B-2-7 [데이터] */
        SELECT COUNT(1)
          FROM TB_CBBO_BND_CNTR_BAS T1 /* 채권계약기본 */
          LEFT JOIN TB_SSCT_CNTR_BAS T2 /* 계약기본 */
            ON T1.CNTR_NO = T2.CNTR_NO
          LEFT JOIN TB_SSCT_CNTR_DTL T3 /* 계약상세 */
            ON T1.CNTR_NO = T3.CNTR_NO
           AND T1.CNTR_SN = T3.CNTR_SN
          LEFT JOIN TB_PDBS_PD_BAS T4 /*상품기본*/
            ON T4.PD_CD = T3.BASE_PD_CD
          LEFT JOIN TB_CUBS_CST_BAS T5 /* 고객기본 */
            ON T1.CST_NO = T5.CST_NO
         INNER JOIN TB_CBBO_WELLS_AUTH_RSG_IZ T7 /* WELLS직권해지내역 */
            ON T1.CNTR_NO = T7.CNTR_NO
           AND T1.CNTR_SN = T7.CNTR_SN
           AND T7.AUTH_RSG_CNFM_YN = 'Y'
          LEFT JOIN TB_CBCL_WELLS_SL_MM_CL_IZ T9 /* WELLS매출월마감내역 */
            ON T9.SL_CL_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T9.CNTR_NO = T1.CNTR_NO
           AND T9.CNTR_SN = T1.CNTR_SN
          LEFT JOIN TB_CBCL_WELLS_BOR_AMT_BAS T10 /* WELLS위약금액기본 */
            ON T10.PERF_YM = TO_CHAR(ADD_MONTHS(TO_DATE(T1.BASE_YM, 'YYYYMM'), -1), 'YYYYMM')
           AND T10.CNTR_NO = T1.CNTR_NO
           AND T10.CNTR_SN = T1.CNTR_SN
         WHERE 1=1
           AND T1.BASE_YM = (SELECT MAX(BASE_YM) FROM (SELECT BASE_YM FROM TB_CBBO_BND_CNSL_BAS_IZ WHERE BND_CNTR_TP_CD = '01' ORDER BY BASE_YM DESC))
           AND T1.BND_BIZ_DV_CD IN ('L20')
           AND T3.CNTR_DTL_STAT_CD IN ('302')
           AND NVL(T7.RSG_MM_UC_AMT,0) > 0 /*미납렌탈료*/
           AND T1.CNTR_NO = SUBSTR(#{cntrDtlNo},0,12)
           AND T1.CNTR_SN = SUBSTR(#{cntrDtlNo},14,15)
    </select>
</mapper>
