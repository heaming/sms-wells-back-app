<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaWarehouseOrganizationMapper">
    <insert id="insertWareCarried">
        INSERT INTO TB_SVST_MCBY_WARE_IZ ( /*월병창고내역*/
               APY_YM                 /* 적용년월 */
             , WARE_NO                /* 창고번호 */
             , WARE_DV_CD             /* 창고구분코드 */
             , WARE_DTL_DV_CD         /* 창고상세구분코드 */
             , WARE_LOCARA_CD         /* 창고지역코드 */
             , WARE_LOCARA_SN         /* 창고지역일련번호 */
             , HGR_WARE_NO            /* 상위창고번호 */
             , WARE_NM                /* 창고명 */
             , WARE_ICHR_NO           /* 창고담당번호 */
             , WARE_MNGT_PRTNR_NO     /* 창고관리파트너번호 */
             , CO_CD                  /* 회사코드 */
             , DIDY_DV_CD             /* 직배구분코드 */
             , SORT_DV_VAL            /* 정렬구분값 */
             , WARE_ADR_ID            /* 창고주소ID */
             , BLD_CD                 /* 빌딩코드 */
             , WARE_USE_YN            /* 창고사용여부 */
             , ADR_USE_YN             /* 주소사용여부 */
             , APY_STRTDT             /* 적용시작일자 */
             , APY_ENDDT              /* 적용종료일자 */
             , RMK_CN                 /* 비고내용 */
             , DTA_DL_YN              /* 데이터삭제여부 */
             <include refid="COMMON.insertSystemField"/>
        )
        SELECT TO_CHAR(ADD_MONTHS(TO_DATE(APY_YM,'YYYYMM'),1),'YYYYMM')
             , WARE_NO
             , WARE_DV_CD
             , WARE_DTL_DV_CD
             , WARE_LOCARA_CD
             , WARE_LOCARA_SN
             , HGR_WARE_NO
             , WARE_NM
             , WARE_ICHR_NO
             , WARE_MNGT_PRTNR_NO
             , CO_CD
             , DIDY_DV_CD
             , SORT_DV_VAL
             , WARE_ADR_ID
             , BLD_CD
             , WARE_USE_YN
             , ADR_USE_YN
             , APY_STRTDT
             , APY_ENDDT
             , RMK_CN
             , DTA_DL_YN
             <include refid="COMMON.insertSystemFieldValue"/>
         FROM TB_SVST_MCBY_WARE_IZ
        WHERE APY_YM=TO_CHAR(TO_DATE(#{baseYm},'YYYYMM'),'YYYYMM')

    </insert>

    <select id="selectWarehouseOgs"
            resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaWarehouseOrganizationDto$SearchRes">
        SELECT B.APY_YM AS APY_YM       /* 적용년월 */
             , B.WARE_DV_CD AS WARE_DV_CD    /* 창고구분코드 */
             , B.WARE_DTL_DV_CD AS WARE_DTL_DV_CD
             , B.WARE_LOCARA_CD AS WARE_LOCARA_CD
             , B.WARE_LOCARA_SN AS WARE_LOCARA_SN
             , B.HGR_WARE_NO AS HGR_WARE_NO
             , A.WARE_NM AS HGR_WARE_NM
             , B.WARE_NO AS WARE_NO
             , B.WARE_NM AS WARE_NM
             , B.WARE_MNGT_PRTNR_NO AS WARE_MNGT_PRTNR_NO
             , B.DIDY_DV_CD AS DIDY_DV_CD
             , B.WARE_ADR_ID AS WARE_ADR_ID
             , B.WARE_USE_YN AS WARE_USE_YN
             , ( SELECT PRTNR_KNM
                   FROM TB_OGBS_MM_PRTNR_IZ A
                  WHERE A.PRTNR_NO = B.WARE_MNGT_PRTNR_NO
                    AND A.BASE_YM = B.APY_YM
                    AND A.OG_TP_CD IN ('W02', 'W06')) AS WARE_STOC_MGR
             , (SELECT A.BLD_NM
                  FROM TB_OGBS_MM_OG_IZ A
                     , TB_OGBS_MM_PRTNR_IZ C
                 WHERE A.OG_ID = C.OG_ID
                   AND A.BASE_YM = C.BASE_YM
                   AND C.OG_TP_CD IN ('W02','W06')
                   AND C.PRTNR_NO = B.WARE_MNGT_PRTNR_NO
                   AND C.BASE_YM = B.APY_YM ) AS BLD_NM
          FROM TB_SVST_MCBY_WARE_IZ B
             , TB_SVST_MCBY_WARE_IZ A
         WHERE 1 = 1
           AND B.APY_YM = #{baseYm}
           AND B.HGR_WARE_NO = A.WARE_NO
           AND B.APY_YM = A.APY_YM
         <if test="@MybatisUtils@isNotEmpty(wareDtlDvCd)">
           AND B.WARE_DTL_DV_CD = #{wareDtlDvCd}
         </if>
         <if test="@MybatisUtils@isNotEmpty(wareMngtPrtnrNo)">
           AND B.WARE_MNGT_PRTNR_NO = #{wareMngtPrtnrNo}
         </if>
         <if test="@MybatisUtils@isNotEmpty(wareDvCd)">
           AND B.WARE_DV_CD = #{wareDvCd}
         </if>
         <if test="@MybatisUtils@isNotEmpty(wareNoM)">
           AND (B.HGR_WARE_NO = #{wareNoM} or B.WARE_NO = #{wareNoM})
         </if>
         <if test="@MybatisUtils@isNotEmpty(wareNoD)">
           AND B.WARE_NO = #{wareNoD}
         </if>
         <if test="@MybatisUtils@isNotEmpty(codeUseYn)">
           AND B.WARE_USE_YN = #{codeUseYn}
         </if>
            /*AND B.WARE_NO = '305821'*/
         ORDER BY B.WARE_DV_CD, B.HGR_WARE_NO, B.WARE_NM, B.WARE_LOCARA_CD, B.WARE_LOCARA_SN, B.WARE_DTL_DV_CD

    </select>
    <select id="selectWareCarriedCounter" resultType="integer">
        SELECT COUNT(WARE_LOCARA_CD || WARE_LOCARA_SN || WARE_ICHR_NO) AS CNT
          FROM TB_SVST_MCBY_WARE_IZ
         WHERE APY_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{baseYm}, 'YYYYMM'), 1), 'YYYYMM')
    </select>

</mapper>
