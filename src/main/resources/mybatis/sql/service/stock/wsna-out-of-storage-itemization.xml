<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaOutOfStorageItemizationMapper">

    <select id="selectOutOfStorageItemizations" resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaOutOfStorageItemizationDto$SearchRes">
        <if test='@MybatisUtils@isNotEmpty(divide) and @MybatisUtils@equals(divide, "0")'>
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                 , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                 , OSTR_IZ.OSTR_DT   --출고일자
                 , OSTR_IZ.OSTR_SN -- 출고일련번호
                 , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                 , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                        THEN ''
                        ELSE OSTR_IZ.ITM_STR_NO
                    END AS ITM_STR_NO --품목입고번호
                 , OSTR_IZ.STR_WARE_NO   --입고창고번호
                 , WARE_IZ.WARE_NM -- 창고명
                 , WARE_IZ.WARE_ADR_ID -- 창고주소ID
            --     , ADR_BAS.NEW_ADR_ZIP
            --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
            --     , ADR_BAS.RNADR
            --     , ADR_BAS.RDADR
              FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
              LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
               AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
            --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
            --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
              WHERE 1 = 1
                AND SUBSTR(OSTR_IZ.OSTR_AK_NO,1,3) = '110'
                AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
               <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                   AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                   AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                   AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
               </if>
              GROUP BY OSTR_TP_CD
                     , OSTR_WARE_NO
                     , OSTR_DT
                     , OSTR_SN
                     , ITM_OSTR_NO
                     , SELL_RCPDT
                     , ITM_STR_NO
                     , STR_TP_CD
                     , STR_WARE_NO
                     , WARE_NM
                     , WARE_ADR_ID
            --	     , RNADR
            --	     , RDADR
            UNION ALL
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                 , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                 , OSTR_IZ.OSTR_DT   --출고일자
                 , OSTR_IZ.OSTR_SN -- 출고일련번호
                 , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                 , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                        THEN ''
                        ELSE OSTR_IZ.ITM_STR_NO
                    END AS ITM_STR_NO --품목입고번호
                 , OSTR_IZ.STR_WARE_NO   --입고창고번호
                 , WARE_IZ.WARE_NM -- 창고명
                 , WARE_IZ.WARE_ADR_ID -- 창고주소ID
            --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
            --     , ADR_BAS.RNADR
            --     , ADR_BAS.RDADR
              FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
              LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
               AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
            --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
            --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
              WHERE 1 = 1
                AND SUBSTR(OSTR_IZ.OSTR_AK_NO,1,3) IN ('310','320','360','261')
                AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
               <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                   AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                   AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                   AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
               </if>
              GROUP BY OSTR_TP_CD
                     , OSTR_WARE_NO
                     , OSTR_DT
                     , OSTR_SN
                     , ITM_OSTR_NO
                     , SELL_RCPDT
                     , ITM_STR_NO
                     , STR_TP_CD
                     , STR_WARE_NO
                     , WARE_NM
                     , WARE_ADR_ID
            --	     , RNADR
            --	     , RDADR
            UNION ALL
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                     , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                     , OSTR_IZ.OSTR_DT   --출고일자
                     , OSTR_IZ.OSTR_SN -- 출고일련번호
                     , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                     , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                            THEN ''
                            ELSE OSTR_IZ.ITM_STR_NO
                        END AS ITM_STR_NO --품목입고번호
                     , OSTR_IZ.STR_WARE_NO   --입고창고번호
                     , WARE_IZ.WARE_NM -- 창고명
                     , WARE_IZ.WARE_ADR_ID -- 창고주소ID
                --     , ADR_BAS.NEW_ADR_ZIP
                --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
                --     , ADR_BAS.RNADR
                --     , ADR_BAS.RDADR
                  FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
                  LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                    ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
                   AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
                --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
                --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
                  WHERE 1 = 1
                    AND SUBSTR(OSTR_IZ.OSTR_AK_NO,1,3) = '262'
                    AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                    AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
                   <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                       AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
                   </if>
                   <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                       AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
                   </if>
                   <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                       AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
                   </if>
                  GROUP BY OSTR_TP_CD
                         , OSTR_WARE_NO
                         , OSTR_DT
                         , OSTR_SN
                         , ITM_OSTR_NO
                         , SELL_RCPDT
                         , ITM_STR_NO
                         , STR_TP_CD
                         , STR_WARE_NO
                         , WARE_NM
                         , WARE_ADR_ID
                --	     , RNADR
                --	     , RDADR
            UNION ALL
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                     , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                     , OSTR_IZ.OSTR_DT   --출고일자
                     , OSTR_IZ.OSTR_SN -- 출고일련번호
                     , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                     , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                            THEN ''
                            ELSE OSTR_IZ.ITM_STR_NO
                        END AS ITM_STR_NO --품목입고번호
                     , OSTR_IZ.STR_WARE_NO   --입고창고번호
                     , '' AS WARE_NM -- 창고명
                     , '' AS WARE_ADR_ID -- 창고주소ID
                --     , ADR_BAS.NEW_ADR_ZIP
                --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
                --     , ADR_BAS.RNADR
                --     , ADR_BAS.RDADR
                  FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
                  WHERE 1 = 1
                    AND OSTR_IZ.OSTR_TP_CD IN ('211', '212', '217')
                    AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                    AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
                  GROUP BY OSTR_TP_CD
                         , OSTR_WARE_NO
                         , OSTR_DT
                         , OSTR_SN
                         , ITM_OSTR_NO
                         , SELL_RCPDT
                         , ITM_STR_NO
                         , STR_TP_CD
                         , STR_WARE_NO
                  ORDER BY ITM_OSTR_NO
        </if>
        <if test='@MybatisUtils@isNotEmpty(divide) and @MybatisUtils@equals(divide, "1")'>
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                 , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                 , OSTR_IZ.OSTR_DT   --출고일자
                 , OSTR_IZ.OSTR_SN -- 출고일련번호
                 , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                 , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                        THEN ''
                        ELSE OSTR_IZ.ITM_STR_NO
                    END AS ITM_STR_NO --품목입고번호
                 , OSTR_IZ.STR_WARE_NO   --입고창고번호
                 , WARE_IZ.WARE_NM -- 창고명
                 , WARE_IZ.WARE_ADR_ID -- 창고주소ID
            --     , ADR_BAS.NEW_ADR_ZIP
            --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
            --     , ADR_BAS.RNADR
            --     , ADR_BAS.RDADR
              FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
              LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
               AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
            --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
            --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
              WHERE 1 = 1
                AND SUBSTR(OSTR_IZ.OSTR_AK_NO,1,3) = '110'
                AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
               <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                   AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                   AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                   AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
               </if>
              GROUP BY OSTR_TP_CD
                     , OSTR_WARE_NO
                     , OSTR_DT
                     , OSTR_SN
                     , ITM_OSTR_NO
                     , SELL_RCPDT
                     , ITM_STR_NO
                     , STR_TP_CD
                     , STR_WARE_NO
                     , WARE_NM
                     , WARE_ADR_ID
            --	     , RNADR
            --	     , RDADR
            UNION ALL
            SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                 , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                 , OSTR_IZ.OSTR_DT   --출고일자
                 , OSTR_IZ.OSTR_SN -- 출고일련번호
                 , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                 , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                        THEN ''
                        ELSE OSTR_IZ.ITM_STR_NO
                    END AS ITM_STR_NO --품목입고번호
                 , OSTR_IZ.STR_WARE_NO   --입고창고번호
                 , WARE_IZ.WARE_NM -- 창고명
                 , WARE_IZ.WARE_ADR_ID -- 창고주소ID
            --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
            --     , ADR_BAS.RNADR
            --     , ADR_BAS.RDADR
              FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
              LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
               AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
            --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
            --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
              WHERE 1 = 1
                AND SUBSTR(OSTR_IZ.OSTR_AK_NO,1,3) = '310'
                AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
               <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                   AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                   AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                   AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
               </if>
              GROUP BY OSTR_TP_CD
                     , OSTR_WARE_NO
                     , OSTR_DT
                     , OSTR_SN
                     , ITM_OSTR_NO
                     , SELL_RCPDT
                     , ITM_STR_NO
                     , STR_TP_CD
                     , STR_WARE_NO
                     , WARE_NM
                     , WARE_ADR_ID
            --	     , RNADR
            --	     , RDADR
    </if>
    <if test='@MybatisUtils@isNotEmpty(divide) and @MybatisUtils@equals(divide, "2") or @MybatisUtils@equals(divide, "3")'>
        SELECT OSTR_IZ.OSTR_TP_CD    --출고유형
                 , OSTR_IZ.OSTR_WARE_NO  --출고창고번호
                 , OSTR_IZ.OSTR_DT   --출고일자
                 , OSTR_IZ.OSTR_SN -- 출고일련번호
                 , OSTR_IZ.ITM_OSTR_NO -- 품목출고번호
                 , CASE WHEN OSTR_IZ.SELL_RCPDT IS NULL
                        THEN ''
                        ELSE OSTR_IZ.ITM_STR_NO
                    END AS ITM_STR_NO --품목입고번호
                 , OSTR_IZ.STR_WARE_NO   --입고창고번호
                 , WARE_IZ.WARE_NM -- 창고명
                 , WARE_IZ.WARE_ADR_ID -- 창고주소ID
            --     , ADR_BAS.NEW_ADR_ZIP
            --	 , CONCAT(CONCAT(A.RNADR,' '),A.RDADR) AS ADR_ID
            --     , ADR_BAS.RNADR
            --     , ADR_BAS.RDADR
              FROM TB_SVST_ITM_OSTR_IZ OSTR_IZ
              LEFT OUTER JOIN TB_SVST_MCBY_WARE_IZ WARE_IZ
                ON WARE_IZ.WARE_NO = OSTR_IZ.STR_WARE_NO
               AND WARE_IZ.APY_YM = SUBSTR(OSTR_IZ.OSTR_DT,1,6)
            --  INNER JOIN TB_GBCO_ADR_BAS ADR_BAS
            --    ON ADR_BAS.ADR_ID = WARE_IZ.WARE_ADR_ID
              WHERE 1 = 1
                AND OSTR_IZ.OSTR_TP_CD = #{ostrTpCd}
                AND OSTR_IZ.OSTR_WARE_NO='200371' --출고창고번호
                AND OSTR_IZ.OSTR_DT BETWEEN #{stOstrDt} AND #{edOstrDt}
               <if test="@MybatisUtils@isNotEmpty(ostrWareDvCd)">
                   AND WARE_IZ.WARE_DV_CD = #{ostrWareDvCd}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoD)">
                   AND WARE_IZ.HGR_WARE_NO = #{ostrWareNoD}
               </if>
               <if test="@MybatisUtils@isNotEmpty(ostrWareNoM)">
                   AND OSTR_IZ.STR_WARE_NO = #{ostrWareNoM}
               </if>
              GROUP BY OSTR_TP_CD
                     , OSTR_WARE_NO
                     , OSTR_DT
                     , OSTR_SN
                     , ITM_OSTR_NO
                     , SELL_RCPDT
                     , ITM_STR_NO
                     , STR_TP_CD
                     , STR_WARE_NO
                     , WARE_NM
                     , WARE_ADR_ID
            --	     , RNADR
            --	     , RDADR
              ORDER BY ITM_OSTR_NO
    </if>
</select>
</mapper>
