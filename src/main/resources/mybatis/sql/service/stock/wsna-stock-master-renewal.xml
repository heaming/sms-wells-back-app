<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaStockMasterRenewalMapper">

    <update id="updateBaseTermDateStocks">
         MERGE INTO TB_SVST_MCITM_STOC_IZ TB_TGT   /* 월별품목재고내역 */
         USING
             (
               SELECT D2.BASE_YM              /* 기준년월 */
                    , D2.WARE_NO              /* 창고번호 */
                    , D2.ITM_PD_CD            /* 품목상품코드 */
                    , D1.PITM_STOC_A_GD_QTY   /* 시점재고A등급수량 */
                    , D1.PITM_STOC_B_GD_QTY   /* 시점재고B등급수량 */
                    , D1.PITM_STOC_E_GD_QTY   /* 시점재고E등급수량 */
                    , D1.PITM_STOC_R_GD_QTY   /* 시점재고R등급수량 */
                 FROM TB_SVST_MCITM_STOC_IZ D1        /* 월별품목재고내역 */
                INNER JOIN TB_SVST_MCITM_STOC_IZ D2   /* 월별품목재고내역 */
                   ON D2.WARE_NO   = D1.WARE_NO
                  AND D2.ITM_PD_CD = D1.ITM_PD_CD
                  AND D2.BASE_YM   = #{mngtYm}
                WHERE D1.DTA_DL_YN = 'N'
                  AND D2.DTA_DL_YN = 'N'
                  AND D1.BASE_YM   = TO_CHAR(ADD_MONTHS(TO_DATE(#{mngtYm}, 'YYYYMM'), -1), 'YYYYMM')
                  AND D2.WARE_NO LIKE #{wareDvCd} || '%'
                  AND (    NVL(D2.BTD_STOC_A_GD_QTY, 0) <![CDATA[<>]]> NVL(D1.PITM_STOC_A_GD_QTY, 0)
                        OR NVL(D2.BTD_STOC_B_GD_QTY, 0) <![CDATA[<>]]> NVL(D1.PITM_STOC_B_GD_QTY, 0)
                        OR NVL(D2.BTD_STOC_E_GD_QTY, 0) <![CDATA[<>]]> NVL(D1.PITM_STOC_E_GD_QTY, 0)
                        OR NVL(D2.BTD_STOC_R_GD_QTY, 0) <![CDATA[<>]]> NVL(D1.PITM_STOC_R_GD_QTY, 0) )
             ) TB_SRC
            ON
             (     TB_TGT.BASE_YM   = TB_SRC.BASE_YM
               AND TB_TGT.WARE_NO   = TB_SRC.WARE_NO
               AND TB_TGT.ITM_PD_CD = TB_SRC.ITM_PD_CD
               AND TB_TGT.DTA_DL_YN = 'N'
             )
          WHEN MATCHED THEN
        UPDATE
           SET TB_TGT.BTD_STOC_A_GD_QTY = TB_SRC.PITM_STOC_A_GD_QTY   /* 기초재고A등급수량 */
             , TB_TGT.BTD_STOC_B_GD_QTY = TB_SRC.PITM_STOC_B_GD_QTY   /* 기초재고B등급수량 */
             , TB_TGT.BTD_STOC_E_GD_QTY = TB_SRC.PITM_STOC_E_GD_QTY   /* 기초재고E등급수량 */
             , TB_TGT.BTD_STOC_R_GD_QTY = TB_SRC.PITM_STOC_R_GD_QTY   /* 기초재고R등급수량 */
        <include refid="COMMON.updateSystemField"/>
    </update>

    <update id="updateMonthlyStocks">
         MERGE INTO TB_SVST_MCITM_STOC_IZ TB_TGT   /* 월별품목재고내역 */
         USING
             (
               SELECT S1.BASE_YM                                                         /* 기준년월 */
                    , S1.WARE_NO                                                         /* 창고번호 */
                    , S1.ITM_PD_CD                                                       /* 품목상품코드 */
                    , S1.NEW_PITM_STOC_A_GD_QTY              AS NEW_PITM_STOC_A_GD_QTY   /* 시점재고A등급수량, 시점재고는 마이너스일 수 있음 */
                    , S1.NEW_PITM_STOC_B_GD_QTY              AS NEW_PITM_STOC_B_GD_QTY   /* 시점재고B등급수량, 시점재고는 마이너스일 수 있음 */
                    , S1.NEW_PITM_STOC_E_GD_QTY              AS NEW_PITM_STOC_E_GD_QTY   /* 시점재고E등급수량, 시점재고는 마이너스일 수 있음 */
                    , S1.NEW_PITM_STOC_R_GD_QTY              AS NEW_PITM_STOC_R_GD_QTY   /* 시점재고R등급수량, 시점재고는 마이너스일 수 있음 */
                    , S1.NEW_PRCHS_STR_QTY                                               /* 구매입고수량 */
                    , S1.NEW_PRCHS_STR_B_GD_QTY                                          /* 구매입고B등급수량 */
                    , S1.NEW_NOM_STR_A_GD_QTY                                            /* 정상입고A등급수량 */
                    , S1.NEW_NOM_STR_B_GD_QTY                                            /* 정상입고B등급수량 */
                    , S1.NEW_NOM_STR_E_GD_QTY                                            /* 정상입고E등급수량 */
                    , S1.NEW_NOM_STR_R_GD_QTY                                            /* 정상입고R등급수량 */
                    , S1.NEW_QOM_ASN_STR_A_GD_QTY                                        /* 물량배정입고A등급수량 */
                    , S1.NEW_QOM_ASN_STR_B_GD_QTY                                        /* 물량배정입고B등급수량 */
                    , S1.NEW_QOM_ASN_STR_E_GD_QTY                                        /* 물량배정입고E등급수량 */
                    , S1.NEW_QOM_ASN_STR_R_GD_QTY                                        /* 물량배정입고R등급수량 */
                    , S1.NEW_QOM_MMT_STR_A_GD_QTY                                        /* 물량이동입고A등급수량 */
                    , S1.NEW_QOM_MMT_STR_B_GD_QTY                                        /* 물량이동입고B등급수량 */
                    , S1.NEW_QOM_MMT_STR_E_GD_QTY                                        /* 물량이동입고E등급수량 */
                    , S1.NEW_QOM_MMT_STR_R_GD_QTY                                        /* 물량이동입고R등급수량 */
                    , S1.NEW_RTNGD_STR_INSI_A_GD_QTY                                     /* 반품입고내부A등급수량 */
                    , S1.NEW_RTNGD_STR_INSI_B_GD_QTY                                     /* 반품입고내부B등급수량 */
                    , S1.NEW_RTNGD_STR_INSI_E_GD_QTY                                     /* 반품입고내부E등급수량 */
                    , S1.NEW_RTNGD_STR_INSI_R_GD_QTY                                     /* 반품입고내부R등급수량 */
                    , S1.NEW_RTNGD_STR_OTSD_A_GD_QTY                                     /* 반품입고외부A등급수량, 반품입고수량 포함 */
                    , S1.NEW_RTNGD_STR_OTSD_B_GD_QTY                                     /* 반품입고외부B등급수량, 반품입고수량 포함 */
                    , S1.NEW_RTNGD_STR_OTSD_E_GD_QTY                                     /* 반품입고외부E등급수량, 반품입고수량 포함 */
                    , S1.NEW_RTNGD_STR_OTSD_R_GD_QTY                                     /* 반품입고외부R등급수량, 반품입고수량 포함 */
                    , S1.NEW_ETC_STR_A_GD_QTY                                            /* 기타입고A등급수량 */
                    , S1.NEW_ETC_STR_E_GD_QTY                                            /* 기타입고E등급수량 */
                    , S1.NEW_ETC_STR_A_GD_QTY1                                           /* 기타입고1A등급수량 = 등급조정입고수량 */
                    , S1.NEW_ETC_STR_B_GD_QTY1                                           /* 기타입고1B등급수량 = 등급조정입고수량 */
                    , S1.NEW_ETC_STR_E_GD_QTY1                                           /* 기타입고1E등급수량 = 등급조정입고수량  */
                    , S1.NEW_ETC_STR_R_GD_QTY1                                           /* 기타입고1R등급수량 = 등급조정입고수량 */
                    , S1.NEW_NOM_OSTR_A_GD_QTY                                           /* 정상출고A등급수량 */
                    , S1.NEW_NOM_OSTR_B_GD_QTY                                           /* 정상출고B등급수량 */
                    , S1.NEW_NOM_OSTR_E_GD_QTY                                           /* 정상출고E등급수량 */
                    , S1.NEW_NOM_OSTR_R_GD_QTY                                           /* 정상출고R등급수량 */
                    , S1.NEW_QOM_ASN_OSTR_A_GD_QTY                                       /* 물량배정출고A등급수량 */
                    , S1.NEW_QOM_ASN_OSTR_B_GD_QTY                                       /* 물량배정출고B등급수량 */
                    , S1.NEW_QOM_ASN_OSTR_E_GD_QTY                                       /* 물량배정출고E등급수량 */
                    , S1.NEW_QOM_ASN_OSTR_R_GD_QTY                                       /* 물량배정출고R등급수량 */
                    , S1.NEW_QOM_MMT_OSTR_A_GD_QTY                                       /* 물량이동출고A등급수량 */
                    , S1.NEW_QOM_MMT_OSTR_B_GD_QTY                                       /* 물량이동출고B등급수량 */
                    , S1.NEW_QOM_MMT_OSTR_E_GD_QTY                                       /* 물량이동출고E등급수량 */
                    , S1.NEW_QOM_MMT_OSTR_R_GD_QTY                                       /* 물량이동출고R등급수량 */
                    , S1.NEW_RTNGD_OSTR_INSI_A_GD_QTY                                    /* 반품출고내부A등급수량 */
                    , S1.NEW_RTNGD_OSTR_INSI_B_GD_QTY                                    /* 반품출고내부B등급수량 */
                    , S1.NEW_RTNGD_OSTR_INSI_E_GD_QTY                                    /* 반품출고내부E등급수량 */
                    , S1.NEW_RTNGD_OSTR_INSI_R_GD_QTY                                    /* 반품출고내부R등급수량 */
                    , S1.NEW_RTNGD_OSTR_OTSD_A_GD_QTY                                    /* 반품출고외부A등급수량 */
                    , S1.NEW_RTNGD_OSTR_OTSD_B_GD_QTY                                    /* 반품출고외부B등급수량 */
                    , S1.NEW_RTNGD_OSTR_OTSD_E_GD_QTY                                    /* 반품출고외부E등급수량 */
                    , S1.NEW_RTNGD_OSTR_OTSD_R_GD_QTY                                    /* 반품출고외부R등급수량 */
                    , S1.NEW_SELL_OSTR_QTY                                               /* 판매출고수량 */
                    , S1.NEW_SELL_OSTR_B_GD_QTY                                          /* 판매출고B등급수량 */
                    , S1.NEW_DSU_OSTR_A_GD_QTY                                           /* 폐기출고A등급수량 */
                    , S1.NEW_DSU_OSTR_B_GD_QTY                                           /* 폐기출고B등급수량 */
                    , S1.NEW_DSU_OSTR_E_GD_QTY                                           /* 폐기출고E등급수량 */
                    , S1.NEW_DSU_OSTR_R_GD_QTY                                           /* 폐기출고R등급수량 */
                    , S1.NEW_ETC_OSTR_A_GD_QTY                                           /* 기타출고A등급수량 */
                    , S1.NEW_ETC_OSTR_B_GD_QTY                                           /* 기타출고B등급수량 */
                    , S1.NEW_ETC_OSTR_E_GD_QTY                                           /* 기타출고E등급수량 */
                    , S1.NEW_ETC_OSTR_R_GD_QTY                                           /* 기타출고R등급수량 */
                    , S1.NEW_REFR_OSTR_A_GD_QTY                                          /* 리퍼출고A등급수량 */
                    , S1.NEW_REFR_OSTR_B_GD_QTY                                          /* 리퍼출고B등급수량 */
                    , S1.NEW_REFR_OSTR_E_GD_QTY                                          /* 리퍼출고E등급수량 */
                    , S1.NEW_REFR_OSTR_R_GD_QTY                                          /* 리퍼출고R등급수량 */
                    , S1.NEW_ETC_OSTR_A_GD_QTY1                                          /* 기타출고1A등급수량 = 등급조정출고수량 */
                    , S1.NEW_ETC_OSTR_B_GD_QTY1                                          /* 기타출고1B등급수량 = 등급조정출고수량 */
                    , S1.NEW_ETC_OSTR_E_GD_QTY1                                          /* 기타출고1E등급수량 = 등급조정출고수량 */
                    , S1.NEW_ETC_OSTR_R_GD_QTY1                                          /* 기타출고1R등급수량 = 등급조정출고수량 */
                    , S1.NEW_WK_OSTR_A_GD_QTY                                            /* 작업출고A등급수량 */
                    , S1.NEW_WK_OSTR_B_GD_QTY                                            /* 작업출고B등급수량 */
                    , S1.NEW_WK_OSTR_E_GD_QTY                                            /* 작업출고E등급수량 */
                    , S1.NEW_WK_OSTR_R_GD_QTY                                            /* 작업출고R등급수량 */
                 FROM
                    (
                      SELECT T1.BASE_YM
                           , T1.WARE_NO
                           , T1.ITM_PD_CD
                           , ( NVL(T1.BTD_STOC_A_GD_QTY, 0) + NVL(T1.STOC_ACINSP_STR_A_GD_QTY, 0) + NVL(T2.PRCHS_STR_QTY, 0)
                               + NVL(T2.NOM_STR_A_GD_QTY, 0) + NVL(T2.QOM_ASN_STR_A_GD_QTY, 0) + NVL(T2.QOM_MMT_STR_A_GD_QTY, 0)
                               + NVL(T2.RTNGD_STR_INSI_A_GD_QTY, 0) + NVL(T2.RTNGD_STR_OTSD_A_GD_QTY, 0) + NVL(T2.ETC_STR_A_GD_QTY, 0)
                               + NVL(T3.WK_STR_A_QTY, 0) + NVL(T4.ETC_STR_A_GD_QTY1, 0) )
                             - ( NVL(T1.STOC_ACINSP_OSTR_A_GD_QTY, 0) + NVL(T5.NOM_OSTR_A_GD_QTY, 0) + NVL(T5.QOM_ASN_OSTR_A_GD_QTY, 0)
                                 + NVL(T5.QOM_MMT_OSTR_A_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_INSI_A_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_OTSD_A_GD_QTY, 0)
                                 + NVL(T5.SELL_OSTR_QTY, 0) + NVL(T5.DSU_OSTR_A_GD_QTY, 0) + NVL(T5.ETC_OSTR_A_GD_QTY, 0) + NVL(T5.REFR_OSTR_A_GD_QTY, 0)
                                 + NVL(T6.WK_OSTR_A_GD_QTY, 0) + NVL(T7.ETC_OSTR_A_GD_QTY1, 0) ) AS NEW_PITM_STOC_A_GD_QTY
                           , NVL(T1.PITM_STOC_A_GD_QTY, 0)                                       AS PITM_STOC_A_GD_QTY
                           , ( NVL(T1.BTD_STOC_B_GD_QTY, 0) + NVL(T1.STOC_ACINSP_STR_B_GD_QTY, 0) + NVL(T2.PRCHS_STR_B_GD_QTY, 0)
                               + NVL(T2.NOM_STR_B_GD_QTY, 0) + NVL(T2.QOM_ASN_STR_B_GD_QTY, 0) + NVL(T2.QOM_MMT_STR_B_GD_QTY, 0)
                               + NVL(T2.RTNGD_STR_INSI_B_GD_QTY, 0) + NVL(T2.RTNGD_STR_OTSD_B_GD_QTY, 0) + NVL(T3.WK_STR_B_QTY, 0) + NVL(T4.ETC_STR_B_GD_QTY1, 0) )
                             - ( NVL(T1.STOC_ACINSP_OSTR_B_GD_QTY, 0) + NVL(T5.NOM_OSTR_B_GD_QTY, 0) + NVL(T5.QOM_ASN_OSTR_B_GD_QTY, 0)
                                 + NVL(T5.QOM_MMT_OSTR_B_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_INSI_B_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_OTSD_B_GD_QTY, 0)
                                 + NVL(T5.SELL_OSTR_B_GD_QTY, 0) + NVL(T5.DSU_OSTR_B_GD_QTY, 0) + NVL(T5.ETC_OSTR_B_GD_QTY, 0) + NVL(T5.REFR_OSTR_B_GD_QTY, 0)
                                 + NVL(T6.WK_OSTR_B_GD_QTY, 0) + NVL(T7.ETC_OSTR_B_GD_QTY1, 0) ) AS NEW_PITM_STOC_B_GD_QTY
                           , NVL(T1.PITM_STOC_B_GD_QTY, 0)                                       AS PITM_STOC_B_GD_QTY
                           , ( NVL(T1.BTD_STOC_E_GD_QTY, 0) + NVL(T1.STOC_ACINSP_STR_E_GD_QTY, 0)
                               + NVL(T2.NOM_STR_E_GD_QTY, 0) + NVL(T2.QOM_ASN_STR_E_GD_QTY, 0) + NVL(T2.QOM_MMT_STR_E_GD_QTY, 0)
                               + NVL(T2.RTNGD_STR_INSI_E_GD_QTY, 0) + NVL(T2.RTNGD_STR_OTSD_E_GD_QTY, 0) + NVL(T2.ETC_STR_E_GD_QTY, 0)
                               + NVL(T3.WK_STR_E_QTY, 0) + NVL(T4.ETC_STR_E_GD_QTY1, 0) )
                             - ( NVL(T1.STOC_ACINSP_OSTR_E_GD_QTY, 0) + NVL(T5.NOM_OSTR_E_GD_QTY, 0) + NVL(T5.QOM_ASN_OSTR_E_GD_QTY, 0)
                                 + NVL(T5.QOM_MMT_OSTR_E_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_INSI_E_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_OTSD_E_GD_QTY, 0)
                                 + NVL(T5.DSU_OSTR_E_GD_QTY, 0) + NVL(T5.ETC_OSTR_E_GD_QTY, 0) + NVL(T5.REFR_OSTR_E_GD_QTY, 0)
                                 + NVL(T6.WK_OSTR_E_GD_QTY, 0) + NVL(T7.ETC_OSTR_E_GD_QTY1, 0) ) AS NEW_PITM_STOC_E_GD_QTY
                           , NVL(T1.PITM_STOC_E_GD_QTY, 0)                                       AS PITM_STOC_E_GD_QTY
                           , ( NVL(T1.BTD_STOC_R_GD_QTY, 0) + NVL(T1.STOC_ACINSP_STR_R_GD_QTY, 0)
                               + NVL(T2.NOM_STR_R_GD_QTY, 0) + NVL(T2.QOM_ASN_STR_R_GD_QTY, 0) + NVL(T2.QOM_MMT_STR_R_GD_QTY, 0)
                               + NVL(T2.RTNGD_STR_INSI_R_GD_QTY, 0) + NVL(T2.RTNGD_STR_OTSD_R_GD_QTY, 0) + NVL(T3.WK_STR_R_QTY, 0) + NVL(T4.ETC_STR_R_GD_QTY1, 0) )
                             - ( NVL(T1.STOC_ACINSP_OSTR_R_GD_QTY, 0) + NVL(T5.NOM_OSTR_R_GD_QTY, 0) + NVL(T5.QOM_ASN_OSTR_R_GD_QTY, 0)
                                 + NVL(T5.QOM_MMT_OSTR_R_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_INSI_R_GD_QTY, 0) + NVL(T5.RTNGD_OSTR_OTSD_R_GD_QTY, 0)
                                 + NVL(T5.DSU_OSTR_R_GD_QTY, 0) + NVL(T5.ETC_OSTR_R_GD_QTY, 0) + NVL(T5.REFR_OSTR_R_GD_QTY, 0)
                                 + NVL(T6.WK_OSTR_R_GD_QTY, 0) + NVL(T7.ETC_OSTR_R_GD_QTY1, 0) ) AS NEW_PITM_STOC_R_GD_QTY
                           , NVL(T1.PITM_STOC_R_GD_QTY, 0)                                       AS PITM_STOC_R_GD_QTY
                           , NVL(T2.PRCHS_STR_QTY, 0)                                            AS NEW_PRCHS_STR_QTY
                           , NVL(T1.PRCHS_STR_QTY, 0)                                            AS PRCHS_STR_QTY
                           , NVL(T2.PRCHS_STR_B_GD_QTY, 0)                                       AS NEW_PRCHS_STR_B_GD_QTY
                           , NVL(T1.PRCHS_STR_B_GD_QTY, 0)                                       AS PRCHS_STR_B_GD_QTY
                           , NVL(T2.NOM_STR_A_GD_QTY, 0)                                         AS NEW_NOM_STR_A_GD_QTY
                           , NVL(T1.NOM_STR_A_GD_QTY, 0)                                         AS NOM_STR_A_GD_QTY
                           , NVL(T2.NOM_STR_B_GD_QTY, 0)                                         AS NEW_NOM_STR_B_GD_QTY
                           , NVL(T1.NOM_STR_B_GD_QTY, 0)                                         AS NOM_STR_B_GD_QTY
                           , NVL(T2.NOM_STR_E_GD_QTY, 0)                                         AS NEW_NOM_STR_E_GD_QTY
                           , NVL(T1.NOM_STR_E_GD_QTY, 0)                                         AS NOM_STR_E_GD_QTY
                           , NVL(T2.NOM_STR_R_GD_QTY, 0)                                         AS NEW_NOM_STR_R_GD_QTY
                           , NVL(T1.NOM_STR_R_GD_QTY, 0)                                         AS NOM_STR_R_GD_QTY
                           , NVL(T2.QOM_ASN_STR_A_GD_QTY, 0)                                     AS NEW_QOM_ASN_STR_A_GD_QTY
                           , NVL(T1.QOM_ASN_STR_A_GD_QTY, 0)                                     AS QOM_ASN_STR_A_GD_QTY
                           , NVL(T2.QOM_ASN_STR_B_GD_QTY, 0)                                     AS NEW_QOM_ASN_STR_B_GD_QTY
                           , NVL(T1.QOM_ASN_STR_B_GD_QTY, 0)                                     AS QOM_ASN_STR_B_GD_QTY
                           , NVL(T2.QOM_ASN_STR_E_GD_QTY, 0)                                     AS NEW_QOM_ASN_STR_E_GD_QTY
                           , NVL(T1.QOM_ASN_STR_E_GD_QTY, 0)                                     AS QOM_ASN_STR_E_GD_QTY
                           , NVL(T2.QOM_ASN_STR_R_GD_QTY, 0)                                     AS NEW_QOM_ASN_STR_R_GD_QTY
                           , NVL(T1.QOM_ASN_STR_R_GD_QTY, 0)                                     AS QOM_ASN_STR_R_GD_QTY
                           , NVL(T2.QOM_MMT_STR_A_GD_QTY, 0)                                     AS NEW_QOM_MMT_STR_A_GD_QTY
                           , NVL(T1.QOM_MMT_STR_A_GD_QTY, 0)                                     AS QOM_MMT_STR_A_GD_QTY
                           , NVL(T2.QOM_MMT_STR_B_GD_QTY, 0)                                     AS NEW_QOM_MMT_STR_B_GD_QTY
                           , NVL(T1.QOM_MMT_STR_B_GD_QTY, 0)                                     AS QOM_MMT_STR_B_GD_QTY
                           , NVL(T2.QOM_MMT_STR_E_GD_QTY, 0)                                     AS NEW_QOM_MMT_STR_E_GD_QTY
                           , NVL(T1.QOM_MMT_STR_E_GD_QTY, 0)                                     AS QOM_MMT_STR_E_GD_QTY
                           , NVL(T2.QOM_MMT_STR_R_GD_QTY, 0)                                     AS NEW_QOM_MMT_STR_R_GD_QTY
                           , NVL(T1.QOM_MMT_STR_R_GD_QTY, 0)                                     AS QOM_MMT_STR_R_GD_QTY
                           , NVL(T2.RTNGD_STR_INSI_A_GD_QTY, 0)                                  AS NEW_RTNGD_STR_INSI_A_GD_QTY
                           , NVL(T1.RTNGD_STR_INSI_A_GD_QTY, 0)                                  AS RTNGD_STR_INSI_A_GD_QTY
                           , NVL(T2.RTNGD_STR_INSI_B_GD_QTY, 0)                                  AS NEW_RTNGD_STR_INSI_B_GD_QTY
                           , NVL(T1.RTNGD_STR_INSI_B_GD_QTY, 0)                                  AS RTNGD_STR_INSI_B_GD_QTY
                           , NVL(T2.RTNGD_STR_INSI_E_GD_QTY, 0)                                  AS NEW_RTNGD_STR_INSI_E_GD_QTY
                           , NVL(T1.RTNGD_STR_INSI_E_GD_QTY, 0)                                  AS RTNGD_STR_INSI_E_GD_QTY
                           , NVL(T2.RTNGD_STR_INSI_R_GD_QTY, 0)                                  AS NEW_RTNGD_STR_INSI_R_GD_QTY
                           , NVL(T1.RTNGD_STR_INSI_R_GD_QTY, 0)                                  AS RTNGD_STR_INSI_R_GD_QTY
                           , NVL(T2.RTNGD_STR_OTSD_A_GD_QTY, 0) + NVL(T3.WK_STR_A_QTY, 0)        AS NEW_RTNGD_STR_OTSD_A_GD_QTY
                           , NVL(T1.RTNGD_STR_OTSD_A_GD_QTY, 0)                                  AS RTNGD_STR_OTSD_A_GD_QTY
                           , NVL(T2.RTNGD_STR_OTSD_B_GD_QTY, 0) + NVL(T3.WK_STR_B_QTY, 0)        AS NEW_RTNGD_STR_OTSD_B_GD_QTY
                           , NVL(T1.RTNGD_STR_OTSD_B_GD_QTY, 0)                                  AS RTNGD_STR_OTSD_B_GD_QTY
                           , NVL(T2.RTNGD_STR_OTSD_E_GD_QTY, 0) + NVL(T3.WK_STR_E_QTY, 0)        AS NEW_RTNGD_STR_OTSD_E_GD_QTY
                           , NVL(T1.RTNGD_STR_OTSD_E_GD_QTY, 0)                                  AS RTNGD_STR_OTSD_E_GD_QTY
                           , NVL(T2.RTNGD_STR_OTSD_R_GD_QTY, 0) + NVL(T3.WK_STR_R_QTY, 0)        AS NEW_RTNGD_STR_OTSD_R_GD_QTY
                           , NVL(T1.RTNGD_STR_OTSD_R_GD_QTY, 0)                                  AS RTNGD_STR_OTSD_R_GD_QTY
                           , NVL(T2.ETC_STR_A_GD_QTY, 0)                                         AS NEW_ETC_STR_A_GD_QTY
                           , NVL(T1.ETC_STR_A_GD_QTY, 0)                                         AS ETC_STR_A_GD_QTY
                           , NVL(T2.ETC_STR_E_GD_QTY, 0)                                         AS NEW_ETC_STR_E_GD_QTY
                           , NVL(T1.ETC_STR_E_GD_QTY, 0)                                         AS ETC_STR_E_GD_QTY
                           , NVL(T4.ETC_STR_A_GD_QTY1, 0)                                        AS NEW_ETC_STR_A_GD_QTY1
                           , NVL(T1.ETC_STR_A_GD_QTY1, 0)                                        AS ETC_STR_A_GD_QTY1
                           , NVL(T4.ETC_STR_B_GD_QTY1, 0)                                        AS NEW_ETC_STR_B_GD_QTY1
                           , NVL(T1.ETC_STR_B_GD_QTY1, 0)                                        AS ETC_STR_B_GD_QTY1
                           , NVL(T4.ETC_STR_E_GD_QTY1, 0)                                        AS NEW_ETC_STR_E_GD_QTY1
                           , NVL(T1.ETC_STR_E_GD_QTY1, 0)                                        AS ETC_STR_E_GD_QTY1
                           , NVL(T4.ETC_STR_R_GD_QTY1, 0)                                        AS NEW_ETC_STR_R_GD_QTY1
                           , NVL(T1.ETC_STR_R_GD_QTY1, 0)                                        AS ETC_STR_R_GD_QTY1
                           , NVL(T5.NOM_OSTR_A_GD_QTY, 0)                                        AS NEW_NOM_OSTR_A_GD_QTY
                           , NVL(T1.NOM_OSTR_A_GD_QTY, 0)                                        AS NOM_OSTR_A_GD_QTY
                           , NVL(T5.NOM_OSTR_B_GD_QTY, 0)                                        AS NEW_NOM_OSTR_B_GD_QTY
                           , NVL(T1.NOM_OSTR_B_GD_QTY, 0)                                        AS NOM_OSTR_B_GD_QTY
                           , NVL(T5.NOM_OSTR_E_GD_QTY, 0)                                        AS NEW_NOM_OSTR_E_GD_QTY
                           , NVL(T1.NOM_OSTR_E_GD_QTY, 0)                                        AS NOM_OSTR_E_GD_QTY
                           , NVL(T5.NOM_OSTR_R_GD_QTY, 0)                                        AS NEW_NOM_OSTR_R_GD_QTY
                           , NVL(T1.NOM_OSTR_R_GD_QTY, 0)                                        AS NOM_OSTR_R_GD_QTY
                           , NVL(T5.QOM_ASN_OSTR_A_GD_QTY, 0)                                    AS NEW_QOM_ASN_OSTR_A_GD_QTY
                           , NVL(T1.QOM_ASN_OSTR_A_GD_QTY, 0)                                    AS QOM_ASN_OSTR_A_GD_QTY
                           , NVL(T5.QOM_ASN_OSTR_B_GD_QTY, 0)                                    AS NEW_QOM_ASN_OSTR_B_GD_QTY
                           , NVL(T1.QOM_ASN_OSTR_B_GD_QTY, 0)                                    AS QOM_ASN_OSTR_B_GD_QTY
                           , NVL(T5.QOM_ASN_OSTR_E_GD_QTY, 0)                                    AS NEW_QOM_ASN_OSTR_E_GD_QTY
                           , NVL(T1.QOM_ASN_OSTR_E_GD_QTY, 0)                                    AS QOM_ASN_OSTR_E_GD_QTY
                           , NVL(T5.QOM_ASN_OSTR_R_GD_QTY, 0)                                    AS NEW_QOM_ASN_OSTR_R_GD_QTY
                           , NVL(T1.QOM_ASN_OSTR_R_GD_QTY, 0)                                    AS QOM_ASN_OSTR_R_GD_QTY
                           , NVL(T5.QOM_MMT_OSTR_A_GD_QTY, 0)                                    AS NEW_QOM_MMT_OSTR_A_GD_QTY
                           , NVL(T1.QOM_MMT_OSTR_A_GD_QTY, 0)                                    AS QOM_MMT_OSTR_A_GD_QTY
                           , NVL(T5.QOM_MMT_OSTR_B_GD_QTY, 0)                                    AS NEW_QOM_MMT_OSTR_B_GD_QTY
                           , NVL(T1.QOM_MMT_OSTR_B_GD_QTY, 0)                                    AS QOM_MMT_OSTR_B_GD_QTY
                           , NVL(T5.QOM_MMT_OSTR_E_GD_QTY, 0)                                    AS NEW_QOM_MMT_OSTR_E_GD_QTY
                           , NVL(T1.QOM_MMT_OSTR_E_GD_QTY, 0)                                    AS QOM_MMT_OSTR_E_GD_QTY
                           , NVL(T5.QOM_MMT_OSTR_R_GD_QTY, 0)                                    AS NEW_QOM_MMT_OSTR_R_GD_QTY
                           , NVL(T1.QOM_MMT_OSTR_R_GD_QTY, 0)                                    AS QOM_MMT_OSTR_R_GD_QTY
                           , NVL(T5.RTNGD_OSTR_INSI_A_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_INSI_A_GD_QTY
                           , NVL(T1.RTNGD_OSTR_INSI_A_GD_QTY, 0)                                 AS RTNGD_OSTR_INSI_A_GD_QTY
                           , NVL(T5.RTNGD_OSTR_INSI_B_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_INSI_B_GD_QTY
                           , NVL(T1.RTNGD_OSTR_INSI_B_GD_QTY, 0)                                 AS RTNGD_OSTR_INSI_B_GD_QTY
                           , NVL(T5.RTNGD_OSTR_INSI_E_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_INSI_E_GD_QTY
                           , NVL(T1.RTNGD_OSTR_INSI_E_GD_QTY, 0)                                 AS RTNGD_OSTR_INSI_E_GD_QTY
                           , NVL(T5.RTNGD_OSTR_INSI_R_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_INSI_R_GD_QTY
                           , NVL(T1.RTNGD_OSTR_INSI_R_GD_QTY, 0)                                 AS RTNGD_OSTR_INSI_R_GD_QTY
                           , NVL(T5.RTNGD_OSTR_OTSD_A_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_OTSD_A_GD_QTY
                           , NVL(T1.RTNGD_OSTR_OTSD_A_GD_QTY, 0)                                 AS RTNGD_OSTR_OTSD_A_GD_QTY
                           , NVL(T5.RTNGD_OSTR_OTSD_B_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_OTSD_B_GD_QTY
                           , NVL(T1.RTNGD_OSTR_OTSD_B_GD_QTY, 0)                                 AS RTNGD_OSTR_OTSD_B_GD_QTY
                           , NVL(T5.RTNGD_OSTR_OTSD_E_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_OTSD_E_GD_QTY
                           , NVL(T1.RTNGD_OSTR_OTSD_E_GD_QTY, 0)                                 AS RTNGD_OSTR_OTSD_E_GD_QTY
                           , NVL(T5.RTNGD_OSTR_OTSD_R_GD_QTY, 0)                                 AS NEW_RTNGD_OSTR_OTSD_R_GD_QTY
                           , NVL(T1.RTNGD_OSTR_OTSD_R_GD_QTY, 0)                                 AS RTNGD_OSTR_OTSD_R_GD_QTY
                           , NVL(T5.SELL_OSTR_QTY, 0)                                            AS NEW_SELL_OSTR_QTY
                           , NVL(T1.SELL_OSTR_QTY, 0)                                            AS SELL_OSTR_QTY
                           , NVL(T5.SELL_OSTR_B_GD_QTY, 0)                                       AS NEW_SELL_OSTR_B_GD_QTY
                           , NVL(T1.SELL_OSTR_B_GD_QTY, 0)                                       AS SELL_OSTR_B_GD_QTY
                           , NVL(T5.DSU_OSTR_A_GD_QTY, 0)                                        AS NEW_DSU_OSTR_A_GD_QTY
                           , NVL(T1.DSU_OSTR_A_GD_QTY, 0)                                        AS DSU_OSTR_A_GD_QTY
                           , NVL(T5.DSU_OSTR_B_GD_QTY, 0)                                        AS NEW_DSU_OSTR_B_GD_QTY
                           , NVL(T1.DSU_OSTR_B_GD_QTY, 0)                                        AS DSU_OSTR_B_GD_QTY
                           , NVL(T5.DSU_OSTR_E_GD_QTY, 0)                                        AS NEW_DSU_OSTR_E_GD_QTY
                           , NVL(T1.DSU_OSTR_E_GD_QTY, 0)                                        AS DSU_OSTR_E_GD_QTY
                           , NVL(T5.DSU_OSTR_R_GD_QTY, 0)                                        AS NEW_DSU_OSTR_R_GD_QTY
                           , NVL(T1.DSU_OSTR_R_GD_QTY, 0)                                        AS DSU_OSTR_R_GD_QTY
                           , NVL(T5.ETC_OSTR_A_GD_QTY, 0)                                        AS NEW_ETC_OSTR_A_GD_QTY
                           , NVL(T1.ETC_OSTR_A_GD_QTY, 0)                                        AS ETC_OSTR_A_GD_QTY
                           , NVL(T5.ETC_OSTR_B_GD_QTY, 0)                                        AS NEW_ETC_OSTR_B_GD_QTY
                           , NVL(T1.ETC_OSTR_B_GD_QTY, 0)                                        AS ETC_OSTR_B_GD_QTY
                           , NVL(T5.ETC_OSTR_E_GD_QTY, 0)                                        AS NEW_ETC_OSTR_E_GD_QTY
                           , NVL(T1.ETC_OSTR_E_GD_QTY, 0)                                        AS ETC_OSTR_E_GD_QTY
                           , NVL(T5.ETC_OSTR_R_GD_QTY, 0)                                        AS NEW_ETC_OSTR_R_GD_QTY
                           , NVL(T1.ETC_OSTR_R_GD_QTY, 0)                                        AS ETC_OSTR_R_GD_QTY
                           , NVL(T5.REFR_OSTR_A_GD_QTY, 0)                                       AS NEW_REFR_OSTR_A_GD_QTY
                           , NVL(T1.REFR_OSTR_A_GD_QTY, 0)                                       AS REFR_OSTR_A_GD_QTY
                           , NVL(T5.REFR_OSTR_B_GD_QTY, 0)                                       AS NEW_REFR_OSTR_B_GD_QTY
                           , NVL(T1.REFR_OSTR_B_GD_QTY, 0)                                       AS REFR_OSTR_B_GD_QTY
                           , NVL(T5.REFR_OSTR_E_GD_QTY, 0)                                       AS NEW_REFR_OSTR_E_GD_QTY
                           , NVL(T1.REFR_OSTR_E_GD_QTY, 0)                                       AS REFR_OSTR_E_GD_QTY
                           , NVL(T5.REFR_OSTR_R_GD_QTY, 0)                                       AS NEW_REFR_OSTR_R_GD_QTY
                           , NVL(T1.REFR_OSTR_R_GD_QTY, 0)                                       AS REFR_OSTR_R_GD_QTY
                           , NVL(T7.ETC_OSTR_A_GD_QTY1, 0)                                       AS NEW_ETC_OSTR_A_GD_QTY1
                           , NVL(T1.ETC_OSTR_A_GD_QTY1, 0)                                       AS ETC_OSTR_A_GD_QTY1
                           , NVL(T7.ETC_OSTR_B_GD_QTY1, 0)                                       AS NEW_ETC_OSTR_B_GD_QTY1
                           , NVL(T1.ETC_OSTR_B_GD_QTY1, 0)                                       AS ETC_OSTR_B_GD_QTY1
                           , NVL(T7.ETC_OSTR_E_GD_QTY1, 0)                                       AS NEW_ETC_OSTR_E_GD_QTY1
                           , NVL(T1.ETC_OSTR_E_GD_QTY1, 0)                                       AS ETC_OSTR_E_GD_QTY1
                           , NVL(T7.ETC_OSTR_R_GD_QTY1, 0)                                       AS NEW_ETC_OSTR_R_GD_QTY1
                           , NVL(T1.ETC_OSTR_R_GD_QTY1, 0)                                       AS ETC_OSTR_R_GD_QTY1
                           , NVL(T6.WK_OSTR_A_GD_QTY, 0)                                         AS NEW_WK_OSTR_A_GD_QTY
                           , NVL(T1.WK_OSTR_A_GD_QTY, 0)                                         AS WK_OSTR_A_GD_QTY
                           , NVL(T6.WK_OSTR_B_GD_QTY, 0)                                         AS NEW_WK_OSTR_B_GD_QTY
                           , NVL(T1.WK_OSTR_B_GD_QTY, 0)                                         AS WK_OSTR_B_GD_QTY
                           , NVL(T6.WK_OSTR_E_GD_QTY, 0)                                         AS NEW_WK_OSTR_E_GD_QTY
                           , NVL(T1.WK_OSTR_E_GD_QTY, 0)                                         AS WK_OSTR_E_GD_QTY
                           , NVL(T6.WK_OSTR_R_GD_QTY, 0)                                         AS NEW_WK_OSTR_R_GD_QTY
                           , NVL(T1.WK_OSTR_R_GD_QTY, 0)                                         AS WK_OSTR_R_GD_QTY
                        FROM TB_SVST_MCITM_STOC_IZ T1
                        LEFT OUTER JOIN
                           (
                             SELECT SUBSTR(STR_RGST_DT, 1, 6) AS BASE_YM                                                               /* 기준년월 */
                                  , STR_WARE_NO               AS WARE_NO                                                               /* 창고번호 */
                                  , ITM_PD_CD                                                                                          /* 품목상품코드 */
                                  , SUM(CASE WHEN STR_TP_CD = '110' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS PRCHS_STR_QTY             /* 구매입고수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '110' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS PRCHS_STR_B_GD_QTY        /* 구매입고B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '117' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS ETC_STR_A_GD_QTY          /* 기타입고A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '117' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS ETC_STR_E_GD_QTY          /* 기타입고E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '121' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS NOM_STR_A_GD_QTY          /* 정상입고A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '121' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS NOM_STR_B_GD_QTY          /* 정상입고B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '121' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS NOM_STR_E_GD_QTY          /* 정상입고E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '121' AND ITM_GD_CD = 'R' THEN STR_QTY END) AS NOM_STR_R_GD_QTY          /* 정상입고R등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '122' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS QOM_ASN_STR_A_GD_QTY      /* 물량배정입고A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '122' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS QOM_ASN_STR_B_GD_QTY      /* 물량배정입고B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '122' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS QOM_ASN_STR_E_GD_QTY      /* 물량배정입고E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '122' AND ITM_GD_CD = 'R' THEN STR_QTY END) AS QOM_ASN_STR_R_GD_QTY      /* 물량배정입고R등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '123' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS QOM_MMT_STR_A_GD_QTY      /* 물량이동입고A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '123' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS QOM_MMT_STR_B_GD_QTY      /* 물량이동입고B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '123' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS QOM_MMT_STR_E_GD_QTY      /* 물량이동입고E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '123' AND ITM_GD_CD = 'R' THEN STR_QTY END) AS QOM_MMT_STR_R_GD_QTY      /* 물량이동입고R등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '161' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS RTNGD_STR_INSI_A_GD_QTY   /* 반품입고내부A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '161' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS RTNGD_STR_INSI_B_GD_QTY   /* 반품입고내부B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '161' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS RTNGD_STR_INSI_E_GD_QTY   /* 반품입고내부E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '161' AND ITM_GD_CD = 'R' THEN STR_QTY END) AS RTNGD_STR_INSI_R_GD_QTY   /* 반품입고내부R등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '162' AND ITM_GD_CD = 'A' THEN STR_QTY END) AS RTNGD_STR_OTSD_A_GD_QTY   /* 반품입고외부A등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '162' AND ITM_GD_CD = 'B' THEN STR_QTY END) AS RTNGD_STR_OTSD_B_GD_QTY   /* 반품입고외부B등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '162' AND ITM_GD_CD = 'E' THEN STR_QTY END) AS RTNGD_STR_OTSD_E_GD_QTY   /* 반품입고외부E등급수량 */
                                  , SUM(CASE WHEN STR_TP_CD = '162' AND ITM_GD_CD = 'R' THEN STR_QTY END) AS RTNGD_STR_OTSD_R_GD_QTY   /* 반품입고외부R등급수량 */
                               FROM TB_SVST_ITM_STR_IZ   /* 품목입고내역 */
                              WHERE DTA_DL_YN = 'N'
                                AND STR_RGST_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                                AND STR_WARE_NO LIKE #{wareDvCd} || '%'
                              GROUP BY SUBSTR(STR_RGST_DT, 1, 6), STR_WARE_NO, ITM_PD_CD
                           ) T2   /* 입고정보 */
                         ON T2.BASE_YM   = T1.BASE_YM
                        AND T2.WARE_NO   = T1.WARE_NO
                        AND T2.ITM_PD_CD = T1.ITM_PD_CD
                       LEFT OUTER JOIN
                          (
                            SELECT /*+ INDEX(D1 IX_SVST_SV_WK_OSTR_IZ_01) */
                                   SUBSTR(D1.FNL_VST_FSH_DT, 1, 6)                           AS BASE_YM        /* 기준년월 */
                                 , D1.WK_WARE_NO                                             AS WARE_NO        /* 창고번호 */
                                 , D1.ITM_PD_CD                                                                /* 품목상품코드 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'A' THEN D1.USE_QTY END) AS WK_STR_A_QTY   /* 작업입고A등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'B' THEN D1.USE_QTY END) AS WK_STR_B_QTY   /* 작업입고B등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'E' THEN D1.USE_QTY END) AS WK_STR_E_QTY   /* 작업입고E등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'R' THEN D1.USE_QTY END) AS WK_STR_R_QTY   /* 작업입고R등급수량 */
                              FROM TB_SVST_SV_WK_OSTR_IZ D1          /* 서비스작업출고내역 */
                              LEFT OUTER JOIN TB_PDBS_PD_ECOM_PRP_DTL D2   /* 상품각사속성상세 */
                                ON D2.PD_CD              = D1.ITM_PD_CD
                               AND D2.DTA_DL_YN          = 'N'
                               AND D2.PD_EXTS_PRP_GRP_CD = 'PART'
                             WHERE D1.DTA_DL_YN       = 'N'
                               AND D1.SV_BIZ_HCLSF_CD = '6'
                               AND (    D2.PD_PRP_VAL19 IS NULL
                                     OR D2.PD_PRP_VAL20 IS NULL
                                     OR NOT(D2.PD_PRP_VAL20 = '11' AND D2.PD_PRP_VAL19 IN ('3', '4'))   /* 모종 제외 */
                                   )
                               AND D1.FNL_VST_FSH_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                               AND D1.WK_WARE_NO LIKE #{wareDvCd} || '%'
                               AND D1.ITM_PD_CD NOT IN ( 'WM07100982', 'WM07105746', 'WM07100987', 'WM07100988', 'WM07105749', 'WM07105750', 'WM07105751', 'WM07105752'
                                                       , 'WM07100981', 'WM07100985', 'WM07100986', 'WM07105706', 'WM07105707', 'WM07105708', 'WM07105709' )
                             GROUP BY SUBSTR(D1.FNL_VST_FSH_DT, 1, 6), D1.WK_WARE_NO, D1.ITM_PD_CD
                          ) T3   /* 작업출고 반품입고 */
                         ON T3.BASE_YM   = T1.BASE_YM
                        AND T3.WARE_NO   = T1.WARE_NO
                        AND T3.ITM_PD_CD = T1.ITM_PD_CD
                       LEFT OUTER JOIN
                          (
                            SELECT SUBSTR(STAT_CTR_APY_DT, 1, 6) AS BASE_YM                                    /* 기준년월 */
                                 , WARE_NO                                                                     /* 창고번호 */
                                 , PD_CD                         AS ITM_PD_CD                                  /* 품목상품코드 */
                                 , SUM(CASE WHEN AFCT_ITM_GD_CD = 'A' THEN CTR_QTY END) AS ETC_STR_A_GD_QTY1   /* 기타입고1A등급수량 */
                                 , SUM(CASE WHEN AFCT_ITM_GD_CD = 'B' THEN CTR_QTY END) AS ETC_STR_B_GD_QTY1   /* 기타입고1B등급수량 */
                                 , SUM(CASE WHEN AFCT_ITM_GD_CD = 'E' THEN CTR_QTY END) AS ETC_STR_E_GD_QTY1   /* 기타입고1E등급수량 */
                                 , SUM(CASE WHEN AFCT_ITM_GD_CD = 'R' THEN CTR_QTY END) AS ETC_STR_R_GD_QTY1   /* 기타입고1R등급수량 */
                              FROM TB_SVST_ITM_GD_CTR_IZ   /* 품목등급조정내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND STAT_CTR_APY_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                               AND WARE_NO LIKE #{wareDvCd} || '%'
                             GROUP BY SUBSTR(STAT_CTR_APY_DT, 1, 6), WARE_NO, PD_CD
                          ) T4   /* 등급조정 입고 */
                         ON T4.BASE_YM   = T1.BASE_YM
                        AND T4.WARE_NO   = T1.WARE_NO
                        AND T4.ITM_PD_CD = T1.ITM_PD_CD
                       LEFT OUTER JOIN
                          (
                            SELECT SUBSTR(OSTR_DT, 1, 6) AS BASE_YM                                                                      /* 기준년월 */
                                 , OSTR_WARE_NO          AS WARE_NO                                                                      /* 창고번호 */
                                 , ITM_PD_CD                                                                                             /* 품목상품코드 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '211' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS SELL_OSTR_QTY              /* 판매출고수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '211' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS SELL_OSTR_B_GD_QTY         /* 판매출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '212' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS DSU_OSTR_A_GD_QTY          /* 폐기출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '212' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS DSU_OSTR_B_GD_QTY          /* 폐기출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '212' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS DSU_OSTR_E_GD_QTY          /* 폐기출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '212' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS DSU_OSTR_R_GD_QTY          /* 폐기출고R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '221' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS NOM_OSTR_A_GD_QTY          /* 정상출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '221' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS NOM_OSTR_B_GD_QTY          /* 정상출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '221' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS NOM_OSTR_E_GD_QTY          /* 정상출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '221' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS NOM_OSTR_R_GD_QTY          /* 정상출고R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '222' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS QOM_ASN_OSTR_A_GD_QTY      /* 물량배정출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '222' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS QOM_ASN_OSTR_B_GD_QTY      /* 물량배정출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '222' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS QOM_ASN_OSTR_E_GD_QTY      /* 물량배정출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '222' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS QOM_ASN_OSTR_R_GD_QTY      /* 물량배정출고R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '223' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS QOM_MMT_OSTR_A_GD_QTY      /* 물량이동출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '223' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS QOM_MMT_OSTR_B_GD_QTY      /* 물량이동출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '223' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS QOM_MMT_OSTR_E_GD_QTY      /* 물량이동출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '223' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS QOM_MMT_OSTR_R_GD_QTY      /* 물량이동출고R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '261' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS RTNGD_OSTR_INSI_A_GD_QTY   /* 반품출고내부A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '261' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS RTNGD_OSTR_INSI_B_GD_QTY   /* 반품출고내부B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '261' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS RTNGD_OSTR_INSI_E_GD_QTY   /* 반품출고내부E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '261' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS RTNGD_OSTR_INSI_R_GD_QTY   /* 반품출고내부R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '262' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS RTNGD_OSTR_OTSD_A_GD_QTY   /* 반품출고외부A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '262' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS RTNGD_OSTR_OTSD_B_GD_QTY   /* 반품출고외부B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '262' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS RTNGD_OSTR_OTSD_E_GD_QTY   /* 반품출고외부E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '262' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS RTNGD_OSTR_OTSD_R_GD_QTY   /* 반품출고외부R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '217' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS ETC_OSTR_A_GD_QTY          /* 기타출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '217' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS ETC_OSTR_B_GD_QTY          /* 기타출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '217' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS ETC_OSTR_E_GD_QTY          /* 기타출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '217' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS ETC_OSTR_R_GD_QTY          /* 기타출고R등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '218' AND ITM_GD_CD = 'A' THEN OSTR_QTY END) AS REFR_OSTR_A_GD_QTY         /* 리퍼출고A등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '218' AND ITM_GD_CD = 'B' THEN OSTR_QTY END) AS REFR_OSTR_B_GD_QTY         /* 리퍼출고B등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '218' AND ITM_GD_CD = 'E' THEN OSTR_QTY END) AS REFR_OSTR_E_GD_QTY         /* 리퍼출고E등급수량 */
                                 , SUM(CASE WHEN OSTR_TP_CD = '218' AND ITM_GD_CD = 'R' THEN OSTR_QTY END) AS REFR_OSTR_R_GD_QTY         /* 리퍼출고R등급수량 */
                              FROM TB_SVST_ITM_OSTR_IZ   /* 품목출고내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND OSTR_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                               AND OSTR_WARE_NO LIKE #{wareDvCd} || '%'
                             GROUP BY SUBSTR(OSTR_DT, 1, 6), OSTR_WARE_NO, ITM_PD_CD
                          ) T5   /* 출고정보 */
                         ON T5.BASE_YM   = T1.BASE_YM
                        AND T5.WARE_NO   = T1.WARE_NO
                        AND T5.ITM_PD_CD = T1.ITM_PD_CD
                       LEFT OUTER JOIN
                          (
                            SELECT /*+ INDEX(D1 IX_SVST_SV_WK_OSTR_IZ_01) */
                                   SUBSTR(D1.FNL_VST_FSH_DT, 1, 6)                           AS BASE_YM            /* 기준년월 */
                                 , D1.WK_WARE_NO                                             AS WARE_NO            /* 창고번호 */
                                 , D1.ITM_PD_CD                                                                    /* 품목상품코드 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'A' THEN D1.USE_QTY END) AS WK_OSTR_A_GD_QTY   /* 작업출고A등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'B' THEN D1.USE_QTY END) AS WK_OSTR_B_GD_QTY   /* 작업출고B등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'E' THEN D1.USE_QTY END) AS WK_OSTR_E_GD_QTY   /* 작업출고E등급수량 */
                                 , SUM(CASE WHEN D1.FNL_ITM_GD_CD = 'R' THEN D1.USE_QTY END) AS WK_OSTR_R_GD_QTY   /* 작업출고R등급수량 */
                              FROM TB_SVST_SV_WK_OSTR_IZ D1          /* 서비스작업출고내역 */
                              LEFT OUTER JOIN TB_PDBS_PD_ECOM_PRP_DTL D2   /* 상품각사속성상세 */
                                ON D2.PD_CD              = D1.ITM_PD_CD
                               AND D2.DTA_DL_YN          = 'N'
                               AND D2.PD_EXTS_PRP_GRP_CD = 'PART'
                             WHERE D1.DTA_DL_YN          = 'N'
                               AND D1.SV_BIZ_HCLSF_CD   IN ('1', '2', '3', '4')
                               AND (    D2.PD_PRP_VAL19 IS NULL
                                     OR D2.PD_PRP_VAL20 IS NULL
                                     OR NOT(D2.PD_PRP_VAL20 = '11' AND D2.PD_PRP_VAL19 IN ('3', '4'))   /* 모종 제외 */
                                   )
                               AND D1.FNL_VST_FSH_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                               AND D1.WK_WARE_NO LIKE #{wareDvCd} || '%'
                               AND D1.ITM_PD_CD NOT IN ( 'WM07100982', 'WM07105746', 'WM07100981' )
                             GROUP BY SUBSTR(D1.FNL_VST_FSH_DT, 1, 6), D1.WK_WARE_NO, D1.ITM_PD_CD
                          ) T6   /* 작업출고정보 */
                         ON T6.BASE_YM   = T1.BASE_YM
                        AND T6.WARE_NO   = T1.WARE_NO
                        AND T6.ITM_PD_CD = T1.ITM_PD_CD
                       LEFT OUTER JOIN
                          (
                            SELECT SUBSTR(STAT_CTR_APY_DT, 1, 6) AS BASE_YM                                     /* 기준년월 */
                                 , WARE_NO                                                                      /* 창고번호 */
                                 , PD_CD                         AS ITM_PD_CD                                   /* 품목상품코드 */
                                 , SUM(CASE WHEN BFCT_ITM_GD_CD = 'A' THEN CTR_QTY END) AS ETC_OSTR_A_GD_QTY1   /* 기타출고1A등급수량 */
                                 , SUM(CASE WHEN BFCT_ITM_GD_CD = 'B' THEN CTR_QTY END) AS ETC_OSTR_B_GD_QTY1   /* 기타출고1B등급수량 */
                                 , SUM(CASE WHEN BFCT_ITM_GD_CD = 'E' THEN CTR_QTY END) AS ETC_OSTR_E_GD_QTY1   /* 기타출고1E등급수량 */
                                 , SUM(CASE WHEN BFCT_ITM_GD_CD = 'R' THEN CTR_QTY END) AS ETC_OSTR_R_GD_QTY1   /* 기타출고1R등급수량 */
                              FROM TB_SVST_ITM_GD_CTR_IZ   /* 품목등급조정내역 */
                             WHERE DTA_DL_YN = 'N'
                               AND STAT_CTR_APY_DT BETWEEN #{mngtYm} || '01' AND #{mngtYm} || '31'
                               AND WARE_NO LIKE #{wareDvCd} || '%'
                             GROUP BY SUBSTR(STAT_CTR_APY_DT, 1, 6), WARE_NO, PD_CD
                          ) T7
                         ON T7.BASE_YM   = T1.BASE_YM
                        AND T7.WARE_NO   = T1.WARE_NO
                        AND T7.ITM_PD_CD = T1.ITM_PD_CD
                      WHERE T1.DTA_DL_YN = 'N'
                        AND T1.BASE_YM   = #{mngtYm}
                        AND T1.WARE_NO LIKE #{wareDvCd} || '%'
                    ) S1
                WHERE S1.PITM_STOC_A_GD_QTY <![CDATA[<>]]> S1.NEW_PITM_STOC_A_GD_QTY OR S1.PITM_STOC_B_GD_QTY <![CDATA[<>]]> S1.NEW_PITM_STOC_B_GD_QTY
                   OR S1.PITM_STOC_E_GD_QTY <![CDATA[<>]]> S1.NEW_PITM_STOC_E_GD_QTY OR S1.PITM_STOC_R_GD_QTY <![CDATA[<>]]> S1.NEW_PITM_STOC_R_GD_QTY
                   OR S1.PRCHS_STR_QTY <![CDATA[<>]]> S1.NEW_PRCHS_STR_QTY OR S1.PRCHS_STR_B_GD_QTY <![CDATA[<>]]> S1.NEW_PRCHS_STR_B_GD_QTY
                   OR S1.NOM_STR_A_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_STR_A_GD_QTY OR S1.NOM_STR_B_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_STR_B_GD_QTY
                   OR S1.NOM_STR_E_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_STR_E_GD_QTY OR S1.NOM_STR_R_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_STR_R_GD_QTY
                   OR S1.QOM_ASN_STR_A_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_STR_A_GD_QTY OR S1.QOM_ASN_STR_B_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_STR_B_GD_QTY
                   OR S1.QOM_ASN_STR_E_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_STR_E_GD_QTY OR S1.QOM_ASN_STR_R_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_STR_R_GD_QTY
                   OR S1.QOM_MMT_STR_A_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_STR_A_GD_QTY OR S1.QOM_MMT_STR_B_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_STR_B_GD_QTY
                   OR S1.QOM_MMT_STR_E_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_STR_E_GD_QTY OR S1.QOM_MMT_STR_R_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_STR_R_GD_QTY
                   OR S1.RTNGD_STR_INSI_A_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_INSI_A_GD_QTY OR S1.RTNGD_STR_INSI_B_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_INSI_B_GD_QTY
                   OR S1.RTNGD_STR_INSI_E_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_INSI_E_GD_QTY OR S1.RTNGD_STR_INSI_R_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_INSI_R_GD_QTY
                   OR S1.RTNGD_STR_OTSD_A_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_OTSD_A_GD_QTY OR S1.RTNGD_STR_OTSD_B_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_OTSD_B_GD_QTY
                   OR S1.RTNGD_STR_OTSD_E_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_OTSD_E_GD_QTY OR S1.RTNGD_STR_OTSD_R_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_STR_OTSD_R_GD_QTY
                   OR S1.ETC_STR_A_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_STR_A_GD_QTY OR S1.ETC_STR_E_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_STR_E_GD_QTY
                   OR S1.ETC_STR_A_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_STR_A_GD_QTY1 OR S1.ETC_STR_B_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_STR_B_GD_QTY1
                   OR S1.ETC_STR_E_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_STR_E_GD_QTY1 OR S1.ETC_STR_R_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_STR_R_GD_QTY1
                   OR S1.NOM_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_OSTR_A_GD_QTY OR S1.NOM_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_OSTR_B_GD_QTY
                   OR S1.NOM_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_OSTR_E_GD_QTY OR S1.NOM_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_NOM_OSTR_R_GD_QTY
                   OR S1.QOM_ASN_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_OSTR_A_GD_QTY OR S1.QOM_ASN_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_OSTR_B_GD_QTY
                   OR S1.QOM_ASN_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_OSTR_E_GD_QTY OR S1.QOM_ASN_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_ASN_OSTR_R_GD_QTY
                   OR S1.QOM_MMT_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_OSTR_A_GD_QTY OR S1.QOM_MMT_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_OSTR_B_GD_QTY
                   OR S1.QOM_MMT_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_OSTR_E_GD_QTY OR S1.QOM_MMT_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_QOM_MMT_OSTR_R_GD_QTY
                   OR S1.RTNGD_OSTR_INSI_A_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_INSI_A_GD_QTY OR S1.RTNGD_OSTR_INSI_B_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_INSI_B_GD_QTY
                   OR S1.RTNGD_OSTR_INSI_E_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_INSI_E_GD_QTY OR S1.RTNGD_OSTR_INSI_R_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_INSI_R_GD_QTY
                   OR S1.RTNGD_OSTR_OTSD_A_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_OTSD_A_GD_QTY OR S1.RTNGD_OSTR_OTSD_B_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_OTSD_B_GD_QTY
                   OR S1.RTNGD_OSTR_OTSD_E_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_OTSD_E_GD_QTY OR S1.RTNGD_OSTR_OTSD_R_GD_QTY <![CDATA[<>]]> S1.NEW_RTNGD_OSTR_OTSD_R_GD_QTY
                   OR S1.SELL_OSTR_QTY <![CDATA[<>]]> S1.NEW_SELL_OSTR_QTY OR S1.SELL_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_SELL_OSTR_B_GD_QTY
                   OR S1.DSU_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_DSU_OSTR_A_GD_QTY OR S1.DSU_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_DSU_OSTR_B_GD_QTY
                   OR S1.DSU_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_DSU_OSTR_E_GD_QTY OR S1.DSU_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_DSU_OSTR_R_GD_QTY
                   OR S1.ETC_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_OSTR_A_GD_QTY OR S1.ETC_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_OSTR_B_GD_QTY
                   OR S1.ETC_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_OSTR_E_GD_QTY OR S1.ETC_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_ETC_OSTR_R_GD_QTY
                   OR S1.REFR_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_REFR_OSTR_A_GD_QTY OR S1.REFR_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_REFR_OSTR_B_GD_QTY
                   OR S1.REFR_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_REFR_OSTR_E_GD_QTY OR S1.REFR_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_REFR_OSTR_R_GD_QTY
                   OR S1.ETC_OSTR_A_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_OSTR_A_GD_QTY1 OR S1.ETC_OSTR_B_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_OSTR_B_GD_QTY1
                   OR S1.ETC_OSTR_E_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_OSTR_E_GD_QTY1 OR S1.ETC_OSTR_R_GD_QTY1 <![CDATA[<>]]> S1.NEW_ETC_OSTR_R_GD_QTY1
                   OR S1.WK_OSTR_A_GD_QTY <![CDATA[<>]]> S1.NEW_WK_OSTR_A_GD_QTY OR S1.WK_OSTR_B_GD_QTY <![CDATA[<>]]> S1.NEW_WK_OSTR_B_GD_QTY
                   OR S1.WK_OSTR_E_GD_QTY <![CDATA[<>]]> S1.NEW_WK_OSTR_E_GD_QTY OR S1.WK_OSTR_R_GD_QTY <![CDATA[<>]]> S1.NEW_WK_OSTR_R_GD_QTY
             ) TB_SRC
            ON
             (
                   TB_TGT.BASE_YM   = TB_SRC.BASE_YM
               AND TB_TGT.WARE_NO   = TB_SRC.WARE_NO
               AND TB_TGT.ITM_PD_CD = TB_SRC.ITM_PD_CD
               AND TB_TGT.DTA_DL_YN = 'N'
             )
          WHEN MATCHED THEN
        UPDATE
           SET TB_TGT.PITM_STOC_A_GD_QTY       = TB_SRC.NEW_PITM_STOC_A_GD_QTY         /* 시점재고A등급수량 */
             , TB_TGT.PITM_STOC_B_GD_QTY       = TB_SRC.NEW_PITM_STOC_B_GD_QTY         /* 시점재고B등급수량 */
             , TB_TGT.PITM_STOC_E_GD_QTY       = TB_SRC.NEW_PITM_STOC_E_GD_QTY         /* 시점재고E등급수량 */
             , TB_TGT.PITM_STOC_R_GD_QTY       = TB_SRC.NEW_PITM_STOC_R_GD_QTY         /* 시점재고R등급수량 */
             , TB_TGT.PRCHS_STR_QTY            = TB_SRC.NEW_PRCHS_STR_QTY              /* 구매입고수량 */
             , TB_TGT.PRCHS_STR_B_GD_QTY       = TB_SRC.NEW_PRCHS_STR_B_GD_QTY         /* 구매입고B등급수량 */
             , TB_TGT.NOM_STR_A_GD_QTY         = TB_SRC.NEW_NOM_STR_A_GD_QTY           /* 정상입고A등급수량 */
             , TB_TGT.NOM_STR_B_GD_QTY         = TB_SRC.NEW_NOM_STR_B_GD_QTY           /* 정상입고B등급수량 */
             , TB_TGT.NOM_STR_E_GD_QTY         = TB_SRC.NEW_NOM_STR_E_GD_QTY           /* 정상입고E등급수량 */
             , TB_TGT.NOM_STR_R_GD_QTY         = TB_SRC.NEW_NOM_STR_R_GD_QTY           /* 정상입고R등급수량 */
             , TB_TGT.QOM_ASN_STR_A_GD_QTY     = TB_SRC.NEW_QOM_ASN_STR_A_GD_QTY       /* 물량배정입고A등급수량 */
             , TB_TGT.QOM_ASN_STR_B_GD_QTY     = TB_SRC.NEW_QOM_ASN_STR_B_GD_QTY       /* 물량배정입고B등급수량 */
             , TB_TGT.QOM_ASN_STR_E_GD_QTY     = TB_SRC.NEW_QOM_ASN_STR_E_GD_QTY       /* 물량배정입고E등급수량 */
             , TB_TGT.QOM_ASN_STR_R_GD_QTY     = TB_SRC.NEW_QOM_ASN_STR_R_GD_QTY       /* 물량배정입고R등급수량 */
             , TB_TGT.QOM_MMT_STR_A_GD_QTY     = TB_SRC.NEW_QOM_MMT_STR_A_GD_QTY       /* 물량이동입고A등급수량 */
             , TB_TGT.QOM_MMT_STR_B_GD_QTY     = TB_SRC.NEW_QOM_MMT_STR_B_GD_QTY       /* 물량이동입고B등급수량 */
             , TB_TGT.QOM_MMT_STR_E_GD_QTY     = TB_SRC.NEW_QOM_MMT_STR_E_GD_QTY       /* 물량이동입고E등급수량 */
             , TB_TGT.QOM_MMT_STR_R_GD_QTY     = TB_SRC.NEW_QOM_MMT_STR_R_GD_QTY       /* 물량이동입고R등급수량 */
             , TB_TGT.RTNGD_STR_INSI_A_GD_QTY  = TB_SRC.NEW_RTNGD_STR_INSI_A_GD_QTY    /* 반품입고내부A등급수량 */
             , TB_TGT.RTNGD_STR_INSI_B_GD_QTY  = TB_SRC.NEW_RTNGD_STR_INSI_B_GD_QTY    /* 반품입고내부B등급수량 */
             , TB_TGT.RTNGD_STR_INSI_E_GD_QTY  = TB_SRC.NEW_RTNGD_STR_INSI_E_GD_QTY    /* 반품입고내부E등급수량 */
             , TB_TGT.RTNGD_STR_INSI_R_GD_QTY  = TB_SRC.NEW_RTNGD_STR_INSI_R_GD_QTY    /* 반품입고내부R등급수량 */
             , TB_TGT.RTNGD_STR_OTSD_A_GD_QTY  = TB_SRC.NEW_RTNGD_STR_OTSD_A_GD_QTY    /* 반품입고외부A등급수량 */
             , TB_TGT.RTNGD_STR_OTSD_B_GD_QTY  = TB_SRC.NEW_RTNGD_STR_OTSD_B_GD_QTY    /* 반품입고외부B등급수량 */
             , TB_TGT.RTNGD_STR_OTSD_E_GD_QTY  = TB_SRC.NEW_RTNGD_STR_OTSD_E_GD_QTY    /* 반품입고외부E등급수량 */
             , TB_TGT.RTNGD_STR_OTSD_R_GD_QTY  = TB_SRC.NEW_RTNGD_STR_OTSD_R_GD_QTY    /* 반품입고외부R등급수량 */
             , TB_TGT.ETC_STR_A_GD_QTY         = TB_SRC.NEW_ETC_STR_A_GD_QTY           /* 기타입고A등급수량 */
             , TB_TGT.ETC_STR_E_GD_QTY         = TB_SRC.NEW_ETC_STR_E_GD_QTY           /* 기타입고E등급수량 */
             , TB_TGT.ETC_STR_A_GD_QTY1        = TB_SRC.NEW_ETC_STR_A_GD_QTY1          /* 기타입고1A등급수량 */
             , TB_TGT.ETC_STR_B_GD_QTY1        = TB_SRC.NEW_ETC_STR_B_GD_QTY1          /* 기타입고1B등급수량 */
             , TB_TGT.ETC_STR_E_GD_QTY1        = TB_SRC.NEW_ETC_STR_E_GD_QTY1          /* 기타입고1E등급수량 */
             , TB_TGT.ETC_STR_R_GD_QTY1        = TB_SRC.NEW_ETC_STR_R_GD_QTY1          /* 기타입고1R등급수량 */
             , TB_TGT.NOM_OSTR_A_GD_QTY        = TB_SRC.NEW_NOM_OSTR_A_GD_QTY          /* 정상출고A등급수량 */
             , TB_TGT.NOM_OSTR_B_GD_QTY        = TB_SRC.NEW_NOM_OSTR_B_GD_QTY          /* 정상출고B등급수량 */
             , TB_TGT.NOM_OSTR_E_GD_QTY        = TB_SRC.NEW_NOM_OSTR_E_GD_QTY          /* 정상출고E등급수량 */
             , TB_TGT.NOM_OSTR_R_GD_QTY        = TB_SRC.NEW_NOM_OSTR_R_GD_QTY          /* 정상출고R등급수량 */
             , TB_TGT.QOM_ASN_OSTR_A_GD_QTY    = TB_SRC.NEW_QOM_ASN_OSTR_A_GD_QTY      /* 물량배정출고A등급수량 */
             , TB_TGT.QOM_ASN_OSTR_B_GD_QTY    = TB_SRC.NEW_QOM_ASN_OSTR_B_GD_QTY      /* 물량배정출고B등급수량 */
             , TB_TGT.QOM_ASN_OSTR_E_GD_QTY    = TB_SRC.NEW_QOM_ASN_OSTR_E_GD_QTY      /* 물량배정출고E등급수량 */
             , TB_TGT.QOM_ASN_OSTR_R_GD_QTY    = TB_SRC.NEW_QOM_ASN_OSTR_R_GD_QTY      /* 물량배정출고R등급수량 */
             , TB_TGT.QOM_MMT_OSTR_A_GD_QTY    = TB_SRC.NEW_QOM_MMT_OSTR_A_GD_QTY      /* 물량이동출고A등급수량 */
             , TB_TGT.QOM_MMT_OSTR_B_GD_QTY    = TB_SRC.NEW_QOM_MMT_OSTR_B_GD_QTY      /* 물량이동출고B등급수량 */
             , TB_TGT.QOM_MMT_OSTR_E_GD_QTY    = TB_SRC.NEW_QOM_MMT_OSTR_E_GD_QTY      /* 물량이동출고E등급수량 */
             , TB_TGT.QOM_MMT_OSTR_R_GD_QTY    = TB_SRC.NEW_QOM_MMT_OSTR_R_GD_QTY      /* 물량이동출고R등급수량 */
             , TB_TGT.RTNGD_OSTR_INSI_A_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_INSI_A_GD_QTY   /* 반품출고내부A등급수량 */
             , TB_TGT.RTNGD_OSTR_INSI_B_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_INSI_B_GD_QTY   /* 반품출고내부B등급수량 */
             , TB_TGT.RTNGD_OSTR_INSI_E_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_INSI_E_GD_QTY   /* 반품출고내부E등급수량 */
             , TB_TGT.RTNGD_OSTR_INSI_R_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_INSI_R_GD_QTY   /* 반품출고내부R등급수량 */
             , TB_TGT.RTNGD_OSTR_OTSD_A_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_OTSD_A_GD_QTY   /* 반품출고외부A등급수량 */
             , TB_TGT.RTNGD_OSTR_OTSD_B_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_OTSD_B_GD_QTY   /* 반품출고외부B등급수량 */
             , TB_TGT.RTNGD_OSTR_OTSD_E_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_OTSD_E_GD_QTY   /* 반품출고외부E등급수량 */
             , TB_TGT.RTNGD_OSTR_OTSD_R_GD_QTY = TB_SRC.NEW_RTNGD_OSTR_OTSD_R_GD_QTY   /* 반품출고외부R등급수량 */
             , TB_TGT.SELL_OSTR_QTY            = TB_SRC.NEW_SELL_OSTR_QTY              /* 판매출고수량 */
             , TB_TGT.SELL_OSTR_B_GD_QTY       = TB_SRC.NEW_SELL_OSTR_B_GD_QTY         /* 판매출고B등급수량 */
             , TB_TGT.DSU_OSTR_A_GD_QTY        = TB_SRC.NEW_DSU_OSTR_A_GD_QTY          /* 폐기출고A등급수량 */
             , TB_TGT.DSU_OSTR_B_GD_QTY        = TB_SRC.NEW_DSU_OSTR_B_GD_QTY          /* 폐기출고B등급수량 */
             , TB_TGT.DSU_OSTR_E_GD_QTY        = TB_SRC.NEW_DSU_OSTR_E_GD_QTY          /* 폐기출고E등급수량 */
             , TB_TGT.DSU_OSTR_R_GD_QTY        = TB_SRC.NEW_DSU_OSTR_R_GD_QTY          /* 폐기출고R등급수량 */
             , TB_TGT.ETC_OSTR_A_GD_QTY        = TB_SRC.NEW_ETC_OSTR_A_GD_QTY          /* 기타출고A등급수량 */
             , TB_TGT.ETC_OSTR_B_GD_QTY        = TB_SRC.NEW_ETC_OSTR_B_GD_QTY          /* 기타출고B등급수량 */
             , TB_TGT.ETC_OSTR_E_GD_QTY        = TB_SRC.NEW_ETC_OSTR_E_GD_QTY          /* 기타출고E등급수량 */
             , TB_TGT.ETC_OSTR_R_GD_QTY        = TB_SRC.NEW_ETC_OSTR_R_GD_QTY          /* 기타출고R등급수량 */
             , TB_TGT.REFR_OSTR_A_GD_QTY       = TB_SRC.NEW_REFR_OSTR_A_GD_QTY         /* 리퍼출고A등급수량 */
             , TB_TGT.REFR_OSTR_B_GD_QTY       = TB_SRC.NEW_REFR_OSTR_B_GD_QTY         /* 리퍼출고B등급수량 */
             , TB_TGT.REFR_OSTR_E_GD_QTY       = TB_SRC.NEW_REFR_OSTR_E_GD_QTY         /* 리퍼출고E등급수량 */
             , TB_TGT.REFR_OSTR_R_GD_QTY       = TB_SRC.NEW_REFR_OSTR_R_GD_QTY         /* 리퍼출고R등급수량 */
             , TB_TGT.ETC_OSTR_A_GD_QTY1       = TB_SRC.NEW_ETC_OSTR_A_GD_QTY1         /* 기타출고1A등급수량 */
             , TB_TGT.ETC_OSTR_B_GD_QTY1       = TB_SRC.NEW_ETC_OSTR_B_GD_QTY1         /* 기타출고1B등급수량 */
             , TB_TGT.ETC_OSTR_E_GD_QTY1       = TB_SRC.NEW_ETC_OSTR_E_GD_QTY1         /* 기타출고1E등급수량 */
             , TB_TGT.ETC_OSTR_R_GD_QTY1       = TB_SRC.NEW_ETC_OSTR_R_GD_QTY1         /* 기타출고1R등급수량 */
             , TB_TGT.WK_OSTR_A_GD_QTY         = TB_SRC.NEW_WK_OSTR_A_GD_QTY           /* 작업출고A등급수량 */
             , TB_TGT.WK_OSTR_B_GD_QTY         = TB_SRC.NEW_WK_OSTR_B_GD_QTY           /* 작업출고B등급수량 */
             , TB_TGT.WK_OSTR_E_GD_QTY         = TB_SRC.NEW_WK_OSTR_E_GD_QTY           /* 작업출고E등급수량 */
             , TB_TGT.WK_OSTR_R_GD_QTY         = TB_SRC.NEW_WK_OSTR_R_GD_QTY           /* 작업출고R등급수량 */
        <include refid="COMMON.updateSystemField"/>
    </update>

     <update id="updatePointInTimeStocks">
          MERGE INTO TB_SVST_CST_SV_ITM_STOC_IZ TB_TGT   /* 고객서비스품목재고내역 */
          USING
              (
                SELECT D1.WARE_NO              /* 창고번호 */
                     , D1.ITM_PD_CD            /* 품목상품코드 */
                     , D2.PITM_STOC_A_GD_QTY   /* 시점재고A등급수량 */
                     , D2.PITM_STOC_B_GD_QTY   /* 시점재고B등급수량 */
                     , D2.PITM_STOC_E_GD_QTY   /* 시점재고E등급수량 */
                     , D2.PITM_STOC_R_GD_QTY   /* 시점재고R등급수량 */
                  FROM TB_SVST_CST_SV_ITM_STOC_IZ D1   /* 고객서비스품목재고내역 */
                 INNER JOIN TB_SVST_MCITM_STOC_IZ D2   /* 월별품목재고내역 */
                    ON D2.WARE_NO   = D1.WARE_NO
                   AND D2.ITM_PD_CD = D1.ITM_PD_CD
                 WHERE D1.DTA_DL_YN = 'N'
                   AND D2.DTA_DL_YN = 'N'
                   AND D2.BASE_YM   = #{mngtYm}
                   AND D2.WARE_NO LIKE #{wareDvCd} || '%'
                   AND (    NVL(D1.PITM_STOC_A_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.PITM_STOC_A_GD_QTY, 0)
                         OR NVL(D1.PITM_STOC_B_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.PITM_STOC_B_GD_QTY, 0)
                         OR NVL(D1.PITM_STOC_E_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.PITM_STOC_E_GD_QTY, 0)
                         OR NVL(D1.PITM_STOC_R_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.PITM_STOC_R_GD_QTY, 0) )
              ) TB_SRC
             ON
              (
                   TB_TGT.WARE_NO   = TB_SRC.WARE_NO
               AND TB_TGT.ITM_PD_CD = TB_SRC.ITM_PD_CD
               AND TB_TGT.DTA_DL_YN = 'N'
             )
           WHEN MATCHED THEN
        UPDATE
           SET TB_TGT.PITM_STOC_A_GD_QTY = TB_SRC.PITM_STOC_A_GD_QTY   /* 시점재고A등급수량 */
             , TB_TGT.PITM_STOC_B_GD_QTY = TB_SRC.PITM_STOC_B_GD_QTY   /* 시점재고B등급수량 */
             , TB_TGT.PITM_STOC_E_GD_QTY = TB_SRC.PITM_STOC_E_GD_QTY   /* 시점재고E등급수량 */
             , TB_TGT.PITM_STOC_R_GD_QTY = TB_SRC.PITM_STOC_R_GD_QTY   /* 시점재고R등급수량 */
         <include refid="COMMON.updateSystemField"/>
    </update>

    <update id="updateMovementStocks">
         MERGE INTO TB_SVST_CST_SV_ITM_STOC_IZ TB_TGT   /* 고객서비스품목재고내역 */
         USING
             (
               SELECT D1.WARE_NO                                          /* 창고번호 */
                    , D1.ITM_PD_CD                                        /* 품목상품코드 */
                    , NVL(D2.MMT_STOC_A_GD_QTY, 0) AS MMT_STOC_A_GD_QTY   /* 이동재고A등급수량 */
                    , NVL(D2.MMT_STOC_B_GD_QTY, 0) AS MMT_STOC_B_GD_QTY   /* 이동재고B등급수량 */
                    , NVL(D2.MMT_STOC_E_GD_QTY, 0) AS MMT_STOC_E_GD_QTY   /* 이동재고E등급수량 */
                    , NVL(D2.MMT_STOC_R_GD_QTY, 0) AS MMT_STOC_R_GD_QTY   /* 이동재고R등급수량 */
                 FROM TB_SVST_CST_SV_ITM_STOC_IZ D1   /* 고객서비스품목재고내역 */
                 LEFT OUTER JOIN
                    (
                      SELECT STR_WARE_NO
                           , ITM_PD_CD
                           , SUM(CASE WHEN ITM_GD_CD = 'A' THEN STR_QTY END) AS MMT_STOC_A_GD_QTY
                           , SUM(CASE WHEN ITM_GD_CD = 'B' THEN STR_QTY END) AS MMT_STOC_B_GD_QTY
                           , SUM(CASE WHEN ITM_GD_CD = 'E' THEN STR_QTY END) AS MMT_STOC_E_GD_QTY
                           , SUM(CASE WHEN ITM_GD_CD = 'R' THEN STR_QTY END) AS MMT_STOC_R_GD_QTY
                        FROM TB_SVST_ITM_STR_IZ
                       WHERE DTA_DL_YN = 'N'
                         AND TO_NUMBER(STR_WARE_NO) <![CDATA[>]]> 100000
                         AND STR_CONF_DT IS NULL
                       GROUP BY STR_WARE_NO, ITM_PD_CD
                    ) D2
                   ON D2.STR_WARE_NO = D1.WARE_NO
                  AND D2.ITM_PD_CD   = D1.ITM_PD_CD
                WHERE NVL(D1.MMT_STOC_A_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.MMT_STOC_A_GD_QTY, 0)
                   OR NVL(D1.MMT_STOC_B_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.MMT_STOC_B_GD_QTY, 0)
                   OR NVL(D1.MMT_STOC_E_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.MMT_STOC_E_GD_QTY, 0)
                   OR NVL(D1.MMT_STOC_R_GD_QTY, 0) <![CDATA[<>]]> NVL(D2.MMT_STOC_R_GD_QTY, 0)
             ) TB_SRC
            ON
             (
                   TB_TGT.WARE_NO   = TB_SRC.WARE_NO
               AND TB_TGT.ITM_PD_CD = TB_SRC.ITM_PD_CD
               AND TB_TGT.DTA_DL_YN = 'N'
             )
          WHEN MATCHED THEN
        UPDATE
           SET TB_TGT.MMT_STOC_A_GD_QTY = TB_SRC.MMT_STOC_A_GD_QTY   /* 이동재고A등급수량 */
             , TB_TGT.MMT_STOC_B_GD_QTY = TB_SRC.MMT_STOC_B_GD_QTY   /* 이동재고B등급수량 */
             , TB_TGT.MMT_STOC_E_GD_QTY = TB_SRC.MMT_STOC_E_GD_QTY   /* 이동재고E등급수량 */
             , TB_TGT.MMT_STOC_R_GD_QTY = TB_SRC.MMT_STOC_R_GD_QTY   /* 이동재고R등급수량 */
         <include refid="COMMON.updateSystemField"/>
    </update>



</mapper>
