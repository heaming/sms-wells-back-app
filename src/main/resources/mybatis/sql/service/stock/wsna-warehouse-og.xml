<?xml version="1.0" encoding="UTF-8"?>
<!---
 ****************************************************************************************************
 * 프로그램 개요
 ****************************************************************************************************
 1. 모듈 : SNA (재고관리)
 2. 프로그램 ID : W-SV-U-0138M01 AS 창고조직 관리
 3. 작성자 : gs.piit58
 4. 작성일 : 2022.12.08
 ****************************************************************************************************
 * 프로그램 설명
 ****************************************************************************************************
 - 창고조직 관리 (http://localhost:3000/#/service/wwsna-warehouse-og)
 ****************************************************************************************************
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaWarehouseOgMapper">
    <insert id="insertWareCarried">
        INSERT INTO TB_SVST_MCBY_WARE_IZ ( /*월병창고내역*/
        APY_YM                 /* 적용년월 */
        , WARE_NO                /* 창고번호 */
        , WARE_DV_CD             /* 창고구분코드 */
        , WARE_DTL_DV_CD         /* 창고상세구분코드 */
        , WARE_LOCARA_CD         /* 창고지역코드 */
        , WARE_LOCARA_SN         /* 창고지역일련번호 */
        , HGR_WARE_NO            /* 상위창고번호 */
        , WARE_NM                /* 창고명 */
        , WARE_ICHR_NO           /* 창고담당번호 */
        , WARE_MNGT_PRTNR_NO     /* 창고관리파트너번호 */
        , CO_CD                  /* 회사코드 */
        , DIDY_DV_CD             /* 직배구분코드 */
        , SORT_DV_VAL            /* 정렬구분값 */
        , WARE_ADR_ID            /* 창고주소ID */
        , BLD_CD                 /* 빌딩코드 */
        , WARE_USE_YN            /* 창고사용여부 */
        , ADR_USE_YN             /* 주소사용여부 */
        , APY_STRTDT             /* 적용시작일자 */
        , APY_ENDDT              /* 적용종료일자 */
        , RMK_CN                 /* 비고내용 */
        , DTA_DL_YN              /* 데이터삭제여부 */
        <include refid="COMMON.insertSystemField"/>
        )
        SELECT
        TO_CHAR(ADD_MONTHS(TO_DATE(APY_YM,'YYYYMM'),1),'YYYYMM')
        , WARE_NO
        , WARE_DV_CD
        , WARE_DTL_DV_CD
        , WARE_LOCARA_CD
        , WARE_LOCARA_SN
        , HGR_WARE_NO
        , WARE_NM
        , WARE_ICHR_NO
        , WARE_MNGT_PRTNR_NO
        , CO_CD
        , DIDY_DV_CD
        , SORT_DV_VAL
        , WARE_ADR_ID
        , BLD_CD
        , WARE_USE_YN
        , ADR_USE_YN
        , APY_STRTDT
        , APY_ENDDT
        , RMK_CN
        , DTA_DL_YN
        <include refid="COMMON.insertSystemFieldValue"/>
        FROM TB_SVST_MCBY_WARE_IZ
        WHERE APY_YM=TO_CHAR(TO_DATE(#{baseYm},'YYYYMM'),'YYYYMM')

    </insert>

    <select id="selectWarehouseOgs"
            resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaWarehouseOgDto$SearchRes">
        SELECT B.APY_YM AS APY_YM       /* 적용년월 */
        , B.WARE_DV_CD AS WARE_DV_CD    /* 창고구분코드 */
        , B.WARE_DV_CD ||B.WARE_LOCARA_CD || B.WARE_LOCARA_SN || B.WARE_ICHR_NO AS WARE_CD
        , A.WARE_DV_CD ||A.WARE_LOCARA_CD || A.WARE_LOCARA_SN || A.WARE_ICHR_NO AS HGR_WARE
        , B.WARE_DTL_DV_CD AS WARE_DTL_DV_CD
        , B.WARE_LOCARA_CD AS WARE_LOCARA_CD
        , B.WARE_LOCARA_SN AS WARE_LOCARA_SN
        , B.HGR_WARE_NO AS HGR_WARE_NO
        , A.WARE_NM AS HGR_WARE_NM
        , B.WARE_NO AS WARE_NO
        , B.WARE_NM AS WARE_NM
        , B.WARE_ICHR_NO AS WARE_ICHR_NO
        , B.WARE_MNGT_PRTNR_NO AS WARE_MNGT_PRTNR_NO
        , B.DIDY_DV_CD AS DIDY_DV_CD
        , B.WARE_ADR_ID AS WARE_ADR_ID
        , B.WARE_USE_YN AS WARE_USE_YN
        FROM TB_SVST_MCBY_WARE_IZ B
        , TB_SVST_MCBY_WARE_IZ A
        WHERE 1 = 1
        AND B.APY_YM = #{baseYm}
        AND B.HGR_WARE_NO = A.WARE_NO
        AND B.APY_YM = A.APY_YM
        <if test="@MybatisUtils@isNotEmpty(wareMngtPrtnrNo)">
            AND B.WARE_MNGT_PRTNR_NO = #{wareMngtPrtnrNo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(wareDvCd)">
            AND B.WARE_DV_CD = #{wareDvCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(codeUseYn)">
            AND B.WARE_USE_YN = #{codeUseYn}
        </if>
        <if test="@MybatisUtils@isNotEmpty(wareLocaraCd)">
            AND B.WARE_LOCARA_CD = #{wareLocaraCd}
        </if>
--             AND B.WARE_NO = '305821'
        ORDER BY B.WARE_DV_CD, B.HGR_WARE_NO, B.WARE_NM, B.WARE_LOCARA_CD, B.WARE_LOCARA_SN, B.WARE_ICHR_NO

    </select>
    <select id="selectWareCarriedCounter" resultType="integer">
        SELECT COUNT(WARE_LOCARA_CD || WARE_LOCARA_SN || WARE_ICHR_NO) AS CNT
        FROM TB_SVST_MCBY_WARE_IZ
        WHERE APY_YM = TO_CHAR(ADD_MONTHS(TO_DATE(#{baseYm}, 'YYYYMM'), 1), 'YYYYMM')
    </select>

</mapper>
