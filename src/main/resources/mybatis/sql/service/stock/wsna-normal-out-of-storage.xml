<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaNormalOutOfStorageMapper">

    <select id="selectNormalOutOfStorage"
            resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaNormalOutOfStorageDto$SearchRes">
        SELECT J1.OSTR_AK_NO
             , J1.OSTR_AK_TP_CD
             , J1.OSTR_OJ_WARE_NO
             , J1.STR_OJ_WARE_NO
             , (SELECT S1.WARE_NM
                  FROM TB_SVST_MCBY_WARE_IZ S1
                 WHERE S1.APY_YM = SUBSTR(#{strHopDtStr}, 1,6)
                   AND S1.WARE_NO = J1.OSTR_OJ_WARE_NO
               ) AS OSTR_OJ_WARE_NM
             , (SELECT S1.WARE_NM
                  FROM TB_SVST_MCBY_WARE_IZ S1
                 WHERE S1.APY_YM = SUBSTR(#{strHopDtStr}, 1,6)
                   AND S1.WARE_NO = J1.STR_OJ_WARE_NO
               ) AS STR_OJ_WARE_NM
             , J1.STR_HOP_DT
             , J1.OVIV_TP_CD
             , J1.RECT_OSTR_DT
             , J1.ITM_PD_CD
             , J1.OSTR_AK_RGST_DT
             , J1.OSTR_DTRN_YN
             , J2.PD_NM || ' 외' AS PD_NM
             , ' ' AS RMK_CN
          FROM (SELECT T1.OSTR_AK_NO
                     , T1.OSTR_AK_TP_CD
                     , T1.OSTR_OJ_WARE_NO
                     , T1.STR_OJ_WARE_NO
                     , T1.STR_HOP_DT
                     , T1.OVIV_TP_CD
                     , MAX(T1.RECT_OSTR_DT) AS RECT_OSTR_DT
                     , MIN(T1.ITM_PD_CD) AS ITM_PD_CD
                     , T1.OSTR_AK_RGST_DT
                     , (CASE WHEN T1.OSTR_AK_RGST_DT > '20190700'
                             THEN CASE WHEN COUNT(T1.OSTR_CNFM_QTY) - COUNT(T1.OSTR_AGG_QTY) = 0
                                       THEN '출고완료'
                                       WHEN COUNT(T1.OSTR_CNFM_QTY) = COUNT(T1.OSTR_AGG_QTY)
                                       THEN '출고대기'
                                       ELSE '일부출고'
                                        END
                             ELSE CASE WHEN COUNT(*) = COUNT(T1.RECT_OSTR_DT) THEN '출고완료'
                                       ELSE ''
                                        END
                      END) AS OSTR_DTRN_YN
                  FROM TB_SVST_ITM_OSTR_AK_IZ T1
                 INNER JOIN TB_SVST_MCBY_WARE_IZ T2
                    ON T1.OSTR_OJ_WARE_NO = T2.WARE_NO
                   AND T2.APY_YM = SUBSTR(#{strHopDtStr}, 1,6)
                 WHERE T1.STR_HOP_DT BETWEEN #{strHopDtStr} AND #{strHopDtEnd}
                 <if test="@MybatisUtils@isNotEmpty(ostrAkTpCd)">
                   AND T1.OSTR_AK_TP_CD = #{ostrAkTpCd}
                 </if>
                 <if test="@MybatisUtils@isNotEmpty(wareDvCd)">
                   AND T1.OSTR_AK_WARE_DV_CD = #{wareDvCd}
                 </if>
                 <if test="@MybatisUtils@isNotEmpty(ostrOjWareNo)">
                   AND T1.OSTR_OJ_WARE_NO = #{ostrOjWareNo}
                 </if>
                 <if test="@MybatisUtils@isNotEmpty(wareLocaraCd)">
                   AND T2.WARE_LOCARA_CD = #{wareLocaraCd}
                 </if>
                 GROUP BY T1.OSTR_AK_TP_CD
                        , T1.OSTR_OJ_WARE_NO
                        , T1.STR_OJ_WARE_NO
                        , T1.OSTR_AK_RGST_DT
                        , T1.OSTR_AK_NO
                        , T1.STR_HOP_DT
                        , T1.OVIV_TP_CD
                HAVING (CASE WHEN T1.OSTR_AK_RGST_DT > '20190700'
			                 THEN CASE WHEN COUNT(T1.OSTR_CNFM_QTY) - COUNT(T1.OSTR_AGG_QTY) = 0
			                           THEN '1'
			                           ELSE '0'
			                            END
			            ELSE CASE WHEN COUNT(*) = COUNT(T1.RECT_OSTR_DT)
			                      THEN '1'
			                      ELSE '0'
			                       END
			             END) = CASE WHEN #{ostrCnfm} = 'Y' THEN '1'
                                     ELSE '0'
                                      END
               )J1
         INNER JOIN TB_PDBS_PD_BAS J2
            ON J1.ITM_PD_CD = J2.PD_CD
         INNER JOIN TB_PDBS_PD_ECOM_PRP_DTL J3
            ON J2.PD_CD = J3.PD_CD AND J3.PD_EXTS_PRP_GRP_CD = 'PART'
         <where>
            <if test="@MybatisUtils@isNotEmpty(itmKndCd)">
               AND J3.PD_PRP_VAL19 = #{itmKndCd}
            </if>
         </where>
    </select>

    <select id="selectWarehouses"
            resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaNormalOutOfStorageDto$SearchWarehouse">
        SELECT T1.WARE_NO
             , T1.WARE_NM
          FROM TB_SVST_MCBY_WARE_IZ T1
         <where>
           <if test="@MybatisUtils@isNotEmpty(apyYm)">
           AND T1.APY_YM = #{apyYm}
           </if>
           <if test="@MybatisUtils@isEmpty(apyYm)">
           AND T1.APY_YM = TO_CHAR(SYSDATE, 'YYYYMM')
           </if>
           /* TODO : 사용자 계정으로 정리해야함. */
           AND T1.WARE_MNGT_PRTNR_NO = '36680'

           AND T1.WARE_USE_YN = 'Y'
         </where>
         ORDER BY T1.WARE_NO
    </select>

    <select id="selectAskMaterialsHavePss"
            resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaNormalOutOfStorageDto$AskRes">
        SELECT TA.WARE_MNGT_PRTNR_NO
             , TA.WARE_NM
             , TB.ITM_PD_CD
             , TA.WARE_NO
             , NVL((TB.PITM_STOC_A_GD_QTY - MMT_STOC_A_GD_QTY),0) AS QTY
          FROM TB_SVST_MCBY_WARE_IZ TA
         INNER JOIN TB_SVST_CST_SV_ITM_STOC_IZ TB
            ON TB.WARE_NO = TA.WARE_NO
         WHERE 1 = 1
           AND TA.APY_YM = TO_CHAR(SYSDATE, 'YYYYMM')
           AND TA.WARE_USE_YN = 'Y'
           AND TA.WARE_DV_CD = '2'
           AND TB.ITM_PD_CD = #{itmPdCd}
           AND TA.HGR_WARE_NO = (SELECT HGR_WARE_NO
                                   FROM TB_SVST_MCBY_WARE_IZ
                                  WHERE APY_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                                    AND WARE_USE_YN = 'Y'
                                    AND WARE_NO = #{strOjWareNo}
                                    AND WARE_DTL_DV_CD != '20')
         ORDER BY WARE_NM
    </select>

    <select id="selectAskMaterialsCenterPresentState" resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaNormalOutOfStorageDto$CenterRes">
            SELECT WARE_NO
                , NVL((PITM_STOC_A_GD_QTY - MMT_STOC_A_GD_QTY),0) AS QTY
                , (SELECT T2.OG_NM
                     FROM TB_SVST_MCBY_WARE_IZ T1
                    INNER JOIN TB_OGBS_MM_OG_IZ T2
                       ON T1.OG_ID = T2.OG_ID
                      AND T1.APY_YM = T2.BASE_YM
                    WHERE 1 = 1
                      AND T1.APY_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                      AND WARE_DTL_DV_CD = '20') AS OG_NM
             FROM TB_SVST_CST_SV_ITM_STOC_IZ
            WHERE 1 = 1
              AND ITM_PD_CD = #{itmPdCd}
              AND WARE_NO IN ( SELECT WARE_NO
                                 FROM TB_SVST_MCBY_WARE_IZ
                                WHERE 1 = 1
                                  AND APY_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                                  AND WARE_DTL_DV_CD = '20')
    </select>

    <select id="selectNormalOutOfStoragesDetails"
        resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaNormalOutOfStorageDto$DetailRes">
        SELECT 'I' AS FLAG
             , (CASE WHEN T1.OSTR_AK_RGST_DT <![CDATA[>]]> '20190700'
                     THEN CASE WHEN (NVL(T1.OSTR_CNFM_QTY,0) - NVL(T1.OSTR_AGG_QTY,0)) = 0
                              THEN '0'
                              ELSE '1'
                          END
                     ELSE CASE WHEN T1.RECT_OSTR_DT IS NULL
                              THEN '1'
                              ELSE '0'
                          END
               END) AS CHK
             , T1.OSTR_AK_TP_CD
             , (CASE T1.OSTR_AK_TP_CD
                     WHEN '310' THEN '221'
                     WHEN '320' THEN '223'
                     WHEN '330' THEN '221'
               END) AS OSTR_TP_CD
             , T1.STR_OJ_WARE_NO
             , T1.OSTR_AK_RGST_DT
             , T1.OSTR_AK_SN || '' AS OSTR_AK_SN
             , T1.OSTR_AK_NO
             , T1.STR_HOP_DT
             , T3.PD_PRP_VAL19 /* ST156_ITEM_KND */
             , T1.ITM_PD_CD
             , T1.ITM_CD
             , T2.PD_NM
             , T2.SAP_MAT_CD
             /* TODO:  품목위치를 교원파주물류센터,표준창고 서대구,대전센터 확인할것 */
             /* ITEM_LOC */
             /* PAJU_LOC */
             , (SELECT CASE WHEN #{ostrOjWareNm} = '교원파주물류센터'
                            THEN (SELECT CD1.CD_CNTN
                                         FROM T_CMZ_CD_D CD1
                                        WHERE CD1.CD_ID = 'WARE_TP_CD'
                                          AND CD1.CD_VLD_VAL = S1.WARE_TP_CD)
                                   || ' '
                                   || (SELECT CD2.CD_CNTN
                                          FROM T_CMZ_CD_D CD2
                                         WHERE CD2.CD_ID = 'LCT_ANGLE_CD'
                                           AND CD2.CD_VLD_VAL = S1.ITM_LCT_ANGLE_VAL)
                                   || ' '
                                   || (SELECT CD3.CD_CNTN
                                         FROM T_CMZ_CD_D CD3
                                        WHERE CD3.CD_ID = 'LCT_FLOR_NO_CD'
                                          AND CD3.CD_VLD_VAL = S1.ITM_LCT_FLOR_NO_VAL)
                                   || ' '
                                   || (SELECT CD4.CD_CNTN
                                         FROM T_CMZ_CD_D CD4
                                        WHERE CD4.CD_ID = 'LCT_COF_CD'
                                          AND CD4.CD_VLD_VAL = S1.ITM_LCT_COF_VAL)
                                   || ' '
                                   || (SELECT CD5.CD_CNTN
                                         FROM T_CMZ_CD_D CD5
                                        WHERE CD5.CD_ID = 'LCT_MAT_GRP_CD'
                                          AND CD5.CD_VLD_VAL = S1.ITM_LCT_MAT_GRP_CD)
                            ELSE (SELECT CD6.CD_CNTN
                                    FROM T_CMZ_CD_D CD6
                                   WHERE CD6.CD_ID = 'WARE_TP_CD'
                                     AND CD6.CD_VLD_VAL = S1.WARE_TP_CD)
                                   || ' '
                                   || (SELECT CD7.CD_CNTN
                                         FROM T_CMZ_CD_D CD7
                                        WHERE CD7.CD_ID = 'LCT_ANGLE_CD'
                                          AND CD7.CD_VLD_VAL = S1.ITM_LCT_ANGLE_VAL)
                                   || ' '
                                   || (SELECT CD8.CD_CNTN
                                         FROM T_CMZ_CD_D CD8
                                        WHERE CD8.CD_ID = 'LCT_COF_CD'
                                          AND CD8.CD_VLD_VAL = S1.ITM_LCT_COF_VAL)
                                   || ' '
                                   || (SELECT CD9.CD_CNTN
                                         FROM T_CMZ_CD_D CD9
                                        WHERE CD9.CD_ID = 'LCT_FLOR_NO_CD'
                                          AND CD9.CD_VLD_VAL = S1.ITM_LCT_FLOR_NO_VAL)
                                   ||' '
                                   || (SELECT CD10.CD_CNTN
                                         FROM T_CMZ_CD_D CD10
                                        WHERE CD10.CD_ID = 'LCT_MAT_GRP_CD'
                                          AND CD10.CD_VLD_VAL = S1.ITM_LCT_MAT_GRP_CD)
		               END
                  FROM TB_SVST_CST_SV_ITM_LCT_IZ S1
                 WHERE S1.WARE_NO = (SELECT CASE WHEN #{stckStdGb} != '1' THEN '200012'
                                                 WHEN S2.WARE_NO = '100002' THEN '' /* 교원파주물류센터로 조회 시 품목위치 조회되게 변경(2020.12.03 안승기 매니저님) */
                                                 ELSE S2.WARE_NO
                                                  END
                                       FROM TB_SVST_MCBY_WARE_IZ S2
                                      WHERE S2.WARE_NM = #{ostrOjWareNm}
                                        AND S2.APY_YM = SUBSTR(#{ostrAkRgstDt},1,6)
                                    )
                   AND S1.ITM_PD_CD  = T1.ITM_PD_CD
               ) AS ITEM_LOC
             , (SELECT S3.OSTR_TMS || ''
                  FROM TB_SVST_CST_SV_ITM_LCT_IZ S3
                 WHERE S3.WARE_NO = (SELECT CASE WHEN S4.WARE_NO = '100002' THEN S4.WARE_NO
                                                 ELSE ''
                                             END
                                       FROM TB_SVST_MCBY_WARE_IZ S4
                                      WHERE S4.WARE_NM = #{ostrOjWareNm}
                                        AND S4.APY_YM = SUBSTR(#{ostrAkRgstDt},1,6)
                                    )
                   AND S3.ITM_PD_CD  = T1.ITM_PD_CD
               ) AS PAJU_LOC
             , T1.OSTR_AK_WARE_DV_CD /* ST156_REQ_DEPT_GB */
             , T1.WARE_MNGT_PRTNR_NO /* ST156_REQ_STCK_MGR */
             , T1.ITM_GD_CD
             , '0' AS REQ_STCK_QTY
             /*
             , (CASE T1.ITM_GD_CD
                     WHEN 'A' THEN (T4.PITM_STOC_A_GD_QTY - T4.MMT_STOC_A_GD_QTY)
                     WHEN 'B' THEN (T4.PITM_STOC_B_GD_QTY - T4.MMT_STOC_B_GD_QTY)
                     WHEN 'E' THEN (T4.PITM_STOC_E_GD_QTY - T4.MMT_STOC_E_GD_QTY)
                     WHEN 'R' THEN (T4.PITM_STOC_R_GD_QTY - T4.MMT_STOC_R_GD_QTY)
               END) AS REQ_STCK_QTY--요청창고 재고수량
              */
             , T1.OSTR_OJ_WARE_NO
             , T1.OSTR_WARE_MNGT_PRTNR_NO
             , T1.MNGT_UNIT_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'MNGT_UNIT_CD', T1.MNGT_UNIT_CD) AS MGT_UNT_NM
             , T1.BOX_UNIT_QTY || '' AS BOX_UNIT_QTY
             , T1.OSTR_AK_QTY || '' AS OSTR_AK_QTY
             , '0' AS QTY
             /*
             , (CASE T1.ITM_GD_CD
                     WHEN 'A' THEN (T5.PITM_STOC_A_GD_QTY - T5.MMT_STOC_A_GD_QTY)
                     WHEN 'B' THEN (T5.PITM_STOC_B_GD_QTY - T5.MMT_STOC_B_GD_QTY)
                     WHEN 'E' THEN (T5.PITM_STOC_E_GD_QTY - T5.MMT_STOC_E_GD_QTY)
                     WHEN 'R' THEN (T5.PITM_STOC_R_GD_QTY - T5.MMT_STOC_R_GD_QTY)
               END) AS QTY
              */
             , T1.OSTR_CNFM_QTY || '' AS OSTR_CNFM_QTY
             , T1.RMK_CN
             , T1.OSTR_CNFM_CD
             , T1.RECT_OSTR_DT
             , T1.OSTR_AGG_QTY || '' AS OSTR_AGG_QTY
             , (T1.OSTR_CNFM_QTY - T1.OSTR_AGG_QTY) || '' AS OUT_QTY
             , (T1.OSTR_CNFM_QTY - T1.OSTR_AGG_QTY) || '' AS OUT_QTY_ORG
             , '' AS STR_CONF_DT
             , T3.PD_PRP_VAL15 /* ST101_BASE_GB */
             , T3.PD_PRP_VAL16 /* ST101_BASE_COLOR_GB */
             , T3.PD_PRP_VAL02 /* ST101_MGT_TYP */
             , '' AS CFRM_CNT
             , '' AS AVG_OUT
             /* TODO: 일별 방문예정 집계 확인할것 */
             /* CFRM_CNT */
             /* AVG_OUT */
          FROM TB_SVST_ITM_OSTR_AK_IZ T1
         INNER JOIN TB_PDBS_PD_BAS T2
            ON T1.ITM_PD_CD = T2.PD_CD
         INNER JOIN TB_PDBS_PD_ECOM_PRP_DTL T3
            ON T1.ITM_PD_CD = T3.PD_CD
            /*
         INNER JOIN TB_SVST_CST_SV_ITM_STOC_IZ T4
            ON T1.ITM_PD_CD = T4.ITM_PD_CD
           AND T1.STR_OJ_WARE_NO = T4.WARE_NO
         INNER JOIN TB_SVST_CST_SV_ITM_STOC_IZ T5
            ON T1.ITM_PD_CD = T5.ITM_PD_CD
           AND T1.OSTR_OJ_WARE_NO = T5.WARE_NO
             */
         WHERE T1.OSTR_AK_TP_CD = #{ostrAkTpCd}
           AND T1.STR_OJ_WARE_NO = #{strOjWareNo}
           AND T1.OSTR_AK_RGST_DT = #{ostrAkRgstDt}
           AND T1.OSTR_AK_NO = #{ostrAkNo}
           AND T1.ITM_PD_CD = #{itmPdCd}
          ORDER BY T1.OSTR_AK_NO, T1.OSTR_AK_SN
    </select>

    <select id="selectStrNoAndOstrNo">
        /* TODO: sequence로 쿼리 바꿔야함*/
        /* 품목입고번호(ITM_STR_NO) 생성규칙 : 입고유형(3)+입고등록일자(8)+일련번호(7)(일련번호는 1부터 순차증가, 앞의 입고유형, 입고등록일자가 달라지면 다시 1부터 시작하도록신규채번 요청) */
        SELECT
               T1.STR_TP_CD || T1.STR_RGST_DT || MAX(NVL(T1.OSTR_SN,0)) + 1
          FROM TB_SVST_ITM_STR_IZ T1
         WHERE T1.STR_TP_CD = DECODE(#{ostrTpCd},'221','121','222','122','223','123','261','161','262','162')
           AND T1.STR_RGST_DT = #{strRgstDt}
    </select>

    <insert id="insertNormalOstrRgst">
        /* 품목출고 내역 등록 */
        INSERT INTO TB_SVST_ITM_OSTR_IZ (
               ITM_OSTR_NO
             , OSTR_TP_CD
             , OSTR_DT
             , OSTR_WARE_NO
             , OSTR_SN
             , ITM_KND_CD
             , ITM_CD
             , ITM_PD_CD
             , STR_AK_WARE_DV_CD
             , WARE_MNGT_PRTNR_NO
             , OSTR_WARE_DV_CD
             , MNGT_UNIT_CD
             , BOX_UNIT_QTY
             , ITM_GD_CD
             , OSTR_QTY
             , RMK_CN
             , OSTR_AK_NO
             , OSTR_AK_SN
             , STR_HOP_DT
             , ACB_DT /* 회계일자 */
             , EVID_DV_CD /* 증빙구분코드 */
             , ITM_STR_NO
             , STR_TP_CD
             , STR_WARE_NO
             , STR_SN
             , SELL_RCPDT
             , DTA_DL_YN
             <include refid="COMMON.insertSystemField"/>
        )
        SELECT #{itmOstrNo} /* 품목출고번호 채번 */
             , #{ostrTpCd}
             , #{ostrDt}
             , #{ostrWareNo}
             , #{ostrSn} /* MAX + 1 */
             , #{itmKndCd}
             , #{itmCd}
             , #{itmPdCd}
             , '1' /* STR_AK_WARE_DV_CD */
             , #{wareMngtPrtnrNo}
             , '1' /* OSTR_WARE_DV_CD */
             , #{mngtUnitCd}
             , #{boxUnitQty}
             , #{itmGdCd}
             , #{ostrQty}
             , #{rmkCn}
             , #{ostrAkNo}
             , #{ostrAkSn}
             , #{strHopDt}
             , #{acbDt} /* 회계일자 */
             , #{evidDvCd} /* 증빙구분코드 */
             , #{itmStrNo}
             , DECODE(#{ostrTpCd},'221','121','222','122','223','123','261','161','262','162')
             , #{strWareNo}
             , #{strSn}
             , #{sellRcpdt}
             , 'N' /* DTA_DL_YN : DEFAULT : N */
             <include refid="COMMON.insertSystemFieldValue"/>
          FROM DUAL
    </insert>

    <insert id="insertNormalStrRgst">
        /* 품목입고 내역 등록 */
        INSERT INTO TB_SVST_ITM_STR_IZ (
               ITM_STR_NO
             , STR_TP_CD
             , STR_WARE_NO
             , STR_RGST_DT
             , STR_SN
             , WARE_MNGT_PRTNR_NO
             , STR_WARE_DV_CD
             , DRT_STR_YN
             , DLVG_DLPNR_NO
             , ITM_CD
             , ITM_PD_CD
             , ITM_GD_CD
             , MNGT_UNIT_CD
	         , STR_QTY
	         , STR_UPRC_AMT
	         , STR_LOT_NO
	         , RMK_CN
	         , ACB_DT
	         , EVID_DV_CD
             , ITM_OSTR_NO
	         , OSTR_TP_CD
	         , OSTR_WARE_NO
	         , OSTR_DT
	         , OSTR_SN
	         , ITM_GD_CTR_DT
	         , ITM_GD_CTR_PRTNR_NO
	         , BFCT_ITM_GD_CD
             , DTA_DL_YN
             <include refid="COMMON.insertSystemField"/>
        )
        SELECT
               #{itmStrNo} /* 품목입고번호 채번 */
             , DECODE(#{ostrTpCd},'221','121','222','122','223','123','261','161','262','162')
             , #{strWareNo}
             , #{strRgstDt}
             , #{strSn} /* MAX + 1 */
             , #{wareMngtPrtnrNo}
             , '1'
             , 'N' /* DRT_STR_YN : DEFAULT : N */
             , #{dlvgDlpnrNo}
             , #{itmCd}
             , #{itmPdCd}
             , #{itmGdCd}
             , #{mngtUnitCd}
	         , #{strQty}
	         , 0
	         , ''
	         , #{rmkCn}
	         , #{acbDt}
	         , #{evidDvCd}
             , #{itmOstrNo} /* 품목출고번호 채번 */
	         , #{ostrTpCd}
	         , #{ostrWareNo}
	         , #{ostrDt}
	         , #{ostrSn}
	         , ''
	         , ''
	         , ''
             , 'N' /* DTA_DL_YN : DEFAULT : N */
             <include refid="COMMON.insertSystemFieldValue"/>
          FROM DUAL
    </insert>

    <select id="selectNormalOstrRgstChecked"
        resultType="int">
        SELECT (CASE WHEN #{ostrAkNo} > '20190700'
                    THEN COUNT(CASE WHEN (T1.OSTR_CNFM_QTY - T1.OSTR_AGG_QTY) != 0 THEN 1 END)
                    ELSE COUNT(CASE WHEN T1.RECT_OSTR_DT IS NULL THEN 1 END)
                END) AS CNT
          FROM TB_SVST_ITM_OSTR_AK_IZ T1
        <where>
           AND T1.OSTR_AK_NO = #{ostrAkNo}
           AND T1.OSTR_AK_SN IN (
           <foreach collection="list" item="item" separator=",">
               #{item}
           </foreach>
            )
        </where>
    </select>

</mapper>
