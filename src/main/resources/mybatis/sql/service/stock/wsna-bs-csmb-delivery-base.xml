<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaBsCsmbDeliveryBaseMapper">
    <insert id="insertDeliveryBase">
        <choose>
            <when test="@MybatisUtils@isEmpty(bfsvcCsmbDdlvOrtYn)">
                INSERT INTO TB_SVST_BFSVC_CSMB_BASE_BAS
                     ( MNGT_YM
                     , CSMB_PD_CD
                     , ITM_KNM
                     , MNGT_UNIT_CD
                     , GO_DV_CD
                     , GO_UPRC
                     , BOX_UNIT_QTY
                     , RMK_CN
                     , DTA_DL_YN
                     <include refid="COMMON.insertSystemField" />
                     )
                VALUES
                     ( #{mngtYm}
                     , #{csmbPdCd}
                     , #{itmKnm}
                     , #{mngtUnitCd}
                     , #{goDvCd}
                     , #{goUprc}
                     , #{boxUnitQty}
                     , #{rmkCn}
                     , 'N'
                     <include refid="COMMON.insertSystemFieldValue" />
                     )
            </when>
            <otherwise>
                INSERT INTO TB_SVST_BFSVC_CSMB_BASE_DTL
                     ( MNGT_YM
                     , CSMB_PD_CD
                     , BFSVC_CSMB_DDLV_OJ_CD
                     , BFSVC_CSMB_DDLV_ORT_YN
                     , BFSVC_CSMB_DDLV_TP_CD
                     , BFSVC_CSMB_DDLV_CMPT_BASE_CD
                     , BFSVC_CSMB_DDLV_OJ_PD_GRP_CD
                     , BFSVC_CSMB_DDLV_OJ_ACC_TP_CD
                     , BFSVC_CSMB_DDLV_UNIT_ACC_N
                     , BFSVC_CSMB_DDLV_UNIT_QTY
                     , BFSVC_CSMB_APLC_LM_QTY
                     , SORT_ODR
                     , DTA_DL_YN
                     <include refid="COMMON.insertSystemField" />
                     )
                VALUES
                     ( #{mngtYm}
                     , #{csmbPdCd}
                     , #{bfsvcCsmbDdlvOjCd}
                     , #{bfsvcCsmbDdlvOrtYn}
                     , #{bfsvcCsmbDdlvTpCd}
                     , #{bfsvcCsmbDdlvCmptBaseCd}
                     , #{bfsvcCsmbDdlvOjPdGrpCd}
                     , #{bfsvcCsmbDdlvOjAccTpCd}
                     , #{bfsvcCsmbDdlvUnitAccN}
                     , #{bfsvcCsmbDdlvUnitQty}
                     , #{bfsvcCsmbAplcLmQty}
                     , #{sortOdr}
                     , 'N'
                     <include refid="COMMON.insertSystemFieldValue" />
                     )
            </otherwise>
        </choose>

    </insert>

    <select id="selectDeliveryBaseDuplicateYn" resultType="String">
        SELECT 1
          FROM (SELECT 1
                  FROM TB_SVST_BFSVC_CSMB_BASE_BAS A
                 WHERE A.MNGT_YM = #{mngtYm}
                   AND A.CSMB_PD_CD = #{csmbPdCd}
                   AND A.ITM_KNM = #{itmKnm}
                   AND A.MNGT_UNIT_CD = #{mngtUnitCd}
                 UNION ALL
                SELECT 1
                  FROM TB_SVST_BFSVC_CSMB_BASE_DTL B
                 WHERE B.MNGT_YM = #{mngtYm}
                   AND B.CSMB_PD_CD = #{csmbPdCd}
                   AND B.BFSVC_CSMB_DDLV_OJ_CD  = #{bfsvcCsmbDdlvOjCd}
                   AND B.BFSVC_CSMB_DDLV_ORT_YN  = #{bfsvcCsmbDdlvOrtYn}
               )
         WHERE ROWNUM = 1
    </select>
</mapper>
