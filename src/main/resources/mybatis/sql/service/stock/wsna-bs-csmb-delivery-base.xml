<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaBsCsmbDeliveryBaseMapper">

    <select id="selectAllItemInformation" resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaBsCsmbDeliveryBaseDto$SearchItemsRes">
        SELECT D1.PD_CD
             , D1.PD_NM
             , D1.PD_ABBR_NM
          FROM TB_PDBS_PD_BAS D1                 /* 상품기본 */
         INNER JOIN TB_PDBS_PD_ECOM_PRP_DTL D2   /* 상품각사속성상세 */
            ON D2.PD_CD = D1.PD_CD
         WHERE D1.DTA_DL_YN          = 'N'
           AND D1.PD_TP_CD           = 'M'
           AND D2.DTA_DL_YN          = 'N'
           AND D2.PD_EXTS_PRP_GRP_CD = 'PART'
           AND ( D2.PD_PRP_VAL32 = 'Y' OR D2.PD_PRP_VAL32 IS NULL )
         ORDER BY D1.PD_NM
    </select>

    <select id="selectDeliveryBases" resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaBsCsmbDeliveryBaseDto$SearchRes">
        SELECT D1.MNGT_YM                                                                                                                 /* 관리년월 */
             , D1.CSMB_PD_CD                                                                                                              /* 소모품상품코드 */
             , D1.ITM_KNM                                                                                                                 /* 품목한글명 */
             , D1.MNGT_UNIT_CD                                                                                                            /* 관리단위코드 */
             , F_CMZ_CD_NM('TNT_WELLS', 'MNGT_UNIT_CD', D1.MNGT_UNIT_CD, #{session.langId})                       AS MNGT_UNIT_NM         /* 관리단위 */
             , D1.GO_DV_CD                                                                                                                /* 발주구분코드 */
             , F_CMZ_CD_NM('TNT_WELLS', 'GO_DV_CD', D1.GO_DV_CD, #{session.langId})                               AS GO_DV_NM             /* 발주구분 */
             , D1.GO_UPRC                                                                                                                 /* 발주단가 */
             , D1.BOX_UNIT_QTY                                                                                                            /* 박스단위수량 */
             , TO_CHAR(TO_NUMBER(D2.SAP_MAT_CD))                                                                  AS SAP_MAT_CD           /* SAP코드 */
             , D1.RMK_CN                                                                                                                  /* 비고내용 */
             , D3.NWCMR_ORT_YN                                                                                                            /* 운영여부(신입) */
             , D3.NWCMR_TP_CD                                                                                                             /* 유형코드(신입) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_TP_CD', D3.NWCMR_TP_CD, #{session.langId})               AS NWCMR_TP_NM          /* 유형(신입) */
             , D3.NWCMR_CMPT_BASE_CD                                                                                                      /* 산출기준코드(신입) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_CMPT_BASE_CD', D3.NWCMR_CMPT_BASE_CD, #{session.langId}) AS NWCMR_CMPT_BASE_NM   /* 산출기준(신입) */
             , D3.NWCMR_PD_GRP_CD                                                                                                         /* 상품그룹코드(신입) */
             , F_CMZ_CD_NM('TNT_WELLS', 'PD_GRP_CD', D3.NWCMR_PD_GRP_CD, #{session.langId})                       AS NWCMR_PD_GRP_NM      /* 상품그룹(신입) */
             , D3.NWCMR_ACC_TP_CD                                                                                                         /* 계정유형코드(신입) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_OJ_ACC_TP_CD', D3.NWCMR_ACC_TP_CD, #{session.langId})    AS NWCMR_ACC_TP_NM      /* 계정유형(신입) */
             , D3.NWCMR_UNIT_ACC_N                                                                                                        /* 단위계정수(신입) */
             , D3.NWCMR_UNIT_QTY                                                                                                          /* 단위수량(신입) */
             , D3.NWCMR_LM_QTY                                                                                                            /* 신청제한수량(신입) */
             , D3.NWCMR_SORT_ODR                                                                                                          /* 정렬순서(신입) */
             , D3.INDV_ORT_YN                                                                                                             /* 운영여부(개인) */
             , D3.INDV_TP_CD                                                                                                              /* 유형코드(개인) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_TP_CD', D3.INDV_TP_CD, #{session.langId})               AS INDV_TP_NM            /* 유형(개인) */
             , D3.INDV_CMPT_BASE_CD                                                                                                       /* 산출기준코드(개인) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_CMPT_BASE_CD', D3.INDV_CMPT_BASE_CD, #{session.langId}) AS INDV_CMPT_BASE_NM     /* 산출기준(개인) */
             , D3.INDV_PD_GRP_CD                                                                                                          /* 상품그룹코드(개인) */
             , F_CMZ_CD_NM('TNT_WELLS', 'PD_GRP_CD', D3.INDV_PD_GRP_CD, #{session.langId})                       AS INDV_PD_GRP_NM        /* 상품그룹(개인) */
             , D3.INDV_ACC_TP_CD                                                                                                          /* 계정유형코드(개인) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_OJ_ACC_TP_CD', D3.INDV_ACC_TP_CD, #{session.langId})    AS INDV_ACC_TP_NM        /* 계정유형(개인) */
             , D3.INDV_UNIT_ACC_N                                                                                                         /* 단위계정수(개인) */
             , D3.INDV_UNIT_QTY                                                                                                           /* 단위수량(개인) */
             , D3.INDV_LM_QTY                                                                                                             /* 신청제한수량(개인) */
             , D3.INDV_SORT_ODR                                                                                                           /* 정렬순서(개인) */
             , D3.BLD_ORT_YN                                                                                                              /* 운영여부(빌딩) */
             , D3.BLD_TP_CD                                                                                                               /* 유형코드(빌딩) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_TP_CD', D3.BLD_TP_CD, #{session.langId})               AS BLD_TP_NM              /* 유형(빌딩) */
             , D3.BLD_CMPT_BASE_CD                                                                                                        /* 산출기준코드(빌딩) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_CMPT_BASE_CD', D3.BLD_CMPT_BASE_CD, #{session.langId}) AS BLD_CMPT_BASE_NM       /* 산출기준(빌딩) */
             , D3.BLD_PD_GRP_CD                                                                                                           /* 상품그룹코드(빌딩) */
             , F_CMZ_CD_NM('TNT_WELLS', 'PD_GRP_CD', D3.BLD_PD_GRP_CD, #{session.langId})                       AS BLD_PD_GRP_NM          /* 상품그룹(빌딩) */
             , D3.BLD_ACC_TP_CD                                                                                                           /* 계정유형코드(빌딩) */
             , F_CMZ_CD_NM('TNT_WELLS', 'BFSVC_CSMB_DDLV_OJ_ACC_TP_CD', D3.BLD_ACC_TP_CD, #{session.langId})    AS BLD_ACC_TP_NM          /* 계정유형(빌딩) */
             , D3.BLD_UNIT_ACC_N                                                                                                          /* 단위계정수(빌딩) */
             , D3.BLD_UNIT_QTY                                                                                                            /* 단위수량(빌딩) */
             , D3.BLD_LM_QTY                                                                                                              /* 신청제한수량(빌딩) */
             , D3.BLD_SORT_ODR                                                                                                            /* 정렬순서(빌딩) */
          FROM TB_SVST_BFSVC_CSMB_BASE_BAS D1   /* BS소모품기준기본 */
         INNER JOIN TB_PDBS_PD_BAS D2           /* 상품기본 */
            ON D2.PD_CD = D1.CSMB_PD_CD
         INNER JOIN
             (
               SELECT MNGT_YM
                    , CSMB_PD_CD
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_ORT_YN END)       AS NWCMR_ORT_YN         /* 운영여부(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_TP_CD END)        AS NWCMR_TP_CD          /* 유형코드(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_CMPT_BASE_CD END) AS NWCMR_CMPT_BASE_CD   /* 산출기준코드(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_OJ_PD_GRP_CD END) AS NWCMR_PD_GRP_CD      /* 상품그룹코드(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_OJ_ACC_TP_CD END) AS NWCMR_ACC_TP_CD      /* 계정유형코드(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_UNIT_ACC_N END)   AS NWCMR_UNIT_ACC_N     /* 단위계정수(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_DDLV_UNIT_QTY END)     AS NWCMR_UNIT_QTY       /* 단위수량(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN BFSVC_CSMB_APLC_LM_QTY END)       AS NWCMR_LM_QTY         /* 신청제한수량(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '1' THEN SORT_ODR END)                     AS NWCMR_SORT_ODR       /* 정렬순서(신입) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_ORT_YN END)       AS INDV_ORT_YN          /* 운영여부(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_TP_CD END)        AS INDV_TP_CD           /* 유형코드(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_CMPT_BASE_CD END) AS INDV_CMPT_BASE_CD    /* 산출기준코드(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_OJ_PD_GRP_CD END) AS INDV_PD_GRP_CD       /* 상품그룹코드(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_OJ_ACC_TP_CD END) AS INDV_ACC_TP_CD       /* 계정유형코드(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_UNIT_ACC_N END)   AS INDV_UNIT_ACC_N      /* 단위계정수(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_DDLV_UNIT_QTY END)     AS INDV_UNIT_QTY        /* 단위수량(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN BFSVC_CSMB_APLC_LM_QTY END)       AS INDV_LM_QTY          /* 신청제한수량(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '2' THEN SORT_ODR END)                     AS INDV_SORT_ODR        /* 정렬순서(개인) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_ORT_YN END)       AS BLD_ORT_YN           /* 운영여부(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_TP_CD END)        AS BLD_TP_CD            /* 유형코드(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_CMPT_BASE_CD END) AS BLD_CMPT_BASE_CD     /* 산출기준코드(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_OJ_PD_GRP_CD END) AS BLD_PD_GRP_CD        /* 상품그룹코드(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_OJ_ACC_TP_CD END) AS BLD_ACC_TP_CD        /* 계정유형코드(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_UNIT_ACC_N END)   AS BLD_UNIT_ACC_N       /* 단위계정수(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_DDLV_UNIT_QTY END)     AS BLD_UNIT_QTY         /* 단위수량(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN BFSVC_CSMB_APLC_LM_QTY END)       AS BLD_LM_QTY           /* 신청제한수량(빌딩) */
                    , MAX(CASE WHEN BFSVC_CSMB_DDLV_OJ_CD = '3' THEN SORT_ODR END)                     AS BLD_SORT_ODR         /* 정렬순서(빌딩) */
                 FROM TB_SVST_BFSVC_CSMB_BASE_DTL
                WHERE DTA_DL_YN  = 'N'
                  AND MNGT_YM    = #{mngtYm}
            <if test="@MybatisUtils@isNotEmpty(csmbPdCd)">
                  AND CSMB_PD_CD = #{csmbPdCd}
            </if>
            <if test="@MybatisUtils@isNotEmpty(csmbPdCdStrt)">
                  AND CSMB_PD_CD <![CDATA[>=]]> #{csmbPdCdStrt}
            </if>
            <if test="@MybatisUtils@isNotEmpty(csmbPdCdEnd)">
                  AND CSMB_PD_CD <![CDATA[<=]]> #{csmbPdCdEnd}
            </if>
                GROUP BY MNGT_YM, CSMB_PD_CD
             ) D3
            ON D3.MNGT_YM    = D1.MNGT_YM
           AND D3.CSMB_PD_CD = D1.CSMB_PD_CD
         WHERE D1.DTA_DL_YN  = 'N'
           AND D2.DTA_DL_YN  = 'N'
           AND D2.PD_TP_CD   = 'M'
           AND D1.MNGT_YM    = #{mngtYm}
        <if test="@MybatisUtils@isNotEmpty(csmbPdCd)">
           AND D1.CSMB_PD_CD = #{csmbPdCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(goDvCd)">
           AND D1.GO_DV_CD   = #{goDvCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(csmbPdCdStrt)">
           AND D1.CSMB_PD_CD <![CDATA[>=]]> #{csmbPdCdStrt}
        </if>
        <if test="@MybatisUtils@isNotEmpty(csmbPdCdEnd)">
           AND D1.CSMB_PD_CD <![CDATA[<=]]> #{csmbPdCdEnd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(sapMatCdStrt)">
           AND D2.SAP_MAT_CD <![CDATA[>=]]> LPAD(#{sapMatCdStrt}, 18, '0')
        </if>
        <if test="@MybatisUtils@isNotEmpty(sapMatCdEnd)">
           AND D2.SAP_MAT_CD <![CDATA[<=]]> LPAD(#{sapMatCdEnd}, 18, '0')
        </if>
        <if test="@MybatisUtils@isNotEmpty(itmKnms)">
           AND D1.CSMB_PD_CD IN
                            <foreach collection="itmKnms" item="item" separator="," open="(" close=")">
                                 #{item}
                            </foreach>
        </if>
         ORDER BY D1.CSMB_PD_CD
    </select>

    <select id="selectExistNowMonthDeliveryBase" resultType="java.lang.Integer">
        SELECT COUNT(1)
          FROM TB_SVST_BFSVC_CSMB_BASE_BAS
         WHERE DTA_DL_YN = 'N'
           AND MNGT_YM   = #{mngtYm}
           AND ROWNUM    = 1
    </select>

    <select id="selectExistNowMonthDeliveryDtl" resultType="java.lang.Integer">
        SELECT COUNT(1)
          FROM TB_SVST_BFSVC_CSMB_BASE_DTL
         WHERE DTA_DL_YN = 'N'
           AND MNGT_YM   = #{mngtYm}
           AND ROWNUM    = 1
    </select>

    <insert id="insertDeliveryBasesNowMonth">
        INSERT INTO TB_SVST_BFSVC_CSMB_BASE_BAS   /* BS소모품기준기본 */
             (
               MNGT_YM        /* 관리년월 */
             , CSMB_PD_CD     /* 소모품상품코드 */
             , ITM_KNM        /* 품목한글명 */
             , MNGT_UNIT_CD   /* 관리단위 */
             , GO_DV_CD       /* 발주구분코드 */
             , GO_UPRC        /* 발주단가 */
             , BOX_UNIT_QTY   /* 박스단위수량 */
             , RMK_CN         /* 비고내용 */
             , DTA_DL_YN      /* 데이터삭제여부 */
        <include refid="COMMON.insertSystemField" />
             )
        SELECT #{carriedOverTo}
             , CSMB_PD_CD
             , ITM_KNM
             , MNGT_UNIT_CD
             , GO_DV_CD
             , GO_UPRC
             , BOX_UNIT_QTY
             , RMK_CN
             , 'N'
        <include refid="COMMON.insertSystemFieldValue" />
          FROM TB_SVST_BFSVC_CSMB_BASE_BAS
         WHERE DTA_DL_YN = 'N'
           AND MNGT_YM   = #{carriedOverFrom}
    </insert>

    <insert id="insertDeliveryBaseDtlsNowMonth">
        INSERT INTO TB_SVST_BFSVC_CSMB_BASE_DTL   /* BS소모품기준상세 */
             (
               MNGT_YM                        /* 관리년월 */
             , CSMB_PD_CD                     /* 소모품상품코드 */
             , BFSVC_CSMB_DDLV_OJ_CD          /* 대상코드 */
             , BFSVC_CSMB_DDLV_ORT_YN         /* 운영여부 */
             , BFSVC_CSMB_DDLV_TP_CD          /* 유형코드 */
             , BFSVC_CSMB_DDLV_CMPT_BASE_CD   /* 산출기준코드 */
             , BFSVC_CSMB_DDLV_OJ_PD_GRP_CD   /* 상품그룹코드 */
             , BFSVC_CSMB_DDLV_OJ_ACC_TP_CD   /* 계정유형코드 */
             , BFSVC_CSMB_DDLV_UNIT_ACC_N     /* 단위계정수 */
             , BFSVC_CSMB_DDLV_UNIT_QTY       /* 단위수량 */
             , BFSVC_CSMB_APLC_LM_QTY         /* 신청제한수량 */
             , SORT_ODR                       /* 정렬순서 */
             , DTA_DL_YN                      /* 데이터삭제여부 */
        <include refid="COMMON.insertSystemField" />
             )
        SELECT #{carriedOverTo}
             , CSMB_PD_CD
             , BFSVC_CSMB_DDLV_OJ_CD
             , BFSVC_CSMB_DDLV_ORT_YN
             , BFSVC_CSMB_DDLV_TP_CD
             , BFSVC_CSMB_DDLV_CMPT_BASE_CD
             , BFSVC_CSMB_DDLV_OJ_PD_GRP_CD
             , BFSVC_CSMB_DDLV_OJ_ACC_TP_CD
             , BFSVC_CSMB_DDLV_UNIT_ACC_N
             , BFSVC_CSMB_DDLV_UNIT_QTY
             , BFSVC_CSMB_APLC_LM_QTY
             , SORT_ODR
             , 'N'
        <include refid="COMMON.insertSystemFieldValue" />
          FROM TB_SVST_BFSVC_CSMB_BASE_DTL
         WHERE DTA_DL_YN = 'N'
           AND MNGT_YM   = #{carriedOverFrom}
    </insert>

    <select id="selectDeliveryBaseDuplicateYn" resultType="java.lang.String">
    <choose>
    <when test="@MybatisUtils@isEmpty(bfsvcCsmbDdlvOrtYn)">
        SELECT 1
          FROM TB_SVST_BFSVC_CSMB_BASE_BAS
         WHERE MNGT_YM    = #{mngtYm}
           AND CSMB_PD_CD = #{csmbPdCd}
    </when>
    <otherwise>
        SELECT 1
          FROM TB_SVST_BFSVC_CSMB_BASE_DTL
         WHERE MNGT_YM               = #{mngtYm}
           AND CSMB_PD_CD            = #{csmbPdCd}
           AND BFSVC_CSMB_DDLV_OJ_CD = #{bfsvcCsmbDdlvOjCd}
    </otherwise>
    </choose>
    </select>

    <insert id="insertDeliveryBase">
    <choose>
    <when test="@MybatisUtils@isEmpty(bfsvcCsmbDdlvOrtYn)">
        INSERT INTO TB_SVST_BFSVC_CSMB_BASE_BAS   /* BS소모품기준기본 */
             (
               MNGT_YM        /* 관리년월 */
             , CSMB_PD_CD     /* 소모품상품코드 */
             , ITM_KNM        /* 품목한글명 */
             , MNGT_UNIT_CD   /* 관리단위코드 */
             , GO_DV_CD       /* 발주구분코드 */
             , GO_UPRC        /* 발주단가 */
             , BOX_UNIT_QTY   /* 박스단위수량 */
             , RMK_CN         /* 비고내용 */
             , DTA_DL_YN      /* 데이터삭제여부 */
        <include refid="COMMON.insertSystemField" />
             )
        VALUES
             (
               #{mngtYm}
             , #{csmbPdCd}
             , #{itmKnm}
             , #{mngtUnitCd}
             , #{goDvCd}
             , #{goUprc}
             , #{boxUnitQty}
             , #{rmkCn}
             , 'N'
        <include refid="COMMON.insertSystemFieldValue" />
             )
    </when>
    <otherwise>
        INSERT INTO TB_SVST_BFSVC_CSMB_BASE_DTL   /* BS소모품기준상세 */
             (
               MNGT_YM                        /* 관리년월 */
             , CSMB_PD_CD                     /* 소모품상품코드 */
             , BFSVC_CSMB_DDLV_OJ_CD          /* 대상코드 */
             , BFSVC_CSMB_DDLV_ORT_YN         /* 운영여부 */
             , BFSVC_CSMB_DDLV_TP_CD          /* 유형코드 */
             , BFSVC_CSMB_DDLV_CMPT_BASE_CD   /* 산출기준코드 */
             , BFSVC_CSMB_DDLV_OJ_PD_GRP_CD   /* 상품그룹코드 */
             , BFSVC_CSMB_DDLV_OJ_ACC_TP_CD   /* 계정유형코드 */
             , BFSVC_CSMB_DDLV_UNIT_ACC_N     /* 단위계정수 */
             , BFSVC_CSMB_DDLV_UNIT_QTY       /* 단위수량 */
             , BFSVC_CSMB_APLC_LM_QTY         /* 신청제한수량 */
             , SORT_ODR                       /* 정렬순서 */
             , DTA_DL_YN                      /* 데이터삭제여부 */
        <include refid="COMMON.insertSystemField" />
             )
        VALUES
             (
               #{mngtYm}
             , #{csmbPdCd}
             , #{bfsvcCsmbDdlvOjCd}
             , #{bfsvcCsmbDdlvOrtYn}
             , #{bfsvcCsmbDdlvTpCd}
             , #{bfsvcCsmbDdlvCmptBaseCd}
             , #{bfsvcCsmbDdlvOjPdGrpCd}
             , #{bfsvcCsmbDdlvOjAccTpCd}
             , #{bfsvcCsmbDdlvUnitAccN}
             , #{bfsvcCsmbDdlvUnitQty}
             , #{bfsvcCsmbAplcLmQty}
             , #{sortOdr}
             , 'N'
        <include refid="COMMON.insertSystemFieldValue" />
             )
    </otherwise>
    </choose>
    </insert>

    <update id="updateDeliveryBase">
    <choose>
    <when test="@MybatisUtils@isEmpty(bfsvcCsmbDdlvOrtYn)">
        UPDATE TB_SVST_BFSVC_CSMB_BASE_BAS   /* BS소모품기준기본 */
           SET MNGT_UNIT_CD = #{mngtUnitCd}   /* 관리단위코드 */
             , GO_DV_CD     = #{goDvCd}       /* 발주구분코드 */
             , GO_UPRC      = #{goUprc}       /* 발주단가 */
             , BOX_UNIT_QTY = #{boxUnitQty}   /* 박스단위수량 */
             , RMK_CN       = #{rmkCn}        /* 비고내용 */
        <include refid="COMMON.updateSystemField"/>
         WHERE MNGT_YM    = #{mngtYm}
           AND CSMB_PD_CD = #{csmbPdCd}
    </when>
    <otherwise>
        UPDATE TB_SVST_BFSVC_CSMB_BASE_DTL   /* BS소모품기준상세 */
           SET BFSVC_CSMB_DDLV_ORT_YN       = #{bfsvcCsmbDdlvOrtYn}        /* 운영여부 */
             , BFSVC_CSMB_DDLV_TP_CD        = #{bfsvcCsmbDdlvTpCd}         /* 유형코드 */
             , BFSVC_CSMB_DDLV_CMPT_BASE_CD = #{bfsvcCsmbDdlvCmptBaseCd}   /* 산출기준코드 */
             , BFSVC_CSMB_DDLV_OJ_PD_GRP_CD = #{bfsvcCsmbDdlvOjPdGrpCd}    /* 상품그룹코드 */
             , BFSVC_CSMB_DDLV_OJ_ACC_TP_CD = #{bfsvcCsmbDdlvOjAccTpCd}    /* 계정유형코드 */
             , BFSVC_CSMB_DDLV_UNIT_ACC_N   = #{bfsvcCsmbDdlvUnitAccN}     /* 단위계정수 */
             , BFSVC_CSMB_DDLV_UNIT_QTY     = #{bfsvcCsmbDdlvUnitQty}      /* 단위수량 */
             , BFSVC_CSMB_APLC_LM_QTY       = #{bfsvcCsmbAplcLmQty}        /* 신청제한수량 */
             , SORT_ODR                     = #{sortOdr}                   /* 정렬순서 */
        <include refid="COMMON.updateSystemField"/>
         WHERE MNGT_YM               = #{mngtYm}
           AND CSMB_PD_CD            = #{csmbPdCd}
           AND BFSVC_CSMB_DDLV_OJ_CD = #{bfsvcCsmbDdlvOjCd}
    </otherwise>
    </choose>
    </update>

</mapper>
