<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaReturningGoodsStoreMapper">

    <select id="selectReturningGoodsStores" resultType="com.kyowon.sms.wells.web.service.stock.dto.WsnaReturningGoodsStoreDto$SearchRes">

        SELECT T1.CST_SV_ASN_NO /*고객서비스배정내역*/
               , T5.SVPD_SAP_CD AS SAP_CD /*SAP코드*/
               , T1.ITM_PD_CD /*품목상품코드*/
               , T5.SVPD_NM_KOR AS ITM_PD_NM /*품목상품명*/
               , (CASE WHEN T5.SVPD_ITEM_GR IN ('1', '3', '4', '92', '11', '10', '93', '95', '91') THEN F_CMZ_CD_NM('TNT_WELLS', 'PD_GRP_CD', T5.SVPD_ITEM_GR)
                       WHEN T5.SVPD_ITEM_GR = '2' AND T5.SVPD_ITEM_CD = '42990' THEN '커피머신'
                       WHEN T5.SVPD_ITEM_CD IN ('49010', '49020') THEN '커피머신'
                       WHEN T5.SVPD_ITEM_GR IN ('5', '7', '8') THEN '기타'
                       WHEN T5.SVPD_ITEM_GR IN ('9') AND T5.SVPD_ITEM_CD IN ('49200', '49060', '49070', '49080') THEN '기타'
                       ELSE F_CMZ_CD_NM('TNT_WELLS', 'PD_GRP_CD', T5.SVPD_ITEM_GR)
                   END ) AS ITEM_GR_NM
             , T5.SVPD_ITEM_GR AS ITEM_GR
             , T1.STKR_PRNT_YN /*스티커출력여부*/
             , T3.IST_DT /*설치일자*/
             , (SELECT A1.REQD_DT
                  FROM TB_SSCT_CNTR_WELLS_DTL A1
                 WHERE 1 = 1
                   AND A1.CNTR_NO = X1.CNTR_NO) AS REQD_DT /*철거일자*/
             , TO_CHAR(TO_DATE(T4.VST_FSH_DT,'YYYYMMDD'),'YYYY-MM-DD') || ' ' || TO_CHAR(TO_DATE(T4.VST_FSH_HH,'HH24MISS'),'HH24:MI:SS') AS VST_FSH_DT /*작업일자*/
             , T1.RTNGD_CONF_YN  /*반품확인여부*/
             , CEIL(MONTHS_BETWEEN(T1.FNL_VST_FSH_DT, T3.IST_DT)) AS USE_MTHS /*사용개월*/
             , (CASE WHEN MONTHS_BETWEEN(T1.FNL_VST_FSH_DT, T3.IST_DT)   <![CDATA[ <= ]]>   1 THEN 'Y'
                         ELSE 'N'
                    END) AS REFURBISH_YN    --리퍼여부
             , T1.FNL_ITM_GD_CD /*등급*/
             , T1.USE_QTY /*사용수량*/
             , CASE WHEN T1.REFR_AS_RCP_YN = '1' THEN '접수완료'
                    ELSE ''
                END REFR_AS_RCP_YN /*리퍼접수*/
             , T1.CNTR_NO || '-' ||T1.CNTR_SN AS CNTR_DTL_NO /*고객번호*/
             , X4.RCGVP_KNM
             , X2.SELL_TP_CD /*판매유형코드*/
             , F_CMZ_CD_NM('TNT_WELLS', 'SELL_TP_CD', X2.SELL_TP_CD) AS SELL_TP_NM /*판매유형명*/
             , (CASE WHEN X2.FRISU_YN = 'Y' THEN '무료체험'
                     WHEN X2.ALNCMP_CD = '45' THEN F_CMZ_CD_NM('TNT_WELLS', 'ALNCMP_CD', X2.ALNCMP_CD)
                     ELSE ''
                END) AS REFER_ARTC /*참고사항*/
             , T1.SV_BIZ_DCLSF_CD /*서비스업무세분류코드 BA04*/
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_DCLSF_CD', T1.SV_BIZ_DCLSF_CD) AS SV_BIZ_DCLSF_NM /*업무유형*/
             , T1.OSTR_CONF_DT /*확인일자*/
             , T1.OSTR_CONF_DT AS OSTR_CONF_DT1 /*확인일자*/
             , T1.OSTR_DT /*전산반품*/
             , T1.RTNGD_PROCS_TP_CD /*반품처리유형코드*/
             , T1.RTNGD_PROCS_TP_CD AS RTNGD_PROCS_TP_CD1 /*반품처리유형코드*/
             , T1.RMK_CN /*특이사항*/
             , (CASE WHEN SUBSTR(T1.CST_SV_ASN_NO,1,1) = '9' THEN T2.CNTR_NO
                     ELSE ''
                 END) AS CNTR_NO_NEW /*신규 고객번호*/
             , CASE WHEN T1.FNL_ITM_GD_CD = 'E'
                     AND T1.SV_BIZ_DCLSF_CD = '3210'
                    THEN T1.FST_BC_NO
                    ELSE T4.BC_NO
                END AS BAR_CD /*제조번호*/
             , F_CMZ_CD_NM('TNT_WELLS', 'AS_LCT_CD', T4.AS_LCT_CD) AS AS_LCT_NM /*AS위치코드*/
             , F_CMZ_CD_NM('TNT_WELLS', 'AS_PHN_CD', T4.AS_PHN_CD) AS AS_PHN_NM /*AS현상코드*/
             , F_CMZ_CD_NM('TNT_WELLS', 'AS_CAUS_CD', T4.AS_CAUS_CD) AS AS_CAUS_NM /*AS원인코드*/
             , T4.SV_PROCS_CN /*서비스처리내용*/
             , T1.ICHR_PRTNR_NO /*담당엔지니어사번*/
             , (SELECT A1.PRTNR_KNM
                  FROM TB_OGBS_PRTNR_BAS A1
                 WHERE 1 = 1
                   AND A1.PRTNR_NO = T1.ICHR_PRTNR_NO
                   AND A1.OG_TP_CD = T1.OG_TP_CD) AS EMP_NM /*담당엔지니어명*/
             , T2.FST_RGST_USR_ID /*철거요청사번*/
             , (SELECT A.PRTNR_KNM
                          FROM TB_OGBS_PRTNR_BAS A
                         WHERE 1 = 1
                           AND A.PRTNR_NO = T2.FST_RGST_USR_ID
                           AND A.OG_TP_CD IN ('W02','W06','HR1')
                           AND ROWNUM = 1) AS FST_RGST_USER_NM /*철거요청자명*/
             , T2.CNSL_MO_CN /*접수내역*/
             /*접수자소속*/
             , T7.PRTNR_KNM /*접수자명*/
             , F_CMZ_CD_NM('TNT_WELLS', 'BAD_DV_CD', T4.BAD_DV_CD) AS BAD_DV_NM /*불량구분*/
             , T1.WK_OSTR_SN /*작업출고일련번호*/
             , T1.SV_BIZ_HCLSF_CD /*서비스대분류코드*/
             , T1.WK_WARE_NO /*작업창고번호*/
             , T8.WARE_NM /*창고명*/
             , T1.MNGR_DV_CD /*관리자 구분코드*/
             , T1.ITM_OSTR_NO /*품목출고번호*/
             , T1.STKR_R_PRNT_YN /*스티거R출력여부*/
        --     , (SELECT A1.DEPT_NM2
        --          FROM TB_OGBS_MM_OG_IZ A1
        --         WHERE 1 = 1
        --           AND A1.DEPT_CD = T1.BIZ_CD) AS DEPT_NM
             , DECODE(T1.RTNGD_RVPY_PROCS_YN, 'Y','Y','N') AS RTNGD_RVPY_PROCS_YN
             , T5.SVPD_ITEM_KND AS ITEM_KND
             , T5.SVPD_MGT_UNT AS MGT_UNT
             , T1.CNTR_NO
             , T1.CNTR_SN
            FROM TB_SVST_SV_WK_OSTR_IZ T1 /*LC_STOCK_ST163TB*/
           INNER JOIN TB_SVPD_CST_SVAS_IST_OJ_IZ T2 /*LC_ALLOCATE_AC211TB*/
              ON T2.CST_SV_ASN_NO = DECODE(SUBSTR(T1.CST_SV_ASN_NO,1,1),'9', '1', T1.CST_SV_ASN_NO)
           INNER JOIN TB_SVPD_CST_SV_EXCN_IZ T3 /*LC_ALLOCATE_AC201TB*/
              ON T3.CNTR_NO = T1.CNTR_NO
             AND T3.CNTR_SN = T1.CNTR_SN
           INNER JOIN TB_SVPD_CST_SV_WK_RS_IZ T4 /*LC_VISIT_VS106TB*/
              ON T4.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
             AND T4.CNTR_NO = T1.CNTR_NO
             AND T4.CNTR_SN = T1.CNTR_SN
           INNER JOIN (<include refid="com.kyowon.sms.wells.web.service.common.BASE.selectPartMaster"/>) T5
              ON T5.SVPD_PD_CD = T1.ITM_PD_CD
             LEFT OUTER JOIN TB_SSCT_CNTR_BAS /*계약기본*/ X1
                ON X1.CNTR_NO = T3.CNTR_NO
               AND X1.DTA_DL_YN = 'N'
             INNER JOIN TB_SSCT_CNTR_DTL /*계약상세*/ X2
                ON X2.CNTR_NO = X1.CNTR_NO
               AND X2.DTA_DL_YN = 'N'
             INNER JOIN TB_SSCT_CNTR_ADR_REL X3
                ON X3.DTL_CNTR_NO = X2.CNTR_NO
               AND X3.DTL_CNTR_SN = X2.CNTR_SN
               AND X3.ADRPC_TP_CD = '3'
               AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') BETWEEN X3.VL_STRT_DTM AND X3.VL_END_DTM
               AND X3.DTA_DL_YN = 'N'
             INNER JOIN TB_SSCT_CNTR_ADRPC_BAS X4
                ON X4.CNTR_ADRPC_ID = X3.CNTR_ADRPC_ID
             LEFT OUTER JOIN (SELECT A.*
                                FROM TB_SVPD_CST_SVAS_IST_OJ_IZ A
                               INNER JOIN TB_SVPD_CST_SVAS_IST_ASN_IZ B
                                  ON A.CST_SV_ASN_NO = B.CST_SV_ASN_NO
                               WHERE 1 = 1
                                 AND A.SV_BIZ_DCLSF_CD LIKE '11%'
                                 AND A.MTR_STAT_CD != '3'
                                 AND B.WK_PRGS_STAT_CD = '20'
                                 AND A.DTA_DL_YN = 'N'
                                 AND B.DTA_DL_YN = 'N'
                                 AND ROWNUM = 1) T6
                ON T6.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
              LEFT OUTER JOIN TB_OGBS_MM_PRTNR_IZ T7
                    ON T7.PRTNR_NO = T6.FST_RGST_USR_ID
                   AND T7.BASE_YM = SUBSTR(T6.FST_RGST_DTM, 1, 6)
                   AND T7.OG_TP_CD IN ('W06', 'W02', 'HR1')
                   AND T7.DTA_DL_YN = 'N'
             INNER JOIN (SELECT WARE_NO
                              , MAX(WARE_NM) AS WARE_NM
                              , HGR_WARE_NO
                              , WARE_DV_CD
                           FROM TB_SVST_MCBY_WARE_IZ
                          WHERE 1 = 1
                            AND APY_YM BETWEEN SUBSTR(#{stFnlVstFshDtFrom},1,6) AND SUBSTR(#{edFnlVstFshDtTo},1,6)
                          <if test="@MybatisUtils@isNotEmpty(strWareNoM)">
                            AND HGR_WARE_NO = #{strWareNoM}
                          </if>
        --                    AND WARE_DV_CD = '2'
                            AND DTA_DL_YN = 'N'
                          GROUP BY WARE_NO
                                 , HGR_WARE_NO
                                 , WARE_DV_CD
                         ) T8
                    ON T8.WARE_NO = T1.WK_WARE_NO
               WHERE T1.FNL_VST_FSH_DT BETWEEN #{stFnlVstFshDtFrom} AND #{edFnlVstFshDtTo}
                 AND T1.SV_BIZ_HCLSF_CD = '6'
            <if test="@MybatisUtils@isNotEmpty(fnlItmGdCd)">
                 AND T1.FNL_ITM_GD_CD = #{fnlItmGdCd}
            </if>
            <if test="@MybatisUtils@isNotEmpty(itmKndCd)">
                 AND T5.SVPD_ITEM_KND = #{itmKndCd}
            </if>
            <if test="@MybatisUtils@isNotEmpty(itmPdCd)">
                 AND T5.SVPD_PD_CD = #{itmPdCd}
            </if>
            <if test="@MybatisUtils@isEmpty(stRtngdProcsTpCd)">
                 AND T1.FNL_VST_FSH_DT BETWEEN #{stFnlVstFshDtFrom} AND #{edFnlVstFshDtTo}
            </if>
            <if test="@MybatisUtils@isNotEmpty(stRtngdProcsTpCd)">
                 AND T1.RTNGD_PROCS_TP_CD = #{stRtngdProcsTpCd}
                 AND T1.OSTR_CONF_DT BETWEEN #{stFnlVstFshDtFrom} AND #{edFnlVstFshDtTo}
            </if>
            <if test="@MybatisUtils@isNotEmpty(strWareDvCd)">
                 AND T8.WARE_DV_CD = #{strWareDvCd}
            </if>
            <if test="@MybatisUtils@isNotEmpty(strWareNoM)">
                 AND T8.HGR_WARE_NO = #{strWareNoM}
            </if>
            <if test="@MybatisUtils@isNotEmpty(strWareNoD)">
                 AND T8.WARE_DV_CD = #{strWareNoD}
            </if>
            <if test="@MybatisUtils@isNotEmpty(svBizDclsfCd)">
                 AND T1.SV_BIZ_DCLSF_CD = #{svBizDclsfCd}
            </if>
            <if test="@MybatisUtils@isNotEmpty(stOstrConfDt)">
                 AND T1.OSTR_CONF_DT = #{stOstrConfDt}
            </if>
            <if test="@MybatisUtils@isNotEmpty(strConfYnCd) and @MybatisUtils@equals(strConfYnCd, '1')">
                 AND T1.OSTR_CONF_DT IS NOT NULL
            </if>
            <if test="@MybatisUtils@isNotEmpty(strConfYnCd) and @MybatisUtils@equals(strConfYnCd, '2')">
                 AND T1.OSTR_CONF_DT IS NULL
            </if>
            ORDER BY T1.CST_SV_ASN_NO
    </select>

    <select id="selectNextItmOstrNo" resultType="java.lang.String">
        SELECT #{ostrTpCd} ||#{ostrDt} || LPAD(SQ_SVST_ITM_OSTR_IZ$ITM_OSTR_NO.NEXTVAL,7,'0') AS ITM_OSTR_NO
          FROM DUAL
    </select>

    <select id="selectNextItmStrNo" resultType="java.lang.String">
    <!-- 반품인 경우 입고번호 채번 261 -> 161 itmStrNo (161 + 등록일자8 + 일련번호7) -->
        SELECT (CASE #{ostrTpCd} WHEN '261' THEN '161' WHEN '281' THEN '161' WHEN '123' THEN '123' ELSE '' END) || #{ostrDt} || LPAD(SQ_SVST_ITM_STR_IZ$ITM_STR_NO.NEXTVAL,7,'0') AS ITM_STR_NO
          FROM DUAL
    </select>

    <select id="selectNextOstrAkNo" resultType="java.lang.String">
        SELECT #{ostrAkTpCd} || #{ostrAkDt} || LPAD(SQ_SVST_ITM_OSTR_AK_IZ$OSTR_AK_NO.NEXTVAL,7,'0') AS OSTR_AK_NO
          FROM DUAL
    </select>

    <select id="selectHgrWareNo" resultType="java.lang.String">
        SELECT A.HGR_WARE_NO
          FROM TB_SVST_MCBY_WARE_IZ A
         WHERE 1 = 1
           AND APY_YM = SUBSTR(#{cfrmDt}, 1, 6)
           AND WARE_NO = #{wkWareNo}
    </select>

    <select id="selectUpHgrWareNo" resultType="java.lang.String">
        SELECT A.HGR_WARE_NO
          FROM TB_SVST_MCBY_WARE_IZ A
         WHERE 1 = 1
           AND APY_YM = SUBSTR(#{cfrmDt}, 1, 6)
           AND WARE_NO = #{hgrWareNo}
    </select>

    <select id="selectRmkCn" resultType="java.lang.String">
        SELECT REPLACE(TRIM(''),' ', '') || ' ' || #{cfrmDt} || ' ' || #{fnlItmGdCd} || '급 ' || DECODE(#{rtngdProcsTpCd},'10','물류폐기','20','리퍼용','21','품질팀','22','리퍼-tt특별자재','') || ' 반품입니다'
          FROM DUAL
    </select>

    <select id="selectRefrRmkCn"  resultType="java.lang.String">
        SELECT REPLACE(TRIM(''),' ', '') || ' ' || #{cfrmDt} || ' ' || #{fnlItmGdCd} || '급 ' || DECODE(#{rtngdProcsTpCd},'80','리퍼작업완료-A급','81','리퍼작업완료-B-1급','82','리퍼작업완료-B-2급','') || ' 리퍼완료 기타 출고 입니다.'
          FROM DUAL
    </select>

    <insert id="insertItmOstrIz">
        INSERT INTO TB_SVST_ITM_OSTR_IZ (  /* 품목출고내역 */
              ITM_OSTR_NO              /* 품목출고번호 */
            , OSTR_SN                  /* 출고일련번호 */
            , OSTR_TP_CD               /* 출고유형코드 */
            , OSTR_WARE_NO             /* 출고창고번호 */
            , OSTR_DT                  /* 출고일자 */
            , ITM_KND_CD               /* 품목종류코드 */
            , ITM_PD_CD                /* 품목상품코드 */
            , OSTR_WARE_DV_CD          /* 출고창고구분코드 */
            , MNGT_UNIT_CD             /* 관리단위코드 */
            , BOX_UNIT_QTY             /* 박스단위수량 */
            , ITM_GD_CD                /* 품목등급코드 */
            , OSTR_QTY                 /* 출고수량 */
            , OSTR_AK_NO               /* 출고요청번호 */
            , OSTR_AK_SN               /* 출고요청일련번호 */
            , STR_AK_WARE_DV_CD        /* 입고요청창고구분코드 */
            , WARE_MNGT_PRTNR_NO       /* 창고관리파트너번호 */
            , WARE_MNGT_PRTNR_OG_TP_CD /* 창고관리파트너조직유형코드 */
            , STR_HOP_DT               /* 입고희망일자 */
            , OSTR_RSON_CD             /* 출고사유코드 */
            , ACB_DT                   /* 회계일자 */
            , EVID_DV_CD               /* 증빙구분코드 */
            , SELL_AK_RCP_NO           /* 판매요청접수번호 */
            , SELL_RCPDT               /* 판매접수일자 */
            , STR_TP_CD                /* 입고유형코드 */
            , STR_WARE_NO              /* 입고창고번호 */
            , COTP_ADJ_DT              /* 운송비정산일자 */
            , ITM_STR_NO               /* 품목입고번호 */
            , STR_SN                   /* 입고일련번호 */
            , STR_CONF_DT              /* 입고확인일자 */
            , STR_CONF_HH              /* 입고확인시간 */
            , STR_CONF_PRTNR_NO        /* 입고확인파트너번호 */
            , STR_CONF_PRTNR_OG_TP_CD  /* 입고확인파트너조직유형코드 */
            , DIDY_DV_CD               /* 직배구분코드 */
            , DTA_DL_YN                /* 데이터삭제여부 */
            , RMK_CN                   /* 비고내용 */
            <include refid="COMMON.insertSystemField" />)
        VALUES (
              #{itmOstrNo}
            , #{ostrSn}
            , '261'
            , #{hgrWareNo}
            , #{cfrmDt}
            , #{itmKndCd}
            , #{itmPdCd}
            , (SELECT WARE_DV_CD
                 FROM TB_SVST_MCBY_WARE_IZ
                 WHERE 1 = 1
                  AND WARE_NO = #{hgrWareNo}
                  AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
            , #{mgtUnt}
            , 0
            , #{fnlItmGdCd}
            , #{useQty}
            , #{ostrAkNo}
            , #{ostrAkSn}
            , #{strAkWareDvCd}
            , ( SELECT WARE_MNGT_PRTNR_NO
                  FROM TB_SVST_MCBY_WARE_IZ
                 WHERE 1 = 1
                   AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                   AND WARE_NO = #{hgrWareNo})
            , (SELECT OG_TP_CD
                 FROM TB_SVST_MCBY_WARE_IZ
                WHERE 1 = 1
                  AND WARE_NO = #{hgrWareNo}
                  AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
            , #{strHopDt}
            , '10'
            , #{cfrmDt}
            , #{evidDvCd}
            , #{sellAkRcpNo}
            , #{sellRcpdt}
            , '161'
            , #{upHgrWareNo}
            , #{cotpAdjDt}
            , #{itmStrNo}
            , #{strSn}
            , #{cfrmDt}
            , TO_CHAR(SYSDATE, 'HH24MISS')
            , 'SYS'
            , #{strConfPrtnrOgTpCd}
            , #{didyDvCd}
            , 'N'
            , #{rmkCn}
            <include refid="COMMON.insertSystemFieldValue" /> )

    </insert>

    <insert id="insertItmStrIz">
        INSERT INTO TB_SVST_ITM_STR_IZ (  /* 품목입고내역 */
                  ITM_STR_NO                /* 품목입고번호 */
                , STR_SN                    /* 입고일련번호 */
                , STR_TP_CD                 /* 입고유형코드 */
                , STR_RGST_DT               /* 입고등록일자 */
                , STR_WARE_NO               /* 입고창고번호 */
                , WARE_MNGT_PRTNR_NO        /* 창고관리파트너번호 */
                , WARE_MNGT_PRTNR_OG_TP_CD  /* 창고관리파트너조직유형코드 */
                , STR_WARE_DV_CD            /* 입고창고구분코드 */
                , DRT_STR_YN                /* 직접입고여부 */
                , DLVG_DLPNR_NO             /* 납품거래처번호 */
                , ITM_PD_CD                 /* 품목상품코드 */
                , ITM_GD_CD                 /* 품목등급코드 */
                , MNGT_UNIT_CD              /* 관리단위코드 */
                , STR_QTY                   /* 입고수량 */
                , STR_UPRC_AMT              /* 입고단가금액 */
                , STR_LOT_NO                /* 입고LOT번호 */
                , ACB_DT                    /* 회계일자 */
                , EVID_DV_CD                /* 증빙구분코드 */
                , OSTR_AK_NO                /* 출고요청번호 */
                , OSTR_AK_SN                /* 출고요청일련번호 */
                , ITM_OSTR_NO               /* 품목출고번호 */
                , OSTR_SN                   /* 출고일련번호 */
                , OSTR_TP_CD                /* 출고유형코드 */
                , OSTR_WARE_NO              /* 출고창고번호 */
                , OSTR_DT                   /* 출고일자 */
                , COTP_ADJ_DT               /* 운송비정산일자 */
                , ITM_GD_CTR_DT             /* 품목등급조정일자 */
                , ITM_GD_CTR_PRTNR_NO       /* 품목등급조정파트너번호 */
                , ITM_GD_CTR_PRTNR_OG_TP_CD /* 품목등급조정파트너조직유형코드 */
                , BFCT_ITM_GD_CD            /* 조정전품목등급코드 */
                , STR_CONF_DT               /* 입고확인일자 */
                , STR_CONF_HH               /* 입고확인시간 */
                , STR_CONF_PRTNR_NO         /* 입고확인파트너번호 */
                , STR_CONF_PRTNR_OG_TP_CD   /* 입고확인파트너조직유형코드 */
                , OJ_ORD_NO                 /* 대상주문번호 */
                , ORD_ITM_CD                /* 주문품목코드 */
                , STR_RSON_CD               /* 입고사유코드 */
                , RMK_CN                    /* 비고내용 */
                , DTA_DL_YN                 /* 데이터삭제여부 */
                <include refid="COMMON.insertSystemField" />)
            VALUES (
                  #{itmStrNo}
                , #{strSn}
                , '161'
                , #{cfrmDt}
                , #{upHgrWareNo}
                , ( SELECT WARE_MNGT_PRTNR_NO
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{upHgrWareNo})
                , ( SELECT OG_TP_CD
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{upHgrWareNo})
                , (SELECT WARE_DV_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                      AND WARE_NO = #{upHgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , 'N'
                , #{hgrWareNo}
                , #{itmPdCd}
                , #{fnlItmGdCd}
                , #{mgtUnt}
                , #{useQty}
                , 0
                , #{strLotNo}
                , #{cfrmDt}
                , '1'
                , #{ostrAkNo}
                , #{ostrAkSn}
                , #{itmOstrNo}
                , #{ostrSn}
                , '261'
                , #{hgrWareNo}
                , #{cfrmDt}
                , #{cotpAdjDt}
                , #{itmGdCtrDt}
                , #{itmGdCtrPrtnrNo}
                , #{itmGdCtrPrtnrOgTpCd}
                , #{bfctItmGdCd}
                , TO_CHAR(SYSDATE, 'YYYYMMDD')
                , TO_CHAR(SYSDATE, 'HH24MISS')
                , #{strConfPrtnrNo}
                , #{strConfPrtnrOgTpCd}
                , #{ojOrdNo}
                , #{ordItmCd}
                , #{strRsonCd}
                , #{rmkCn}
                , 'N'
                <include refid="COMMON.insertSystemFieldValue" /> )

    </insert>

    <update id="updateSvItmStocIz">
        UPDATE TB_SVST_CST_SV_ITM_STOC_IZ
           SET MMT_STOC_A_GD_QTY = CASE WHEN MMT_STOC_A_GD_QTY - DECODE(#{fnlItmGdCd}, 'A', #{useQty},0) <![CDATA[ < ]]> 0
                                     THEN 0
                                     ELSE MMT_STOC_A_GD_QTY - DECODE(#{fnlItmGdCd}, 'A', #{useQty},0)
                                    END
             , MMT_STOC_B_GD_QTY = CASE WHEN MMT_STOC_B_GD_QTY - DECODE(#{fnlItmGdCd}, 'B', #{useQty},0) <![CDATA[ < ]]> 0
                                     THEN 0
                                     ELSE MMT_STOC_B_GD_QTY - DECODE(#{fnlItmGdCd}, 'B', #{useQty},0)
                                    END
             , MMT_STOC_E_GD_QTY = CASE WHEN MMT_STOC_E_GD_QTY - DECODE(#{fnlItmGdCd}, 'E', #{useQty},0) <![CDATA[ < ]]> 0
                                     THEN 0
                                     ELSE MMT_STOC_E_GD_QTY - DECODE(#{fnlItmGdCd}, 'E', #{useQty},0)
                                    END
             , MMT_STOC_R_GD_QTY = CASE WHEN MMT_STOC_R_GD_QTY - DECODE(#{fnlItmGdCd}, 'R', #{useQty},0) <![CDATA[ < ]]> 0
                                     THEN 0
                                     ELSE MMT_STOC_R_GD_QTY - DECODE(#{fnlItmGdCd}, 'R', #{useQty},0)
                                    END
            <include refid="COMMON.updateSystemField"/>
         WHERE WARE_NO = #{upHgrWareNo}
           AND ITM_PD_CD = #{itmPdCd}
    </update>

    <insert id="insertQuantityItmOstrIz" >

        INSERT INTO TB_SVST_ITM_OSTR_IZ (  /* 품목출고내역 */
                  ITM_OSTR_NO              /* 품목출고번호 */
                , OSTR_SN                  /* 출고일련번호 */
                , OSTR_TP_CD               /* 출고유형코드 */
                , OSTR_WARE_NO             /* 출고창고번호 */
                , OSTR_DT                  /* 출고일자 */
                , ITM_KND_CD               /* 품목종류코드 */
                , ITM_PD_CD                /* 품목상품코드 */
                , OSTR_WARE_DV_CD          /* 출고창고구분코드 */
                , MNGT_UNIT_CD             /* 관리단위코드 */
                , BOX_UNIT_QTY             /* 박스단위수량 */
                , ITM_GD_CD                /* 품목등급코드 */
                , OSTR_QTY                 /* 출고수량 */
                , OSTR_AK_NO               /* 출고요청번호 */
                , OSTR_AK_SN               /* 출고요청일련번호 */
                , STR_AK_WARE_DV_CD        /* 입고요청창고구분코드 */
                , WARE_MNGT_PRTNR_NO       /* 창고관리파트너번호 */
                , WARE_MNGT_PRTNR_OG_TP_CD /* 창고관리파트너조직유형코드 */
                , STR_HOP_DT               /* 입고희망일자 */
                , OSTR_RSON_CD             /* 출고사유코드 */
                , ACB_DT                   /* 회계일자 */
                , EVID_DV_CD               /* 증빙구분코드 */
                , SELL_AK_RCP_NO           /* 판매요청접수번호 */
                , SELL_RCPDT               /* 판매접수일자 */
                , STR_TP_CD                /* 입고유형코드 */
                , STR_WARE_NO              /* 입고창고번호 */
                , COTP_ADJ_DT              /* 운송비정산일자 */
                , ITM_STR_NO               /* 품목입고번호 */
                , STR_SN                   /* 입고일련번호 */
                , STR_CONF_DT              /* 입고확인일자 */
                , STR_CONF_HH              /* 입고확인시간 */
                , STR_CONF_PRTNR_NO        /* 입고확인파트너번호 */
                , STR_CONF_PRTNR_OG_TP_CD  /* 입고확인파트너조직유형코드 */
                , DIDY_DV_CD               /* 직배구분코드 */
                , DTA_DL_YN                /* 데이터삭제여부 */
                , RMK_CN                   /* 비고내용 */
                <include refid="COMMON.insertSystemField" />)
            VALUES (
                  #{quantityItmOstrNo}
                , #{ostrSn}
                , #{ostrTpCd}
                , #{hgrWareNo}
                , #{cfrmDt}
                , #{itmKndCd}
                , #{itmPdCd}
                , (SELECT WARE_DV_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                      AND WARE_NO = #{hgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , #{mgtUnt}
                , 0
                , #{fnlItmGdCd}
                , #{useQty}
                , #{ostrAkNo}
                , #{ostrAkSn}
                , #{strAkWareDvCd}
                , ( SELECT WARE_MNGT_PRTNR_NO
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{hgrWareNo})
                , (SELECT OG_TP_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                    WHERE 1 = 1
                      AND WARE_NO = #{hgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , #{strHopDt}
                , #{ostrRsonCd}
                , #{acbDt}
                , #{evidDvCd}
                , #{sellAkRcpNo}
                , #{sellRcpdt}
                , '161'
                , '100010'
                , #{cotpAdjDt}
                , #{strQuantityItmStrNo}
                , #{strSn}
                , #{cfrmDt}
                , TO_CHAR(SYSDATE, 'HH24MISS')
                , #{strConfPrtnrNo}
                , #{strConfPrtnrOgTpCd}
                , #{didyDvCd}
                , 'N'
                , '내부반품으로 인청공장으로 출고'
                <include refid="COMMON.insertSystemFieldValue" /> )
    </insert>

    <insert id="insertQuantityItmStrIz">

            INSERT INTO TB_SVST_ITM_STR_IZ (  /* 품목입고내역 */
                  ITM_STR_NO                /* 품목입고번호 */
                , STR_SN                    /* 입고일련번호 */
                , STR_TP_CD                 /* 입고유형코드 */
                , STR_RGST_DT               /* 입고등록일자 */
                , STR_WARE_NO               /* 입고창고번호 */
                , WARE_MNGT_PRTNR_NO        /* 창고관리파트너번호 */
                , WARE_MNGT_PRTNR_OG_TP_CD  /* 창고관리파트너조직유형코드 */
                , STR_WARE_DV_CD            /* 입고창고구분코드 */
                , DRT_STR_YN                /* 직접입고여부 */
                , DLVG_DLPNR_NO             /* 납품거래처번호 */
                , ITM_PD_CD                 /* 품목상품코드 */
                , ITM_GD_CD                 /* 품목등급코드 */
                , MNGT_UNIT_CD              /* 관리단위코드 */
                , STR_QTY                   /* 입고수량 */
                , STR_UPRC_AMT              /* 입고단가금액 */
                , STR_LOT_NO                /* 입고LOT번호 */
                , ACB_DT                    /* 회계일자 */
                , EVID_DV_CD                /* 증빙구분코드 */
                , OSTR_AK_NO                /* 출고요청번호 */
                , OSTR_AK_SN                /* 출고요청일련번호 */
                , ITM_OSTR_NO               /* 품목출고번호 */
                , OSTR_SN                   /* 출고일련번호 */
                , OSTR_TP_CD                /* 출고유형코드 */
                , OSTR_WARE_NO              /* 출고창고번호 */
                , OSTR_DT                   /* 출고일자 */
                , COTP_ADJ_DT               /* 운송비정산일자 */
                , ITM_GD_CTR_DT             /* 품목등급조정일자 */
                , ITM_GD_CTR_PRTNR_NO       /* 품목등급조정파트너번호 */
                , ITM_GD_CTR_PRTNR_OG_TP_CD /* 품목등급조정파트너조직유형코드 */
                , BFCT_ITM_GD_CD            /* 조정전품목등급코드 */
                , STR_CONF_DT               /* 입고확인일자 */
                , STR_CONF_HH               /* 입고확인시간 */
                , STR_CONF_PRTNR_NO         /* 입고확인파트너번호 */
                , STR_CONF_PRTNR_OG_TP_CD   /* 입고확인파트너조직유형코드 */
                , OJ_ORD_NO                 /* 대상주문번호 */
                , ORD_ITM_CD                /* 주문품목코드 */
                , STR_RSON_CD               /* 입고사유코드 */
                , RMK_CN                    /* 비고내용 */
                , DTA_DL_YN                 /* 데이터삭제여부 */
                <include refid="COMMON.insertSystemField" />)
            VALUES (
                  #{itmStrNo}
                , #{strSn}
                , '161'
                , #{cfrmDt}
                , '100010'
                , ( SELECT WARE_MNGT_PRTNR_NO
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{upHgrWareNo})
                , ( SELECT OG_TP_CD
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{upHgrWareNo})
                , (SELECT WARE_DV_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                      AND WARE_NO = #{upHgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , 'N'
                , #{hgrWareNo}
                , #{itmPdCd}
                , #{fnlItmGdCd}
                , #{mgtUnt}
                , #{useQty}
                , 0
                , #{strLotNo}
                , #{cfrmDt}
                , '1'
                , #{ostrAkNo}
                , #{ostrAkSn}
                , #{quantityItmOstrNo}
                , #{ostrSn}
                , '161'
                , #{upHgrWareNo}
                , #{cfrmDt}
                , #{cotpAdjDt}
                , #{itmGdCtrDt}
                , #{itmGdCtrPrtnrNo}
                , #{itmGdCtrPrtnrOgTpCd}
                , #{bfctItmGdCd}
                , TO_CHAR(SYSDATE, 'YYYYMMDD')
                , TO_CHAR(SYSDATE, 'HH24MISS')
                , #{strConfPrtnrNo}
                , #{strConfPrtnrOgTpCd}
                , #{ojOrdNo}
                , #{ordItmCd}
                , #{strRsonCd}
                , '입고창고는 인천공장생산팀(100010) 출고창고는 엔지니어 창고의 상위센터'
                , 'N'
                <include refid="COMMON.insertSystemFieldValue" /> )

    </insert>

    <insert id="insertRefrOstrFinish">
        INSERT INTO TB_SVST_ITM_OSTR_IZ (  /* 품목출고내역 */
              ITM_OSTR_NO              /* 품목출고번호 */
            , OSTR_SN                  /* 출고일련번호 */
            , OSTR_TP_CD               /* 출고유형코드 */
            , OSTR_WARE_NO             /* 출고창고번호 */
            , OSTR_DT                  /* 출고일자 */
            , ITM_KND_CD               /* 품목종류코드 */
            , ITM_PD_CD                /* 품목상품코드 */
            , OSTR_WARE_DV_CD          /* 출고창고구분코드 */
            , MNGT_UNIT_CD             /* 관리단위코드 */
            , BOX_UNIT_QTY             /* 박스단위수량 */
            , ITM_GD_CD                /* 품목등급코드 */
            , OSTR_QTY                 /* 출고수량 */
            , OSTR_AK_NO               /* 출고요청번호 */
            , OSTR_AK_SN               /* 출고요청일련번호 */
            , STR_AK_WARE_DV_CD        /* 입고요청창고구분코드 */
            , WARE_MNGT_PRTNR_NO       /* 창고관리파트너번호 */
            , WARE_MNGT_PRTNR_OG_TP_CD /* 창고관리파트너조직유형코드 */
            , STR_HOP_DT               /* 입고희망일자 */
            , OSTR_RSON_CD             /* 출고사유코드 */
            , ACB_DT                   /* 회계일자 */
            , EVID_DV_CD               /* 증빙구분코드 */
            , SELL_AK_RCP_NO           /* 판매요청접수번호 */
            , SELL_RCPDT               /* 판매접수일자 */
            , STR_TP_CD                /* 입고유형코드 */
            , STR_WARE_NO              /* 입고창고번호 */
            , COTP_ADJ_DT              /* 운송비정산일자 */
            , ITM_STR_NO               /* 품목입고번호 */
            , STR_SN                   /* 입고일련번호 */
            , STR_CONF_DT              /* 입고확인일자 */
            , STR_CONF_HH              /* 입고확인시간 */
            , STR_CONF_PRTNR_NO        /* 입고확인파트너번호 */
            , STR_CONF_PRTNR_OG_TP_CD  /* 입고확인파트너조직유형코드 */
            , DIDY_DV_CD               /* 직배구분코드 */
            , DTA_DL_YN                /* 데이터삭제여부 */
            , RMK_CN                   /* 비고내용 */
            <include refid="COMMON.insertSystemField" />)
        VALUES (
              #{itmOstrNo}
            , #{ostrSn}
            , #{ostrTpCd}
            , #{hgrWareNo}
            , #{cfrmDt}
            , #{itmKndCd}
            , #{itmPdCd}
            , (SELECT WARE_DV_CD
                 FROM TB_SVST_MCBY_WARE_IZ
                 WHERE 1 = 1
                  AND WARE_NO = #{hgrWareNo}
                  AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
            , #{mgtUnt}
            , 0
            , #{fnlItmGdCd}
            , #{useQty}
            , #{ostrAkNo}
            , #{ostrAkSn}
            , #{strAkWareDvCd}
            , ( SELECT WARE_MNGT_PRTNR_NO
                  FROM TB_SVST_MCBY_WARE_IZ
                 WHERE 1 = 1
                   AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                   AND WARE_NO = #{hgrWareNo})
            , (SELECT OG_TP_CD
                 FROM TB_SVST_MCBY_WARE_IZ
                WHERE 1 = 1
                  AND WARE_NO = #{hgrWareNo}
                  AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
            , #{strHopDt}
            , #{ostrRsonCd}
            , #{cfrmDt}
            , '1'
            , #{sellAkRcpNo}
            , #{sellRcpdt}
            , #{strTpCd}
            , '71314'
            , #{cotpAdjDt}
            , ''
            , ''
            , TO_CHAR(SYSDATE, 'YYYYMMDD')
            , TO_CHAR(SYSDATE, 'HH24MISS')
            , #{session.employeeIDNumber}
            , #{session.ogTpCd}
            , #{didyDvCd}
            , 'N'
            , #{rmkCn}
            <include refid="COMMON.insertSystemFieldValue" /> )
    </insert>

    <update id="updateWkOstrIz">
	    UPDATE TB_SVST_SV_WK_OSTR_IZ
	       SET OSTR_CONF_DT = #{ostrConfDt}
	         , STKR_PRNT_YN = #{stkrPrntYn}
	         , RMK_CN = #{rmkCn}
	         , RTNGD_PROCS_TP_CD = #{rtngdProcsTpCd}
	         , RTNGD_RVPY_PROCS_YN = 'Y'
	         , OSTR_TP_CD = '261'
	         , OSTR_WARE_NO = #{hgrWareNo}
	         , OSTR_DT = #{cfrmDt}
	         , ITM_OSTR_NO = #{itmOstrNo}
	         , OSTR_SN = #{ostrSn}
	       <include refid="COMMON.updateSystemField"/>
	     WHERE 1 = 1
	       AND CST_SV_ASN_NO = #{cstSvAsnNo}
	       AND CNTR_NO = #{cntrNo}
	       AND CNTR_SN = #{cntrSn}
    </update>

    <update id="updateRefrOstrFinish">
	    UPDATE TB_SVST_SV_WK_OSTR_IZ
	       SET OSTR_CONF_DT = #{ostrConfDt}
	         , STKR_PRNT_YN = #{stkrPrntYn}
	         , RMK_CN = #{rmkCn}
	         , RTNGD_PROCS_TP_CD = #{rtngdProcsTpCd}
	         , RTNGD_RVPY_PROCS_YN = 'Y'
	         , OSTR_TP_CD = '218'
	         , OSTR_WARE_NO = #{hgrWareNo}
	         , OSTR_DT = #{cfrmDt}
	         , ITM_OSTR_NO = #{itmOstrNo}
	         , OSTR_SN = #{ostrSn}
	     WHERE 1 = 1
	       AND CST_SV_ASN_NO = #{cstSvAsnNo}
	       AND CNTR_NO = #{cntrNo}
	       AND CNTR_SN = #{cntrSn}


    </update>

    <update id="updateNotOstrConfDt">
		UPDATE TB_SVST_SV_WK_OSTR_IZ
	       SET OSTR_CONF_DT = #{ostrConfDt}
	         , STKR_PRNT_YN = #{stkrPrntYn}
	         , RMK_CN = #{rmkCn}
	         , RTNGD_PROCS_TP_CD = #{rtngdProcsTpCd}
	       <include refid="COMMON.updateSystemField"/>
	     WHERE 1 = 1
	       AND CST_SV_ASN_NO = #{cstSvAsnNo}
	       AND CNTR_NO = #{cntrNo}
	       AND CNTR_SN = #{cntrSn}
    </update>


    <select id="selectHgrWarePrtnrNo" resultType="java.lang.String">
        SELECT WARE_MNGT_PRTNR_NO
          FROM TB_SVST_MCBY_WARE_IZ
         WHERE 1 = 1
           AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
           AND WARE_NO = #{hgrWareNo}

    </select>

    <select id="selectUpHgrWarePrtnrNo" resultType="java.lang.String">
        SELECT WARE_MNGT_PRTNR_NO
          FROM TB_SVST_MCBY_WARE_IZ
         WHERE 1 = 1
           AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
           AND WARE_NO = #{upHgrWareNo}
    </select>

    <update id="updateReturningGoodsStoreConfirmations">
         UPDATE TB_SVST_SV_WK_OSTR_IZ
            SET RTNGD_CONF_YN = #{rtngdConfYn}
              , RTNGD_PROCS_TP_CD = #{rtngdProcsTpCd}
              , RMK_CN = #{rmkCn}
          <include refid="COMMON.updateSystemField"/>
          WHERE CST_SV_ASN_NO = #{cstSvAsnNo}
            AND WK_OSTR_SN = #{wkOstrSn}
            AND CNTR_NO = #{cntrNo}
            AND CNTR_SN = #{cntrSn}

    </update>

    <insert id="insertDiDisuseOstrIz" >
        INSERT INTO TB_SVST_ITM_OSTR_IZ (  /* 품목출고내역 */
                  ITM_OSTR_NO              /* 품목출고번호 */
                , OSTR_SN                  /* 출고일련번호 */
                , OSTR_TP_CD               /* 출고유형코드 */
                , OSTR_WARE_NO             /* 출고창고번호 */
                , OSTR_DT                  /* 출고일자 */
                , ITM_KND_CD               /* 품목종류코드 */
                , ITM_PD_CD                /* 품목상품코드 */
                , OSTR_WARE_DV_CD          /* 출고창고구분코드 */
                , MNGT_UNIT_CD             /* 관리단위코드 */
                , BOX_UNIT_QTY             /* 박스단위수량 */
                , ITM_GD_CD                /* 품목등급코드 */
                , OSTR_QTY                 /* 출고수량 */
                , OSTR_AK_NO               /* 출고요청번호 */
                , OSTR_AK_SN               /* 출고요청일련번호 */
                , STR_AK_WARE_DV_CD        /* 입고요청창고구분코드 */
                , WARE_MNGT_PRTNR_NO       /* 창고관리파트너번호 */
                , WARE_MNGT_PRTNR_OG_TP_CD /* 창고관리파트너조직유형코드 */
                , STR_HOP_DT               /* 입고희망일자 */
                , OSTR_RSON_CD             /* 출고사유코드 */
                , ACB_DT                   /* 회계일자 */
                , EVID_DV_CD               /* 증빙구분코드 */
                , SELL_AK_RCP_NO           /* 판매요청접수번호 */
                , SELL_RCPDT               /* 판매접수일자 */
                , STR_TP_CD                /* 입고유형코드 */
                , STR_WARE_NO              /* 입고창고번호 */
                , COTP_ADJ_DT              /* 운송비정산일자 */
                , ITM_STR_NO               /* 품목입고번호 */
                , STR_SN                   /* 입고일련번호 */
                , STR_CONF_DT              /* 입고확인일자 */
                , STR_CONF_HH              /* 입고확인시간 */
                , STR_CONF_PRTNR_NO        /* 입고확인파트너번호 */
                , STR_CONF_PRTNR_OG_TP_CD  /* 입고확인파트너조직유형코드 */
                , DIDY_DV_CD               /* 직배구분코드 */
                , DTA_DL_YN                /* 데이터삭제여부 */
                , RMK_CN                   /* 비고내용 */
                <include refid="COMMON.insertSystemField" />)
            VALUES (
                  #{disuseItmOstrNo}
                , #{ostrSn}
                , #{disuseOstrTpCd}
                , #{hgrWareNo}
                , #{cfrmDt}
                , #{itmKndCd}
                , #{itmPdCd}
                , (SELECT WARE_DV_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                      AND WARE_NO = #{hgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , #{mgtUnt}
                , 0
                , #{fnlItmGdCd}
                , #{useQty}
                , #{ostrAkNo}
                , #{ostrAkSn}
                , #{strAkWareDvCd}
                , ( SELECT WARE_MNGT_PRTNR_NO
                      FROM TB_SVST_MCBY_WARE_IZ
                     WHERE 1 = 1
                       AND APY_YM =  SUBSTR(#{cfrmDt},1,6)
                       AND WARE_NO = #{hgrWareNo})
                , (SELECT OG_TP_CD
                     FROM TB_SVST_MCBY_WARE_IZ
                    WHERE 1 = 1
                      AND WARE_NO = #{hgrWareNo}
                      AND APY_YM = TO_CHAR(SYSDATE,'YYYYMM'))
                , #{strHopDt}
                , #{ostrRsonCd}
                , #{cfrmDt}
                , '1'
                , #{sellAkRcpNo}
                , #{sellRcpdt}
                , '212'
                , #{upHgrWareNo}
                , #{cotpAdjDt}
                , ''
                , ''
                , TO_CHAR(SYSDATE, 'YYYYMMDD')
                , TO_CHAR(SYSDATE, 'HH24MISS')
                , #{session.employeeIDNumber}
                , #{session.ogTpCd}
                , #{didyDvCd}
                , 'N'
                , #{ostrConfDt} || '폐기출고'
                <include refid="COMMON.insertSystemFieldValue" /> )
    </insert>


    <select id="selectLogisticsReturningGoodsAskInfo" resultType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaReturningGoodsStoreDvo">
        SELECT T1.ITM_OSTR_NO                  AS OSTR_AK_NO
             , T1.OSTR_SN                      AS OSTR_AK_SN
             , T1.OSTR_TP_CD                   AS OSTR_AK_TP_CD
             , T1.OSTR_DT                      AS OSTR_AK_RGST_DT
             , TO_CHAR(SYSDATE, 'YYYYMMDD')    AS STR_HOP_DT
             , 'MV'                            AS LGST_STR_TP_CD
             , 'WE'                            AS IOST_AK_DV_CD
             , T1.WARE_MNGT_PRTNR_NO           AS WARE_MNGT_PRTNR_NO
             , T1.WARE_MNGT_PRTNR_OG_TP_CD     AS WARE_MNGT_PRTNR_OG_TP_CD
             , ''                              AS SAP_IOST_TP_CD
             , '6'                             AS LGST_SPP_MTHD_CD
             , T1.ITM_PD_CD                    AS ITM_PD_CD
             , T1.OSTR_QTY                     AS OSTR_AK_QTY
             , T1.ITM_GD_CD                    AS ITM_GD_CD
             , T1.OSTR_WARE_NO                 AS OSTR_OJ_WARE_NO
             , A1.WARE_NO                      AS SV_CNR_CD /*서비스센터코드*/
             , A1.WARE_NM                      AS SV_CNR_NM /*서비스센터명*/
             , T1.RMK_CN                       AS RMK_CN
          FROM TB_SVST_ITM_OSTR_IZ T1
         INNER JOIN (
                        SELECT T2.APY_YM /* 적용년월 */
                             , T2.WARE_DV_CD /* 창고구분코드 */
                             , T2.WARE_DTL_DV_CD /* 창고상세구분코드 */
                             , T2.WARE_NO /* 창고번호 */
                             , T2.WARE_NM /* 창고명 */
                             , T3.PRTNR_KNM AS WARE_MNGT_PRTNR_NM
                             , T5.RNADR || ' ' || T5.RDADR AS ADR_NM
                             , T4.LOCARA_TNO
                             , T4.EXNO_ENCR
                             , T4.IDV_TNO
                          FROM TB_SVST_MCBY_WARE_IZ T2 /* 월별창고내역 */
                          LEFT OUTER JOIN TB_OGBS_PRTNR_BAS T3 /* 파트너기본 */
                            ON T3.OG_TP_CD = T2.OG_TP_CD
                           AND T3.PRTNR_NO = T2.WARE_MNGT_PRTNR_NO
                           AND T3.DTA_DL_YN = 'N'
                          LEFT OUTER JOIN TB_OGBS_OG_BAS T4 /* 조직내역 */
                            ON T4.OG_ID = T2.OG_ID
                           AND T4.DTA_DL_YN = 'N'
                          LEFT OUTER JOIN TB_GBCO_ADR_BAS T5 /* 주소기본 */
                            ON T5.ADR_ID = T2.WARE_ADR_ID
                           AND T5.DTA_DL_YN = 'N'
                          WHERE T2.APY_YM = TO_CHAR(SYSDATE , 'YYYYMM')
                        ) A1
            ON A1.WARE_NO = T1.OSTR_WARE_NO
         WHERE T1.ITM_OSTR_NO = #{itmOstrNo}
           AND T1.OSTR_SN = #{ostrSn}

    </select>

</mapper>
