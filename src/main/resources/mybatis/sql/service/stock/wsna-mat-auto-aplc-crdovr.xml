<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaMatAutoAplcCrdovrMapper">
    <insert id="insertMatAutoAplcCrdovr">
        INSERT INTO TB_SVST_OTEAM_MAT_AUTO_APLC_IZ(
               MNGT_YM
             , MAT_AUTO_OSTR_DV_CD
             , WARE_NO
             , PD_CD /* ST182_ITEM_CD, ST182_PART_CD */
             , APLC_SN
             , BASE_QTY
             , MMS3_USE_QTY
             , EGER_PSNO
             , AUTO_APLC_QTY
             , MIN_HV_QTY
             , QOM_AUTO_APLC_QTY
             , BRCH_MIN_HV_QTY
             , QOM_AUTO_APLC_YN
             , BRCH_AUTO_APLC_YN
             <include refid="COMMON.insertSystemField" />
        )
        SELECT TO_CHAR(SYSDATE, 'YYYYMM') AS MNGT_YM
             , T1.MAT_AUTO_OSTR_DV_CD
             , T1.WARE_NO
             , T1.PD_CD  /* ST182_ITEM_CD, ST182_PART_CD */
             , T1.APLC_SN
             , T1.BASE_QTY
             , T1.MMS3_USE_QTY
             , T1.EGER_PSNO
             , T1.AUTO_APLC_QTY
             , T1.MIN_HV_QTY
             , T1.QOM_AUTO_APLC_QTY
             , T1.BRCH_MIN_HV_QTY
             , T1.QOM_AUTO_APLC_YN
             , T1.BRCH_AUTO_APLC_YN
             <include refid="COMMON.insertSystemFieldValue"/>
          FROM TB_SVST_OTEAM_MAT_AUTO_APLC_IZ T1
         WHERE T1.MNGT_YM = TO_CHAR(ADD_MONTHS(SYSDATE, -1), 'YYYYMM')
           AND T1.APLC_SN = (SELECT MAX(S1.APLC_SN) FROM TB_SVST_OTEAM_MAT_AUTO_APLC_IZ S1
                              WHERE S1.MNGT_YM = TO_CHAR(ADD_MONTHS(SYSDATE, -1), 'YYYYMM')
                                AND S1.WARE_NO = T1.WARE_NO
                                AND S1.PD_CD = T1.PD_CD
                            )
    </insert>
    <update id="updateMatAutoAplcCrdovr">
        UPDATE TB_SVST_ITM_OSTR_AK_IZ
           SET STR_HOP_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
               /* , ST156_UPD_ID = '37615' */
               <include refid="COMMON.updateSystemField"/>
         WHERE OSTR_AK_TP_CD = '330' /* TOBE CODE 확인 필요 */
           AND RECT_OSTR_DT IS NULL
           AND STR_HOP_DT  = TO_CHAR(ADD_MONTHS(SYSDATE , -1), 'YYYYMM')
    </update>
</mapper>
