<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaPcsvOutOfStorageSaveMapper">
    <sql id="updateSvpdCstSvasIstAsnIz">
        UPDATE TB_SVPD_CST_SVAS_IST_ASN_IZ
            SET WK_PRGS_STAT_CD = '20'
                , WK_EXCN_DT    = TO_CHAR(SYSDATE,'YYYYMMDD')
                , WK_EXCN_HH    = TO_CHAR(SYSDATE,'HH24MISS')
                , WK_PRTNR_NO = #{prtnrNo}
                , SITE_AW_PD_GRP_CD = '3'   /* TODO KWAS.GET_ITEM_GR(#PD_CD#) */
                , SITE_AW_SV_TP_CD = #{svBizHclsfCd}
                , SITE_AW_ATC_CD = #{siteAwAtcCd}
               <include refid="COMMON.updateSystemField"/>
            WHERE CST_SV_ASN_NO = #{cstSvAsnNo};
    </sql>
    <sql id="insertSvpdCstSvasIstAsnHistCols">
          CST_SV_ASN_NO    /*  AC221_DATA_GB + AC221_ORD_DT + AC221_ORD_SEQ  */
         /*  AC221_LOG_SEQ 컬럼없음  */
        , HIST_CH_DTM      /*  AC221_REG_DT, AC221_REG_TM  > (FNL_MDFC_DTM) 확인필요  */
        , CNTR_NO          /*  AC221_CSMR_YR ,AC221_CSMR_CD  */
        , CNTR_SN          /*  AC221_CSMR_SEQ  */
                           /*  AC221_VST_AR 컬럼없음  */
                           /*  AC221_BAD_AR 컬럼없음 */
                           /*  AC221_GRD_GB 컬럼없음  */
                           /*  AC221_DATA_STUS  */
                           /*  AC221_ORD_TYP 컬럼없음   */
        , SV_CNR_OG_ID     /*  AC221_SVC_CD_CHG 컬럼없음  */
                           /*  AC221_SVC_YN 컬럼없음  */
                           /*  AC221_ORD_DT_ENG 컬럼없음   */
        , EGER_ASN_HH      /*  AC221_ORD_TM_ENG  */
        , ASN_DT           /*  AC221_ORD_DT     */
        , EGER_ASN_DT      /*  AC221_ORD_DT     */
                           /*  AC221_POS_CD 컬럼없음  */
                           /*  AC221_DUTY_CD  컬럼없음  */
        , ICHR_PRTNR_NO    /*  AC221_EMP_ID_ENG  */
        , WK_ACPTE_STAT_CD /*  AC221_CFRM_STUS_WRK  */
        , WK_ACPTE_DT      /*  AC221_CFRM_DT_WRK  */
        , WK_ACPTE_HH      /*  AC221_CFRM_TM_WRK  */
                           /*  AC221_REJ_CD 컬럼없음  */
                           /*  AC221_REJ_ACT_GB  컬럼없음 */
                           /*  AC221_ACT_CD  컬럼없음 */
                           /*  AC221_ACT_DT 컬럼없음   */
                           /*  AC221_ACT_TM 컬럼없음  */
        , VST_DUEDT        /*  AC221_VST_DT    */
        , VST_EXP_HH       /*  AC221_VST_TM  */
        , VST_CNFMDT       /*  AC221_CFRM_DT  */
        , VST_CNFM_HH      /*  AC221_CFRM_TM  */
        , DTM_CH_CAUS_CD   /*  AC221_CFRM_CD  */
        , ARV_DT           /*  AC221_ARR_DT  */
        , ARV_HH           /*  AC221_ARR_TM  */
        , WK_PRGS_STAT_CD  /*  AC221_PROC_STUS  */
                           /*  AC221_RSLT_ACT_CD 컬럼없음  */
        , WK_CAN_RSON_CD   /*  AC221_CANC_CD  */
        , WK_CAN_MO_CN     /*  AC221_CANC_MEMO  */
        , WK_EXCN_DT       /*  AC221_WRK_DT   */
        , WK_EXCN_HH       /*  AC221_WRK_TM  */
        , WK_PRTNR_NO      /*  AC221_EMP_ID_WRK  */
        , SITE_AW_PD_GRP_CD /*  AC221_GDS_GR  */
        , SITE_AW_SV_TP_CD  /*  AC221_SVC_TYP  */
        , SITE_AW_ATC_CD   /*  AC221_ALW_CD  */
                           /*  AC221_TR_DT 컬럼없음  */
                           /*  AC221_TR_TM 컬럼없음  */
                           /*  AC221_MGRT_GB  */
        , DTM_CH_RSON_DTL_CN /*  AC221_CFRM_MEMO  */
                           /*  AC221_LOG_ID 컬럼없음   */
        , SV_BIZ_HCLSF_CD  /*  AC221_DATA_GB  */

         /* TO-BE only */
        , SV_BIZ_DCLSF_CD  /*  AC211_WRK_TYP_DTL  */
        , CNTR_CST_NO      /*  new col   */
        , ICHR_OG_TP_CD    /*  new col   */
        , RGLVL_GD_CD      /*  AC221_LOCAL_DEG  */
        , RPB_LOCARA_CD    /*  AC221_LOCAL_GB  */
        , DTM_CH_RSON_CD   /*  AC221_CFRM_DTL_CD  */
        , WK_GRP_CD        /*  AC221_WRK_GR  */
        , WK_PRTNR_OG_TP_CD /*  new col  */
        , DTA_DL_YN       /*  new col  */
        <include refid="COMMON.insertSystemField"/>
    </sql>
    <sql id="insertSvpdCstSvasIstAsnHistValues">
              CST_SV_ASN_NO    /*  AC221_DATA_GB + AC221_ORD_DT + AC221_ORD_SEQ */
             /*  AC221_LOG_SEQ 컬럼없음  */ /* TODO AC221_LOG_SEQ (확인필요)  ,  (SELECT LPAD(NVL(MAX(CST_SV_ASN_SN),0)+1,3,'0') FROM TB_SVPD_CST_SVAS_IST_ASN_HIST WHERE CST_SV_ASN_NO = '') AS AC221_LOG_SEQ */
            , FNL_MDFC_DTM     /*   AC221_REG_DT, AC221_REG_TM */
            , CNTR_NO          /*  AC221_CSMR_YR ,AC221_CSMR_CD */
            , CNTR_SN          /*  AC221_CSMR_SEQ */
                               /*  AC221_VST_AR  */
                               /*  AC221_BAD_AR */
                  			   /*  AC221_GRD_GB */
                               /*  AC221_DATA_STUS */
                               /*  AC221_ORD_TYP */
            , SV_CNR_OG_ID     /*  AC221_SVC_CD_CHG */
                               /*  AC221_SVC_YN */
                               /*  AC221_ORD_DT_ENG */
            , EGER_ASN_HH      /*  AC221_ORD_TM_ENG */
            , ASN_DT           /*  AC221_ORD_DT    */
            , EGER_ASN_DT      /*  AC221_ORD_DT    */
                               /*  AC221_POS_CD */
                               /*  AC221_DUTY_CD  */
            , ICHR_PRTNR_NO    /*  AC221_EMP_ID_ENG */
            , WK_ACPTE_STAT_CD /*  AC221_CFRM_STUS_WRK */
            , WK_ACPTE_DT      /*  AC221_CFRM_DT_WRK */
            , WK_ACPTE_HH      /*  AC221_CFRM_TM_WRK */
                               /*  AC221_REJ_CD */
                               /*  AC221_REJ_ACT_GB */
                               /*  AC221_ACT_CD */
                               /*  AC221_ACT_DT  */
                               /*  AC221_ACT_TM */
            , VST_DUEDT        /*  AC221_VST_DT   */
            , VST_EXP_HH       /*  AC221_VST_TM */
            , VST_CNFMDT       /*  AC221_CFRM_DT */
            , VST_CNFM_HH      /*  AC221_CFRM_TM */
            , DTM_CH_CAUS_CD   /*  AC221_CFRM_CD */
            , ARV_DT           /*  AC221_ARR_DT */
            , ARV_HH           /*  AC221_ARR_TM */
            , WK_PRGS_STAT_CD  /*  AC221_PROC_STUS */
                               /*  AC221_RSLT_ACT_CD */
            , WK_CAN_RSON_CD   /*  AC221_CANC_CD */
            , WK_CAN_MO_CN     /*  AC221_CANC_MEMO */
            , WK_EXCN_DT       /*  AC221_WRK_DT    */
            , WK_EXCN_HH       /*  AC221_WRK_TM */
            , WK_PRTNR_NO      /*  AC221_EMP_ID_WRK */
            , SITE_AW_PD_GRP_CD /*  AC221_GDS_GR */
            , SITE_AW_SV_TP_CD  /*  AC221_SVC_TYP */
            , SITE_AW_ATC_CD   /*  AC221_ALW_CD */
                               /*  AC221_TR_DT */
                               /*  AC221_TR_TM */
                               /*  AC221_MGRT_GB */
            , DTM_CH_RSON_DTL_CN /*  AC221_CFRM_MEMO */
                               /*  AC221_LOG_ID  TODO (확인필요 :AS-IS '40' 정의)  */
            , SV_BIZ_HCLSF_CD  /*  AC221_DATA_GB */

             /* TO-BE only */
            , SV_BIZ_DCLSF_CD  /*  AC211_WRK_TYP_DTL */
            , CNTR_CST_NO      /*  new col */
            , ICHR_OG_TP_CD    /*  new col  */
            , RGLVL_GD_CD      /*  AC221_LOCAL_DEG */
            , RPB_LOCARA_CD    /*  AC221_LOCAL_GB */
            , DTM_CH_RSON_CD   /*  AC221_CFRM_DTL_CD */
            , WK_GRP_CD        /*  AC221_WRK_GR   */
            , WK_PRTNR_OG_TP_CD /*  new col   */
            , DTA_DL_YN         /*  new col  */
            <include refid="COMMON.insertSystemFieldValue" />
    </sql>
    <sql id="insertSvpdCstSvWkRsIzCols">
          CNTR_NO        /* VS106_CSMR_YR, VS106_CSMR_CD */
        , CNTR_SN        /* VS106_CSMR_SEQ */
                         /* VS106_SEQ 없음 */
        , CST_SV_ASN_NO  /* VS106_DATA_GB, VS106_ORD_DT, VS106_ORD_SEQ */
        , PDCT_PD_CD     /* VS106_GDS_CD  */
                         /* VS106_CHAG_CSMR_AS 없음 */
                         /* VS106_CHAG_CSMR_BS 없음 */
        , REFRI_DV_CD    /* VS106_CHAG_GB */
        , URGT_YN        /* VS106_UGNT_YN */
        , VST_LOCARA_CD  /* VS106_VST_AR */
        , CLN_YN         /* VS106_RET_YN */
                         /* VS106_RET_OBJ_GB 없음 */
                         /* VS106_RET_EVDC_GB 없음 */
                         /* VS106_RET_GDS_KND 없음 */
                         /* VS106_SVC_CD 없음 */
        , PRTNR_NO       /* VS106_EMP_ID */
        , VST_FSH_DT     /* VS106_VST_COMP_DT */
        , VST_FSH_HH     /* VS106_VST_COMP_TM */
        , WK_PRGS_STAT_CD /* VS106_PROC_STUS_WRK */
        , BAD_DV_CD      /* VS106_BAD_GB -- 급지구분 */
        , AS_LCT_CD      /* VS106_POSIT */
        , AS_PHN_CD      /* VS106_PHNM */
        , AS_CAUS_CD      /* VS106_CAUS */
        , SV_PROCS_FOM_CD /* VS106_PRC_TYP 처리형태(SB36) */
        , IMPTA_RSON_CD   /* VS106_IMPUTATION 귀책사유(SB35) */
        , SV_PROCS_CN     /* VS106_PROC_TXT */
        , BC_NO           /* VS106_BAR_CD */
        , BC_IN_MTHD_CD   /* VS106_IN_MTH */
        , CST_SIGN_CN     /* VS106_CSMR_SIGN */
        , RGST_IP_ADR     /* VS106_REG_IP */
        , CRAL_LOCARA_TNO /* VS106_PHONE_NUMBER 휴대지역전화번호    */
        , MEXNO_ENCR      /* VS106_PHONE_NUMBER 휴대전화국번호암호화  */
        , CRAL_IDV_TNO    /* VS106_PHONE_NUMBER 휴대개별전화번호 */
                          /*  VS106_VOC_CAT  --VOC카테고리 없음 */
                          /*  VS106_VOC_CD   --VOC상세내용 없음 */
       , IVC_PRNT_SN      /*  VS106_DELIVERY_SEQ   */
       , SPP_IVC_NO       /*  VS106_TRACKING_NO */
       , AS_AK_RCP_YN    /* VS106_AS_REQ_YN    A/S요청접수여부(방문내역) */
       , INF_CH_AK_YN    /* VS106_INFO_REQ_YN  정보변경요청여부(방문내역) */
       , ETC_CH_AK_YN    /*  new col  */
       , IST_CTF_MTMS_FW_YN    /*  new col  */
       , SFT_ACDN_YN    /*  new col  */
       , PLS_SV_YN      /*  new col  */
       , PESL_ARTC_DFRN_YN    /*  new col  */
       , TONEP_IST_OPT_YN    /*  new col  */
       , TONEP_RCVRY_OPT_YN    /*  new col  */
       , TONEP_FRISU_RCVRY_VT1_USE_YN    /*  new col  */
       , CST_SIGN_HS_YN    /*  new col  */
       , DCEVDN_CONF_YN    /*  new col  */
       , IST_FIT_YN    /*  new col  */
       , DTA_DL_YN    /*   new col  */
        <include refid="COMMON.insertSystemField"/>

    </sql>
    <sql id="insertSvstSvWkOstrIzCols">
          CNTR_NO          /* ST163_CSMR_YR ,ST163_CSMR_CD */
          /* ST163_CSMR_SEQ 없음 */
          /* ST163_SEQ 없음 */
        , WK_OSTR_SN /* ST163_SER */
        , ITM_PD_CD  /* ST163_ITEM_CD */
        , SV_BIZ_HCLSF_CD                 /* ST163_WRK_TYP */
        , SV_BIZ_DCLSF_CD                /* ST163_WRK_TYP_DTL */
        , AS_REFRI_DV_CD                 /* ST163_CHAG_CSMR_AS */
        , BFSVC_REFRI_DV_CD              /* ST163_CHAG_CSMR_BS  */
        , REFRI_DV_CD                    /* ST163_CHAG_GB  */
        , FST_PD_CD                      /* ST163_GDS_CD_B  */
        , FST_BC_NO                     /* ST163_BARCODE_B */
        , FST_SELL_TP_CD                /* ST163_SALE_TYP_B */
        , FST_PD_USWY_CD                /* ST163_USGE_B */
        , FST_ITM_GD_CD                 /* ST163_DEG_B */
        , FST_VST_FSH_DT                /* ST163_VST_COMP_DT_B */
        , FNL_PD_CD                     /* ST163_GDS_CD_A */
        , FNL_BC_NO                     /* ST163_BARCODE_A  */
        , FNL_SELL_TP_CD                /* ST163_SALE_TYP_A */
        , FNL_PD_USWY_CD                /* ST163_USGE_A */
        , FNL_ITM_GD_CD                 /* ST163_DEG_A */
        , FNL_VST_FSH_DT                /* ST163_VST_COMP_DT_A */
        , USE_QTY                       /* ST163_QTY  */
        , CSMR_UPRC_AMT                 /* ST163_CSMR_PR */
        , ITM_BIL_AMT                   /* ST163_REQ_AMT  */
        , FRE_EXPN_DC                   /* ST163_EXPR_DAYS */
        , FRE_EXPN_IST_DT               /* ST163_INST_DT */
        , CST_SV_ASN_NO                 /* ST163_DATA_GB ,ST163_ORD_DT, ST163_ORD_SEQ */
        , MNGR_DV_CD                    /* ST163_CHG_GB */
        , DGR1_LEVL_OG_ID               /* ST163_ADMIN_CD */
        , DGR3_LEVL_OG_ID               /* ST163_BIZ_CD */
        , BRCH_OG_ID                    /* ST163_BRNH_CD */
        , ICHR_PRTNR_NO                 /* ST163_EMP_ID */
        , WK_WARE_NO                    /* ST163_WRK_STCK_CD */
        , STKR_PRNT_YN                  /*  new col  */
        , RTNGD_RVPY_PROCS_YN           /*  new col  */
        , RTNGD_CONF_YN                 /*  new col  */
        , REFR_AS_RCP_YN                /*  new col  */
        , DTA_DL_YN                     /*  new col  */
         <include refid="COMMON.insertSystemField"/>
    </sql>

    <insert  id="insertPcsvOutOfStorage"     parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
                V_SV_BIZ_DCLSF_CD   VARCHAR(4);
                V_SV_WK_RS_IZ_COUNT INT;
                V_SV_OJ_IZ_COUNT    INT;
                V_SV_BIZ_HCLSF_CD   CHAR(1);
                V_RCPDT             CHAR(8);
                V_AS_IST_OJ_NO      CHAR(20);
                V_CHK_WELCOME_BS    CHAR(1);
                OUT_MSG             VARCHAR2(1000);
        BEGIN
           /* 동일 키값으로 결과가 저장되었는지 체크한다.*/
            SELECT COUNT(*)
                INTO V_SV_WK_RS_IZ_COUNT
                FROM TB_SVPD_CST_SV_WK_RS_IZ
                WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

           /* 완료건 완료 처리 불가*/
            IF ( V_SV_WK_RS_IZ_COUNT > 0) THEN
                RAISE_APPLICATION_ERROR(-20003, '이미 완료 처리 되었습니다. 작업목록을 다시 확인 해주세요.');
            END IF;
            /*작업구분상세(업무유형)을 구한다.*/
            SELECT SV_BIZ_DCLSF_CD, SV_BIZ_HCLSF_CD, RCPDT, AS_IST_OJ_NO
            INTO V_SV_BIZ_DCLSF_CD, V_SV_BIZ_HCLSF_CD, V_RCPDT, V_AS_IST_OJ_NO
            FROM TB_SVPD_CST_SVAS_IST_OJ_IZ
            WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

            /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)*/
            <include refid="updateSvpdCstSvasIstAsnIz"/>

            /* 15.06.21 변경후 로그 저장 */
            INSERT
            INTO TB_SVPD_CST_SVAS_IST_ASN_HIST    /* 고객서비스AS설치배정이력 */
            (
             <include refid="insertSvpdCstSvasIstAsnHistCols"/>
            )
            SELECT
             <include refid="insertSvpdCstSvasIstAsnHistValues"/>
            FROM TB_SVPD_CST_SVAS_IST_ASN_IZ
            WHERE  CST_SV_ASN_NO = #{cstSvAsnNo};

            /* ★월관리 고객 생성*/
            IF (V_SV_BIZ_DCLSF_CD LIKE '11%') THEN
                SELECT COUNT(1)
                    INTO V_SV_OJ_IZ_COUNT
                FROM TB_SVPD_MCBY_CST_SV_OJ_IZ
                WHERE MNGT_YM = TO_CHAR(SYSDATE, 'YYYYMM')
                AND CNTR_NO = #{cntrNo}
                /* AND AC202_CSMR_SEQ = #CSMR_SEQ#   TODO  AC202_CSMR_SEQ 컬럼 없음 */
                AND ROWNUM=1;

                IF (V_SV_OJ_IZ_COUNT = 0) THEN
                  INSERT
                  INTO TB_SVPD_MCBY_CST_SV_OJ_IZ
                  ( MNGT_YM /* AC202_MGT_YM    */
                  , CNTR_NO /* AC202_CSMR_YR  + AC202_CSMR_CD  */
                  , CNTR_SN
                    /* AC202_CSMR_SEQ  컬럼없음 */
                    /* AC201_SALE_GB   컬럼없음 */
                    /* AC201_MGT_GB    컬럼없음 */
                  , FILT_SELL_TP_CD/* AC202_SALE_TYP  */
                  , FXN_PRTNR_DV_CD /* AC202_CHG_GB    */
                  , FXN_PRTNR_YN /* AC202_FIX_YN    */
                  , FXN_PRTNR_NO /* AC202_EMP_ID    */
                  , IST_NMN_N /* AC202_INST_MTHS */
                  , VST_NMN_N /* AC202_VIS_MTHS  */
                   /* AC202_ZIP_NO1 컬럼없음   */
                   /* AC202_ZIP_NO2 컬럼없음 */
                  , RGLVL_DV_CD /* AC202_GRD_GB    */
                  , MNGER_RGLVL_DV_CD /* AC202_BAD_AR    */
                  , PDCT_PD_CD /* AC202_GDS_CD    */
                    /* AC201_DEG   컬럼없음    */
                    /* AC201_USGE 컬럼없음 */
                    /* AC201_CYCL_TYP 컬럼없음  */
                    /* AC201_SALE_DT	 컬럼없음*/
                  , IST_DT /* AC202_INST_DT   */
                  , CHNG_DT /* AC202_CHNG_DT   */
                  , REQD_DT /* AC202_REMV_DT   */
                  , CAN_DT /* AC202_CANC_DT   */
                  , CPS_DT /* AC202_COMP_DT   */
                  , SV_STP_DT /* AC202_STOP_DT   */
                  , MSH_J_DT /* AC202_MBR_IN_DT */
                  , MSH_WDWAL_DT /* AC202_MBR_OUT_DT*/
                   /* AC202_ETC_1 컬럼없음    */
                   /* AC202_ETC_2 컬럼없음    */
                   /* AC202_ETC_3 컬럼없음    */
                  , MNGR_DV_CD /* AC202_MGT_CHG_GB */
                  , MNGT_PRTNR_NO /* AC202_MGT_EMP_ID*/
                   /* AC202_MGT_CUST_ID 컬럼없음 */
                   /* AC202_CUST_ID 컬럼없음  */
                  , HSHD_EXCD_CD /* AC202_CUST_CHK  */
                  , HSHD_EXCD_CNFM_YN /* AC202_CUST_CFRM_CHK */
                  , EX_HSHD_YN /* AC202_CUST_EX       */
                  , BFSVC_SPP_STP_RSON_CD /* AC202_BS_GB1        */
                   /* AC201_BS_GB2	 컬럼없음*/
                  , FST_RGST_DTM /* AC202_REG_DT    */
                  , FST_RGST_USR_ID /* AC202_REG_ID  */
                  , FST_RGST_PRG_ID
                  , FST_RGST_DEPT_ID
                  , FNL_MDFC_DTM    /* AC202_UPD_DT    */
                  , FNL_MDFC_USR_ID /* AC202_UPD_ID    */
                  , FNL_MDFC_PRG_ID
                  , FNL_MDFC_DEPT_ID
                )
                SELECT TO_CHAR(SYSDATE,'YYYYMM') AS MNGT_YM        /* AC202_MGT_YM    */
                    , CNTR_NO AS CNTR_NO                            /* AC202_CSMR_YR + AC202_CSMR_CD   */
                    , CNTR_SN AS CNTR_SN
                    /* AC202_CSMR_SEQ  컬럼없음 */
                    /* AC201_SALE_GB   컬럼없음 */
                    /* AC201_MGT_GB    컬럼없음 */
                    , ''   AS FILT_SELL_TP_CD     /* AC201_SALE_TYP 컬럼없음 */
                    , '' AS FXN_PRTNR_DV_CD                         /* AC202_CHG_GB    */
                    , 'N' AS FXN_PRTNR_YN                            /* AC202_FIX_YN    */
                    , '' AS FXN_PRTNR_NO                            /* AC202_EMP_ID    */
                    , 0 AS IST_NMN_N                                /* AC202_INST_MTHS */
                    , 0 AS VST_NMN_N                                /* AC202_VIS_MTHS  */
                    /* AC201_ZIP_NO1 컬럼없음   */
                    /* AC201_ZIP_NO2 컬럼없음 */
                    , '' AS RGLVL_DV_CD                             /* AC202_GRD_GB    */
                    , '' AS MNGER_RGLVL_DV_CD                       /* AC202_BAD_AR    */
                    , PDCT_PD_CD AS PDCT_PD_CD                      /* AC202_GDS_CD    */
                     /* AC201_DEG 컬럼없음      */
                     /* AC201_DEG 컬럼없음 */
                     /* AC201_USGE 컬럼없음 */
                     /* AC201_CYCL_TYP 컬럼없음  */
                     /* AC201_SALE_DT	 컬럼없음*/
                    , TO_CHAR(SYSDATE,'YYYYMMDD') AS IST_DT         /* AC202_INST_DT   */
                    , '' AS CHNG_DT                                 /* AC202_CHNG_DT   */
                    , '' AS REQD_DT                                 /* AC202_REMV_DT   */
                    , '' AS CAN_DT                                  /* AC202_CANC_DT   */
                    , '' AS CPS_DT                                  /* AC202_COMP_DT   */
                    , '' AS SV_STP_DT                               /* AC202_STOP_DT   */
                    , '' AS MSH_J_DT                                /* AC202_MBR_IN_DT */
                    , '' AS MSH_WDWAL_DT                            /* AC202_MBR_OUT_DT*/
                     /* AC202_ETC_1 컬럼없음    */
                     /* AC202_ETC_2 컬럼없음    */
                     /* AC202_ETC_3 컬럼없음    */
                    , '' AS MNGR_DV_CD                               /* AC202_MGT_CHG_GB */
                    , '' AS MNGT_PRTNR_NO                            /* AC202_MGT_EMP_ID */
                     /* AC202_MGT_CUST_ID 컬럼없음 */
                     /* AC202_CUST_ID 컬럼없음   */
                    , '' AS HSHD_EXCD_CD                             /* AC202_CUST_CHK  */
                    , 'N' AS HSHD_EXCD_CNFM_YN                        /* AC202_CUST_CFRM_CHK */
                    , 'N' AS EX_HSHD_YN                               /* AC202_CUST_EX     */
                    , BFSVC_SPP_STP_RSON_CD AS BFSVC_SPP_STP_RSON_CD /* AC202_BS_GB1      */
                     /* AC201_BS_GB2	 컬럼없음*/
                    , TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') AS FST_RGST_DTM   /* AC202_REG_DT    */
                    , #{prtnrNo} AS FST_RGST_USR_ID                    /* AC202_REG_ID    */
                    , #{session.pageId}  AS FST_RGST_PRG_ID          /* FST_RGST_PRG_ID    */
                    , #{session.departmentId} AS FST_RGST_DEPT_ID    /* FST_RGST_DEPT_ID    */
                    , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
                    , #{session.userId}
                    , #{session.pageId}
                    , #{session.ogId}
                    FROM TB_SVPD_CST_SV_EXCN_IZ
                WHERE CNTR_NO = #{cntrNo};
                END IF;
            END IF;

            INSERT
            INTO TB_SVPD_CST_SV_WK_RS_IZ
            (
              <include refid="insertSvpdCstSvWkRsIzCols"/>
            )
            VALUES
            (
              #{cntrNo}                                        /* VS106_CSMR_YR, VS106_CSMR_CD */
            , #{cntrSn}                                        /* VS106_CSMR_SEQ */
            /* VS106_SEQ 없음 */                                /* VS106_SEQ 없음 */
            , #{cstSvAsnNo}                                    /* VS106_DATA_GB, VS106_ORD_DT, VS106_OR */
            , #{pdCd}                                          /* VS106_GDS_CD  */
            , NVL('1', '1')                                    /* VS106_CHAG_GB */
            , #{urgtYn}                                        /* VS106_UGNT_YN */
            , #{rpbLocaraCd}                                   /* VS106_VST_AR */
            , 'N'                                              /* VS106_RET_YN */
            , #{prtnrNo}                                       /* VS106_EMP_ID */
            , TO_CHAR(SYSDATE, 'YYYYMMDD')                     /* VS106_VST_COMP_DT */
            , TO_CHAR(SYSDATE, 'HH24MISS')                     /* VS106_VST_COMP_TM */
            , '20'                                             /* VS106_PROC_STUS_WRK */
            , '1'                                              /* VS106_BAD_GB -- 급지구분 */
            , #{asLctCd}                                       /* VS106_POSIT */
            , #{asPhnCd}                                       /* VS106_PHNM */
            , #{asCausCd}                                      /* VS106_CAUS */
            , ''                                               /* VS106_PRC_TYP 처리형태(SB36) */
            , ''                                               /* VS106_IMPUTATION 귀책사유(SB35) */
            , '설치택배상품 출고완료'                              /* VS106_PROC_TXT */
            , ''                                               /* VS106_BAR_CD */
            , ''                                               /* VS106_IN_MTH */
            , ''                                               /* VS106_CSMR_SIGN */
            , ''                                               /* VS106_REG_IP */
            , ''                                               /* VS106_PHONE_NUMBER  휴대지역전화번호*/
            , ''                                               /* VS106_PHONE_NUMBER  휴대전화국번호암호화*/
            , ''                                               /* VS106_PHONE_NUMBER  휴대개별전화번호*/
            , #{ivcPrntSn}                                     /* VS106_DELIVERY_SEQ  */
            , ''                                               /* VS106_TRACKING_NO */
            , 'N'                                              /* VS106_AS_REQ_YN    A/S요청접수여부(방문내역) */
            , 'N'                                              /* VS106_INFO_REQ_YN  정보변경요청여부(방문내역) */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            , 'N'                                              /* new col  */
            <include refid="COMMON.insertSystemFieldValue"/>
             );


            /* 설치일자 업데이트*/
            UPDATE TB_SVPD_CST_SV_EXCN_IZ
            SET IST_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
            , FNL_MDFC_DTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            , FNL_MDFC_USR_ID = #{session.userId}
            , FNL_MDFC_PRG_ID = #{session.pageId}
            , FNL_MDFC_DEPT_ID = #{session.departmentId}
            WHERE CNTR_NO = #{cntrNo};
            /* 23.03.14 이경호 파트장님요청, 렌탈건은 웰컴 BS 생성, 일시불건은 멤버십 가입 예정인건(해당 조건은 조상희 매니저님이 주신 조건으로 만듬)만 생성 */
            /* 웰컴BS생성 */
        END;
    </insert>
    <insert  id="insertPcsvOutOfStorageRvPy" parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
            V_WK_OSTR_IZ_COUNT 		INT;
            V_ITM_STOC_IZ_QTY 		INT;
            V_WK_RS_IZ_SEQ 			VARCHAR(3);
            V_MNGR_DV_CD			CHAR(1);
            V_DGR1_LEVL_OG_ID 		VARCHAR2(20);
            V_DGR3_LEVL_OG_ID		VARCHAR2(20);
            V_BRCH_OG_ID	        VARCHAR2(20);
            OUT_MSG       			VARCHAR2(1000);
        BEGIN

          /* 작업 엔지니어의 소속 정보를 구한다.*/
          SELECT
                  (CASE T1.OG_TP_CD
                      WHEN 'W02' THEN '1'     /* 매니저 */
                      WHEN 'W06' THEN '2'     /* 엔지니어 */
                      WHEN 'W01' THEN '3'     /* P추진 */
                      ELSE ''
                  END) AS MNGR_DV_CD
                  ,(SELECT T2.DGR1_LEVL_OG_ID
                      FROM TB_OGBS_MM_OG_IZ T2
                      WHERE T2.BASE_YM = T1.BASE_YM
                        AND T2.OG_ID = T1.OG_ID
                      ) AS DGR1_LEVL_OG_ID     /* 총괄단 ST163_ADMIN_CD */
                  ,(SELECT T2.DGR2_LEVL_OG_ID
                      FROM TB_OGBS_MM_OG_IZ T2
                      WHERE T2.BASE_YM = T1.BASE_YM
                        AND T2.OG_ID = T1.OG_ID
                      ) AS DGR3_LEVL_OG_ID     /* 센터 ST163_BIZ_CD */
                  ,T1.OG_ID AS BRCH_OG_ID     /* 지점 ST163_BRNH_CD */

              INTO V_MNGR_DV_CD, V_DGR1_LEVL_OG_ID, V_DGR3_LEVL_OG_ID, V_BRCH_OG_ID
              FROM TB_OGBS_MM_PRTNR_IZ T1
            WHERE T1.BASE_YM = TO_CHAR(SYSDATE,'YYYYMM')
              AND T1.BZ_STAT_CD = '1'
              AND T1.DTA_DL_YN = 'N'
              AND T1.PRTNR_NO = #{prtnrNo};


            /* 수불 오류 방지를 위해서 재고 수량 체크 */
            IF (#{pdGdCd}= 'A') THEN
                SELECT 	PITM_STOC_A_GD_QTY - NVL(#{useQty},0) AS QTY
                  INTO V_ITM_STOC_IZ_QTY
                  FROM TB_SVST_CST_SV_ITM_STOC_IZ
                 WHERE 1=1
                   AND WARE_NO = #{wkWareNo}
                   AND ITM_PD_CD = #{pdCd};

            ELSIF (#{pdGdCd}= 'B') THEN
                SELECT PITM_STOC_B_GD_QTY - NVL(#{useQty},0) AS QTY
                  INTO V_ITM_STOC_IZ_QTY
                  FROM TB_SVST_CST_SV_ITM_STOC_IZ
                 WHERE 1=1
                   AND WARE_NO = #{wkWareNo}
                   AND ITM_PD_CD = #{pdCd} ;

            ELSIF (#{pdGdCd}= 'E') THEN
                SELECT PITM_STOC_E_GD_QTY - NVL(#{useQty},0) AS QTY
                  INTO V_ITM_STOC_IZ_QTY
                  FROM TB_SVST_CST_SV_ITM_STOC_IZ
                 WHERE 1=1
                   AND WARE_NO = #{wkWareNo}
                   AND ITM_PD_CD = #{pdCd};

            ELSIF (#{pdGdCd}= 'R') THEN
                SELECT PITM_STOC_R_GD_QTY - NVL(#{useQty},0) AS QTY
                  INTO V_ITM_STOC_IZ_QTY
                  FROM TB_SVST_CST_SV_ITM_STOC_IZ
                 WHERE 1=1
                   AND WARE_NO = #{wkWareNo}
                   AND ITM_PD_CD = #{pdCd};
            END IF;

            /* 작업순번 조회 */
             SELECT COUNT(CST_SV_ASN_NO)      /* VS106_SEQ 없음 임시로 대체  */
              INTO V_WK_RS_IZ_SEQ
              FROM TB_SVPD_CST_SV_WK_RS_IZ
             WHERE 1=1
               AND CST_SV_ASN_NO = #{cstSvAsnNo}
               ;
            /* 중복 제거를 위해서 카운팅 */
              SELECT NVL(COUNT(*),0) AS  OSTR_IZ_COUNT
              INTO V_WK_OSTR_IZ_COUNT
              FROM TB_SVST_SV_WK_OSTR_IZ
              WHERE CNTR_NO = #{cntrNo}
              -- AND ST163_SEQ = V_WK_RS_IZ_SEQ        /* ST163_SEQ 없음 */
              AND ITM_PD_CD = #{pdCd}
              AND REFRI_DV_CD = '1';

            IF ( V_ITM_STOC_IZ_QTY <![CDATA[ < ]]>  0) THEN
                RAISE_APPLICATION_ERROR(-20003, '자재 수량이 부족합니다. 보유 자재를 확인해주세요!' );
            ELSE

                /* 사용 내역을 저장한다. */
                INSERT INTO TB_SVST_SV_WK_OSTR_IZ
                (
                  <include refid="insertSvstSvWkOstrIzCols"/>
                )
                VALUES
                (
                #{cntrNo} /* ST163_CSMR_YR ,ST163_CSMR_CD */
                /* ST163_CSMR_SEQ 없음 */
                /* V_WK_RS_IZ_SEQ: ST163_SEQ 컬럼없음 */
                ,(
                    SELECT LPAD(NVL(MAX(WK_OSTR_SN),0)+1,3,'0')
                    FROM TB_SVST_SV_WK_OSTR_IZ
                    WHERE CST_SV_ASN_NO = #{cstSvAsnNo}
                -- AND ST163_SEQ = V_WK_RS_IZ_SEQ /* ST163_SER : ST163_SEQ 컬럼없음 */
                )
                , #{pdCd} /* ST163_ITEM_CD */
                , #{svBizHclsfCd} /* ST163_WRK_TYP */
                , #{svBizDclsfCd} /* ST163_WRK_TYP_DTL */
                , #{asRefriDvCd} /* ST163_CHAG_CSMR_AS */
                , #{bfsvcRefriDvCd} /* ST163_CHAG_CSMR_BS */
                , '1' /* ST163_CHAG_GB */
                , #{pdCd} /* ST163_GDS_CD_B */
                , '' /* ST163_BARCODE_B */
                , #{filtSellTpCd} /* ST163_SALE_TYP_B */
                , #{pdUswyCd} /* ST163_USGE_B */
                , #{pdGdCd} /* ST163_DEG_B */
                , TO_CHAR(SYSDATE, 'YYYYMMDD') /* ST163_VST_COMP_DT_B */
                , #{pdCd} /* ST163_GDS_CD_A */
                , '' /* ST163_BARCODE_A */
                , #{filtSellTpCd} /* ST163_SALE_TYP_A */
                , #{pdUswyCd} /* ST163_USGE_A */
                , #{pdGdCd} /* ST163_DEG_A */
                , TO_CHAR(SYSDATE, 'YYYYMMDD') /* ST163_VST_COMP_DT_A */
                , NVL(#{useQty},0) /* ST163_QTY */
                , 0 /* ST163_CSMR_PR */
                , 0 /* ST163_REQ_AMT */
                , 0 /* ST163_EXPR_DAYS */
                , NVL(#{istDt}, TO_CHAR(SYSDATE,'YYYYMMDD')) /* ST163_INST_DT */
                , #{cstSvAsnNo} /* ST163_DATA_GB ,ST163_ORD_DT, ST163_ORD_SEQ */
                , V_MNGR_DV_CD /* ST163_CHG_GB */
                , V_DGR1_LEVL_OG_ID /* ST163_ADMIN_CD */
                , NVL(V_DGR3_LEVL_OG_ID, V_BRCH_OG_ID) /* ST163_BIZ_CD */
                , '' /* ST163_BRNH_CD */
                , #{prtnrNo} /* ST163_EMP_ID */
                , #{wkWareNo} /* ST163_WRK_STCK_CD */
                , 'N'
                , 'N'
                , 'N'
                , 'N'
                , 'N'
                <include refid="COMMON.insertSystemFieldValue"/>
                );
            END IF;

            /* 수불처리*/

            RAISE_APPLICATION_ERROR(-20003, '잘못되었음 수불처리!!!');

            IF (LENGTH(OUT_MSG) > 0) THEN
                RAISE_APPLICATION_ERROR(-20003, OUT_MSG );
            END IF;

        END;
    </insert>
    <insert  id="insertPcsvOutOfStorageRshp" parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
                V_SV_BIZ_DCLSF_CD VARCHAR(4);
                V_SV_WK_RS_IZ_COUNT INT;
                V_SV_OJ_IZ_COUNT INT;
                V_SV_BIZ_HCLSF_CD CHAR(1);
                V_RCPDT CHAR(8);
                V_AS_IST_OJ_NO CHAR(20);

                --반품접수오더 완료 처리를 위해
                V_3460_COUNT INT;
                V_CST_SV_ASN_NO CHAR(20);
                V_WK_CAN_MO_CN VARCHAR2(1000);

                V_AS_LCT_CD CHAR(4);
                V_AS_PHN_CD CHAR(4);
                V_AS_CAUS_CD CHAR(4);
                V_SITE_AW_ATC_CD CHAR(4);

                OUT_MSG       VARCHAR2(1000);
        BEGIN
            /*동일 키값으로 결과가 저장되었는지 체크한다. */
            SELECT COUNT(*)
                    INTO V_SV_WK_RS_IZ_COUNT
                    FROM TB_SVPD_CST_SV_WK_RS_IZ
                    WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

            /* 완료건 완료 처리 불가 */
            IF ( V_SV_WK_RS_IZ_COUNT > 0) THEN
                RAISE_APPLICATION_ERROR(-20003, '이미 완료 처리 되었습니다. 작업목록을 다시 확인 해주세요.');
            END IF;

            /*작업구분상세(업무유형)을 구한다.*/
            SELECT SV_BIZ_DCLSF_CD, SV_BIZ_HCLSF_CD, RCPDT, AS_IST_OJ_NO
            INTO V_SV_BIZ_DCLSF_CD, V_SV_BIZ_HCLSF_CD, V_RCPDT, V_AS_IST_OJ_NO
            FROM TB_SVPD_CST_SVAS_IST_OJ_IZ
            WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

            /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)*/
            <include refid="updateSvpdCstSvasIstAsnIz"/>

            /* 15.06.21 변경후 로그 저장 */
            INSERT
            INTO TB_SVPD_CST_SVAS_IST_ASN_HIST    /* 고객서비스AS설치배정이력 */
            (
             <include refid="insertSvpdCstSvasIstAsnHistCols"/>
            )
            SELECT
             <include refid="insertSvpdCstSvasIstAsnHistValues"/>
            FROM TB_SVPD_CST_SVAS_IST_ASN_IZ
            WHERE  CST_SV_ASN_NO = #{cstSvAsnNo};

          /*작업결과 결과테이블에 저장*/
          INSERT
          INTO TB_SVPD_CST_SV_WK_RS_IZ
          (
            <include refid="insertSvpdCstSvWkRsIzCols"/>
          )
          VALUES
           (
            #{cntrNo}                               /* VS106_CSMR_YR, VS106_CSMR_CD */
          , #{cntrSn}                               /* VS106_CSMR_SEQ */
             /* VS106_SEQ 없음  */                   /* VS106_SEQ 없음 */
          , #{cstSvAsnNo}                           /* VS106_DATA_GB, VS106_ORD_DT, VS106_OR */
          , #{pdCd}                                 /* VS106_GDS_CD  */
          , NVL('1', '1')                           /* VS106_CHAG_GB */
          , #{urgtYn}                               /* VS106_UGNT_YN */
          , #{rpbLocaraCd}                          /* VS106_VST_AR */
          , 'N'                                     /* VS106_RET_YN */
          , #{prtnrNo}                              /* VS106_EMP_ID */
          , TO_CHAR(SYSDATE, 'YYYYMMDD')            /* VS106_VST_COMP_DT */
          , TO_CHAR(SYSDATE, 'HH24MISS')            /* VS106_VST_COMP_TM */
          , '20'                                    /* VS106_PROC_STUS_WRK */
          , '1'                                     /* VS106_BAD_GB -- 급지구분 */
          , #{asLctCd}                              /* VS106_POSIT */
          , #{asPhnCd}                              /* VS106_PHNM */
          , #{asCausCd}                             /* VS106_CAUS */
          , ''                                      /* VS106_PRC_TYP 처리형태(SB36) */
          , ''                                      /* VS106_IMPUTATION 귀책사유(SB35) */
          , '설치택배상품 재배송 출고완료'               /* VS106_PROC_TXT */
          , ''                                      /* VS106_BAR_CD */
          , ''                                      /* VS106_IN_MTH */
          , ''                                      /* VS106_CSMR_SIGN */
          , ''                                      /* VS106_REG_IP */
          , ''                                      /* VS106_PHONE_NUMBER  휴대지역전화번호*/
          , ''                                      /* VS106_PHONE_NUMBER  휴대전화국번호암호화*/
          , ''                                      /* VS106_PHONE_NUMBER  휴대개별전화번호*/
          , #{ivcPrntSn}                            /* VS106_DELIVERY_SEQ  */
          , ''                                      /* VS106_TRACKING_NO */
          , 'N'                                     /* VS106_AS_REQ_YN    A/S요청접수여부(방문내역) */
          , 'N'                                     /* VS106_INFO_REQ_YN  정보변경요청여부(방문내역) */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          , 'N'                                     /* new col  */
          <include refid="COMMON.insertSystemFieldValue"/>
           );

            /* 반품요청오더가 미처리된게 있다면 수불 없이 완료 처리를 한다.*/

                  SELECT COUNT(1)
                   INTO V_3460_COUNT
                  FROM TB_SVPD_CST_SVAS_IST_OJ_IZ T1
                   INNER JOIN TB_SVPD_CST_SVAS_IST_ASN_IZ T2
                     ON T1.CST_SV_ASN_NO = T2.CST_SV_ASN_NO
                  WHERE T1.CNTR_NO = #{cntrNo}
                   -- AND AC211_CSMR_SEQ = #CSMR_SEQ#    /*CSMR_SEQ 컬럼없음*/
                   AND T1.SV_BIZ_DCLSF_CD = '3460'
                   AND T2.WK_PRGS_STAT_CD IN ('00', '10');

              /* 반품 요청 오더 (미처리) 정보가  존재하는경우 */
              IF(V_3460_COUNT > 0) THEN
                  /*배정번호조회*/
                 SELECT T1.CST_SV_ASN_NO, T2.WK_CAN_MO_CN , T1.SV_BIZ_HCLSF_CD
                    INTO V_CST_SV_ASN_NO, V_WK_CAN_MO_CN , V_SV_BIZ_HCLSF_CD
                  FROM TB_SVPD_CST_SVAS_IST_OJ_IZ T1
                   INNER JOIN TB_SVPD_CST_SVAS_IST_ASN_IZ T2
                    ON T1.CST_SV_ASN_NO = T2.CST_SV_ASN_NO
                 WHERE T1.CNTR_NO = #{cntrNo}
                   --AND AC211_CSMR_SEQ = #CSMR_SEQ#   /*CSMR_SEQ 컬럼없음*/
                   AND T1.SV_BIZ_DCLSF_CD = '3460'
                   AND T2.WK_PRGS_STAT_CD IN ('00', '10');

                 /*위치현상원인수당조회*/
                 SELECT AS_LCT_CD, AS_PHN_CD, AS_CAUS_CD, SITE_AW_ATC_CD
                      INTO V_AS_LCT_CD, V_AS_PHN_CD, V_AS_CAUS_CD, V_SITE_AW_ATC_CD
                      FROM TB_SVPD_AS_TP_CD
                     WHERE 1=1
                       AND PD_CD = #{pdCd}
                       AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN APY_STRTDT AND APY_ENDDT
                       AND SV_ANA_HCLSF_CD = '3460';

                /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)  (반품시 : V_CST_SV_ASN_NO )  */
                UPDATE TB_SVPD_CST_SVAS_IST_ASN_IZ
                SET WK_PRGS_STAT_CD = '20'
                    , WK_EXCN_DT    = TO_CHAR(SYSDATE,'YYYYMMDD')
                    , WK_EXCN_HH    = TO_CHAR(SYSDATE,'HH24MISS')
                    , WK_PRTNR_NO = #{prtnrNo}
                    , SITE_AW_PD_GRP_CD = '3'    /* TODO KWAS.GET_ITEM_GR(#PD_CD#) */
                    , SITE_AW_SV_TP_CD = V_SV_BIZ_HCLSF_CD
                    , SITE_AW_ATC_CD = V_SITE_AW_ATC_CD
                   <include refid="COMMON.updateSystemField"/>
                 WHERE CST_SV_ASN_NO = V_CST_SV_ASN_NO;

                /* 15.06.21 변경후 로그 저장   (반품시 : V_CST_SV_ASN_NO )  */
                INSERT
                    INTO TB_SVPD_CST_SVAS_IST_ASN_HIST    /* 고객서비스AS설치배정이력 */
                    (
                     <include refid="insertSvpdCstSvasIstAsnHistCols"/>
                    )
                    SELECT
                     <include refid="insertSvpdCstSvasIstAsnHistValues"/>
                    FROM TB_SVPD_CST_SVAS_IST_ASN_IZ
                    WHERE  CST_SV_ASN_NO = V_CST_SV_ASN_NO;

                /* 작업결과 결과테이블에 저장 (반품시 VS106_PROC_TXT , V_WK_CAN_MO_CN ) */
                INSERT
                INTO TB_SVPD_CST_SV_WK_RS_IZ
                (
                  <include refid="insertSvpdCstSvWkRsIzCols"/>
                )
                VALUES
                (
                  #{cntrNo}                                  /* VS106_CSMR_YR, VS106_CSMR_CD */
                , #{cntrSn}                                  /* VS106_CSMR_SEQ */
                  /* VS106_SEQ 없음 */                        /* VS106_SEQ 없음 */
                , V_CST_SV_ASN_NO                            /* VS106_DATA_GB, VS106_ORD_DT, VS106_OR */
                , #{pdCd}                                    /* VS106_GDS_CD  */
                , NVL('1', '1')                              /* VS106_CHAG_GB */
                , #{urgtYn}                                  /* VS106_UGNT_YN */
                , #{rpbLocaraCd}                             /* VS106_VST_AR */
                , 'N'                                        /* VS106_RET_YN */
                , #{prtnrNo}                                 /* VS106_EMP_ID */
                , TO_CHAR(SYSDATE, 'YYYYMMDD')               /* VS106_VST_COMP_DT */
                , TO_CHAR(SYSDATE, 'HH24MISS')               /* VS106_VST_COMP_TM */
                , '20'                                       /* VS106_PROC_STUS_WRK */
                , '1'                                        /* VS106_BAD_GB -- 급지구분 */
                , V_AS_LCT_CD                                /* VS106_POSIT */
                , V_AS_PHN_CD                                /* VS106_PHNM */
                , V_AS_CAUS_CD                               /* VS106_CAUS */
                , ''                                         /* VS106_PRC_TYP 처리형태(SB36) */
                , ''                                         /* VS106_IMPUTATION 귀책사유(SB35) */
                , '설치택배상품 재배송으로 인한 반품완료 처리(재고X)' /* VS106_PROC_TXT */
                , ''                                         /* VS106_BAR_CD */
                , ''                                         /* VS106_IN_MTH */
                , ''                                         /* VS106_CSMR_SIGN */
                , ''                                         /* VS106_REG_IP */
                , ''                                         /* VS106_PHONE_NUMBER  휴대지역전화번호*/
                , ''                                         /* VS106_PHONE_NUMBER  휴대전화국번호암호화*/
                , ''                                         /* VS106_PHONE_NUMBER  휴대개별전화번호*/
                , ''                                         /* VS106_DELIVERY_SEQ  */
                , TRIM(V_WK_CAN_MO_CN)                       /* VS106_TRACKING_NO */
                , 'N'                                        /* VS106_AS_REQ_YN    A/S요청접수여부(방문내역) */
                , 'N'                                        /* VS106_INFO_REQ_YN  정보변경요청여부(방문내역) */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                , 'N'                                        /* new col  */
                <include refid="COMMON.insertSystemFieldValue"/>
                 );

              END IF;

              RAISE_APPLICATION_ERROR(-20003, '잘못되었음 재배송!!!');
        END;
     </insert>
</mapper>
