<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.stock.mapper.WsnaPcsvOutOfStorageSaveMapper">
    <insert  id="insertPcsvOutOfStorage" parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
                V_SV_BIZ_DCLSF_CD VARCHAR(4);
                V_SV_WK_RS_IZ_COUNT INT;
                V_SV_OJ_IZ_COUNT INT;
                V_SV_BIZ_HCLSF_CD CHAR(1);
                V_RCPDT CHAR(8);
                V_AS_IST_OJ_NO CHAR(20);

                V_CHK_WELCOME_BS CHAR(1);
                OUT_MSG       VARCHAR2(1000);
        BEGIN
            -- 동일 키값으로 결과가 저장되었는지 체크한다.
            SELECT COUNT(*)
                INTO V_SV_WK_RS_IZ_COUNT
                FROM TB_SVPD_CST_SV_WK_RS_IZ
                WHERE CST_SV_ASN_NO = #{cstSvAsnNo};
           -- 완료건 완료 처리 불가
           IF ( V_SV_WK_RS_IZ_COUNT > 0) THEN
                RAISE_APPLICATION_ERROR(-20003, '이미 완료 처리 되었습니다. 작업목록을 다시 확인 해주세요.');
            END IF;
        /*작업구분상세(업무유형)을 구한다.*/
        SELECT SV_BIZ_DCLSF_CD, SV_BIZ_HCLSF_CD, RCPDT, AS_IST_OJ_NO
        INTO V_SV_BIZ_DCLSF_CD, V_SV_BIZ_HCLSF_CD, V_RCPDT, V_AS_IST_OJ_NO
        FROM TB_SVPD_CST_SVAS_IST_OJ_IZ
        WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

        /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)*/
        UPDATE TB_SVPD_CST_SVAS_IST_ASN_IZ
            SET WK_PRGS_STAT_CD = '20'
                , WK_EXCN_DT    = TO_CHAR(SYSDATE,'YYYYMMDD')
                , WK_EXCN_HH    = TO_CHAR(SYSDATE,'HH24MISS')
                , WK_PRTNR_NO = #{prtnrNo}
                , SITE_AW_PD_GRP_CD = '3'
                , SITE_AW_SV_TP_CD = #{siteAwSvTpCd}
                , SITE_AW_ATC_CD = #{siteAwAtcCd}
               <include refid="COMMON.updateSystemField"/>
            WHERE CST_SV_ASN_NO = #{cstSvAsnNo};

        /* 15.06.21 변경후 로그 저장 */
        INSERT
        INTO TB_SVPD_CST_SVAS_IST_ASN_HIST    /* 고객서비스AS설치배정이력 */
        (
              CST_SV_ASN_NO    /*  AC221_DATA_GB + AC221_ORD_DT + AC221_ORD_SEQ  */
             /*  AC221_LOG_SEQ 컬럼없음  */
            , HIST_CH_DTM      /*  AC221_REG_DT, AC221_REG_TM  > (FNL_MDFC_DTM) 확인필요  */
            , CNTR_NO          /*  AC221_CSMR_YR ,AC221_CSMR_CD  */
            , CNTR_SN          /*  AC221_CSMR_SEQ  */
                               /*  AC221_VST_AR 컬럼없음  */
                               /*  AC221_BAD_AR 컬럼없음 */
            			       /*  AC221_GRD_GB 컬럼없음  */
                               /*  AC221_DATA_STUS  */
                               /*  AC221_ORD_TYP 컬럼없음   */
            , SV_CNR_OG_ID     /*  AC221_SVC_CD_CHG 컬럼없음  */
                               /*  AC221_SVC_YN 컬럼없음  */
                               /*  AC221_ORD_DT_ENG 컬럼없음   */
            , EGER_ASN_HH      /*  AC221_ORD_TM_ENG  */
            , ASN_DT           /*  AC221_ORD_DT     */
            , EGER_ASN_DT      /*  AC221_ORD_DT     */
                               /*  AC221_POS_CD 컬럼없음  */
                               /*  AC221_DUTY_CD  컬럼없음  */
            , ICHR_PRTNR_NO    /*  AC221_EMP_ID_ENG  */
            , WK_ACPTE_STAT_CD /*  AC221_CFRM_STUS_WRK  */
            , WK_ACPTE_DT      /*  AC221_CFRM_DT_WRK  */
            , WK_ACPTE_HH      /*  AC221_CFRM_TM_WRK  */
                               /*  AC221_REJ_CD 컬럼없음  */
                               /*  AC221_REJ_ACT_GB  컬럼없음 */
                               /*  AC221_ACT_CD  컬럼없음 */
                               /*  AC221_ACT_DT 컬럼없음   */
                               /*  AC221_ACT_TM 컬럼없음  */
            , VST_DUEDT        /*  AC221_VST_DT    */
            , VST_EXP_HH       /*  AC221_VST_TM  */
            , VST_CNFMDT       /*  AC221_CFRM_DT  */
            , VST_CNFM_HH      /*  AC221_CFRM_TM  */
            , DTM_CH_CAUS_CD   /*  AC221_CFRM_CD  */
            , ARV_DT           /*  AC221_ARR_DT  */
            , ARV_HH           /*  AC221_ARR_TM  */
            , WK_PRGS_STAT_CD  /*  AC221_PROC_STUS  */
                               /*  AC221_RSLT_ACT_CD 컬럼없음  */
            , WK_CAN_RSON_CD   /*  AC221_CANC_CD  */
            , WK_CAN_MO_CN     /*  AC221_CANC_MEMO  */
            , WK_EXCN_DT       /*  AC221_WRK_DT   */
            , WK_EXCN_HH       /*  AC221_WRK_TM  */
            , WK_PRTNR_NO      /*  AC221_EMP_ID_WRK  */
            , SITE_AW_PD_GRP_CD /*  AC221_GDS_GR  */
            , SITE_AW_SV_TP_CD  /*  AC221_SVC_TYP  */
            , SITE_AW_ATC_CD   /*  AC221_ALW_CD  */
                               /*  AC221_TR_DT 컬럼없음  */
                               /*  AC221_TR_TM 컬럼없음  */
                               /*  AC221_MGRT_GB  */
            , DTM_CH_RSON_DTL_CN /*  AC221_CFRM_MEMO  */
                               /*  AC221_LOG_ID 컬럼없음  */
            , SV_BIZ_HCLSF_CD  /*  AC221_DATA_GB  */

             /* TO-BE only */
            , SV_BIZ_DCLSF_CD  /*  AC211_WRK_TYP_DTL  */
            , CNTR_CST_NO      /*  new col   */
            , ICHR_OG_TP_CD    /*  new col   */
            , RGLVL_GD_CD      /*  AC221_LOCAL_DEG  */
            , RPB_LOCARA_CD    /*  AC221_LOCAL_GB  */
            , DTM_CH_RSON_CD   /*  AC221_CFRM_DTL_CD  */
            , WK_GRP_CD        /*  AC221_WRK_GR  */
            , WK_PRTNR_OG_TP_CD /*  new col  */
            , DTA_DL_YN       /*  new col  */
            <include refid="COMMON.insertSystemField"/>

        )
        SELECT
              CST_SV_ASN_NO    /*  AC221_DATA_GB + AC221_ORD_DT + AC221_ORD_SEQ */
             /*  AC221_LOG_SEQ 컬럼없음  */ /*  AC221_LOG_SEQ (확인필요)  ,  (SELECT LPAD(NVL(MAX(CST_SV_ASN_SN),0)+1,3,'0') FROM TB_SVPD_CST_SVAS_IST_ASN_HIST WHERE CST_SV_ASN_NO = '') AS AC221_LOG_SEQ */
            , FNL_MDFC_DTM     /*   AC221_REG_DT, AC221_REG_TM */
            , CNTR_NO          /*  AC221_CSMR_YR ,AC221_CSMR_CD */
            , CNTR_SN          /*  AC221_CSMR_SEQ */
                               /*  AC221_VST_AR  */
                               /*  AC221_BAD_AR */
                  			   /*  AC221_GRD_GB */
                               /*  AC221_DATA_STUS */
                               /*  AC221_ORD_TYP */
            , SV_CNR_OG_ID     /*  AC221_SVC_CD_CHG */
                               /*  AC221_SVC_YN */
                               /*  AC221_ORD_DT_ENG */
            , EGER_ASN_HH      /*  AC221_ORD_TM_ENG */
            , ASN_DT           /*  AC221_ORD_DT    */
            , EGER_ASN_DT      /*  AC221_ORD_DT    */
                               /*  AC221_POS_CD */
                               /*  AC221_DUTY_CD  */
            , ICHR_PRTNR_NO    /*  AC221_EMP_ID_ENG */
            , WK_ACPTE_STAT_CD /*  AC221_CFRM_STUS_WRK */
            , WK_ACPTE_DT      /*  AC221_CFRM_DT_WRK */
            , WK_ACPTE_HH      /*  AC221_CFRM_TM_WRK */
                               /*  AC221_REJ_CD */
                               /*  AC221_REJ_ACT_GB */
                               /*  AC221_ACT_CD */
                               /*  AC221_ACT_DT  */
                               /*  AC221_ACT_TM */
            , VST_DUEDT        /*  AC221_VST_DT   */
            , VST_EXP_HH       /*  AC221_VST_TM */
            , VST_CNFMDT       /*  AC221_CFRM_DT */
            , VST_CNFM_HH      /*  AC221_CFRM_TM */
            , DTM_CH_CAUS_CD   /*  AC221_CFRM_CD */
            , ARV_DT           /*  AC221_ARR_DT */
            , ARV_HH           /*  AC221_ARR_TM */
            , WK_PRGS_STAT_CD  /*  AC221_PROC_STUS */
                               /*  AC221_RSLT_ACT_CD */
            , WK_CAN_RSON_CD   /*  AC221_CANC_CD */
            , WK_CAN_MO_CN     /*  AC221_CANC_MEMO */
            , WK_EXCN_DT       /*  AC221_WRK_DT    */
            , WK_EXCN_HH       /*  AC221_WRK_TM */
            , WK_PRTNR_NO      /*  AC221_EMP_ID_WRK */
            , SITE_AW_PD_GRP_CD /*  AC221_GDS_GR */
            , SITE_AW_SV_TP_CD  /*  AC221_SVC_TYP */
            , SITE_AW_ATC_CD   /*  AC221_ALW_CD */
                               /*  AC221_TR_DT */
                               /*  AC221_TR_TM */
                               /*  AC221_MGRT_GB */
            , DTM_CH_RSON_DTL_CN /*  AC221_CFRM_MEMO */
                               /*  AC221_LOG_ID  (확인필요 :AS-IS '40' 정의) */
            , SV_BIZ_HCLSF_CD  /*  AC221_DATA_GB */

             /* TO-BE only */
            , SV_BIZ_DCLSF_CD  /*  AC211_WRK_TYP_DTL */
            , CNTR_CST_NO      /*  new col */
            , ICHR_OG_TP_CD    /*  new col  */
            , RGLVL_GD_CD      /*  AC221_LOCAL_DEG */
            , RPB_LOCARA_CD    /*  AC221_LOCAL_GB */
            , DTM_CH_RSON_CD   /*  AC221_CFRM_DTL_CD */
            , WK_GRP_CD        /*  AC221_WRK_GR   */
            , WK_PRTNR_OG_TP_CD /*  new col   */
            , DTA_DL_YN         /*  new col  */
            <include refid="COMMON.insertSystemFieldValue" />

        FROM TB_SVPD_CST_SVAS_IST_ASN_IZ
        WHERE  CST_SV_ASN_NO = #{cstSvAsnNo};

        /* ★월관리 고객 생성*/
        IF (V_SV_BIZ_DCLSF_CD LIKE '11%') THEN
            SELECT COUNT(1)
                INTO V_SV_OJ_IZ_COUNT
            FROM TB_SVPD_MCBY_CST_SV_OJ_IZ
            WHERE MNGT_YM = TO_CHAR(SYSDATE, 'YYYYMM')
            AND CNTR_NO = #{cntrNo}
            AND ROWNUM=1;

        IF (V_SV_OJ_IZ_COUNT = 0) THEN
          INSERT
          INTO TB_SVPD_MCBY_CST_SV_OJ_IZ
          ( MNGT_YM /* AC202_MGT_YM    */
          , CNTR_NO /* AC202_CSMR_YR  + AC202_CSMR_CD  */
          , CNTR_SN
            /* AC202_CSMR_SEQ 컬럼없음 */
            /* AC21_SALE_GB   컬럼없음 */
            /* AC202_MGT_GB 컬럼없음   */
          , FILT_SELL_TP_CD/* AC202_SALE_TYP  */
          , FXN_PRTNR_DV_CD /* AC202_CHG_GB    */
            /* AC202_MGT_GB 컬럼없음   */
          , FXN_PRTNR_YN /* AC202_FIX_YN    */
          , FXN_PRTNR_NO /* AC202_EMP_ID    */
          , IST_NMN_N /* AC202_INST_MTHS */
          , VST_NMN_N /* AC202_VIS_MTHS  */
           /* AC202_ZIP_NO1 컬럼없음   */
           /* AC202_ZIP_NO2 컬럼없음 */
          , RGLVL_DV_CD /* AC202_GRD_GB    */
          , MNGER_RGLVL_DV_CD /* AC202_BAD_AR    */
          , PDCT_PD_CD /* AC202_GDS_CD    */
            /* AC201_DEG   컬럼없음    */
            /* AC201_USGE 컬럼없음 */
            /* AC201_CYCL_TYP 컬럼없음  */
            /* AC201_SALE_DT	 컬럼없음*/
          , IST_DT /* AC202_INST_DT   */
          , CHNG_DT /* AC202_CHNG_DT   */
          , REQD_DT /* AC202_REMV_DT   */
          , CAN_DT /* AC202_CANC_DT   */
          , CPS_DT /* AC202_COMP_DT   */
          , SV_STP_DT /* AC202_STOP_DT   */
          , MSH_J_DT /* AC202_MBR_IN_DT */
          , MSH_WDWAL_DT /* AC202_MBR_OUT_DT*/
           /* AC202_ETC_1 컬럼없음    */
           /* AC202_ETC_2 컬럼없음    */
           /* AC202_ETC_3 컬럼없음    */
          , MNGR_DV_CD /* AC202_MGT_CHG_GB */
          , MNGT_PRTNR_NO /* AC202_MGT_EMP_ID*/
           /* AC202_MGT_CUST_ID 컬럼없음 */
           /* AC202_CUST_ID 컬럼없음  */
          , HSHD_EXCD_CD /* AC202_CUST_CHK  */
          , HSHD_EXCD_CNFM_YN /* AC202_CUST_CFRM_CHK */
          , EX_HSHD_YN /* AC202_CUST_EX       */
          , BFSVC_SPP_STP_RSON_CD /* AC202_BS_GB1        */
           /* AC201_BS_GB2	 컬럼없음*/
          , FST_RGST_DTM /* AC202_REG_DT    */
          , FST_RGST_USR_ID /* AC202_REG_ID  */
          , FST_RGST_PRG_ID
          , FST_RGST_DEPT_ID
          , FNL_MDFC_DTM    /* AC202_UPD_DT    */
          , FNL_MDFC_USR_ID /* AC202_UPD_ID    */
          , FNL_MDFC_PRG_ID
          , FNL_MDFC_DEPT_ID
        )
        SELECT TO_CHAR(SYSDATE,'YYYYMM') AS MNGT_YM        /* AC202_MGT_YM    */
            , CNTR_NO AS CNTR_NO                            /* AC202_CSMR_YR + AC202_CSMR_CD   */
            , CNTR_SN AS CNTR_SN
            /* AC202_CSMR_SEQ  컬럼없음 */
            /* AC21_SALE_GB   컬럼없음 */
            /* AC201_MGT_GB 컬럼없음   */
            , ''   AS FILT_SELL_TP_CD     /* AC201_SALE_TYP 컬럼없음 */
            , '' AS FXN_PRTNR_DV_CD                         /* AC202_CHG_GB    */
            , 'N' AS FXN_PRTNR_YN                            /* AC202_FIX_YN    */
            , '' AS FXN_PRTNR_NO                            /* AC202_EMP_ID    */
            , 0 AS IST_NMN_N                                /* AC202_INST_MTHS */
            , 0 AS VST_NMN_N                                /* AC202_VIS_MTHS  */
            /* AC201_ZIP_NO1 컬럼없음   */
            /* AC201_ZIP_NO2 컬럼없음 */
            , '' AS RGLVL_DV_CD                             /* AC202_GRD_GB    */
            , '' AS MNGER_RGLVL_DV_CD                       /* AC202_BAD_AR    */
            , PDCT_PD_CD AS PDCT_PD_CD                      /* AC202_GDS_CD    */
             /* AC201_DEG 컬럼없음      */
             /* AC201_DEG 컬럼없음 */
             /* AC201_USGE 컬럼없음 */
             /* AC201_CYCL_TYP 컬럼없음  */
             /* AC201_SALE_DT	 컬럼없음*/
            , TO_CHAR(SYSDATE,'YYYYMMDD') AS IST_DT         /* AC202_INST_DT   */
            , '' AS CHNG_DT                                 /* AC202_CHNG_DT   */
            , '' AS REQD_DT                                 /* AC202_REMV_DT   */
            , '' AS CAN_DT                                  /* AC202_CANC_DT   */
            , '' AS CPS_DT                                  /* AC202_COMP_DT   */
            , '' AS SV_STP_DT                               /* AC202_STOP_DT   */
            , '' AS MSH_J_DT                                /* AC202_MBR_IN_DT */
            , '' AS MSH_WDWAL_DT                            /* AC202_MBR_OUT_DT*/
             /* AC202_ETC_1 컬럼없음    */
             /* AC202_ETC_2 컬럼없음    */
             /* AC202_ETC_3 컬럼없음    */
            , '' AS MNGR_DV_CD                               /* AC202_MGT_CHG_GB */
            , '' AS MNGT_PRTNR_NO                            /* AC202_MGT_EMP_ID */
             /* AC202_MGT_CUST_ID 컬럼없음 */
             /* AC202_CUST_ID 컬럼없음   */
            , '' AS HSHD_EXCD_CD                             /* AC202_CUST_CHK  */
            , 'N' AS HSHD_EXCD_CNFM_YN                        /* AC202_CUST_CFRM_CHK */
            , 'N' AS EX_HSHD_YN                               /* AC202_CUST_EX     */
            , BFSVC_SPP_STP_RSON_CD AS BFSVC_SPP_STP_RSON_CD /* AC202_BS_GB1      */
             /* AC201_BS_GB2	 컬럼없음*/
            , TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') AS FST_RGST_DTM   /* AC202_REG_DT    */
            , #{prtnrNo} AS FST_RGST_USR_ID                    /* AC202_REG_ID    */
            , #{session.pageId}  AS FST_RGST_PRG_ID          /* FST_RGST_PRG_ID    */
            , #{session.departmentId} AS FST_RGST_DEPT_ID    /* FST_RGST_DEPT_ID    */
            , TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            , #{session.userId}
            , #{session.pageId}
            , #{session.ogId}
            FROM TB_SVPD_CST_SV_EXCN_IZ
        WHERE CNTR_NO = #{cntrNo};
        END IF;
    END IF;


        /*작업결과 결과테이블에 저장*/
        INSERT
        INTO TB_SVPD_CST_SV_WK_RS_IZ     /*고객서비스작업결과내역 */
         (
          CNTR_NO         /* VS106_CSMR_YR, VS106_CSMR_CD */
        , CNTR_SN        /* VS106_CSMR_SEQ */
                         /*,  VS106_SEQ 없음 */
        , CST_SV_ASN_NO  /* VS106_DATA_GB, VS106_ORD_DT, VS106_ORD_SEQ */
                         /*,  VS106_GDS_CD 없음 */
                         /*,  VS106_CHAG_CSMR_AS 없음 */
                         /*,  VS106_CHAG_CSMR_BS 없음 */
        , REFRI_DV_CD    /* VS106_CHAG_GB */
        , URGT_YN        /* VS106_UGNT_YN */
        , VST_LOCARA_CD  /* VS106_VST_AR */
        , CLN_YN         /* VS106_RET_YN */
                         /*,  VS106_RET_OBJ_GB 없음 */
                         /*,  VS106_RET_EVDC_GB 없음 */
                         /*,  VS106_RET_GDS_KND 없음 */
                         /*,  VS106_SVC_CD 없음 */
        , PRTNR_NO       /* VS106_EMP_ID */
        , VST_FSH_DT     /* VS106_VST_COMP_DT */
        , VST_FSH_HH     /* VS106_VST_COMP_TM */
        , WK_PRGS_STAT_CD /* VS106_PROC_STUS_WRK */
        , BAD_DV_CD      /* VS106_BAD_GB -- 급지구분 */
        , AS_LCT_CD      /* VS106_POSIT */
        , AS_PHN_CD      /* VS106_PHNM */
        , AS_CAUS_CD      /* VS106_CAUS */
        , SV_PROCS_FOM_CD /* VS106_PRC_TYP 처리형태(SB36) */
        , IMPTA_RSON_CD   /* VS106_IMPUTATION 귀책사유(SB35) */
        , SV_PROCS_CN     /* VS106_PROC_TXT */
        , BC_NO           /* VS106_BAR_CD */
        , BC_IN_MTHD_CD   /* VS106_IN_MTH */
        , CST_SIGN_CN     /* VS106_CSMR_SIGN */
        , RGST_IP_ADR     /* VS106_REG_IP */
        , CRAL_LOCARA_TNO /* VS106_PHONE_NUMBER */
                          /*,  VS106_VOC_CAT  --VOC카테고리 없음 */
                          /*,  VS106_VOC_CD   --VOC상세내용 없음 */
                          /*,  VS106_DELIVERY_SEQ  --제품배송 작업완료 순번관리 없음 */
       , AS_AK_RCP_YN    /* VS106_AS_REQ_YN    A/S요청접수여부(방문내역) */
       , INF_CH_AK_YN    /* VS106_INFO_REQ_YN  정보변경요청여부(방문내역) */
       , ETC_CH_AK_YN    /*  new col  */
       , IST_CTF_MTMS_FW_YN    /*  new col  */
       , SFT_ACDN_YN    /*  new col  */
       , PLS_SV_YN      /*  new col  */
       , PESL_ARTC_DFRN_YN    /*  new col  */
       , TONEP_IST_OPT_YN    /*  new col  */
       , TONEP_RCVRY_OPT_YN    /*  new col  */
       , TONEP_FRISU_RCVRY_VT1_USE_YN    /*  new col  */
       , CST_SIGN_HS_YN    /*  new col  */
       , DCEVDN_CONF_YN    /*  new col  */
       , IST_FIT_YN    /*  new col  */
       , DTA_DL_YN    /*   new col  */

        <include refid="COMMON.insertSystemField"/>
         )
    VALUES
         (
          #{cntrNo}
        , #{cntrSn}
           /* VS106_SEQ (SELECT LPAD(NVL(MAX(VS106_SEQ),0)+1,3,'0')   FROM LC_VISIT_VS106TB  WHERE 1=1 AND VS106_CSMR_YR = #CSMR_YR# AND VS106_CSMR_CD = #CSMR_CD# AND VS106_CSMR_SEQ = #CSMR_SEQ# )  */
        , #{cstSvAsnNo}
        , NVL('1', '1')
        , #{urgtYn}
        , #{rpbLocaraCd}
        , 'N'
        , #{wkPrtnrNo}
        , TO_CHAR(SYSDATE, 'YYYYMMDD')
        , TO_CHAR(SYSDATE, 'HH24MISS')
        , '20'
        , '1'
        , ''
        , ''
        , ''
        , ''
        , ''
        , '설치택배상품 출고완료'
        , ''
        , ''
        , ''
        , ''
        , ''
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        , 'N'
        <include refid="COMMON.insertSystemFieldValue"/>
         );

        /* 설치일자 업데이트*/
        UPDATE TB_SVPD_CST_SV_EXCN_IZ
        SET IST_DT = TO_CHAR(SYSDATE, 'YYYYMMDD')
        , FNL_MDFC_DTM = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
        , FNL_MDFC_USR_ID = #{session.userId}
        , FNL_MDFC_PRG_ID = #{session.pageId}
        , FNL_MDFC_DEPT_ID = #{session.departmentId}
        WHERE CNTR_NO = #{cntrNo};

        /* 23.03.14 이경호 파트장님요청, 렌탈건은 웰컴 BS 생성, 일시불건은 멤버십 가입 예정인건(해당 조건은 조상희 매니저님이 주신 조건으로 만듬)만 생성 */
        /* 웰컴BS생성 */



        END;
    </insert>
    <insert  id="insertPcsvOutOfStorageRvPy" parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
            V_ST163_COUNT INT;
            V_ST121_QTY INT;
            V_VS106_SEQ VARCHAR(3);
            V_ST163_CHG_GB CHAR(1);
            V_ST163_ADMIN_CD VARCHAR2(10);
            V_ST163_BIZ_CD VARCHAR2(10);
            V_ST163_BRNH_CD	VARCHAR2(10);

            OUT_MSG       VARCHAR2(1000);
        BEGIN
        /* 작업 엔지니어의 소속 정보를 구한다. */
        /* 수불 오류 방지를 위해서 재고 수량 체크 */
        /* 작업순번 조회 */
	    /* 중복 제거를 위해서 카운팅 */
	    /* 사용 내역을 저장한다. */
        /* 수불처리*/

        UPDATE TB_SVPD_CST_SVAS_IST_OJ_IZ
        SET FNL_MDFC_USR_ID = 'TEST_PRG_70'
        WHERE CST_SV_ASN_NO = '1202008220000768328'; -- cstSvAsnNo
        RAISE_APPLICATION_ERROR(-20003, '잘못되었음!');

        END;
    </insert>
    <insert  id="insertPcsvOutOfStorageRshp" parameterType="com.kyowon.sms.wells.web.service.stock.dvo.WsnaPcsvOutOfStorageSaveDvo">
        DECLARE
        BEGIN
	    /* 동일 키값으로 결과가 저장되었는지 체크한다. */
	 	/* 완료건 완료 처리 불가 */
        /* 작업구분상세(업무유형)을 구한다.*/
        /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)*/
	 	/* 15.06.21 변경후 로그 저장 */
		/* 작업결과 결과테이블에 저장*/
        /* 반품요청오더가 미처리된게 있다면 수불 없이 완료 처리를 한다.*/
        /* 반품 요청 오더 (미처리) 정보가  존재하는경우 */
        /* 배정번호조회*/
        /* 위치현상원인수당조회*/
        /* 배정테이블 업데이트(LC_VISITASSIGN_114_INS_U01 쿼리 여기서 대체)  (반품시 : V_CST_SV_ASN_NO )  */
        /* 15.06.21 변경후 로그 저장   (반품시 : V_CST_SV_ASN_NO )  */
        /* 작업결과 결과테이블에 저장 (반품시 VS106_PROC_TXT , V_WK_CAN_MO_CN ) */

        UPDATE TB_SVPD_CST_SVAS_IST_OJ_IZ
        SET FNL_MDFC_PRG_ID = 'TEST_PRG_0614'
        WHERE CST_SV_ASN_NO = '1202008220000768328'; -- cstSvAsnNo
        RAISE_APPLICATION_ERROR(-20003, '잘못되었음!');
        END;
     </insert>
</mapper>
