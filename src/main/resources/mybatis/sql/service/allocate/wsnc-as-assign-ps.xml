<?xml version="1.0" encoding="UTF-8"?>
<!---
****************************************************************************************************
* 프로그램 개요
****************************************************************************************************
1. 모듈 : SNC (배정관리)
2. 프로그램 ID : 총 관리고객 집계
3. 작성자 : gs.piit129
4. 작성일 : 2022.11.22
****************************************************************************************************
* 프로그램 설명
****************************************************************************************************
- 책임지역 지역코드 관리 (http://localhost:3000/#/service/total-customers)
 ****************************************************************************************************
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.allocate.mapper.WsncAsAssignPsMapper">

    <select id="selectTotalCustomers" resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsAssTotalCustomerDvo">
    SELECT YYYY||'년' AS YYYY    -- 년
         , TYP                -- 구분
         , (SELECT CD_CNTN FROM T_CMZ_CD_D WHERE TENANT_ID ='TNT_WELLS' AND CD_ID='PRD_MNGT_TP_CD' AND CD_VLD_VAL = TYP) AS TYP_NM
         , SUM(DECODE(MM, '01', 1)) AS ACOL1     -- 1
         , SUM(DECODE(MM, '02', 1)) AS ACOL2     -- 2
         , SUM(DECODE(MM, '03', 1)) AS ACOL3     -- 3
         , SUM(DECODE(MM, '04', 1)) AS ACOL4     -- 4
         , SUM(DECODE(MM, '05', 1)) AS ACOL5     -- 5
         , SUM(DECODE(MM, '06', 1)) AS ACOL6     -- 6
         , SUM(DECODE(MM, '07', 1)) AS ACOL7     -- 7
         , SUM(DECODE(MM, '08', 1)) AS ACOL8     -- 8
         , SUM(DECODE(MM, '09', 1)) AS ACOL9     -- 9
         , SUM(DECODE(MM, '10', 1)) AS ACOL10    -- 10
         , SUM(DECODE(MM, '11', 1)) AS ACOL11    -- 11
         , SUM(DECODE(MM, '12', 1)) AS ACOL12    -- 12
         , COUNT(*) AS TCNT
      FROM (
            SELECT FILT_SELL_TP_CD AS TYP
                 , SUBSTR(MNGT_YM, 0, 4) AS YYYY
                 , SUBSTR(MNGT_YM, 5,2) MM
                 , PD_CD, SUBSTR(PD_CD, 0, 5) AS PD_CD_5
                 , SUBSTR(PD_CD, 6) AS PD_CD_6
                 , MNGT_YM
            FROM TB_SVPD_MCBY_CST_SV_OJ_IZ
            WHERE 1=1
              <if test="@MybatisUtils@isNotEmpty(year)">
              AND MNGT_YM LIKE #{year} || '%'
              </if>
              <if test="@MybatisUtils@isNotEmpty(pdGdCd)">
              AND PD_GD_CD = #{pdGdCd}
              </if>
              <if test="@MybatisUtils@isNotEmpty(pdCd)">
              AND PD_CD = #{pdCd}
              </if>
      )
    GROUP BY YYYY, TYP
    ORDER BY TYP
    </select>

    <select id='selectProductServices' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsAssProductServicesDvo">
    SELECT '2021년' AS WK_EXCN_DT, '1' AS SV_BIZ_HCLSF_CD, '설치' AS SV_BIZ_HCLSF_NM, '13697' AS ACOL1, '17639' AS ACOL2, '23277' AS ACOL3, '23430' AS ACOL4, '20957' AS ACOL5, '19620' AS ACOL6, '19222' AS ACOL7, '20701' AS ACOL8, '15335' AS ACOL9, '8182' AS ACOL10, '' AS ACOL11, '' AS ACOL12, '182060' AS TCNT FROM DUAL UNION ALL
    SELECT '2021년' AS WK_EXCN_DT, '1B' AS SV_BIZ_HCLSF_CD, '필터' AS SV_BIZ_HCLSF_NM, '9' AS ACOL1, '5' AS ACOL2, '12' AS ACOL3, '18' AS ACOL4, '4' AS ACOL5, '13' AS ACOL6, '11' AS ACOL7, '14' AS ACOL8, '3' AS ACOL9, '2' AS ACOL10, '' AS ACOL11, '' AS ACOL12, '91' AS TCNT FROM DUAL UNION ALL
    SELECT '2021년' AS WK_EXCN_DT, '2' AS SV_BIZ_HCLSF_CD, 'B/S' AS SV_BIZ_HCLSF_NM, '' AS ACOL1, '' AS ACOL2, '' AS ACOL3, '' AS ACOL4, '' AS ACOL5, '' AS ACOL6, '' AS ACOL7, '' AS ACOL8, '1105' AS ACOL9, '148459' AS ACOL10, '151987' AS ACOL11, '1500' AS ACOL12, '303051' AS TCNT FROM DUAL UNION ALL
    SELECT '2021년' AS WK_EXCN_DT, '3' AS SV_BIZ_HCLSF_CD, 'A/S' AS SV_BIZ_HCLSF_NM, '23860' AS ACOL1, '21925' AS ACOL2, '29356' AS ACOL3, '27745' AS ACOL4, '24282' AS ACOL5, '28091' AS ACOL6, '29791' AS ACOL7, '27544' AS ACOL8, '23089' AS ACOL9, '13289' AS ACOL10, '' AS ACOL11, '' AS ACOL12, '248972' AS TCNT FROM DUAL UNION ALL
    SELECT '2022년' AS WK_EXCN_DT, '1' AS SV_BIZ_HCLSF_CD, '설치' AS SV_BIZ_HCLSF_NM, '23270' AS ACOL1, '19201' AS ACOL2, '23425' AS ACOL3, '11741' AS ACOL4, '' AS ACOL5, '173' AS ACOL6, '2667' AS ACOL7, '8436' AS ACOL8, '595' AS ACOL9, '6042' AS ACOL10, '2334' AS ACOL11, '3723' AS ACOL12, '101607' AS TCNT FROM DUAL UNION ALL
    SELECT '2022년' AS WK_EXCN_DT, '1B' AS SV_BIZ_HCLSF_CD, '필터' AS SV_BIZ_HCLSF_NM, '7' AS ACOL1, '7' AS ACOL2, '10' AS ACOL3, '18' AS ACOL4, '' AS ACOL5, '' AS ACOL6, '11' AS ACOL7, '9' AS ACOL8, '' AS ACOL9, '16' AS ACOL10, '2' AS ACOL11, '4' AS ACOL12, '84' AS TCNT FROM DUAL UNION ALL
    SELECT '2022년' AS WK_EXCN_DT, '2' AS SV_BIZ_HCLSF_CD, 'B/S' AS SV_BIZ_HCLSF_NM, '236637' AS ACOL1, '226522' AS ACOL2, '236468' AS ACOL3, '192563' AS ACOL4, '190493' AS ACOL5, '11038' AS ACOL6, '72383' AS ACOL7, '175961' AS ACOL8, '23516' AS ACOL9, '151278' AS ACOL10, '60348' AS ACOL11, '85440' AS ACOL12, '1662647' AS TCNT FROM DUAL UNION ALL
    SELECT '2022년' AS WK_EXCN_DT, '3' AS SV_BIZ_HCLSF_CD, 'A/S' AS SV_BIZ_HCLSF_NM, '17900' AS ACOL1, '20936' AS ACOL2, '23510' AS ACOL3, '15153' AS ACOL4, '1' AS ACOL5, '429' AS ACOL6, '4107' AS ACOL7, '14074' AS ACOL8, '788' AS ACOL9, '9360' AS ACOL10, '2615' AS ACOL11, '4518' AS ACOL12, '113391' AS TCNT FROM DUAL
    </select>

</mapper>
