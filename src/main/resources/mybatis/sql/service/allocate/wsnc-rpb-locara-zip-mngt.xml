<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.allocate.mapper.WsncRpbLocaraZipMngtMapper">

    <select id="selectZipNos" resultType="com.kyowon.sms.wells.web.service.allocate.dto.WsncRpbLocaraZipMngtDto$SearchRes">
        SELECT A.NEW_ADR_ZIP            /* 신주소우편번호 */
             , A.MGT_CNT                /* 지역별 서비스 계정 수 */
             , A.WRK_CNT                /* 월별 수임 건수 (조회월 이전 3개월 평균) */
             , A.CTPV_NM                /* 시도명 */
             , A.CTCTY_NM               /* 시군구명 */
             , A.LAWC_EMD_NM            /* 법정읍면동명 */
             , A.AMTD_NM                /* 행정동명 */
             , A.LAWC_EMD_NM || ' / ' || A.AMTD_NM AS MNGT_AMTD /* 관리행정동 */
             , A.RPB_LOCARA_CD          /* 책임지역코드 */
             , A.RPB_LOCARA_GRP_CD      /* 책임지역그룹코드 */
             , A.OG_NM                  /* 조직명 */
             , A.ICHR_PRTNR_NO          /* 담당파트너번호 */
             , A.PRTNR_KNM              /* 파트너한글명 */
             , A.VST_DOW_VAL            /* 방문요일값 */
             , A.EMD_SN                 /* 읍면동일련번호 */
             , A.FR2P_LGLD_CD           /* 앞2자리법정동코드 */
             , A.KYNOR_LOCARA_YN        /* 경북지역여부 */
             , A.ILD_YN                 /* 섬여부 */
             , A.PDLV_NO                /* 출고지번호 */
             , A.DTA_DL_YN              /* 데이터삭제여부 */
             , A.APPLY_DATE             /* 적용일자 */
          FROM
             (
               SELECT '01234' AS NEW_ADR_ZIP, '11' AS MGT_CNT, '11' AS WRK_CNT, '서울특별시' AS CTPV_NM, '도봉구' AS CTCTY_NM, '쌍문동' AS LAWC_EMD_NM, '쌍문동' AS AMTD_NM, '11320' AS RPB_LOCARA_CD, '10500' AS RPB_LOCARA_GRP_CD, '도봉점' AS OG_NM, 'A12345678' AS ICHR_PRTNR_NO, '오동동' AS PRTNR_KNM, '월' AS VST_DOW_VAL, 'N' AS DTA_DL_YN, '20220506' AS FNL_MDFC_DTM, '001' AS EMD_SN, '11' AS FR2P_LGLD_CD, 'N' AS KYNOR_LOCARA_YN, 'N' AS ILD_YN, 'PN0101' AS PDLV_NO, '20220101' AS APPLY_DATE FROM DUAL UNION ALL
               SELECT '02233', '22', '22', '서울특별시', '강북구', '수유동', '수유동', '11305', '10300', '강북점', 'A22345678', '고길동', '토', 'N', '20221003', '001', '11', 'N', 'N', 'PN0102', '20220701' FROM DUAL UNION ALL
               SELECT '01531', '33', '35', '서울특별시', '도봉구', '쌍문동', '쌍문동', '11320', '10500', '도봉점', 'A32345678', '김길동', '금', 'N', '20210111', '001', '11', 'N', 'N', 'PN0103', '20220601' FROM DUAL UNION ALL
               SELECT '02122', '17', '8', '경기도', '장안구', '파장동', '파장동', '41111', '12900', '수원점', 'A92345678', '김갑순', '월화금', 'N', '20200219', '001', '41', 'N', 'N', 'PN0104', '20220501' FROM DUAL UNION ALL
               SELECT '02135', '11', '7', '경기도', '장안구', '율전동', '율전동', '41111', '13200', '수원점', 'A88345670', '이길순', '토', 'N', '20220209', '001', '41', 'N', 'N', 'PN0105', '20190101' FROM DUAL UNION ALL
               SELECT '01673', '15', '3.5', '충청북도', '상당구', '평천동', '평촌동', '43111', '12700', '청주점', 'D12345678', '홍길동', '월토', 'N', '20200512', '001', '43', 'N', 'N', 'PN0106', '20190101' FROM DUAL UNION ALL
               SELECT '01675', '13', '3.5', '충청북도', '상당구', '평천동', '평촌동', '43111', '12700', '청주점', 'D33345675', '나길동', '목금토', 'N', '20210709', '001', '43', 'N', 'N', 'PN0107', '20190101' FROM DUAL UNION ALL
               SELECT '01712', '8', '5.2', '충청남도', '예산군', '삽교읍', '삽교읍', '44810', '25323', '충남점', 'E13345675', '최길동', '목금토', 'N', '20210909', '001', '44', 'N', 'N', 'PN0108', '20220101' FROM DUAL UNION ALL
               SELECT '01856', '9', '3', '충청남도', '아산시', '송악면', '송악면', '44200', '31022', '충남점', 'E74345675', '김첨지', '월화목금', 'N', '20190303', '001', '44', 'N', 'N', 'PN0109', '20220101' FROM DUAL UNION ALL
               SELECT '03133', '15', '8', '부산광역시', '수영구', '광안2동', '광안2동', '26500', '10400', '수영점', 'B42345678', '김교원', '수토', 'N', '20210312', '001', '26', 'N', 'N', 'PN0211', '20210101' FROM DUAL UNION ALL
               SELECT '03271', '19', '17', '부산광역시', '수영구', '광안1동', '광안1동', '26500', '10400', '수영점', 'C42345678', '나교원', '월화수', 'N', '20201123', '001', '26', 'N', 'N', 'PN0212', '20210101' FROM DUAL UNION ALL
               SELECT '04124', '13', '6.5', '경상북도', '경주시', '노동동', '노동동', '47130', '10600', '경북점', 'F32345633', '노동원', '화수토', 'N', '20220126', '001', '47', 'Y', 'N', 'PN0213', '20120101' FROM DUAL UNION ALL
               SELECT '04234', '7', '3', '경상북도', '경주시', '교동', '교동', '47130', '11000', '경북점', 'F55340011', '김동원', '월목금토', 'N', '20220715', '001', '47', 'Y', 'N', 'PN0214', '20220101' FROM DUAL
             ) A
         WHERE 1 = 1
           AND A.DTA_DL_YN = 'N'
        <if test="@MybatisUtils@isNotEmpty(zipFrom)">
           AND A.NEW_ADR_ZIP &gt; #{zipFrom}
        </if>
        <if test="@MybatisUtils@isNotEmpty(zipTo)">
           AND A.NEW_ADR_ZIP &lt; #{zipTo}
        </if>
        <if test="@MybatisUtils@isNotEmpty(ctpvNm)">
           AND A.CTPV_NM = #{ctpvNm}
        </if>
        <if test="@MybatisUtils@isNotEmpty(ctctyNm)">
           AND A.CTCTY_NM = #{ctctyNm}
        </if>
        <!-- TODO: 필수 조건
        <if test="@MybatisUtils@isNotEmpty(wkGrpCd)">
           AND A.WK_GRP_CD = #{wkGrpCd}
        </if>
        <if test="@MybatisUtils@isNotEmpty(applyDate)">
           AND #{applyDate} BETWEEN A.APY_STRTDT AND A.APY_ENDDT
        </if>
        -->
         ORDER BY A.NEW_ADR_ZIP
    </select>

    <select id="selectDistricts" resultType="com.kyowon.sms.wells.web.service.allocate.dto.WsncRpbLocaraZipMngtDto$District">
        SELECT DISTINCT
               T1.FR2P_LGLD_CD 	/* 앞2자리법정동코드 */
             , T1.CTPV_NM 		/* 시도명 */
             , T1.CTCTY_NM 		/* 시군구명 */
             , T1.LAWC_EMD_NM 	/* 법정읍면동명 */
             , T1.AMTD_NM 		/* 행정동명 */
             , T1.LAWC_EMD_NM || ' / ' || T1.AMTD_NM AS MNGT_AMTD /* 관리행정동 */
          FROM TB_SVPD_EGER_ASN_ADR_IZ T1 /* 엔지니어배정주소내역 */
         WHERE 1 = 1
           AND T1.EMD_SN = ( SELECT MAX(EMD_SN)
                               FROM TB_SVPD_EGER_ASN_ADR_IZ
                              WHERE 1 = 1
                                AND NEW_ADR_ZIP = T1.NEW_ADR_ZIP )
         ORDER BY
               T1.FR2P_LGLD_CD
             , T1.CTPV_NM
             , T1.CTCTY_NM
             , T1.LAWC_EMD_NM
             , T1.AMTD_NM
    </select>

    <insert id="insertZipNo">
        SELECT 1 FROM DUAL
<!--        INSERT INTO TB_SVPD_EGER_ASN_ADR_IZ ( /* 엔지니어배정주소내역 */
               NEW_ADR_ZIP      /* 신주소우편번호 */
             , EMD_SN           /* 읍면동일련번호 */
             , FR2P_LGLD_CD     /* 앞2자리법정동코드 */
             , LAWC_EMD_NM      /* 법정읍면동명 */
             , AMTD_NM          /* 행정동명 */
             , KYNOR_LOCARA_YN  /* 경북지역여부 */
             , DTA_DL_YN        /* 데이터삭제여부 */
             , CTPV_NM          /* 시도명 */
             , CTCTY_NM         /* 시군구명 */
             , ILD_YN           /* 섬여부 */
             , PDLV_NO          /* 출고지번호 */
             <include refid="COMMON.insertSystemField" />)
        VALUES (
               #{newAdrZip}
             , #{emdSn}
             , #{fr2pLgldCd}
             , #{lawcEmdNm}
             , #{amtdNm}
             , #{kynorLocaraYn}
             , #{dtaDlYn}
             , #{ctpvNm}
             , #{ctctyNm}
             , #{ildYn}
             , #{pdlvNo}
             <include refid="COMMON.insertSystemFieldValue" /> )-->
    </insert>

</mapper>
