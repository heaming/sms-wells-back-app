<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.allocate.mapper.WsncTransferHistoryMapper">
    <select id="selectTransferHistory"
            resultType="com.kyowon.sms.wells.web.service.allocate.dto.WsncTransferHistoryDto$SearchRes">
        SELECT TO_CHAR(TO_DATE(TB_1.FNL_MDFC_DTM, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD AMHH:MI:SS', 'nls_date_language=korean') AS FNL_MDFC_DTM
             , TB_1.ASN_TF_DV_CD                AS ASN_TF_DV_CD
             , TB_2.OG_NM                     AS BF_OG_NM
             , TB_1.BFCH_ICHR_PRTNR_NO        AS BF_CNFM_PSIC_PRTNR_NO
             , TB_2.PRTNR_KNM                    AS BF_PRTNR_KNM
             , TB_3.OG_NM                     AS AF_OG_NM
             , TB_1.TF_CNFM_PRTNR_NO            AS AF_CNFM_PSIC_PRTNR_NO
             , TB_3.PRTNR_KNM                    AS AF_PRTNR_KNM
          FROM TB_SVPD_ASN_RS_TF_IZ TB_1
         INNER JOIN TB_OGBS_PRTNR_BAS TB_2
         ON (
                TB_1.BFCH_ICHR_PRTNR_OG_TP_CD = TB_2.OG_TP_CD
            AND TB_1.BFCH_ICHR_PRTNR_NO = TB_2.PRTNR_NO
         )
         INNER JOIN TB_OGBS_PRTNR_BAS TB_3
         ON (
                TB_1.TF_CNFM_PRTNR_OG_TP_CD = TB_3.OG_TP_CD
            AND TB_1.TF_CNFM_PRTNR_NO = TB_3.PRTNR_NO
         )
         WHERE 1=1
           AND TB_1.TF_STAT_CD = '20'        -- 확정완료 공통코드(ASN_TF_STAT_CD)
           AND TB_1.CST_SV_ASN_NO = #{cstSvAsnNo}
    </select>

</mapper>
