<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbCnrRcpBzsAsBiztalkMapper">



    <select id="selectCountBiztalkItemization" resultType="int">
        SELECT 1 FROM DUAL
    </select>

    <select id="selectBiztalkTargets" resultType="com.kyowon.sms.wells.web.service.visit.dvo.WsnbCnrRcpBzsAsBiztalkDvo">
        SELECT 1 FROM DUAL
<!--        SELECT I1.SV_BIZ_HCLSF_CD-->
<!--             , I1.RCPDT-->
<!--             , I2.AS_IST_OJ_NO                                                                -->
<!--             , I2.CST_SV_ASN_NO-->
<!--             , I2.CNTR_NO-->
<!--             , I2.CNTR_SN  -->
<!--             , I2.SV_BIZ_DCLSF_CD-->
<!--          FROM ( SELECT I1.SV_BIZ_HCLSF_CD-->
<!--                      , I1.RCPDT-->
<!--                      , I1.AS_IST_OJ_NO-->
<!--                      , I1.CST_SV_ASN_NO-->
<!--                      , I1.CNTR_NO-->
<!--                      , I1.CNTR_SN-->
<!--                      , I1.MTR_STAT_CD-->
<!--                      , I1.SV_BIZ_DCLSF_CD-->
<!--                      , I1.FST_RGST_DTM-->
<!--                      , I1.FST_RGST_USR_ID-->
<!--                      , I1.PD_CD-->
<!--                      , RANK() OVER(PARTITION BY I1.CNTR_NO ORDER BY I1.SV_BIZ_DCLSF_CD ASC) AS RN-->
<!--                   FROM TB_SVPD_CST_SVAS_IST_OJ_IZ I1-->
<!--                  WHERE I1.MTR_STAT_CD = '1'-->
<!--                    AND I1.SV_BIZ_DCLSF_CD IN ('3110','3310','3320','3121','3330','3311','3321')-->
<!--                    AND SUBSTR(I1.FST_RGST_DTM,1,8) = TO_CHAR(SYSDATE,'YYYYMMDD')-->
<!--                    AND TO_DATE(I1.FST_RGST_DTM, 'YYYYMMDDHH24MISS') <![CDATA[>]> (SYSDATE - INTERVAL '15' MINUTE)-->
<!--               ) I2-->
<!--         INNER JOIN TB_OGBS_PRTNR_BAS P1-->
<!--            ON P1.PRTNR_NO = I2.FST_RGST_USR_ID-->
<!--            /* 상품 JOIN 할때, 상품코드와 품목(상품)그룹 필요함. -->
<!--             * (확인된걸로는 TB_PDBS_PD_ECOM_PRP_DTL 이 테이블에 둘다 있음. 사용맞는지) */-->
<!--         INNER JOIN TB_PDBS_PD_ECOM_PRP_DTL D1-->
<!--            ON I2.PD_CD = D1.PD_CD-->
<!--         WHERE NOT EXISTS ( SELECT 1-->
<!--                              FROM TABLE1 T1-->
<!--                             WHERE T1.CNTR_NO       = I2.CNTR_NO-->
<!--                               AND T1.CNTR_SN       = I2.CNTR_SN-->
<!--                               AND T1.CST_SV_ASN_NO = I2.CST_SV_ASN_NO-->
<!--                               AND T1.SEND_PRP_GB   = '1' /* SEND_PRP_GB, SEND_GB 값 미정*/-->
<!--                               AND T1.SEND_GB       = '1'-->
<!--                          )-->
<!--           AND P1.OG_ID = '71309'-->
<!--           AND D1.PD_PRP_VAL20 NOT IN ('93','95') /* 임시컬럼으로 보임. 후에 픽스되면 수정 */-->
<!--           AND I2.RN = 1-->
    </select>

    <select id="selectBiztalkTarget" resultType="com.kyowon.sms.wells.web.service.visit.dvo.WsnbCnrRcpBzsAsBiztalkDvo">
        SELECT 1 FROM DUAL
<!--        SELECT I1.CST_SV_ASN_NO-->
<!--             , C1.CST_KNM-->
<!--             , SUBSTR(VST_RQDT,5,2)||'/'||SUBSTR(VST_RQDT,7,2) AS VST_DATE  /* 템플릿 형식에 맞춤. */-->
<!--             , '' AS VST_TIME-->
<!--             , GET_ITEM_NM() AS PD_NM-->
<!--             , F_CMZ_CD_NM(#{session.tenantId}, 'SV_BIZ_DCLSF_CD', O1.SV_BIZ_DCLSF_CD, #{session.langId}) AS VST_TYPE_NM-->
<!--             , I1.PRTNR_NO /* EMP_ID_ENG */-->
<!--             , C1.CRAL_LOCARA_TNO-->
<!--             , C1.MEXNO_ENCR-->
<!--             , C1.CRAL_IDV_TNO-->
<!--          FROM TB_SVPD_CST_SVAS_IST_OJ_IZ O1-->
<!--         INNER JOIN TB_SVPD_CST_SV_AS_IST_ASN_IZ I1-->
<!--            ON O1.CST_SV_ASN_NO = I1.CST_SV_ASN_NO-->
<!--         INNER JOIN TB_CUBS_CST_BAS C1-->
<!--            ON O1.CST_NO = C1.CST_NO-->
<!--         WHERE O1.IN_CHNL_DV_CD   = '1'-->
<!--           AND O1.SV_BIZ_HCLSF_CD = #{svBizHclsfCd}  /* AS_IST_OJ_NO 같으면 위에 두개도 같은건데 조건 필요한지? */-->
<!--           AND O1.RCPDT           = #{rcpdt}-->
<!--           AND O1.AS_IST_OJ_NO    = ( SELECT MAX(AS_IST_OJ_NO)-->
<!--                                        FROM TB_SVPD_CST_SVAS_IST_OJ_IZ-->
<!--                                       WHERE CNTR_NO = #{cntrNo}-->
<!--                                         AND SV_BIZ_DCLSF_CD = #{svBizDclsfCd}-->
<!--                                         AND IN_CHNL_DV_CD   = '1'-->
<!--                                         AND SV_BIZ_HCLSF_CD = #{svBizHclsfCd}-->
<!--                                         AND RCPDT           = #{rcpdt}-->
<!--                                         AND FST_RGST_DTM    = '1'-->
<!--                                    )-->
<!--           AND O1.CNTR_NO         = #{cntrNo}-->
<!--           AND O1.CST_SV_ASN_NO   = #{cstSvAsnNo}-->
    </select>
</mapper>
