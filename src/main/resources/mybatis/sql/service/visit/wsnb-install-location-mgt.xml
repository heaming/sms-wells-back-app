<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbInstallLocationMgtMapper">

    <select id="selectInstallLocationPages" resultType="com.kyowon.sms.wells.web.service.visit.dto.WsnbInstallLocationMgtDto$SearchRes">
        SELECT A.IST_DT /* 설치일자  */
             , A.CNTR_NO  /* 계약번호 */
             , A.CNTR_SN  /* 계약일련번호 */
             , A.DTL_SN   /* 상세일련번호 */
             , A.CUST_NM  /* 고객명 */
             , A.SELL_TP_CD  /* 유형 (코드로 조회하고, 공통코드와 비교해서 NM 출력) */
             , A.PD_NM  /* 상품명 */
             , A.TEL_NO  /* 전화번호 */
             , A.CRAL_TEL_NO  /* 휴대폰번호 */
             , A.ZIP  /* 우편번호 */
             , A.ADR  /* 주소 (기본주소 +_ 상세주소) */
             , A.IST_LCT_DTL_CN  /* 설치위치상세(프로시저적용부분) */
             , A.OG_NM  /* 소속센터 */
             , A.PRTNR_KNM  /* 등록자명 */
             , A.FST_RGST_USR_ID  /* 등록자사번 */
             , A.FST_RGST_DTM  /* 등록일자 */
          FROM
             (
               SELECT '2022-12-02' AS IST_DT, '2022-74383859-00' AS CNTR_NO, 'W20197199787' AS CNTR_SN, '3' AS DTL_SN, '삼립에스' AS CUST_NM, '렌탈' AS SELL_TP_CD,'정수기(KW-PK2W1)' AS PD_NM, '031-111-2222' AS TEL_NO, '010-1234-5678' AS CRAL_TEL_NO, '15085' AS ZIP, '경기 시흥시 공단1대로 101 시화공장 2층 보건실' AS ADR, '' AS IST_LCT_DTL_CN, '75041' AS OG_ID, '북부서비스센터' AS OG_NM, '김민재' AS PRTNR_KNM, '37209' AS FST_RGST_USR_ID, 'Y' AS RSGN_YN, '2022-12-02 14:06:21' AS FST_RGST_DTM, 'N' AS DTA_DL_YN FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7152078-00', 'W20196011934', '2', '권명국', '렌탈','정수기(KW-PK2W1)', '02-3777-1111', '010-2222-3333', '04339', '서울 용산구 이태원로 221 주영아파트', '지하 2층 직원식당', '75043', '남부서비스센터', '최으뜸', '38767', 'N', '2022-11-30 14:52:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7152079-00', 'W20172224431', '3', '권명국', '렌탈','청정기(AP107CGA)', '02-3777-1111', '010-2222-3333', '04339', '서울 용산구 이태원로 221 주영아파트', '지하 2층 직원식당', '75043', '남부서비스센터', '최으뜸', '38767', 'N', '2022-11-30 14:52:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7152080-00', 'W20200437064', '1', '권명국', '렌탈','비데(BM550RWA)', '02-3777-1111', '010-2222-3333', '04339', '서울 용산구 이태원로 221 주영아파트', '지하 2층 직원식당', '75043', '남부서비스센터', '최으뜸', '38767', 'N', '2022-11-30 14:52:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-02', '2022-7439172-00', 'W20180629064', '3', '제이그림', '렌탈','청정기(AN734CWB)34평', '010-6772-2333', '010-6772-2333', '54831', '전북 전주시 덕진구 와룡로 58-3, (송천동2가)', '1층 감사반', '71364', '전주지점', '안천재', '12345', 'N', '2022-12-02 16:30:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-02', '2022-7439173-00', 'W20200356464', '1', '제이그림', '렌탈','청정기(AN734CWB)34평', '010-6772-2333', '010-6772-2333', '54831', '전북 전주시 덕진구 와룡로 58-3, (송천동2가)', '1층 기쁨반', '71364', '전주지점', '안천재', '12345', 'N', '2022-12-02 16:30:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-02', '2022-7439174-00', 'W20200192558', '1', '제이그림', '렌탈','청정기(AN734CWB)34평', '010-6772-2333', '010-6772-2333', '54831', '전북 전주시 덕진구 와룡로 58-3, (송천동2가)', '2층 창의반', '71364', '전주지점', '안천재', '12345', 'N', '2022-12-02 16:30:28', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394172-00', 'W20200192592', '1', '배반장례', '렌탈','정수기(WP270UWA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 4호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394173-00', 'W20200540135', '2', '배반장례', '렌탈','청정기(AP107CGA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 4호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394174-00', 'W20178493120', '1', '배반장례', '렌탈','정수기(WP270UWA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 특2호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394175-00', 'W20200665106', '1', '배반장례', '렌탈','청정기(AP107CGA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 특2호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394176-00', 'W20201175310', '1', '배반장례', '렌탈','정수기(WP270UWA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 5호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-30', '2022-7394177-00', 'W20193848056', '1', '배반장례', '렌탈','청정기(AP107CGA)', '041-544-1111', '010-8888-7777', '31477', '충남 아산시 배방읍 갈산교로 38, (배방읍,배방장례식장)', '2층 5호실', '75045', '충청서비스센터', '김수호', '36999', 'N', '2022-11-30 09:24:04', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-01', '2022-7431138-00', 'W20201313420', '1', '공군제8', '렌탈','정수기(WP270UWA)', '053-989-2505', '010-7771-7408', '41052', '대구 동구 아양로 352 1층(입석동,사서함 304-120)', '4층 83창 개발팀', '71369', '동대구지점점', '김태오', 'N', '366662', '2022-12-01 12:01:36', 'N' FROM DUAL UNION ALL
			   SELECT '2022-12-01', '2022-7431139-00', 'W20202490087', '1', '공군제8', '렌탈','정수기(WP270UWA)', '053-989-2505', '010-7771-7408', '41052', '대구 동구 아양로 352 1층(입석동,사서함 304-120)', '1번 83창 개발팀', '71369', '동대구지점점', '김태오', 'N', '366662', '2022-12-01 12:01:36', 'N' FROM DUAL UNION ALL
               SELECT '2022-11-29', '2022-7012478-00', 'W20202776512', '1', '한지은', '렌탈','정수기(WP270UWA)', '010-4444-7121', '010-4444-7121', '01859', '서울 노원구 동일로 173가길 59 1층(공릉동)', '프로미카월드에 있는 공릉세차장', '71367', '하남지점', '김이삭', 'N', '36291', '2022-11-29 09:37:12', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-06', '2022-7453428-00', 'W20202598798', '2', '다락지역', '렌탈','청정기(AP520VWA)', '043-233-1111', '010-4400-3333', '28174', '충북 청주시 흥덕구 강내면 다락2길 1-16', '다함께교실(멀티미니어)', '71360', '청주지점', '오종찬', '38252', 'N', '2022-12-06 13:50:46', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-06', '2022-7453429-00', 'W20190751953', '2', '다락지역', '렌탈','청정기(AP520VWA)', '043-233-1111', '010-4400-3333', '28174', '충북 청주시 흥덕구 강내면 다락2길 1-16', '사무실', '71360', '청주지점', '오종찬', '38252', 'N', '2022-12-06 13:50:46', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-06', '2022-7436997-00', 'W20202861074', '2', '예성의원', '렌탈','청정기(AN522CWA)22평', '010-3111-2360', '010-3111-2360', '59331', '전남 장흥군 장흥읍 칠거리예양로 68 1층 ', '로비', '71363', '광주지점', '진기영', '38138', 'N', '2022-12-06 13:51:14', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-06', '2022-7436998-00', 'W20202826484', '1', '예성의원', '렌탈','청정기(AN522CWA)22평', '010-3111-2360', '010-3111-2360', '59331', '전남 장흥군 장흥읍 칠거리예양로 68 1층 ', '물리치료실', '71363', '광주지점', '진기영', 'N', '38138', '2022-12-06 13:51:14', 'N' FROM DUAL UNION ALL
               SELECT '2022-12-05', '2022-7463622-00', 'W20178483472', '1', '이예나', '분할','팝WIDE(KW-G01W1)', '010-4160-7715', '010-4160-7715', '45533', '충북 청주시 상당구 호미로 137 청주동남1단지 105-1010', '', '71360', '청주지점', '박가영', 'Y', '31154', '2022-12-05 14:52"28', 'N' FROM DUAL
               ) A
         WHERE 1 = 1
           AND A.DTA_DL_YN = 'N'
    </select>

    <insert id="insertInstallLocation">
        SELECT 1 FROM DUAL
<!--        INSERT INTO TB_SVPD_CNTR_PDCT_IST_LCT_DTL-->
<!--             ( CNTR_NO-->
<!--             , CNTR_SN-->
<!--             , DTL_SN-->
<!--             , IST_LCT_DTL_CN-->
<!--             , WK_PRTNR_NO-->
<!--             , DTA_DL_YN-->
<!--              <include refid="COMMON.insertSystemField"/>-->
<!--             )-->
<!--        VALUES-->
<!--             ( #{cntrNo}-->
<!--             , #{cntrSn}-->
<!--             , SELECT LPAD(NVL(MAX(DTL_SN),0)+1,3,'0')-->
<!--                 FROM (SELECT MAX(DTL_SN) AS DTL_SN-->
<!--                         FROM TB_SVPD_CNTR_PDCT_IST_LCT_DTL-->
<!--                        WHERE CNRT_NO = #{cntrNo}-->
<!--                          AND CNTR_SN = #{cntrSn}-->
<!--                        GROUP BY CNTR_NO-->
<!--                               , CSMR_SN)-->
<!--             , #{istLctDtlCn}-->
<!--             , #{wkPrtnrNo}-->
<!--             , 'N'-->
<!--              <include refid="COMMON.insertSystemFieldValue"/>-->
<!--             )-->
    </insert>
    <select id="selectSerialNumberByPk" resultType="String">
        SELECT LPAD(NVL(MAX(DTL_SN),0),3,'0')
          FROM (SELECT MAX(DTL_SN) AS DTL_SN
                  FROM TB_SVPD_CNTR_PDCT_IST_LCT_DTL
                 WHERE CNTR_NO = #{cntrNo}
                   AND CNTR_SN = '00'
                 GROUP BY CNTR_NO, CNTR_SN
               )
    </select>

    <select id="selectInstallLocationContentLength" resultType="int">
        SELECT NVL(LENGTH(TRIM(IST_LCT_DTL_CN)),0)
          FROM TB_SVPD_CNTR_PDCT_IST_LCT_DTL
         WHERE CNTR_NO = #{cntrNo}
           AND CNTR_SN = '00'
           AND DTL_SN  = #{dtlSn}
    </select>

    <insert id="insertInitializeInstallLocation">
        SELECT 1 FROM DUAL
<!--        INSERT INTO TB_SVPD_CNTR_PDCT_IST_LCT_DTL-->
<!--             ( CNTR_NO-->
<!--             , CNTR_SN-->
<!--             , DTL_SN-->
<!--             , IST_LCT_DTL_CN-->
<!--             , WK_PRTNR_NO-->
<!--             , DTA_DL_YN-->
<!--              <include refid="COMMON.insertSystemField"/>-->
<!--             )-->
<!--        VALUES-->
<!--             ( #{cntrNo}-->
<!--             , '00'-->
<!--             , #{dtlSn}-->
<!--             , ''-->
<!--             , #{wkPrtnrNo}-->
<!--             , 'N'-->
<!--              <include refid="COMMON.insertSystemFieldValue"/>-->
<!--             )-->
    </insert>
</mapper>
