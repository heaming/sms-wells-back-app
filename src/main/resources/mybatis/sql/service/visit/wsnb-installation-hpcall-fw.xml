<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbInstallationHpcallFwMapper">

    <update id="updateHappyCallBiztalkFwIz">
        SELECT 1 FROM DUAL
    </update>
    <select id="selectCountProcessingCase" resultType="string">
        SELECT 1 FROM DUAL
    </select>

    <select id="selectCustomers" resultType="com.kyowon.sms.wells.web.service.visit.dvo.WsnbInstallationHpcallDvo">
        SELECT 1 FROM DUAL
<!--        SELECT I1.CNTR_NO-->
<!--             , B1.CST_KNM-->
<!--             , F_CMZ_CD_NM(#{session.tenantId}, 'PD_GRP_CD',ST101_ITEM_GR) AS ITEM_GR_NM/* 제픔그룹명 (아직미정) */-->
<!--             , (SELECT STOCK_NM-->
<!--                  FROM LC_STOCK_ST101TB-->
<!--                 WHERE ITEM_CD = SUBSTR(I1.PD_CD,1,5)-->
<!--                   AND PART_CD = SUBSTR(I1.PD_CD,6,6)-->
<!--               ) AS PD_NM-->
<!--             , TO_CHAR(TO_DATE(I2.VST_FSH_DT,'YYYYMMDD'),'YYYY-MM-DD') AS VST_FSH_DT-->
<!--             , B1.CRAL_LOCARA_TNO-->
<!--             , B1.MEXNO_ENCR-->
<!--             , B1.CRAL_IDV_TNO-->
<!--             , II2.VST_FSH_DT  /* 방문완료일자 */-->
<!--             /*, I3.  컬럼 사라짐. TIME만 따로 가져오는 이유?*/-->
<!--          FROM (SELECT I1.CNTR_NO-->
<!--                     , I1.CNTR_SN-->
<!--                     , I1.VST_FSH_DT-->
<!--                     , I1.SV_BIZ_DCLSF_CD-->
<!--                  FROM TB_SVPD_CST_SVAS_IST_OJ_IZ I1-->
<!--                 WHERE I1.CNTR_SN = (SELECT CNTR_SN-->
<!--                                       FROM TB_SVPD_CST_SVAS_IST_OJ_IZ-->
<!--                                      WHERE CNTR_NO = I1.CNTR_NO-->
<!--                                    )-->
<!--               ) II1-->
<!--          LEFT OUTER JOIN TB_CUBS_CST_BAS  B1-->
<!--            ON I1.CST_NO  = B1.CST_NO-->
<!--          LEFT OUTER JOIN (SELECT I2.CNTR_NO-->
<!--                                , I2.CNTR_SN-->
<!--                                , I2.VST_FSH_DT-->
<!--                             FROM TB_SVPD_CST_SV_WK_RS_IZ I2-->
<!--                            WHERE I2.CST_SV_EXCN_SN = (SELECT CST_SV_EXCN_SN-->
<!--                                                         FROM TB_SVPD_CST_SV_WK_RS_IZ-->
<!--                                                        WHERE CNTR_NO = I2.CNTR_NO-->
<!--                                                      )-->
<!--                          ) II2 /* 고객서비스작업결과내역 */-->
<!--            ON I1.CST_SV_ASN_NO = II2.CST_SV_ASN_NO /* tobe에서 하나로 합쳐진 컬럼. */-->
<!--          LEFT OUTER JOIN TB_SVPD_ELC_IST_CONF_IZ I3  /* 전자설치확인내역 (II2테이블과 SN, NO 동일한거 찾는거라 MAX 안해도 됨) */-->
<!--            ON II2.CNTR_NO = I3.CNTR_NO-->
<!--           AND II2.CNTR_SN = I3.CNTR_SN-->
<!--         WHERE I1.SV_BIZ_HCLSF_CD LIKE '11%'-->
<!--           AND II2.VST_FSH_DT >= TO_CHAR(SYSDATE -1, 'YYYYMMDD')-->
<!--           AND SUBSTR(I3.FNL_MDFC_DTM,1,8) >= TO_CHAR(SYSDATE -1, 'YYYYMMDD')-->
<!--           AND (CASE WHEN SUBSTR(I3.FNL_MDFC_DTM,1,8) = TO_CHAR(SYSDATE, 'YYYYMMDD') AND SUBSTR(I3.FNL_MDFC_DTM,9,6) > 210000 THEN '1'-->
<!--                     ELSE '2'-->
<!--                END) = '2'-->
<!--           AND I3.NOTAK_FW_DT IS NULL-->
<!--           AND I3.FNL_MDFC_DTM IS NOT NULL-->
    </select>

    <select id="selectVstPromDt" resultType="String">
        SELECT 1 FROM DUAL
<!--        SELECT NVL(I2.VST_PROM_DT,'')-->
<!--          FROM TB_SVPD_BFSVC_NX_VST_PROM_IZ I2-->
<!--         WHERE I2.CNTR_NO = #{cntrNo}-->
<!--           AND I2.CNTR_SN = #{cntrSn}-->
<!--           AND I2.SAVE_SEQ = (SELECT NVL(MAX(SAVE_SEQ),'000')-->
<!--                                FROM TB_SVPD_BFSVC_NX_VST_PROM_IZ I1-->
<!--                               WHERE I1.CNTR_NO = I2.CNTR_NO-->
<!--                                 AND I1.CNTR_SN = I2.CNTR_SN-->
<!--                                 AND SUBSTR(I1.VST_PROM_DT,1,6) = (SELECT MIN(SUBSTR(VST_PROM_DT,1,6))-->
<!--                                                                     FROM TB_SVPD_BFSVC_NX_VST_PROM_IZ-->
<!--                                                                    WHERE CNTR_NO = #{cntrNo}-->
<!--                                                                      AND CNTR_SN = #{cntrSn}-->
<!--                                                                      AND SUBSTR(VST_PROM_DT,1,6) > SUBSTR(#{wkExcnDt},1,6)-->
<!--                                                                  )-->
<!--                             )-->
<!--           AND #{wkExcnDt} > '20190900'  /* 9월부터 시행 */-->
    </select>
    <update id="updateHappyCallBiztalkFwIzYn">
        SELECT 1 FROM DUAL
<!--        UPDATE TB_SVPD_BFSVC_HCNTAK_FW_IZ-->
<!--           SET FW_YN = 'Y'-->
<!--             , FNL_MDFC_DTM    = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')-->
<!--             , FNL_MDFC_USR_ID = #{wkPrtnrNo}-->
<!--         WHERE CNTR_NO = #{wkCntrNo}-->
<!--           AND CNTR_SN = #{wkCntrSn}-->
<!--           AND CST_SV_ASN_NO = #{wkCstSvAsnNo}-->
    </update>
    <select id="selectCountCustomerByPk" resultType="int">
        SELECT 1 FROM DUAL
<!--        SELECT SUM(CNT)-->
<!--          FROM -->
<!--             ( SELECT COUNT(1) AS CNT-->
<!--                 FROM TB_SVPD_CST_SV_HPCALL_IZ-->
<!--                WHERE CST_SV_ASN_NO    = #{cstSvAsnNo}-->
<!--                  AND VST_DT           = #{wkExcnDt}-->
<!--                  AND CPHON_LOCARA_TNO = #{cralLocaraTno}-->
<!--                  AND CPHON_EXNO_ENCR  = #{mexnoEncrEnc}-->
<!--                  AND CPHON_IDV_TNO    = #{cralIdvTno}-->
<!--                  AND ROWNUM           = 1-->
<!--             )-->
<!--             UNION ALL-->
<!--             (SELECT COUNT(1) AS CNT-->
<!--                FROM TB_SVPD_CST_SV_HPCALL_IZ-->
<!--               WHERE CST_SV_ASN_NO = #{cstSvAsnNo}-->
<!--                 AND VST_DT        = #{wkExcnDt}-->
<!--                 AND CNTR_NO       = #{cntrNo}-->
<!--                 AND ROWNUM        = 1-->
<!--             )-->
<!--             UNION ALL-->
<!--             ( SELECT COUNT(1) AS CNT-->
<!--                 FROM TB_SVPD_CST_SV_HPCALL_IZ-->
<!--                WHERE CST_SV_ASN_NO = #{cstSvAsnNo}-->
<!--                  AND ROWNUM        = 1 -->
<!--             )-->
<!--             UNION ALL-->
<!--             ( SELECT COUNT(1) AS CNT-->
<!--                 FROM TB_CCCS_SMS_RDNY_IZ-->
<!--                WHERE RDNY_DV_CD       = '200'||#{svBizHclsfcd} /* 철거해피콜 없어짐 구분안해도됨(없애도 되는건지??) */-->
<!--                  AND CPHON_LOCARA_TNO = #{cralLocaraTno}-->
<!--                  AND CPHON_EXNO_ENCR  = #{mexnoEncrEnc}-->
<!--                  AND CPHON_IDV_TNO    = #{cralIdvTno}-->
<!--                  AND ROWNUM           = 1-->
<!--             )-->
    </select>

</mapper>
