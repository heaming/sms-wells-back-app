<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbIndividualVisitPrdInqrMapper">
     <select id="selectCustomerVisitIzs" resultType="com.kyowon.sms.wells.web.service.visit.dto.WsnbIndividualVisitPrdInqrDto$SearchCustomerVisitIzRes">
        SELECT T1.VST_NMN_N
             , T1.IST_NMN_N
             , T1.VST_DUEDT
             , T1.SV_BIZ_DCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_DCLSF_CD', T1.SV_BIZ_DCLSF_CD, 'ko') AS SV_BIZ_DCLSF_NM
             , T1.FILT_CHNG_LV_CD
             , T1.WK_DT
             , T1.MTR_CAN_DT
             , T2.PD_CD
             , T2.PD_NM
        FROM TB_SVPD_CST_SV_RGBSPR_IZ T1
        INNER JOIN TB_PDBS_PD_BAS T2
         ON T1.PART_PD_CD= T2.PD_CD
         AND T2.DTA_DL_YN  ='N'
        WHERE T1.CNTR_NO = #{cntrNo}
          AND T1.CNTR_SN = #{cntrSn}
        ORDER BY VST_DUEDT , FILT_CHNG_LV_CD
     </select>
     <select id="selectManagementCstInqrs" resultType="com.kyowon.sms.wells.web.service.visit.dto.WsnbIndividualVisitPrdInqrDto$SearchManagementCstInqrRes">
        SELECT SUBSTR(T1.MNGT_YM,1,4)||'-'||SUBSTR(T1.MNGT_YM,5,2) AS MNGT_YM
            , (CASE WHEN T1.FXN_PRTNR_YN = '9'
                    THEN '고정'
                    WHEN T1.FXN_PRTNR_DV_CD = '1'
                    THEN '매니저'
                    WHEN T1.FXN_PRTNR_DV_CD = '2'
                    THEN 'ENG'
                    ELSE ''
               END)  AS FXN_PRTNR_DV_CD  /* AC202_CHG_GB */
            , T2.PRTNR_KNM   AS FXN_PRTNR_NM   /* AC202_EMP_ID */
            , T1.FXN_PRTNR_NO       /* AC202_EMP_ID_1 */
            , T1.MNGER_RGLVL_DV_CD  /* AC202_BAD_AR */
            , '' AS MNGER_RGLVL_DV_NM /* AC202_BAD_AR 확인필요 */
            , T1.SV_HSHD_NO         /* AC202_CUST_ID 가구코드 */
            , T1.HSHD_EXCD_CD       /* AC202_CUST_CHK */
            , T1.HSHD_EXCD_CNFM_YN  /* AC202_CUST_CFRM_CHK */
            , T1.EX_HSHD_YN         /* AC202_CUST_EX  */
            , T2.OG_TP_CD           /* AC202_DEPT_CD 확인필요 */
        FROM TB_SVPD_MCBY_CST_SV_OJ_IZ T1
        LEFT OUTER JOIN TB_OGBS_PRTNR_BAS T2
        ON T1.FXN_PRTNR_NO =  T2.PRTNR_NO
         AND T1.FXN_PRTNR_OG_TP_CD = T2.OG_TP_CD
         AND T2.DTA_DL_YN ='N'
        WHERE T1.CNTR_NO = #{cntrNo}
          AND T1.CNTR_SN = #{cntrSn}
        ORDER BY T1.MNGT_YM DESC
     </select>
</mapper>
