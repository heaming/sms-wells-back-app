<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbServiceProcessingIzMapper">

    <select id="selectProducts" resultType="com.kyowon.sms.wells.web.service.visit.dto.WsnbServiceProcessingIzDto$Product">
        SELECT T1.SVPD_PD_CD AS CODE_ID
             , T1.SVPD_NM_ABBR1 AS CODE_NAME
          FROM (<include refid="com.kyowon.sms.wells.web.service.common.BASE.selectPartMaster"/>) T1
         WHERE T1.SVPD_ITEM_KND = '4' /* 상품 */
           AND T1.SVPD_USE_YN = 'Y'
           AND T1.SVPD_ITEM_GR = #{pdGrpCd}
         ORDER BY T1.SVPD_ITEM_CD, T1.SVPD_PART_CD
    </select>

    <select id="selectServiceProcessingItemizations" resultType="com.kyowon.sms.wells.web.service.visit.dto.WsnbServiceProcessingIzDto$SearchRes">
        SELECT T1.CNTR_NO /* 계약번호 */
             , (SELECT CST_KNM FROM TB_CUBS_CST_BAS WHERE CST_NO = T1.CNTR_CST_NO) AS CST_KNM /* 고객명 */
             , C1.COPN_DV_CD /* 개인법인구분 */
             , C1.ALNCMP_CD /* 컨택담당 */
             , '' AS SELL_PRP_NUVAL /* TODO: 홈쇼핑 */
             , T3.ALNC_BZS_CD /* 제휴업체코드 */
             , C2.FRISU_YN /* 무료체험(무상여부) */
             , C2.SELL_TP_CD /* 고객유형(판매유형코드) */
             , 'N' AS WTHOL_IST_YN /* TODO: 조리수설치 */
             , C3.CRAL_LOCARA_TNO /* 휴대지역전화번호 */
             , C3.MEXNO_ENCR /* 휴대전화국번호암호화 */
             , C3.CRAL_IDV_TNO /* 휴대개별전화번호 */
             , C4.NEW_ADR_ZIP /* 우편번호 */
             , C4.RNADR || ' ' || C4.RDADR AS RADR /* 주소 */
             , C2.SV_PRD /* 방문주기타입 */
             , C1.CNTR_CNFM_DTM /* 계약일자 */
             , T5.PD_NM /* 상품명 */
             , T5.PD_GRP_CD /* 상품군 */
             , T5.PD_CD /* 품목코드 */
             , T5.PD_NM AS MODEL_NM /* 모델명 */
             , T5.SCN_YN /* 스캔 */
             , T5.BF_MNFT_CO_ID /* 이전제조번호 */
             , T5.BC_NO /* 바코드번호 */
             , T5.PRDT_YM /* 제조년월 */
             , '' AS CHANNEL_NM /* TODO: 접수구분 */
             , '' AS GNRDV /* TODO: 총괄단 */
             , '' AS RGRP /* TODO: 지역단 */
             , O1.OG_NM /* 접수자소속 */
             , O1.PRTNR_KNM /* 접수자표시 */
             , T2.CNSL_DTLP_TP_CD /* 접수내역 */
             , T5.IST_DT /* 설치일자 */
             , T5.USE_MCN /* 사용개월 */
             , T2.SV_BIZ_HCLSF_CD /* 서비스유형 */
             , T2.SV_BIZ_DCLSF_CD /* 서비스유형상세 */
             , '' AS PTY_CST_NO /* TODO: 상대고객번호 */
             , T6.CSTMW_FILT_PD_CD /* 차기 BS 맞춤형 필터 */
             , T5.AS_REFRI_DV_NM /* A/S고객구분 */
             , T5.BFSVC_REFRI_DV_NM /* B/S고객구분 */
             , T5.REFRI_DV_NM /* 유/무상구분 */
             , T5.EGER_CNR_NM /* 담당센터 */
             , T1.RPB_LOCARA_CD /* 책임지역 */
             , T5.EGER_CNR_NM AS ICHR_CNR_SDING_DIDY /* TODO: 담당센터(모종직배) */
             , CASE WHEN T4.PRTNR_NO IS NOT NULL
                    THEN T4.PRTNR_NO || (SELECT ' (' || PRTNR_KNM || ')'
                                           FROM TB_OGBS_PRTNR_BAS
                                          WHERE PRTNR_NO = T4.PRTNR_NO
                                            AND OG_TP_CD = T4.OG_TP_CD)
                ELSE ''
                 END AS PRTNR /* 담당엔지니어 */
             , (SELECT CASE WHEN R1.PRTNR_CLSF_CD = '1' THEN '정규직'
                            WHEN R1.PRTNR_CLSF_CD = '2' AND R2.PSTN_DV_CD = '86' THEN '직무사원(1급)'
                            WHEN R1.PRTNR_CLSF_CD = '2' AND R2.PSTN_DV_CD = '87' THEN '직무사원(2급)'
                            WHEN R1.PRTNR_CLSF_CD = '2' AND R2.PSTN_DV_CD = '88' THEN '직무사원(3급)'
                            WHEN R1.PRTNR_CLSF_CD = '6' THEN '계약직'
                            WHEN R1.PRTNR_CLSF_CD = '7' THEN '개인사업'
                            ELSE ''
                        END AS PRTNR_PSTN_DV /* 동행자 수당구분 */
                  FROM TB_OGBS_PRTNR_BAS R1 /* 파트너기본 */
                 INNER JOIN TB_OGBS_PRTNR_DTL R2 /* 파트너상세 */
                    ON R2.OG_TP_CD = R1.OG_TP_CD
                   AND R2.PRTNR_NO = R1.PRTNR_NO
                 WHERE R1.PRTNR_NO = T4.PRTNR_NO AND R1.OG_TP_CD = T4.OG_TP_CD) AS PRTNR_PSTN_DV /* 직급구분 */
             , T5.SITE_AW_DV_NM /* 현장수당(항목명) */
             , NVL(T5.SITE_AW_AMT, 0) AS SITE_AW_AMT /* 현장수당(금액) */
             , T1.RGLVL_GD_CD /* 현장수당(급지) */
             , NVL(A1.AW_AMT, 0) AS AW_AMT /* 현장수당(금액) */
             , (CASE WHEN T1.LOCARA_CHAOS_GD_CD = '0' THEN 'N' WHEN T1.LOCARA_CHAOS_GD_CD = '1' THEN 'Y' ELSE '' END) AS LOCARA_CHAOS_YN  /* 혼잡지역 */
             , (CASE WHEN T1.LOCARA_CHAOS_GD_CD = '0' THEN 0 WHEN T1.LOCARA_CHAOS_GD_CD = '1' THEN 500 ELSE 0 END) AS LOCARA_CHAOS_AW_AMT /* 혼잡지역수당 */
             , NVL(T5.SITE_AW_AMT, 0) + NVL(A1.AW_AMT, 0) + (CASE WHEN T1.LOCARA_CHAOS_GD_CD = '0' THEN 0 WHEN T1.LOCARA_CHAOS_GD_CD = '1' THEN 500 ELSE 0 END) AS SITE_AW_TOT /* 총계 */
             , T4.CRAL_LOCARA_TNO AS CONTACT_CRAL_LOCARA_TNO /* 연락처(핸드폰) 1 */
             , T4.MEXNO_ENCR AS CONTACT_MEXNO_ENCR /* 연락처(핸드폰) 2 */
             , T4.CRAL_IDV_TNO AS CONTACT_CRAL_IDV_TNO /* 연락처(핸드폰) 3 */
             , T2.RCPDT /* 접수일자 */
             , T2.RCP_HH /* 접수일시 */
             , T1.VST_DUEDT /* 예정일자 */
             , T1.VST_EXP_HH /* 예정일시 */
             , T2.VST_RQDT /* 변경 */
             , T1.VST_CNFMDT /* 확정일자 */
             , T1.VST_CNFM_HH /* 확정일시 */
             , T1.DTM_CH_CAUS_CD /* 변경원인 */
             , T1.DTM_CH_RSON_CD /* 변경사유 */
             , REPLACE(REPLACE(T1.DTM_CH_RSON_DTL_CN, CHR(13), ''), CHR(10), '') AS DTM_CH_RSON_DTL_CN /* 변경사유상세 */
             , '' AS MMS_YN /* TODO: MMS */
             , T4.IST_CTF_MTMS_FW_YN
             , T5.VST_CNFM_HH AS PROM_HH /* 약속시간 */
             , T5.ARV_DTM /* 작업시간(도착) */
             , T5.VST_FSH_DTM /* 작업시간(완료) */
             , '' AS INST_DELAY /* 설치지연일 */
             , T5.WK_LDTM /* 소요시간 */
             , T1.WK_PRGS_STAT_CD /* 작업상태 */
             , T1.WK_CAN_RSON_CD /* 취소사유 */
             , T1.WK_CAN_MO_CN /* 상세내역 */
             , T7.PMOT_DV_VAL /* 사은품 */
             , T4.BAD_DV_CD /* 불량구분 */
             , T5.AS_LCT_CD_NM /* 고장위치 */
             , T5.AS_PHN_CD_NM /* 고장현상 */
             , T4.AS_CAUS_CD /* 위치상세 */
             , T4.SV_PROCS_FOM_CD /* 처리형태 */
             , T4.IMPTA_RSON_CD /* 귀책 */
             , T4.AS_CD_EYN /* AS코드없음 */
             , T4.SFT_ACDN_YN  /* 안전사고 */
             , T4.PLS_SV_YN /* 플러스서비스 */
             , T4.PESL_ARTC_DFRN_YN /* 인적사항다름 */
             , T4.CWTR_WPRS_VAL /* 수압(냉) */
             , T4.WWT_WPRS_VAL /* 수압(온) */
             , T4.PER1M_OLQ_VAL /* 유량 */
             , C5.IST_PLC_TP_CD /* 설치유형(WRFR_IST_MTH_CD) */
             , '' AS RCVRY_OPT /* TODO: 복구옵션 */
             , '' AS RESULT_DTL /* TODO: 결과입력 상세 */
             , REPLACE(REPLACE(T4.SV_PROCS_CN, CHR(13), ''), CHR(10), '') AS SV_PROCS_CN /* 결과입력(상세내역) */
             , '' AS PU1_PART /* 부품1 */
             , '' AS PU2_PART /* 부품2 */
             , '' AS PU3_PART /* 부품3 */
             , '' AS PU4_PART /* 부품4 */
             , '' AS PU5_PART /* 부품5 */
             , '' AS PU6_PART /* 부품6 */
             , '' AS PU7_PART /* 부품7 */
             , '' AS PU8_PART /* 부품8 */
             , '' AS PU9_PART /* 부품9 */
             , '' AS PU10_PART /* 부품10 */
             , (SELECT SUM(BIL_OJ_AMT - BIL_CTR_SUM_AMT)
                  FROM TB_SVPD_SV_CS_BIL_DTL /* 서비스비용청구상세 */
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND CS_BIL_ATC_CD = '10'
                   AND DTA_DL_YN = 'N') AS PART_CS /* 부품비 */
             , (SELECT SUM(BIL_OJ_AMT - BIL_CTR_SUM_AMT)
                  FROM TB_SVPD_SV_CS_BIL_DTL /* 서비스비용청구상세 */
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND CS_BIL_ATC_CD = '20'
                   AND DTA_DL_YN = 'N') AS TCFEE /* 기술료 */
             , (SELECT SUM(BIL_OJ_AMT - BIL_CTR_SUM_AMT)
                  FROM TB_SVPD_SV_CS_BIL_DTL /* 서비스비용청구상세 */
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND CS_BIL_ATC_CD = '30'
                   AND DTA_DL_YN = 'N') AS BSTR_CS /* 출장료 */
             , (SELECT SUM(BIL_OJ_AMT - BIL_CTR_SUM_AMT)
                  FROM TB_SVPD_SV_CS_BIL_DTL /* 서비스비용청구상세 */
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND CS_BIL_ATC_CD = '50'
                   AND DTA_DL_YN = 'N') AS ETC_CS /* 기타비용 */
             , (SELECT SUM(BIL_OJ_AMT - BIL_CTR_SUM_AMT)
                  FROM TB_SVPD_SV_CS_BIL_DTL /* 서비스비용청구상세 */
                 WHERE CNTR_NO = T1.CNTR_NO
                   AND CNTR_SN = T1.CNTR_SN
                   AND CS_BIL_ATC_CD IN ('10', '20', '30', '50')
                   AND DTA_DL_YN = 'N') AS RVE_CS_TOT /* 수납비용 전체 */
             , 0 AS CASH_STLM /* TODO: 현금 */
             , 0 AS CARD_STLM /* TODO: 카드 */
             , 0 AS ELC_STLM /* TODO: 전자결제 */
             , 0 AS CRCDCO_CD /* TODO: 카드사 */
             , T4.CST_SIGN_HS_YN /* 고객서명 */
             , T4.IST_ENVR_PHO_PH_CN /* 사진 */
             , CASE WHEN T4.ACPN_PRTNR_NO IS NOT NULL
                    THEN T4.ACPN_PRTNR_NO || (SELECT ' (' || PRTNR_KNM || ')'
                                                FROM TB_OGBS_PRTNR_BAS
                                               WHERE PRTNR_NO = T4.ACPN_PRTNR_NO
                                                 AND OG_TP_CD = T4.ACPN_PRTNR_OG_TP_CD)
               ELSE ''
                END AS ACPN_PRTNR /* 동행작업자(동행자명) */
             , T5.PSTN_NM /* 동행작업자(직급구분) */
             , (SELECT CASE WHEN O1.PRTNR_CLSF_CD = '1' THEN '정규직'
                            WHEN O1.PRTNR_CLSF_CD = '2' AND O2.PSTN_DV_CD = '86' THEN '직무사원(1급)'
                            WHEN O1.PRTNR_CLSF_CD = '2' AND O2.PSTN_DV_CD = '87' THEN '직무사원(2급)'
                            WHEN O1.PRTNR_CLSF_CD = '2' AND O2.PSTN_DV_CD = '88' THEN '직무사원(3급)'
                            WHEN O1.PRTNR_CLSF_CD = '6' THEN '계약직'
                            WHEN O1.PRTNR_CLSF_CD = '7' THEN '개인사업'
                            ELSE ''
                        END AS CMPA_AW_DV /* 동행자 수당구분 */
                  FROM TB_OGBS_PRTNR_BAS O1 /* 파트너기본 */
                 INNER JOIN TB_OGBS_PRTNR_DTL O2 /* 파트너상세 */
                    ON O2.OG_TP_CD = O1.OG_TP_CD
                   AND O2.PRTNR_NO = O1.PRTNR_NO
                 WHERE O1.PRTNR_NO = T4.ACPN_PRTNR_NO AND O1.OG_TP_CD = T4.ACPN_PRTNR_OG_TP_CD) AS CMPA_SITE_AW_ATC_NM /* 현장수당(항목명) - 동행자 */
             , (CASE WHEN T4.ACPN_PRTNR_NO IS NOT NULL THEN F_CMZ_CD_NM(#{session.tenantId}, 'SITE_AW_ATC_CD', T1.SITE_AW_ATC_CD) ELSE '' END) AS CMPA_SITE_AW_AMT /* 현장수당(금액) - 동행자 */
          FROM TB_SVPD_CST_SVAS_IST_ASN_IZ T1 /* 고객서비스AS설치배정내역 */
         INNER JOIN TB_SVPD_CST_SVAS_IST_OJ_IZ T2 /* 고객서비스AS설치대상내역 */
            ON T2.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T2.DTA_DL_YN = 'N'
         INNER JOIN TB_SVPD_CST_SV_EXCN_IZ T3 /* 고객서비스수행내역 */
            ON T3.CNTR_NO = T1.CNTR_NO
           AND T3.CNTR_SN = T1.CNTR_SN
           AND T3.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SVPD_CST_SV_WK_RS_IZ T4 /* 고객서비스작업결과내역 */
            ON T4.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T4.SV_BIZ_HCLSF_CD IN ('1', '3', '4')
           AND T4.URGT_YN = 'N'
           AND T4.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SVPD_QLTY_MNGT_AS_DTL_IZ T5 /* 품질관리AS상세내역 */
            ON T5.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T5.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_BAS C1 /* 계약기본 */
            ON C1.CNTR_NO = T1.CNTR_NO
           AND C1.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_DTL C2 /* 계약상세 */
            ON C2.CNTR_NO = T1.CNTR_NO
           AND C2.CNTR_SN = T1.CNTR_SN
           AND C2.DTA_DL_YN = 'N'
         INNER JOIN TB_SSCT_CNTR_ADRPC_BAS C3 /* 계약주소지기본 */
            ON C3.CNTR_NO = T1.CNTR_NO
           AND C3.CNTR_CST_NO = T1.CNTR_CST_NO
           AND C3.DTA_DL_YN = 'N'
         INNER JOIN TB_GBCO_ADR_BAS C4 /* 주소기본 */
            ON C4.ADR_ID = C3.ADR_ID
           AND C4.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_OGBS_PRTNR_BAS O1 /* 파트너기본 */
            ON O1.OG_TP_CD = C1.SELL_OG_TP_CD
           AND O1.PRTNR_NO = C1.SELL_PRTNR_NO
           AND O1.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_OGBS_PRTNR_INF_CH_HIST O2 /* 파트너정보변경이력 */
            ON O2.OG_TP_CD = C1.SELL_OG_TP_CD
           AND O2.PRTNR_NO = C1.SELL_PRTNR_NO
           AND O2.HIST_STRT_DTM <![CDATA[ < ]]> TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
           AND O2.DTA_DL_YN = 'N'
          LEFT OUTER JOIN (SELECT V6.CNTR_NO, V6.CNTR_SN, V6.CSTMW_FILT_PD_CD, V6.DTA_DL_YN
                             FROM TB_SVPD_BFSVC_NX_VST_PROM_IZ V6
                            WHERE V6.SAVE_SN = (SELECT MAX(SAVE_SN)
                                                  FROM TB_SVPD_BFSVC_NX_VST_PROM_IZ
                                                 WHERE CNTR_NO = V6.CNTR_NO AND CNTR_SN = V6.CNTR_SN)
             ) T6 /* BS차기방문약속내역 */
            ON T6.CNTR_NO = T1.CNTR_NO
           AND T6.CNTR_SN = T1.CNTR_SN
           AND T6.DTA_DL_YN = 'N'
          LEFT OUTER JOIN (SELECT V1.WK_GRP_CD, V1.RGLVL_GD_CD, V1.AW_AMT, V1.DTA_DL_YN, V1.APY_STRTDT, V1.APY_ENDDT
                             FROM TB_SVPD_RGLVL_GD_AW_WTCF_IZ V1
                            WHERE V1.GD_SN = (SELECT MAX(GD_SN)
                                                FROM TB_SVPD_RGLVL_GD_AW_WTCF_IZ
                                               WHERE WK_GRP_CD = V1.WK_GRP_CD
                                                 AND RGLVL_GD_CD = V1.RGLVL_GD_CD)
                              AND TO_CHAR(SYSDATE, 'YYYYMMDD') BETWEEN V1.APY_STRTDT AND V1.APY_ENDDT
             ) A1 /* 급지등급수당가중치내역 */
            ON A1.WK_GRP_CD = T1.WK_GRP_CD
           AND A1.RGLVL_GD_CD = T1.RGLVL_GD_CD
           AND A1.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SVPD_CST_SV_FGPT_DSB_IZ T7 /* 고객사은품지급내역 */
            ON T7.CST_SV_ASN_NO = T1.CST_SV_ASN_NO
           AND T7.DTA_DL_YN = 'N'
          LEFT OUTER JOIN TB_SSCT_CNTR_WELLS_DTL C5 /* 계약WELLS상세 */
            ON C5.CNTR_NO = T1.CNTR_NO
           AND C5.CNTR_SN = T1.CNTR_SN
           AND C5.DTA_DL_YN = 'N'
          LEFT OUTER JOIN (<include refid="com.kyowon.sms.wells.web.service.common.BASE.selectPartMaster"/>) P1
            ON P1.SVPD_PD_CD = T2.PD_CD
         WHERE 1 = 1
           /* T1.CNTR_CST_NO IS NOT NULL */
           AND T2.MTR_STAT_CD IN ('1', '2')
       <choose>
           <when test='@MybatisUtils@equals(serviceType, "9")'>
           /* 서비스유형 : 홈쇼핑만 */
           AND T2.SV_BIZ_HCLSF_CD = '1'
           AND T3.ALNC_BZS_CD = '03'
           </when>
           <when test='@MybatisUtils@equals(serviceType, "10")'>
           /* 서비스유형 : 리콜 */
           AND T2.SV_BIZ_HCLSF_CD = '3'
           AND ((T2.CNSL_TP_HCLSF_CD = 'L001' AND T2.CNSL_TP_MCLSF_CD = 'N005' AND T2.CNSL_TP_LCLSF_CD = 'C015')
            OR (T2.CNSL_TP_HCLSF_CD = 'L001' AND T2.CNSL_TP_MCLSF_CD = 'N003' AND T2.CNSL_TP_LCLSF_CD = 'C008'))
           </when>
           <when test='@MybatisUtils@isNotEmpty(serviceType)'>
           AND T2.SV_BIZ_HCLSF_CD = #{serviceType}
           </when>
       </choose>
       <if test='@MybatisUtils@isNotEmpty(serviceCenter)'>
           AND T1.SV_CNR_OG_ID = #{serviceCenter} /* 서비스센터 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(engineer)'>
           AND T1.ICHR_PRTNR_NO = #{engineer} /* 엔지니어 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(refriType)'>
           AND T4.REFRI_DV_CD = CASE WHEN #{refriType} IN ('2', '3', '4') THEN '2' ELSE '1' END /* 유/무상구분 */
       </if>
       <if test='@MybatisUtils@equals(refriType, "3")'>
           AND P1.SVPD_ITEM_CD NOT IN ('49060', '49070', '49080', '49090', '49100', '49190', '49200') /* 유상(아웃소싱제외) */
       </if>
       <if test='@MybatisUtils@equals(refriType, "4")'>
           AND P1.SVPD_ITEM_CD IN ('49060', '49070', '49080', '49090', '49100', '49190', '49200') /* 유상(아웃소싱) */
       </if>
       <if test='@MybatisUtils@isNotEmpty(pdGrpCd)'>
           AND T1.SITE_AW_PD_GRP_CD = #{pdGrpCd} /* 상품그룹 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(pdCd)'>
           AND T5.PD_CD = #{pdCd} /* 상품코드 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(svBizDclsfCd)'>
           AND T2.SV_BIZ_DCLSF_CD = #{svBizDclsfCd} /* 업무유형 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(wkPrgsStatCd)'>
           AND T1.WK_PRGS_STAT_CD = #{wkPrgsStatCd} /* 작업상태 */
       </if>
       <if test='@MybatisUtils@isNotEmpty(inquiryBase) and @MybatisUtils@isNotEmpty(baseDateFrom) and @MybatisUtils@isNotEmpty(baseDateTo)'>
           <choose>
                <when test='@MybatisUtils@equals(inquiryBase, "1")'>
           AND T2.RCPDT BETWEEN #{baseDateFrom} AND #{baseDateTo} /* 조회기준 : 접수일자 */
                </when>
                <when test='@MybatisUtils@equals(inquiryBase, "2")'>
           AND T1.WK_EXCN_DT BETWEEN #{baseDateFrom} AND #{baseDateTo} /* 조회기준 : 처리일자 */
                </when>
                <when test='@MybatisUtils@equals(inquiryBase, "3")'>
           AND T1.VST_CNFMDT BETWEEN #{baseDateFrom} AND #{baseDateTo} /* 조회기준 : 방문확정일 */
                </when>
                <when test='@MybatisUtils@equals(inquiryBase, "4")'>
           AND T1.VST_DUEDT BETWEEN #{baseDateFrom} AND #{baseDateTo} /* 조회기준 : 예정일자 */
                </when>
           </choose>
       </if>
       <if test='@MybatisUtils@equals(installBase, "1")'>
           AND T5.IST_DT <![CDATA[ >= ]]> TO_CHAR(ADD_MONTHS(TO_DATE(T2.RCPDT), -12), 'YYYYMMDD') /* 설치1년이내 */
       </if>
         ORDER BY T1.CNTR_NO
    </select>

</mapper>
