<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.visit.mapper.WsnbBsOgProcsListMapper">

    <select id="selectBsOgProcsList" resultType="com.kyowon.sms.wells.web.service.visit.dvo.WsnbBsOgProcsListDvo">
    WITH OG_TEMP1 AS (
                        SELECT T1.OG_ID
                             , T1.OG_NM
                             , T1.OG_CD
                             , T1.DGR1_LEVL_OG_ID
                             , T2.PRTNR_NO
                             , T1.OG_TP_CD
                             , T1.DGR1_LEVL_OG_NM
                          FROM TB_OGBS_MM_OG_IZ T1
                             , TB_OGBS_MM_PRTNR_IZ T2
                         WHERE 1=1
                           AND T1.BASE_YM = #{baseYm}
                           AND T2.BASE_YM = #{baseYm}
                           AND T1.OG_ID = T2.OG_ID
                           <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                           AND T1.OG_TP_CD IN ('W03', 'W06')
                           AND T2.OG_TP_CD IN ('W03', 'W06')
                           </if>
                           <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                           AND T1.OG_TP_CD IN ('W02', 'ALC')
                           AND T2.OG_TP_CD IN ('W02', 'ALC')
                           </if>
                           <if test="@MybatisUtils@isNotEmpty(ogId)">
                               <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                               AND T1.OG_ID = #{ogId}
                               </if>
                               <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                               AND T1.DGR1_LEVL_OG_ID = #{ogId}
                               </if>
                           </if>
                           AND T1.CLO_DT IS NULL
                           AND T1.DTA_DL_YN = 'N'
                       )
    SELECT ogNm
         , pdGrpNm gb
         , asgnCrdovrYCnt
         , asgnCrdovrNCnt
         , asgnTotalCnt
         , compCrdovrYCnt
         , compCrdovrNCnt
         , compTotalCnt
         , compRate||'%' compRate
         , comp01, comp02, comp03, comp04, comp05, comp06, comp07, comp08, comp09, comp10
         , comp11, comp12, comp13, comp14, comp15, comp16, comp17, comp18, comp19, comp20
         , comp21, comp22, comp23, comp24, comp25, comp26, comp27, comp28, comp29, comp30, comp31
      FROM (
            SELECT (CASE WHEN OG_NM IS NULL THEN '합계'
                         ELSE OG_NM
                     END) ogNm
                 , (CASE WHEN PD_GRP_NM IS NULL AND OG_NM IS NOT NULL THEN '총'
                         WHEN OG_NM IS NULL THEN ''
                         ELSE PD_GRP_NM
                     END) pdGrpNm
                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'Y' THEN 1 ELSE 0 END) asgnCrdovrYCnt
                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'N' OR LSTMM_CRDOVR_YN IS NULL THEN 1 ELSE 0 END) asgnCrdovrNCnt
                 , SUM(1) asgnTotalCnt

                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'Y' AND VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compCrdovrYCnt
                 , SUM(CASE WHEN (LSTMM_CRDOVR_YN = 'N' OR LSTMM_CRDOVR_YN IS NULL) AND VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compCrdovrNCnt
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compTotalCnt
                 , ROUND(SUM(CASE WHEN VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) / SUM(1)*100, 2) compRate

                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '01' THEN 1 ELSE 0 END) comp01
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '02' THEN 1 ELSE 0 END) comp02
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '03' THEN 1 ELSE 0 END) comp03
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '04' THEN 1 ELSE 0 END) comp04
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '05' THEN 1 ELSE 0 END) comp05
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '06' THEN 1 ELSE 0 END) comp06
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '07' THEN 1 ELSE 0 END) comp07
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '08' THEN 1 ELSE 0 END) comp08
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '09' THEN 1 ELSE 0 END) comp09
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '10' THEN 1 ELSE 0 END) comp10
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '11' THEN 1 ELSE 0 END) comp11
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '12' THEN 1 ELSE 0 END) comp12
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '13' THEN 1 ELSE 0 END) comp13
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '14' THEN 1 ELSE 0 END) comp14
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '15' THEN 1 ELSE 0 END) comp15
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '16' THEN 1 ELSE 0 END) comp16
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '17' THEN 1 ELSE 0 END) comp17
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '18' THEN 1 ELSE 0 END) comp18
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '19' THEN 1 ELSE 0 END) comp19
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '20' THEN 1 ELSE 0 END) comp20
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '21' THEN 1 ELSE 0 END) comp21
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '22' THEN 1 ELSE 0 END) comp22
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '23' THEN 1 ELSE 0 END) comp23
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '24' THEN 1 ELSE 0 END) comp24
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '25' THEN 1 ELSE 0 END) comp25
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '26' THEN 1 ELSE 0 END) comp26
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '27' THEN 1 ELSE 0 END) comp27
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '28' THEN 1 ELSE 0 END) comp28
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '29' THEN 1 ELSE 0 END) comp29
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '30' THEN 1 ELSE 0 END) comp30
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '31' THEN 1 ELSE 0 END) comp31
                 , OG_ID
              FROM (
                    SELECT <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                           (CASE WHEN PD2.PD_PRP_VAL20 = '11' THEN '모종'
                                 ELSE '일반'
                             END) PD_GRP_NM
                           </if>
                           <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                           (CASE WHEN CNTR1.COPN_DV_CD = '2' THEN '법인'
                                 ELSE '개인'
                             END) PD_GRP_NM
                           </if>
                         , SV1.LSTMM_CRDOVR_YN
                         , SV1.VST_PRGS_STAT_CD
                         , SUBSTR(SV1.WK_EXCN_DT, 1, 6) WK_EXCN_DT
                         , SUBSTR(SV1.WK_EXCN_DT, 7) WK_EXCN_DD
                         , SUBSTR(SV2.VST_DUEDT, 1, 6) VST_DUEDT
                         , CASE WHEN OG1.OG_TP_CD IN ('W03', 'W06') THEN OG1.OG_NM
                                WHEN OG1.OG_TP_CD IN ('W02', 'ALC') THEN OG1.DGR1_LEVL_OG_NM
                            END OG_NM
                         , CASE WHEN OG1.OG_TP_CD IN ('W03', 'W06') THEN OG1.OG_ID
                                WHEN OG1.OG_TP_CD IN ('W02', 'ALC') THEN OG1.DGR1_LEVL_OG_ID
                            END OG_ID
                      FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ SV1
                         , TB_SVPD_CST_SV_BFSVC_OJ_IZ SV2
                         , TB_PDBS_PD_BAS PD1
                         , TB_PDBS_PD_ECOM_PRP_DTL PD2
                         , OG_TEMP1 OG1
                         , TB_SSCT_CNTR_BAS CNTR1
                     WHERE 1=1
                       AND SV2.ASN_OJ_YM = #{baseYm}
                       AND SV1.ASN_OJ_YM = #{baseYm}
                       AND SV1.CST_SV_ASN_NO = SV2.CST_SV_ASN_NO
                       AND SV2.PDCT_PD_CD = PD1.PD_CD

                       AND PD1.PD_CD = PD2.PD_CD
                       AND PD2.PD_EXTS_PRP_GRP_CD = 'PART'
                       AND SV1.CNTR_NO = CNTR1.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(pdGrpCd)">
                       AND PD2.PD_PRP_VAL20 = #{pdGrpCd}
                       </if>
                       AND SV1.CNFM_PSIC_PRTNR_NO = OG1.PRTNR_NO
                    )
             GROUP
                BY ROLLUP(OG_ID, OG_NM, PD_GRP_NM)
             UNION ALL

            SELECT (CASE WHEN OG_NM IS NULL THEN '합계'
                         ELSE OG_NM
                     END) ogNm
                 , (CASE WHEN PD_GRP_NM IS NULL AND OG_NM IS NOT NULL THEN '총'
                         WHEN OG_NM IS NULL THEN ''
                         ELSE PD_GRP_NM
                     END) pdGrpNm
                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'Y' THEN 1 ELSE 0 END) asgnCrdovrYCnt
                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'N' OR LSTMM_CRDOVR_YN IS NULL THEN 1 ELSE 0 END) asgnCrdovrNCnt
                 , SUM(1) asgnTotalCnt

                 , SUM(CASE WHEN LSTMM_CRDOVR_YN = 'Y' AND VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compCrdovrYCnt
                 , SUM(CASE WHEN (LSTMM_CRDOVR_YN = 'N' OR LSTMM_CRDOVR_YN IS NULL) AND VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compCrdovrNCnt
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) compTotalCnt
                 , ROUND(SUM(CASE WHEN VST_PRGS_STAT_CD = '20' THEN 1 ELSE 0 END) / SUM(1)*100, 2) compRate

                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '01' THEN 1 ELSE 0 END) comp01
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '02' THEN 1 ELSE 0 END) comp02
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '03' THEN 1 ELSE 0 END) comp03
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '04' THEN 1 ELSE 0 END) comp04
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '05' THEN 1 ELSE 0 END) comp05
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '06' THEN 1 ELSE 0 END) comp06
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '07' THEN 1 ELSE 0 END) comp07
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '08' THEN 1 ELSE 0 END) comp08
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '09' THEN 1 ELSE 0 END) comp09
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '10' THEN 1 ELSE 0 END) comp10
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '11' THEN 1 ELSE 0 END) comp11
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '12' THEN 1 ELSE 0 END) comp12
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '13' THEN 1 ELSE 0 END) comp13
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '14' THEN 1 ELSE 0 END) comp14
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '15' THEN 1 ELSE 0 END) comp15
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '16' THEN 1 ELSE 0 END) comp16
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '17' THEN 1 ELSE 0 END) comp17
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '18' THEN 1 ELSE 0 END) comp18
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '19' THEN 1 ELSE 0 END) comp19
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '20' THEN 1 ELSE 0 END) comp20
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '21' THEN 1 ELSE 0 END) comp21
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '22' THEN 1 ELSE 0 END) comp22
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '23' THEN 1 ELSE 0 END) comp23
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '24' THEN 1 ELSE 0 END) comp24
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '25' THEN 1 ELSE 0 END) comp25
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '26' THEN 1 ELSE 0 END) comp26
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '27' THEN 1 ELSE 0 END) comp27
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '28' THEN 1 ELSE 0 END) comp28
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '29' THEN 1 ELSE 0 END) comp29
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '30' THEN 1 ELSE 0 END) comp30
                 , SUM(CASE WHEN VST_PRGS_STAT_CD = '20' AND WK_EXCN_DD = '31' THEN 1 ELSE 0 END) comp31
                 , OG_ID
              FROM (
                    SELECT <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                           (CASE WHEN PD2.PD_PRP_VAL20 = '11' THEN '모종'
                                 ELSE '일반'
                             END) PD_GRP_NM
                           </if>
                           <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                           (CASE WHEN CNTR1.COPN_DV_CD = '2' THEN '법인'
                                 ELSE '개인'
                             END) PD_GRP_NM
                           </if>
                         , SV1.LSTMM_CRDOVR_YN
                         , SV1.VST_PRGS_STAT_CD
                         , SUBSTR(SV1.WK_EXCN_DT, 1, 6) WK_EXCN_DT
                         , SUBSTR(SV1.WK_EXCN_DT, 7) WK_EXCN_DD
                         , SUBSTR(SV2.VST_DUEDT, 1, 6) VST_DUEDT
                         , '합계' OG_NM
                         , 'OGO999999999999' OG_ID
                      FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ SV1
                         , TB_SVPD_CST_SV_BFSVC_OJ_IZ SV2
                         , TB_PDBS_PD_BAS PD1
                         , TB_PDBS_PD_ECOM_PRP_DTL PD2
                         , OG_TEMP1 OG1
                         , TB_SSCT_CNTR_BAS CNTR1
                     WHERE 1=1
                       AND SV2.ASN_OJ_YM = #{baseYm}
                       AND SV1.ASN_OJ_YM = #{baseYm}
                       AND SV1.CST_SV_ASN_NO = SV2.CST_SV_ASN_NO
                       AND SV2.PDCT_PD_CD = PD1.PD_CD

                       AND PD1.PD_CD = PD2.PD_CD
                       AND PD2.PD_EXTS_PRP_GRP_CD = 'PART'
                       AND SV1.CNFM_PSIC_PRTNR_NO = OG1.PRTNR_NO
                       AND PD2.PD_PRP_VAL20 != '92'
                       AND SV1.CNTR_NO = CNTR1.CNTR_NO
                       <if test="@MybatisUtils@isNotEmpty(pdGrpCd)">
                       AND PD2.PD_PRP_VAL20 = #{pdGrpCd}
                       </if>
                       AND SV1.SV_BIZ_DCLSF_CD NOT IN ('2177', '2181')
                    )
             GROUP
                BY ROLLUP(OG_ID, OG_NM, PD_GRP_NM)
            )
     WHERE pdGrpNm IS NOT NULL
     ORDER
        BY OG_ID, pdGrpNm
    </select>

    <select id="selectCrdOvrList" resultType="com.kyowon.sms.wells.web.service.visit.dvo.WsnbBsOgProcsListDvo">
    WITH OG_TEMP1 AS (
                        SELECT T1.OG_ID
                             , T1.OG_NM
                             , T1.OG_CD
                             , T1.DGR1_LEVL_OG_ID
                             , T2.PRTNR_NO
                             , T1.OG_TP_CD
                             , T1.DGR1_LEVL_OG_NM
                          FROM TB_OGBS_MM_OG_IZ T1
                             , TB_OGBS_MM_PRTNR_IZ T2
                         WHERE 1=1
                           AND T1.BASE_YM = #{baseYm}
                           AND T2.BASE_YM = #{baseYm}
                           AND T1.OG_ID = T2.OG_ID
                           <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                           AND T1.OG_TP_CD IN ('W03', 'W06')
                           AND T2.OG_TP_CD IN ('W03', 'W06')
                           </if>
                           <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                           AND T1.OG_TP_CD IN ('W02', 'ALC')
                           AND T2.OG_TP_CD IN ('W02', 'ALC')
                           </if>
                           <if test="@MybatisUtils@isNotEmpty(ogId)">
                               <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                               AND T1.OG_ID = #{ogId}
                               </if>
                               <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                               AND T1.DGR1_LEVL_OG_ID = #{ogId}
                               </if>
                           </if>
                           AND T1.CLO_DT IS NULL
                           AND T1.DTA_DL_YN = 'N'
                       )

    SELECT OG_NM ogNm
         , PD_GRP_NM gb
         , (CASE WHEN VST_PRGS_STAT_CD = '00' THEN '배정'
                 WHEN VST_PRGS_STAT_CD = '20' THEN '처리'
             END) vstPrgsStat
         , SUM(CASE WHEN BETWEEN_MONTH = 1 THEN 1 ELSE 0 END) crdovr01
         , SUM(CASE WHEN BETWEEN_MONTH = 2 THEN 1 ELSE 0 END) crdovr02
         , SUM(CASE WHEN BETWEEN_MONTH = 3 THEN 1 ELSE 0 END) crdovr03
         , SUM(CASE WHEN BETWEEN_MONTH = 4 THEN 1 ELSE 0 END) crdovr04
         , SUM(CASE WHEN BETWEEN_MONTH = 5 THEN 1 ELSE 0 END) crdovr05
         , SUM(CASE WHEN BETWEEN_MONTH = 6 THEN 1 ELSE 0 END) crdovr06
         , SUM(CASE WHEN BETWEEN_MONTH = 7 THEN 1 ELSE 0 END) crdovr07
         , SUM(CASE WHEN BETWEEN_MONTH = 8 THEN 1 ELSE 0 END) crdovr08
         , SUM(CASE WHEN BETWEEN_MONTH = 9 THEN 1 ELSE 0 END) crdovr09
         , SUM(CASE WHEN BETWEEN_MONTH = 10 THEN 1 ELSE 0 END) crdovr10
         , SUM(CASE WHEN BETWEEN_MONTH = 11 THEN 1 ELSE 0 END) crdovr11
         , SUM(CASE WHEN BETWEEN_MONTH = 12 THEN 1 ELSE 0 END) crdovr12
         , SUM(CASE WHEN BETWEEN_MONTH >= 13 THEN 1 ELSE 0 END) crdovr13
         , SUM(CASE WHEN BETWEEN_MONTH >= 1 THEN 1 ELSE 0 END) crdovrTotal
      FROM (
            SELECT <if test="@MybatisUtils@equals(mngrDvCd, '2')">
                   (CASE WHEN PD2.PD_PRP_VAL20 = '11' THEN '모종'
                         ELSE '일반'
                     END) PD_GRP_NM
                   </if>
                   <if test="@MybatisUtils@equals(mngrDvCd, '1')">
                   (CASE WHEN CNTR1.COPN_DV_CD = '2' THEN '법인'
                         ELSE '개인'
                     END) PD_GRP_NM
                   </if>
                 , SV1.LSTMM_CRDOVR_YN
                 , CASE WHEN SV1.VST_PRGS_STAT_CD = '20' THEN SV1.VST_PRGS_STAT_CD
                        ELSE '00'
                    END VST_PRGS_STAT_CD
                 , SUBSTR(SV1.WK_EXCN_DT, 1, 6) WK_EXCN_DT
                 , SUBSTR(SV2.VST_DUEDT, 1, 6) VST_DUEDT
                 , CASE WHEN OG1.OG_TP_CD IN ('W03', 'W06') THEN OG1.OG_NM
                        WHEN OG1.OG_TP_CD IN ('W02', 'ALC') THEN OG1.DGR1_LEVL_OG_NM
                    END OG_NM
                 , (CASE WHEN SV1.VST_PRGS_STAT_CD = '20' THEN MONTHS_BETWEEN(TO_DATE(SUBSTR(SV1.WK_EXCN_DT, 1, 6), 'YYYYMM'), TO_DATE(SUBSTR(SV2.VST_DUEDT, 1, 6), 'YYYYMM'))
                         ELSE MONTHS_BETWEEN(TO_DATE(SV1.ASN_OJ_YM, 'YYYYMM'), TO_DATE(SUBSTR(SV2.VST_DUEDT, 1, 6), 'YYYYMM'))
                     END) BETWEEN_MONTH
                 , CASE WHEN OG1.OG_TP_CD IN ('W03', 'W06') THEN OG1.OG_ID
                        WHEN OG1.OG_TP_CD IN ('W02', 'ALC') THEN OG1.DGR1_LEVL_OG_ID
                    END OG_ID
              FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ SV1
                 , TB_SVPD_CST_SV_BFSVC_OJ_IZ SV2
                 , TB_PDBS_PD_BAS PD1
                 , TB_PDBS_PD_ECOM_PRP_DTL PD2
                 , OG_TEMP1 OG1
                 , TB_SSCT_CNTR_BAS CNTR1
             WHERE 1=1
               AND SV2.ASN_OJ_YM = #{baseYm}
               AND SV1.ASN_OJ_YM = #{baseYm}
               AND SV1.CST_SV_ASN_NO = SV2.CST_SV_ASN_NO
               AND SV2.PDCT_PD_CD = PD1.PD_CD

               AND PD1.PD_CD = PD2.PD_CD
               AND PD2.PD_EXTS_PRP_GRP_CD = 'PART'
               AND SV1.CNTR_NO = CNTR1.CNTR_NO
               <if test="@MybatisUtils@isNotEmpty(pdGrpCd)">
               AND PD2.PD_PRP_VAL20 = #{pdGrpCd}
               </if>
               AND SV1.CNFM_PSIC_PRTNR_NO = OG1.PRTNR_NO
               AND SV1.LSTMM_CRDOVR_YN = 'Y'
            )
     GROUP
        BY OG_ID, OG_NM, PD_GRP_NM, VST_PRGS_STAT_CD
     ORDER
        BY OG_ID, PD_GRP_NM, VST_PRGS_STAT_CD
    </select>
</mapper>
