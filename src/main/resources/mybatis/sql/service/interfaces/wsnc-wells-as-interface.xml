<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.interfaces.mapper.WsncWellsAsInterfaceMapper">

    <!-- W-SV-I-0021 > LC_ASREGN_API_S13 -->
    <select id='selectCustomerInformations' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsInterfaceCustInfoDvo">
        SELECT DISTINCT
           SSCT1.CNTR_NO -- 계약번호
         , CUBS1.CST_NO -- 고객번호
         , CUBS1.CST_KNM -- 고객한글명
         , SSCT1.CNTR_CNFM_DTM AS CNTR_DT -- 계약일자
         , PDBS1.PD_CD -- 상품코드
         , PDBS1.PD_NM -- 상품명
         , SSCT3.CRAL_LOCARA_TNO -- 휴대지역전화번호
         , SSCT3.MEXNO_ENCR -- 휴대전화국번호암호화
         , SSCT3.CRAL_IDV_TNO -- 휴대개별전화번호
         , SSCT3.LOCARA_TNO -- 지역전화번호
         , SSCT3.EXNO_ENCR -- 전화국번호암호화
         , SSCT3.IDV_TNO -- 개별전화번호
         , GBCO1.NEW_ADR_ZIP -- 신주소우편번호
         , GBCO1.RNADR -- 도로명주소
         , GBCO1.RDADR -- 도로명상세주소
         , SSCT3.ADR_DV_CD -- 주소구분코드
         , GBCO1.LTN_ADR AS ADDR
         , SSCT3.RCGVP_KNM -- 수령자한글명
         , CUBS1.BRYY_MMDD -- 생년월일
         , CUBS1.SEX_DV_CD -- 성별구분코드
         , SSCT1.CNTR_CST_NO-- 계약고객번호
      FROM TB_SSCT_CNTR_BAS SSCT1 /*계약기본*/
     INNER JOIN TB_SSCT_CNTR_DTL SSCT2 /*계약상세*/
        ON SSCT1.CNTR_NO = SSCT2.CNTR_NO
      LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS SSCT3 /*계약주소지기본*/
        ON SSCT3.CNTR_NO = SSCT1.CNTR_NO
       AND SSCT3.CNTR_CST_NO = SSCT1.CNTR_CST_NO
      LEFT OUTER JOIN TB_CUBS_CST_BAS CUBS1 /*고객기본*/
        ON CUBS1.CST_NO = SSCT1.CNTR_CST_NO
      LEFT OUTER JOIN TB_PDBS_PD_BAS PDBS1 /*상품기본*/
        ON PDBS1.PD_CD = SSCT2.BASE_PD_CD
      LEFT OUTER JOIN TB_PDBS_PD_REL PDBS2 /*상품관계*/
        ON PDBS2.BASE_PD_CD = SSCT2.BASE_PD_CD
      LEFT OUTER JOIN TB_GBCO_ADR_BAS GBCO1/*주소기본*/
        ON CUBS1.ADR_ID = GBCO1.ADR_ID
     WHERE SSCT1.DTA_DL_YN = 'N'
       <if test="@MybatisUtils@isNotEmpty(cntrNo)">
       AND SSCT1.CNTR_NO = #{cntrNo}
       </if>
       <if test="@MybatisUtils@isNotEmpty(cntrSn)">
       AND SSCT2.CNTR_SN = #{cntrSn}
       </if>
       <if test="@MybatisUtils@isNotEmpty(cntrCstNo)">
       AND SSCT1.CNTR_CST_NO = #{cntrCstNo}
       </if>
       <if test="@MybatisUtils@isNotEmpty(cstKnm)">
       AND CUBS1.CST_KNM = #{cstKnm}
       </if>
       <if test="@MybatisUtils@isNotEmpty(cralLocaraTno)">
       AND CUBS1.CRAL_LOCARA_TNO = #{cralLocaraTno}
       </if>
       <if test="@MybatisUtils@isNotEmpty(mexnoEncr)">
       AND CUBS1.MEXNO_ENCR = #{mexnoEncr}
       </if>
       <if test="@MybatisUtils@isNotEmpty(cralIdvTno)">
       AND CUBS1.CRAL_IDV_TNO = #{cralIdvTno}
       </if>
       <if test="@MybatisUtils@isNotEmpty(pdGrpId)">
       AND PDBS2.PD_GRP_ID = #{pdGrpId}
       </if>
       <if test="@MybatisUtils@isNotEmpty(adrId)">
       AND CUBS1.ADR_ID = #{adrId}
       </if>
    </select>

    <!--W-SV-I-0022 > LC_ASREGN_API_S14 -->
    <select id='selectReceiptInformations' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsInterfaceRecInfoDvo">
    SELECT AS_IST_OJ_NO
         , CNSL_MO_CN
         , SV_BIZ_DCLSF_CD
         , SV_BIZ_DCLSF_NM
         , SV_BIZ_HCLSF_CD
         , EGER_ASN_DT
         , CST_SV_ASN_NO
         , CNCL_YN
         , WK_ACPTE_STAT_CD
         , WK_ACPTE_DT
         , VST_DUEDT
         , WK_PRGS_STAT_CD
         , WK_EXCN_DT
         , WK_EXCN_HH
         , WK_PRTNR_NO
         , ICHR_PRTNR_NO
         , PRTNR_KNM
         , OG_NM
         , RECD_DT
         , TEL_CO
         , HP_NO1
         , HP_NO2
         , TEL_AR
         , TEL_NO1
         , TEL_NO2
         , ZIP_NO1
         , ZIP_NO2
         , RNADR
         , RDADR
         , ADD_REFER
         , ADD_GB
    FROM (SELECT AS_IST_OJ_NO /*AC211_IN_GB	입력구분, AC211_WRK_GB	작업구분, AC211_WRK_DT	작업일자, AC211_SEQ	작업번호 -> 입력구분코드(1)+작업구분(1)+접수일자(8)+LPAD(작업번호,8,''0'')*/
               , CNSL_MO_CN
               , T1.SV_BIZ_DCLSF_CD
               , (SELECT CD_CNTN FROM T_CMZ_CD_D WHERE TENANT_ID = 'TNT_WELLS' AND CD_ID = 'SV_BIZ_DCLSF_CD' AND CD_VLD_VAL = T1.SV_BIZ_DCLSF_CD) AS SV_BIZ_DCLSF_NM
               , T7.SV_BIZ_HCLSF_CD /*자료구분(접수관리)*/
               , T7.EGER_ASN_DT /*배정일자(접수관리)*/
               , T7.CST_SV_ASN_NO/*배정순번(접수관리)*/
               , T1.CNTR_NO
               , (CASE WHEN WK_PRGS_STAT_CD = '00' AND NVL(WK_ACPTE_STAT_CD, 'N') = 'N' THEN 'Y' ELSE 'N' END) AS CNCL_YN
               , NVL(WK_ACPTE_STAT_CD, 'N') AS WK_ACPTE_STAT_CD /*작업수락상태(수락 'Y', 그외 '')*/
               , WK_ACPTE_DT /*작업수락일자 : 배송상품 수신 일시*/
               , VST_DUEDT /*방문예정일자*/
               , WK_PRGS_STAT_CD /*작업진행상태*/
               , WK_EXCN_DT /*작업일자*/
               , WK_EXCN_HH/*작업시간*/
               , WK_PRTNR_NO /*작업처리자*/
               , ICHR_PRTNR_NO /*엔지니어(엔지니어배정)*/
               , T8.PRTNR_KNM/*엔지니어명*/
               , T8.OG_NM /*센터명*/
               , SUBSTR(RCPDT, 0, 4) || '-' || SUBSTR(RCPDT, 5, 2) || '-' || SUBSTR(RCPDT, 7, 2) AS RECD_DT
               , TRIM(T3.CRAL_LOCARA_TNO) AS TEL_CO
               , TRIM(T3.MEXNO_ENCR) AS HP_NO1
               , TRIM(T3.CRAL_IDV_TNO) AS HP_NO2
               , TRIM(T3.CRAL_LOCARA_TNO) AS TEL_AR
               , TRIM(T3.MEXNO_ENCR) AS TEL_NO1
               , TRIM(T3.CRAL_IDV_TNO) AS TEL_NO2
               , TRIM(SUBSTR(T6.NEW_ADR_ZIP, 0, 3)) AS ZIP_NO1
               , TRIM(SUBSTR(T6.NEW_ADR_ZIP, 4, 5)) AS ZIP_NO2
               , TRIM(T6.RNADR) AS RNADR
               , TRIM(T6.RDADR) AS RDADR
               , TRIM(T6.RNADR) || TRIM(T6.RDADR) AS ADD_REFER
               , '1' AS ADD_GB
            FROM TB_SVPD_CST_SVAS_IST_OJ_IZ T1 /*고객서비스AS설치대상내역(LC_ALLOCATE_AC211TB)*/
            LEFT OUTER JOIN TB_CUBS_CST_BAS T3 /*고객기본*/ ON T1.CNTR_CST_NO = T3.CST_NO
            LEFT OUTER JOIN TB_SSCT_CNTR_ADRPC_BAS T5 /*계약주소지기본*/ ON T5.DTA_DL_YN = 'N' AND T1.CNTR_NO = T5.CNTR_NO AND T1.CNTR_CST_NO = T5.CNTR_CST_NO
            LEFT OUTER JOIN TB_GBCO_ADR_BAS T6 /*주소기본*/ ON T6.DTA_DL_YN = 'N' AND T5.ADR_ID = T6.ADR_ID
            LEFT OUTER JOIN TB_SVPD_CST_SVAS_IST_ASN_IZ T7 ON T1.CNTR_NO = T7.CNTR_NO /*고객서비스AS설치배정내역*/
            LEFT OUTER JOIN TB_OGBS_PRTNR_BAS T8 /*파트너기본*/ ON T3.PRTNR_NO = T8.PRTNR_NO
           WHERE T1.SV_BIZ_HCLSF_CD = '3')
    WHERE 1 = 1
      <if test="@MybatisUtils@isNotEmpty(cntrNo)">
      AND CNTR_NO = #{cntrNo}
      </if>
    </select>

    <select id='selectUsingProducts' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsInterfaceUsingPdutDvo">
        SELECT T1.CNTR_NO
             , T1.CNTR_CST_NO
             , C2.RCGVP_KNM
             , S1.PDCT_PD_CD
             , P1.PD_ABBR_NM
             , S1.BC_NO
             , C2.CRAL_LOCARA_TNO
             , C2.MEXNO_ENCR
             , C2.CRAL_IDV_TNO
             , A1.RNADR || ' ' || A1.RDADR ADR
          FROM (
                    SELECT C1.CNTR_CST_NO
                         , C1.CNTR_NO
                         , C2.CNTR_SN
                      FROM TB_SSCT_CNTR_BAS C1
                INNER JOIN TB_SSCT_CNTR_DTL C2
                        ON C1.CNTR_NO = C2.CNTR_NO
                     WHERE 1 = 1
                       AND C1.CNTR_NO = #{cntrNo}
                     UNION ALL
                    SELECT C1.CNTR_CST_NO
                         , C2.CNTR_NO
                         , C3.CNTR_SN
                      FROM TB_SSCT_CNTR_BAS C1
                INNER JOIN TB_SSCT_CNTR_BAS C2
                        ON C1.CNTR_CST_NO = C2.CNTR_CST_NO
                       AND C2.CNTR_NO != C1.CNTR_NO
                INNER JOIN TB_SSCT_CNTR_DTL C3
                        ON C2.CNTR_NO = C3.CNTR_NO
                INNER JOIN TB_SVPD_CST_SV_EXCN_IZ S1
                        ON C3.CNTR_NO = S1.CNTR_NO
                       AND C3.CNTR_SN = S1.CNTR_SN
                     WHERE 1 = 1
                       AND C1.CNTR_NO = #{cntrNo}
                       AND C3.SELL_TP_CD IN ('2', '3') /* 렌털(2), 멤버쉽(3) */
                       AND S1.REQD_DT IS NULL
                       AND S1.IST_DT IS NOT NULL
                   ) T1
        INNER JOIN TB_SSCT_CNTR_ADR_REL C1
                ON T1.CNTR_NO = C1.DTL_CNTR_NO
               AND T1.CNTR_SN = C1.DTL_CNTR_SN
               AND C1.ADRPC_TP_CD = '3'
               AND TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') BETWEEN C1.VL_STRT_DTM AND C1.VL_END_DTM
        INNER JOIN TB_SSCT_CNTR_ADRPC_BAS C2
                ON C1.CNTR_ADRPC_ID = C2.CNTR_ADRPC_ID
        INNER JOIN TB_GBCO_ADR_BAS A1
                ON C2.ADR_ID = A1.ADR_ID
        INNER JOIN TB_SVPD_CST_SV_EXCN_IZ S1
                ON T1.CNTR_NO = S1.CNTR_NO
               AND T1.CNTR_SN = S1.CNTR_SN
        INNER JOIN TB_PDBS_PD_BAS P1
                ON S1.PDCT_PD_CD = P1.PD_CD
    </select>

    <select id='selectServiceHistorys' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsInterfaceServHistDvo">
        SELECT T1.CNTR_NO
             , T1.CNTR_SN
             , T1.CST_SV_ASN_NO
             , T1.AS_IST_OJ_NO
             , T1.WK_EXCN_DT
             , O1.PRTNR_KNM AS WK_PRTNR_KNM
             , T1.RGST_DT
             , T1.RCPDT
             , T1.RCP_HH
             , T1.PD_CD
             , NVL(P1.PD_ABBR_NM, P1.PD_NM) AS PD_NM
             , S1.SV_PROCS_CN
             , T1.CNSL_MO_CN
             , T1.SV_BIZ_HCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_HCLSF_CD', T1.SV_BIZ_HCLSF_CD) AS SV_BIZ_HCLSF_NM
             , T1.SV_BIZ_DCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_DCLSF_CD', T1.SV_BIZ_DCLSF_CD) AS SV_BIZ_DCLSF_NM
             , (SELECT X1.IST_NMN_N || '차월'
                  FROM TB_SVPD_MCBY_CST_SV_OJ_IZ X1
                 WHERE T1.CNTR_NO = X1.CNTR_NO
                   AND T1.CNTR_SN = X1.CNTR_SN
                   AND X1.MNGT_YM = SUBSTR(T1.WK_EXCN_DT, 1, 6))  AS IST_NMN_N
          FROM (
                    SELECT S1.CNTR_NO
                         , S1.CNTR_SN
                         , S1.CST_SV_ASN_NO
                         , S1.WK_EXCN_DT
                         , S1.WK_PRTNR_OG_TP_CD
                         , S1.WK_PRTNR_NO
                         , SUBSTR(S1.FST_RGST_DTM, 1, 8) AS RGST_DT
                         , S2.AS_IST_OJ_NO
                         , S2.FNL_RCPDT AS RCPDT
                         , S2.FNL_RCP_HH RCP_HH
                         , S2.PD_CD
                         , S1.SV_BIZ_HCLSF_CD
                         , S1.SV_BIZ_DCLSF_CD
                         , S2.CNSL_MO_CN
                      FROM TB_SVPD_CST_SVAS_IST_ASN_IZ S1
                INNER JOIN TB_SVPD_CST_SVAS_IST_OJ_IZ S2
                        ON S1.CST_SV_ASN_NO = S2.CST_SV_ASN_NO
                     WHERE 1 = 1
                       AND S1.WK_PRGS_STAT_CD IN ('00', '10', '20')
                       AND S2.DTA_DL_YN = 'N'
                       AND S2.SV_BIZ_HCLSF_CD = '3' /* A/S(3) */
                       AND S2.MTR_STAT_CD != '3' /* 취소(3) */
                       AND S1.CNTR_NO = #{cntrNo}
                UNION ALL
                    SELECT S1.CNTR_NO
                         , S1.CNTR_SN
                         , S1.CST_SV_ASN_NO
                         , S1.WK_EXCN_DT
                         , S1.CNFM_PSIC_PRTNR_OG_TP_CD AS WK_PRTNR_OG_TP_CD
                         , S1.CNFM_PSIC_PRTNR_NO AS WK_PRTNR_NO
                         , SUBSTR(S1.FST_RGST_DTM, 1, 8) AS RGST_DT
                         , '' AS_IST_OJ_NO
                         , S1.CNFM_PSIC_ASN_DT AS RCPDT
                         , S1.CNFM_PSIC_ASN_HH AS RCP_HH
                         , S2.PDCT_PD_CD AS PD_CD
                         , S1.SITE_AW_SV_TP_CD AS SV_BIZ_HCLSF_CD
                         , S1.SV_BIZ_DCLSF_CD
                         , '' CNSL_MO_CN
                      FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ S1
                INNER JOIN TB_SVPD_CST_SV_BFSVC_OJ_IZ S2
                        ON S1.CST_SV_ASN_NO = S2.CST_SV_ASN_NO
                     WHERE 1 = 1
                       AND S1.VST_PRGS_STAT_CD IN ('00', '10', '20')
                       AND S2.DTA_DL_YN = 'N'
                       AND S1.CNTR_NO = #{cntrNo}
                   ) T1
         LEFT JOIN TB_SVPD_CST_SV_WK_RS_IZ S1
                ON T1.CST_SV_ASN_NO = S1.CST_SV_ASN_NO
               AND S1.DTA_DL_YN = 'N'
        INNER JOIN TB_PDBS_PD_BAS P1
                ON T1.PD_CD = P1.PD_CD
        INNER JOIN TB_OGBS_MM_PRTNR_IZ O1
                ON SUBSTR(T1.WK_EXCN_DT, 1, 6) = O1.BASE_YM
               AND T1.WK_PRTNR_OG_TP_CD = O1.OG_TP_CD
               AND T1.WK_PRTNR_NO = O1.PRTNR_NO;




        /* ASIS 쿼리ID bestDeptQuery.xml (selectSrvcinfoList) */
        /* DESC : ASIS에는 MAT_NM 가져오는 로직 없음(구현 제외) */
    </select>

    <select id='selectServiceContents' resultType="com.kyowon.sms.wells.web.service.allocate.dvo.WsncAsInterfaceServContDvo">
        SELECT T1.CNTR_NO
             , T1.CNTR_SN
             , T1.CST_SV_ASN_NO
             , T1.AS_IST_OJ_NO
             , T1.WK_EXCN_DT
             , O1.PRTNR_KNM AS WK_PRTNR_KNM
             , T1.RGST_DT
             , T1.RCPDT
             , T1.RCP_HH
             , T1.PD_CD
             , NVL(P1.PD_ABBR_NM, P1.PD_NM) AS PD_NM
             , S1.SV_PROCS_CN
             , T1.CNSL_MO_CN
             , T1.SV_BIZ_HCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_HCLSF_CD', T1.SV_BIZ_HCLSF_CD) AS SV_BIZ_HCLSF_NM
             , T1.SV_BIZ_DCLSF_CD
             , F_CMZ_CD_NM('TNT_WELLS', 'SV_BIZ_DCLSF_CD', T1.SV_BIZ_DCLSF_CD) AS SV_BIZ_DCLSF_NM
          FROM (
                    SELECT S1.CNTR_NO
                         , S1.CNTR_SN
                         , S1.CST_SV_ASN_NO
                         , S1.WK_EXCN_DT
                         , S1.WK_PRTNR_OG_TP_CD
                         , S1.WK_PRTNR_NO
                         , SUBSTR(S1.FST_RGST_DTM, 1, 8) AS RGST_DT
                         , S2.AS_IST_OJ_NO
                         , S2.FNL_RCPDT AS RCPDT
                         , S2.FNL_RCP_HH RCP_HH
                         , S2.PD_CD
                         , S1.SV_BIZ_HCLSF_CD
                         , S1.SV_BIZ_DCLSF_CD
                         , S2.CNSL_MO_CN
                      FROM TB_SVPD_CST_SVAS_IST_ASN_IZ S1
                INNER JOIN TB_SVPD_CST_SVAS_IST_OJ_IZ S2
                        ON S1.CST_SV_ASN_NO = S2.CST_SV_ASN_NO
                     WHERE 1 = 1
                       AND S1.WK_PRGS_STAT_CD IN ('00', '10', '20')
                       AND S2.DTA_DL_YN = 'N'
                       AND S2.SV_BIZ_HCLSF_CD = '3' /* A/S(3) */
                       AND S2.MTR_STAT_CD != '3' /* 취소(3) */
                       AND S1.CST_SV_ASN_NO = #{cstSvAsnNo}
                UNION ALL
                    SELECT S1.CNTR_NO
                         , S1.CNTR_SN
                         , S1.CST_SV_ASN_NO
                         , S1.WK_EXCN_DT
                         , S1.CNFM_PSIC_PRTNR_OG_TP_CD AS WK_PRTNR_OG_TP_CD
                         , S1.CNFM_PSIC_PRTNR_NO AS WK_PRTNR_NO
                         , SUBSTR(S1.FST_RGST_DTM, 1, 8) AS RGST_DT
                         , '' AS_IST_OJ_NO
                         , S1.CNFM_PSIC_ASN_DT AS RCPDT
                         , S1.CNFM_PSIC_ASN_HH AS RCP_HH
                         , S2.PDCT_PD_CD AS PD_CD
                         , S1.SITE_AW_SV_TP_CD AS SV_BIZ_HCLSF_CD
                         , S1.SV_BIZ_DCLSF_CD
                         , '' CNSL_MO_CN
                      FROM TB_SVPD_CST_SV_BFSVC_ASN_IZ S1
                INNER JOIN TB_SVPD_CST_SV_BFSVC_OJ_IZ S2
                        ON S1.CST_SV_ASN_NO = S2.CST_SV_ASN_NO
                     WHERE 1 = 1
                       AND S1.VST_PRGS_STAT_CD IN ('00', '10', '20')
                       AND S2.DTA_DL_YN = 'N'
                       AND S1.CST_SV_ASN_NO = #{cstSvAsnNo}
                   ) T1
         LEFT JOIN TB_SVPD_CST_SV_WK_RS_IZ S1
                ON T1.CST_SV_ASN_NO = S1.CST_SV_ASN_NO
               AND S1.DTA_DL_YN = 'N'
        INNER JOIN TB_PDBS_PD_BAS P1
                ON T1.PD_CD = P1.PD_CD
        INNER JOIN TB_OGBS_MM_PRTNR_IZ O1
                ON SUBSTR(T1.WK_EXCN_DT, 1, 6) = O1.BASE_YM
               AND T1.WK_PRTNR_OG_TP_CD = O1.OG_TP_CD
               AND T1.WK_PRTNR_NO = O1.PRTNR_NO




        /* ASIS 쿼리ID bestDeptQuery.xml (selectChkhistdetail) */
        /* DESC : ASIS에는 MAT_NM 가져오는 로직 없음(구현 제외) */
    </select>

    <select id="selectCustomerInformation" resultType="com.kyowon.sms.wells.web.service.interfaces.dvo.WsniCustomerInformationDvo">
        SELECT T1.AS_AK_ID /* AS요청ID */
             , T1.SYS_DV_CD /* 시스템구분코드 */
             , C1.FST_RGST_DTM /* 최초등록일시 */
             , C1.FST_RGST_USR_ID /* 최초등록사용자ID */
             , O1.PRTNR_KNM /* 최초등록사용자명 */
             , O1.OG_CD /* 조직코드 */
             , O1.OG_NM /* 조직명 */
             , C1.CST_UNUITM_CN /* 고객특이사항내용 */
          FROM TB_IFIN_CST_CNR_AS_AK_RCV_ETXT T1 /* 고객센터AS요청수신전문 */
          LEFT OUTER JOIN (SELECT V1.CNTR_NO
                                , V1.CNTR_SN
                                , V1.DTL_SN
                                , V1.DTA_DL_YN
                                , V1.OG_TP_CD
                                , V1.WK_PRTNR_NO
                                , V1.CST_UNUITM_CN /* 고객특이사항내용 */
                                , V1.FST_RGST_DTM
                                , V1.FST_RGST_USR_ID
                             FROM TB_SVPD_CNTR_CST_UNUITM_DTL V1 /* 계약고객특이사항상세 */
                            WHERE V1.DTL_SN = (SELECT MAX(DTL_SN)
                                                 FROM TB_SVPD_CNTR_CST_UNUITM_DTL
                                                WHERE CNTR_NO = V1.CNTR_NO
                                                  AND CNTR_SN = V1.CNTR_SN
                                                  AND DTA_DL_YN = 'N')
             ) C1
            ON C1.CNTR_NO = T1.CNTR_NO
           AND C1.CNTR_SN = T1.CNTR_SN
          LEFT OUTER JOIN TB_OGBS_PRTNR_BAS O1 /* 파트너기본 */
            ON O1.OG_TP_CD = C1.OG_TP_CD
           AND O1.PRTNR_NO = C1.WK_PRTNR_NO
         WHERE T1.AS_AK_ID = #{asAkId}
           AND T1.CNTR_NO = #{cntrNo}
           AND T1.CNTR_SN = #{cntrSn}
    </select>

</mapper>
