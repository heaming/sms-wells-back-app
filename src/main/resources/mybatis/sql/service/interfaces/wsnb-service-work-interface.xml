<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.interfaces.mapper.WsnbServiceWorkInterfaceMapper">

    <select id="selectAsInstallationTarget" resultType="com.kyowon.sms.wells.web.service.interfaces.dvo.WsnbServiceWorkInterfaceDvo">
        SELECT V1.AS_IST_OJ_NO /* AS설치대상번호 */
             , V1.IN_CHNL_DV_CD /* 입력채널구분코드 */
             , V1.SV_BIZ_HCLSF_CD /* 서비스업무대분류코드 */
             , V1.RCPDT /* 접수일자 */
             , V1.CNTR_NO /* 계약번호 */
          FROM (SELECT ROW_NUMBER() OVER(PARTITION BY T1.CNTR_NO, T1.CNTR_SN ORDER BY FST_RGST_DTM DESC) AS RN
                     , T1.AS_IST_OJ_NO
                     , T1.IN_CHNL_DV_CD
                     , T1.SV_BIZ_HCLSF_CD
                     , T1.RCPDT
                     , T1.CNTR_NO
                  FROM TB_SVPD_CST_SVAS_IST_OJ_IZ T1 /* 고객서비스AS설치대상내역 */
                 WHERE T1.AS_IST_OJ_NO = #{asIstOjNo}
                   AND T1.CNTR_NO = #{cntrNo}
<!--                   AND T1.RCPDT = :rcpdt-->
             ) V1
         WHERE V1.RN = 1
    </select>

</mapper>
