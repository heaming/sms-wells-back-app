<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kyowon.sms.wells.web.service.adrwork.mapper.WsnfAsEnrgMatMngtMapper">

    <select id="selectAsEncourageMaterials" resultType="com.kyowon.sms.wells.web.service.adrwork.dvo.WsnfAsEnrgMatMngtDvo">
SELECT SVPD4.PDCT_PD_CD AS PD_CD /*품목코드*/
     , PDBS1.PD_ABBR_NM AS PD_NM /*상품명*/
     , SVPD4.ITM_PD_CD
     , (SELECT PD_ABBR_NM AS PD_NM FROM TB_PDBS_PD_BAS T WHERE T.PD_CD = SVPD4.ITM_PD_CD) AS ITM_PD_NM
     , (SELECT T.SAP_MAT_CD FROM TB_PDBS_PD_BAS T WHERE T.PD_CD = SVPD4.ITM_PD_CD) AS SAP_MAT_CD
     , CNSL_TP_LCSF_CD_NM
     , CNSL_CN
     , ITM_RCMD_RNK
     , ITM_RCMD_QTY
  FROM TB_SVPD_CST_SV_RCMD_ITM_IZ SVPD4
  LEFT OUTER JOIN CCSDBS.TB_CLASS_C TX /*상담유형소분류*/
    ON USE_FG = 'Y' AND JOB_CD = 'L001' AND TX.CNSL_TP_HCSF_CD = SVPD4.CNSL_TP_HCLSF_CD AND TX.CNSL_TP_MCSF_CD = SVPD4.CNSL_TP_MCLSF_CD AND TX.CNSL_TP_LCSF_CD = SVPD4.CNSL_TP_LCLSF_CD
  INNER JOIN TB_PDBS_PD_BAS PDBS1 /*상품기본*/
    ON PDBS1.DTA_DL_YN = 'N' AND SVPD4.PDCT_PD_CD = PDBS1.PD_CD
 WHERE SVPD4.DTA_DL_YN = 'N'
<!--       <choose>-->
<!--       <when test='@MybatisUtils@equals(dateType, "vstCnfmdt")'>-->
<!--       AND SVPD1.VST_CNFMDT BETWEEN #{dateValueFromDt} AND #{dateValueToDt} /*방문확정일*/-->
<!--       </when>-->
<!--       <when test='@MybatisUtils@equals(dateType, "rcpdt")'>-->
<!--       AND SVPD2.RCPDT BETWEEN #{dateValueFromDt} AND #{dateValueToDt} /*접수일자*/-->
<!--       </when>-->
<!--       <when test='@MybatisUtils@equals(dateType, "vstDuedt")'>-->
<!--       AND SVPD1.VST_DUEDT BETWEEN #{dateValueFromDt} AND #{dateValueToDt} /*예정일자*/-->
<!--       </when>-->
<!--       <when test='@MybatisUtils@equals(dateType, "wkExcnDt")'>-->
<!--       AND SVPD1.WK_EXCN_DT BETWEEN #{dateValueFromDt} AND #{dateValueToDt} /*처리일자*/-->
<!--       </when>-->
<!--       </choose>-->
       <if test="@MybatisUtils@isNotEmpty(pdCd)">
       AND SVPD4.PDCT_PD_CD = #{pdCd}
       </if>
<!--       <if test="@MybatisUtils@isNotEmpty(svTpCd)">-->
<!--       AND SVPD1.SV_BIZ_HCLSF_CD = #{svTpCd}-->
<!--       </if>-->
<!--       <if test="@MybatisUtils@isNotEmpty(prtnrNo)">-->
<!--       AND SVPD1.ICHR_PRTNR_NO = #{prtnrNo}-->
<!--       </if>-->
<!--       <if test="@MybatisUtils@isNotEmpty(ogId)">-->
<!--       AND OGBS1.OG_ID = #{ogId}-->
<!--       </if>-->
<!--       AND ITM_RCMD_RNK IS NOT NULL-->
<!--     GROUP BY PDBS1.SAP_MAT_CD, SVPD2.PD_CD, PDBS1.PD_NM, SVPD4.ITM_PD_CD, CNSL_TP_LCSF_CD_NM, CNSL_CN, ITM_RCMD_RNK-->
<!--     ORDER BY SVPD2.PD_CD DESC, ITM_RCMD_RNK ASC-->
    ORDER BY PDCT_PD_CD DESC, ITM_RCMD_RNK ASC
    </select>

</mapper>
